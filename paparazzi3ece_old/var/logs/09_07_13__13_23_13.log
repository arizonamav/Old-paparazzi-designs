<configuration time_of_day="1247516593.89" data_file="09_07_13__13_23_13.data">
  <conf>
    <aircraft name="blademdm" ac_id="32" airframe="airframes/blade_mdm.xml" radio="radios/T9cap.xml" telemetry="telemetry/debug.xml" settings="settings/tuning.xml" flight_plan="flight_plans/himmel_landing_new.xml">
      <flight_plan alt="800" ground_alt="750" lat0="32.23298" lon0="-110.93243" max_dist_from_home="500" name="himmel 2" qfu="180" security_height="20" wind_dir="60" wind_mod="3">
        <waypoints>
          <waypoint alt="800." name="HOME" x="-73.5401595418" y="34.2456246042"/>
          <waypoint alt="800." name="4" x="13.5556140051" y="42.7654076088"/>
        </waypoints>
        <blocks>
          <block name="init">
            <exception cond="(RcEvent1())" deroute="landing"/>
            <exception cond="(RcEvent2())" deroute="2wp loiter"/>
            <while cond="(!launch)"/>
            <attitude pitch="0.3" roll="0.0" throttle="1.0" until="(estimator_z > SECURITY_ALT)" vmode="throttle"/>
            <deroute block="2wp loiter"/>
          </block>
          <block name="2wp loiter">
            <exception cond="(RcEvent1())" deroute="init"/>
            <exception cond="(RcEvent2())" deroute="circle"/>
            <while>
              <go pitch="0.0" wp="4" approaching_time="1" throttle="auto" vmode="alt"/>
              <go pitch="0.0" wp="HOME" approaching_time="1" throttle="auto" vmode="alt"/>
            </while>
          </block>
          <block name="circle">
            <exception cond="(RcEvent2())" deroute="2wp loiter"/>
            <exception cond="(RcEvent1())" deroute="landing"/>
            <circle alt="GROUND_ALT+50" radius="25" wp="HOME"/>
          </block>
          <block name="landing">
            <exception cond="(RcEvent2())" deroute="circle"/>
            <exception cond="(RcEvent1())" deroute="init"/>
            <go alt="GROUND_ALT+40" wp="4"/>
            <go alt="GROUND_ALT" throttle="0.20" vmode="throttle" wp="HOME"/>
          </block>
        </blocks>
      </flight_plan>
      <airframe name="Blade with sound downlink">
        <servos>
          <servo name="GAZ" no="4" min="1000" neutral="1000" max="2000"/>
          <servo name="AILERON" no="0" min="2000" neutral="1600" max="1200"/>
          <servo name="ELEVATOR" no="1" min="2000" neutral="1600" max="1200"/>
          <servo name="RUDDER" no="2" max="1220" neutral="1530" min="1816"/>
        </servos>
        <commands>
          <axis name="THROTTLE" failsafe_value="0"/>
          <axis name="ROLL" failsafe_value="0"/>
          <axis name="PITCH" failsafe_value="0"/>
          <axis name="YAW" failsafe_value="0"/>
        </commands>
        <rc_commands>
          <set command="THROTTLE" value="@THROTTLE"/>
          <set command="ROLL" value="@ROLL"/>
          <set command="PITCH" value="@PITCH"/>
          <set command="YAW" value="@YAW"/>
        </rc_commands>
        <section name="MIXER">
          <define name="AILERON_DIFF" value="0.66"/>
          <define name="COMBI_SWITCH" value="1.0"/>
          <define name="PTCH_of_THRT" value="-0.05"/>
        </section>
        <command_laws>
          <set servo="GAZ" value="@THROTTLE"/>
          <set servo="AILERON" value="@ROLL"/>
          <set servo="ELEVATOR" value="@PITCH"/>
          <set servo="RUDDER" value="@YAW"/>
        </command_laws>
        <section name="adc" prefix="ADC_CHANNEL_">
          <define name="IR1" value="1"/>
          <define name="IR2" value="0"/>
          <define name="IR_NB_SAMPLES" value="16"/>
          <define name="GYRO_ROLL" value="2"/>
          <define name="GYRO_PITCH" value="3"/>
          <define name="GYRO_NB_SAMPLES" value="16"/>
          <define name="ACCEL_AX" value="6"/>
          <define name="ACCEL_AY" value="5"/>
          <define name="ACCEL_AZ" value="4"/>
          <define name="ACCEL_NB_SAMPLES" value="16"/>
        </section>
        <section name="AUTO1" prefix="AUTO1_">
          <define name="MAX_ROLL" value="RadOfDeg(40)"/>
          <define name="MAX_PITCH" value="RadOfDeg(40)"/>
        </section>
        <section name="INFRARED" prefix="IR_">
          <define name="ROLL_NEUTRAL_DEFAULT" value="6.3" unit="deg"/>
          <define name="PITCH_NEUTRAL_DEFAULT" value="-61" unit="deg"/>
          <define name="DEFAULT_CONTRAST" value="900"/>
          <define name="RAD_OF_IR_CONTRAST" value="1.7"/>
          <linear name="RollOfIrs" arity="2" coeff1="0.7" coeff2="-0.7"/>
          <linear name="PitchOfIrs" arity="2" coeff1="-0.7" coeff2="-0.7"/>
          <define name="RAD_OF_IR_MAX_VALUE" value="0.0045"/>
          <define name="RAD_OF_IR_MIN_VALUE" value="0.00075"/>
          <define name="ADC_ROLL_NEUTRAL" value="0"/>
          <define name="ADC_PITCH_NEUTRAL" value="0"/>
          <define name="ESTIMATED_PHI_PI_4" value="M_PI_4"/>
          <define name="CORRECTION_UP" value="1."/>
          <define name="CORRECTION_DOWN" value="1."/>
          <define name="CORRECTION_LEFT" value="1."/>
          <define name="CORRECTION_RIGHT" value="1."/>
        </section>
        <section name="GYRO" prefix="GYRO_">
          <define name="ADC_ROLL_NEUTRAL" value="329"/>
          <define name="ADC_PITCH_NEUTRAL" value="276"/>
          <define name="ROLL_SCALE" value="3.07"/>
          <define name="ROLL_DIRECTION" value="-1"/>
          <define name="PITCH_SCALE" value="2.52"/>
          <define name="PITCH_DIRECTION" value="1."/>
        </section>
        <section name="ACCEL" prefix="ACCEL_">
          <define name="AX_NEUTRAL" value="327"/>
          <define name="AY_NEUTRAL" value="667"/>
          <define name="AZ_NEUTRAL" value="658"/>
          <define name="AX_SCALE" value="0.03"/>
          <define name="AY_SCALE" value="0.03"/>
          <define name="AZ_SCALE" value="0.03"/>
        </section>
        <section name="BAT">
          <define name="MILLIAMP_PER_PERCENT" value="0.86"/>
          <define name="VOLTAGE_ADC_A" value="0.0177531"/>
          <define name="VOLTAGE_ADC_B" value="0.173626"/>
          <define name="VoltageOfAdc(adc)" value="(VOLTAGE_ADC_A * adc+VOLTAGE_ADC_B)"/>
          <define name="LOW_BATTERY" value="9.3" unit="V"/>
        </section>
        <section name="VERTICAL CONTROL" prefix="V_CTL_">
          <define name="ALTITUDE_PGAIN" value="-0.085"/>
          <define name="ALTITUDE_MAX_CLIMB" value="2."/>
          <define name="AUTO_THROTTLE_PGAIN" value="-0.021"/>
          <define name="AUTO_THROTTLE_IGAIN" value="0.0"/>
          <define name="AUTO_THROTTLE_PITCH_OF_VZ_PGAIN" value="0.05"/>
          <define name="AUTO_THROTTLE_DASH_TRIM" value="-1000"/>
          <define name="AUTO_THROTTLE_LOITER_TRIM" value="1500"/>
          <define name="AUTO_THROTTLE_CRUISE_THROTTLE" value="0.60"/>
          <define name="AUTO_THROTTLE_NOMINAL_CRUISE_THROTTLE" value="0.60"/>
          <define name="AUTO_THROTTLE_CLIMB_THROTTLE_INCREMENT" value="0.07" unit="%/(m/s)"/>
          <define name="AUTO_PITCH_PGAIN" value="-0.1"/>
          <define name="AUTO_PITCH_IGAIN" value="0.0"/>
          <define name="AUTO_PITCH_MAX_PITCH" value="0.35"/>
          <define name="AUTO_PITCH_MIN_PITCH" value="-0.35"/>
          <define name="THROTTLE_SLEW" value="0.05"/>
        </section>
        <section name="HORIZONTAL CONTROL" prefix="H_CTL_">
          <define name="COURSE_PGAIN" value="0.12"/>
          <define name="ROLL_MAX_SETPOINT" value="0.6" unit="radians"/>
          <define name="PITCH_MAX_SETPOINT" value="0.5" unit="radians"/>
          <define name="PITCH_MIN_SETPOINT" value="-0.5" unit="radians"/>
          <define name="ROLL_PGAIN" value="-12000."/>
          <define name="AILERON_OF_THROTTLE" value="0.0"/>
          <define name="PITCH_PGAIN" value="-8000."/>
          <define name="PITCH_DGAIN" value="0.0"/>
          <define name="ELEVATOR_OF_ROLL" value="2250"/>
          <define name="ROLL_RATE_MODE_DEFAULT" value="1"/>
          <define name="ROLL_RATE_SETPOINT_PGAIN" value="6.0" unit="1/s"/>
          <define name="ROLL_RATE_MAX_SETPOINT" value="10"/>
          <define name="LO_THROTTLE_ROLL_RATE_PGAIN" value="1700."/>
          <define name="HI_THROTTLE_ROLL_RATE_PGAIN" value="1400."/>
          <define name="ROLL_RATE_IGAIN" value="0."/>
          <define name="ROLL_RATE_DGAIN" value="0."/>
          <define name="ROLL_RATE_SUM_NB_SAMPLES" value="64"/>
        </section>
        <section name="THR">
          <define name="DASH_THR" value="1.0"/>
          <define name="LOITER_THR" value="0.50"/>
        </section>
        <section name="NAV">
          <define name="NAV_PITCH" value="0."/>
          <define name="NAV_GLIDE_PITCH_TRIM" value="0"/>
        </section>
        <section name="AGGRESSIVE" prefix="AGR_">
          <define name="BLEND_START" value="20"/>
          <define name="BLEND_END" value="10"/>
          <define name="CLIMB_THROTTLE" value="0.95"/>
          <define name="CLIMB_PITCH" value="0.3"/>
          <define name="DESCENT_THROTTLE" value="0.1"/>
          <define name="DESCENT_PITCH" value="-0.25"/>
          <define name="CLIMB_NAV_RATIO" value="0.8"/>
          <define name="DESCENT_NAV_RATIO" value="1.0"/>
        </section>
        <section name="MISC">
          <define name="NOMINAL_AIRSPEED" value="10." unit="m/s"/>
          <define name="CARROT" value="5." unit="s"/>
          <define name="KILL_MODE_DISTANCE" value="(MAX_DIST_FROM_HOME*1.5)" unit="m"/>
          <define name="XBEE_INIT" value="\"ATPL4\\rATRN1\\rATTT80\\rATBD3\\rATWR\\r\""/>
          <define name="NO_XBEE_API_INIT" value="TRUE"/>
          <define name="UNLOCKED_HOME_MODE" value="TRUE"/>
          <define name="RC_LOST_MODE" value="PPRZ_MODE_AUTO2"/>
        </section>
        <section name="GYRO">
          <define name="GYRO_MAX_RATE" value="500."/>
          <define name="ROLLRATESUM_NB_SAMPLES" value="60"/>
          <define name="ALT_ROLL_PGAIN" value="5.5"/>
          <define name="ROLL_RATE_PGAIN" value="860.0"/>
          <define name="ROLL_RATE_IGAIN" value="0.0"/>
          <define name="ROLL_RATE_DGAIN" value="0.0"/>
          <define name="CONFIDENCE_COEFF" value="34.0"/>
          <define name="J_FILTER" value="0"/>
        </section>
        <section name="SIMU">
          <define name="ROLL_RESPONSE_FACTOR" value="60."/>
          <define name="YAW_RESPONSE_FACTOR" value="0.6"/>
          <define name="WEIGHT" value="1.280"/>
        </section>
        <section name="FAILSAFE" prefix="FAILSAFE_">
          <define name="DELAY_WITHOUT_GPS" value="2" unit="s"/>
          <define name="DEFAULT_THROTTLE" value="0.1" unit="%"/>
          <define name="DEFAULT_ROLL" value="0.3" unit="rad"/>
          <define name="DEFAULT_PITCH" value="0.08" unit="rad"/>
          <define name="HOME_RADIUS" value="50" unit="m"/>
        </section>
        <section name="CAM" prefix="CAM_">
          <define name="THETA0" value="0" unit="deg"/>
          <define name="PHI0" value="0" unit="deg"/>
        </section>
        <section name="DATALINK" prefix="DATALINK_">
          <define name="DEVICE_TYPE" value="XBEE"/>
          <define name="DEVICE_ADDRESS" value="...."/>
        </section>
        <makefile>include $(PAPARAZZI_SRC)/conf/autopilot/v1_2_1.makefile
include $(PAPARAZZI_SRC)/conf/autopilot/twin_mcu_avr.makefile
ap.srcs += $(SRC_ARCH)/sys_time_hw.c
fbw.srcs += $(SRC_ARCH)/sys_time_hw.c
#--SERIAL MODE--------
#ap.CFLAGS += -DDOWNLINK -DUSE_UART0 -DDOWNLINK_TRANSPORT=PprzTransport 
#ap.CFLAGS += -DDOWNLINK_FBW_DEVICE=Uart0 -DDOWNLINK_AP_DEVICE=Uart0 
#ap.CFLAGS += -DPPRZ_UART=Uart0 -DUART0_BAUD=B9600
#ap.srcs += downlink.c $(SRC_ARCH)/uart_hw.c pprz_transport.c
#--API MODE-----------
ap.CFLAGS += -DDOWNLINK -DUSE_UART0 -DDOWNLINK_TRANSPORT=XBeeTransport 
ap.CFLAGS += -DDOWNLINK_FBW_DEVICE=Uart0 -DDOWNLINK_AP_DEVICE=Uart0 
ap.CFLAGS += -DXBEE_UART=Uart0 -DDATALINK=XBEE -DUART0_BAUD=B9600
ap.srcs += downlink.c $(SRC_ARCH)/uart_hw.c datalink.c xbee.c
ap.srcs += traffic_info.c
#ap.CFLAGS += -DRADIO_CONTROL_SETTINGS -DRADIO_CONTROL_TYPE=RC_FUTABA
#ap.srcs += rc_settings.c
ap.CFLAGS += -DRADIO_CONTROL_TYPE=RC_FUTABA
ap.CFLAGS += -DUART1_BAUD=B38400
ap.CFLAGS += -DGYRO -DIDG300 
ap.srcs += gyro.c
ap.CFLAGS += -DACCEL -DADXL330 
ap.srcs += accel.c
ap.CFLAGS += -DKALMAN_ROLL_PITCH 
ap.srcs += kalman_roll_pitch.c
ap.CFLAGS += -DH_CTL_RATE_LOOP 
#ap.CFLAGS += -DAGR_CLIMB -DLOITER_TRIM
# Config for SITL simulation
include $(PAPARAZZI_SRC)/conf/autopilot/sitl.makefile
sim.EXTRA_SRCS += traffic_info.c datalink.c</makefile>
      </airframe>
      <radio name="T9cap" data_min="900" data_max="2100" sync_min="5000" sync_max="15000">
        <channel ctl="right_stick_horiz" function="ROLL" min="1939" neutral="1525" max="1114" average="0"/>
        <channel ctl="right_stick_vert" function="PITCH" min="1112" neutral="1518" max="1937" average="0"/>
        <channel ctl="left_stick_vert" function="THROTTLE" min="1940" neutral="1940" max="1115" average="0"/>
        <channel ctl="left_stick_horiz" function="YAW" min="1940" neutral="1498" max="1115" average="0"/>
        <channel ctl="switch_G" function="CALIB" min="2080" neutral="1525" max="969" average="10"/>
        <channel ctl="VRA" function="GAIN1" min="970" neutral="1520" max="2078" average="10"/>
        <channel ctl="VRC" function="GAIN2" min="970" neutral="1518" max="2077" average="10"/>
        <channel ctl="switch_C" function="MODE" min="2079" neutral="1526" max="966" average="10"/>
      </radio>
    </aircraft>
    <aircraft name="zagi" ac_id="12" airframe="airframes/zagi_arm.xml" radio="radios/T9cap.xml" telemetry="telemetry/debug.xml" settings="settings/tuning_nogyro.xml" flight_plan="flight_plans/maxwell.xml">
      <flight_plan alt="833" ground_alt="758" lat0="32.22610" lon0="-111.02574" max_dist_from_home="500" name="maxwell" qfu="180" security_height="20" wind_dir="60" wind_mod="3">
        <waypoints>
          <waypoint name="HOME" x="11.6840794038" y="1.88159691589"/>
          <waypoint name="1" x="47.676852903" y="0.432076195721"/>
          <waypoint name="2" x="-28.6443295429" y="-2.43171868613"/>
        </waypoints>
        <blocks>
          <block name="init">
            <exception cond="(RcEvent1())" deroute="landing"/>
            <exception cond="(RcEvent2())" deroute="2wp loiter"/>
            <while cond="(!launch)"/>
            <attitude pitch="0.3" roll="0.0" throttle="1.0" until="(estimator_z > SECURITY_ALT)" vmode="throttle"/>
            <deroute block="2wp loiter"/>
          </block>
          <block name="2wp loiter">
            <exception cond="(RcEvent1())" deroute="init"/>
            <exception cond="(RcEvent2())" deroute="circle"/>
            <while>
              <go approaching_time="1" throttle="auto" vmode="alt" wp="1"/>
              <go approaching_time="1" throttle="auto" vmode="alt" wp="2"/>
            </while>
          </block>
          <block name="circle">
            <exception cond="(RcEvent2())" deroute="2wp loiter"/>
            <exception cond="(RcEvent1())" deroute="landing"/>
            <circle radius="40" wp="HOME"/>
          </block>
          <block name="landing">
            <exception cond="(RcEvent2())" deroute="circle"/>
            <exception cond="(RcEvent1())" deroute="init"/>
            <go alt="GROUND_ALT+8" wp="1"/>
            <go alt="GROUND_ALT" throttle="0.30" vmode="throttle" wp="2"/>
          </block>
        </blocks>
      </flight_plan>
      <airframe name="ZAGI ARM">
        <servos>
          <servo name="ELEVON1" no="0" min="1000" neutral="1500" max="2000"/>
          <servo name="ELEVON2" no="1" min="1000" neutral="1500" max="2000"/>
          <servo name="THR" no="3" min="1000" neutral="1000" max="2000"/>
        </servos>
        <commands>
          <axis name="THROTTLE" failsafe_value="0"/>
          <axis name="ROLL" failsafe_value="0"/>
          <axis name="PITCH" failsafe_value="0"/>
        </commands>
        <rc_commands>
          <set command="THROTTLE" value="@THROTTLE"/>
          <set command="ROLL" value="@ROLL"/>
          <set command="PITCH" value="@PITCH"/>
        </rc_commands>
        <section name="MIXER"/>
        <command_laws>
          <set servo="THR" value="@THROTTLE"/>
          <set servo="ELEVON1" value="-@PITCH+@ROLL"/>
          <set servo="ELEVON2" value="+@PITCH+@ROLL"/>
        </command_laws>
        <section name="adc" prefix="ADC_CHANNEL_">
          <define name="IR1" value="ADC_3"/>
          <define name="IR2" value="ADC_4"/>
          <define name="IR_NB_SAMPLES" value="16"/>
        </section>
        <section name="AUTO1" prefix="AUTO1_">
          <define name="MAX_ROLL" value="RadOfDeg(45)"/>
          <define name="MAX_PITCH" value="RadOfDeg(15)"/>
        </section>
        <section name="INFRARED" prefix="IR_">
          <define name="ROLL_NEUTRAL_DEFAULT" value="DegOfRad(0.)" unit="deg"/>
          <define name="PITCH_NEUTRAL_DEFAULT" value="0" unit="rad"/>
          <define name="DEFAULT_CONTRAST" value="900"/>
          <define name="RAD_OF_IR_CONTRAST" value="1.9"/>
          <linear name="RollOfIrs" arity="2" coeff1="0.7" coeff2="-0.7"/>
          <linear name="PitchOfIrs" arity="2" coeff1="-0.7" coeff2="-0.7"/>
          <define name="RAD_OF_IR_MAX_VALUE" value="0.0045"/>
          <define name="RAD_OF_IR_MIN_VALUE" value="0.00075"/>
          <define name="ADC_ROLL_NEUTRAL" value="0"/>
          <define name="ADC_PITCH_NEUTRAL" value="0"/>
          <define name="ESTIMATED_PHI_PI_4" value="M_PI_4*0.6"/>
          <define name="CORRECTION_UP" value="1.5"/>
          <define name="CORRECTION_DOWN" value="1.5"/>
          <define name="CORRECTION_LEFT" value="1.5"/>
          <define name="CORRECTION_RIGHT" value="1.5"/>
        </section>
        <section name="GYRO" prefix="GYRO_">
          <define name="ADC_ROLL_NEUTRAL" value="426"/>
          <define name="ADC_PITCH_NEUTRAL" value="535"/>
          <define name="ROLL_SCALE" value="0.5"/>
          <define name="ROLL_DIRECTION" value="-1"/>
          <define name="PITCH_SCALE" value="0.5"/>
          <define name="PITCH_DIRECTION" value="1."/>
        </section>
        <section name="ACCEL" prefix="ACCEL_">
          <define name="AX_NEUTRAL" value="528"/>
          <define name="AY_NEUTRAL" value="516"/>
          <define name="AZ_NEUTRAL" value="509"/>
          <define name="AX_SCALE" value="0.01"/>
          <define name="AY_SCALE" value="0.01"/>
          <define name="AZ_SCALE" value="0.01"/>
        </section>
        <section name="KALMAN" prefix="KALMAN_">
          <define name="Q_ANGLE" value="1e-1f"/>
          <define name="Q_GYRO" value="5e-1f"/>
          <define name="R_ANGLE" value="1e-3f"/>
        </section>
        <section name="BAT">
          <define name="MILLIAMP_PER_PERCENT" value="0.86"/>
          <define name="ADC_CHANNEL_VSUPPLY" value="AdcBank1(6)"/>
          <define name="VoltageOfAdc(adc)" value="(0.01787109375*adc)"/>
          <define name="LOW_BATTERY" value="9.3" unit="V"/>
        </section>
        <section name="VERTICAL CONTROL" prefix="V_CTL_">
          <define name="ALTITUDE_PGAIN" value="0.25"/>
          <define name="ALTITUDE_MAX_CLIMB" value="2."/>
          <define name="AUTO_THROTTLE_MIN_CRUISE_THROTTLE" value="0.35"/>
          <define name="AUTO_THROTTLE_MAX_CRUISE_THROTTLE" value="0.7"/>
          <define name="AUTO_THROTTLE_PGAIN" value="0.037"/>
          <define name="AUTO_THROTTLE_IGAIN" value="0.001"/>
          <define name="AUTO_THROTTLE_PITCH_OF_VZ_PGAIN" value="0.0"/>
          <define name="AUTO_THROTTLE_DASH_TRIM" value="1000"/>
          <define name="AUTO_THROTTLE_LOITER_TRIM" value="1500"/>
          <define name="AUTO_THROTTLE_CRUISE_THROTTLE" value="0.55"/>
          <define name="AUTO_THROTTLE_CRUISE_THROTTLE_PGAIN" value="0.005"/>
          <define name="AUTO_THROTTLE_NOMINAL_CRUISE_THROTTLE" value="0.55"/>
          <define name="AUTO_THROTTLE_CLIMB_THROTTLE_INCREMENT" value="0.051" unit="%/(m/s)"/>
          <define name="THROTTLE_SUM_NB_SAMPLES" value="32"/>
          <define name="AUTO_PITCH_PGAIN" value="0.1"/>
          <define name="AUTO_PITCH_IGAIN" value="0.0"/>
          <define name="AUTO_PITCH_MAX_PITCH" value="0.35"/>
          <define name="AUTO_PITCH_MIN_PITCH" value="-0.35"/>
          <define name="VDROP2THROTTLE" value="0"/>
          <define name="THROTTLE_SLEW" value="1.0"/>
        </section>
        <section name="HORIZONTAL CONTROL" prefix="H_CTL_">
          <define name="COURSE_PGAIN" value="0.25"/>
          <define name="ROLL_MAX_SETPOINT" value="RadOfDeg(40)" unit="radians"/>
          <define name="PITCH_MAX_SETPOINT" value="RadOfDeg(20)" unit="radians"/>
          <define name="PITCH_MIN_SETPOINT" value="RadOfDeg(-10)" unit="radians"/>
          <define name="YAW_MAX_SETPOINT" value="RadOfDeg(30)" unit="radians"/>
          <define name="ROLL_PGAIN" value="-12000."/>
          <define name="AILERON_OF_THROTTLE" value="0.0"/>
          <define name="PITCH_PGAIN" value="11950."/>
          <define name="PITCH_DGAIN" value="0.0"/>
          <define name="ELEVATOR_OF_ROLL" value="1000."/>
          <define name="ROLL_RATE_MODE_DEFAULT" value="1"/>
          <define name="PITCH_RATE_MODE_DEFAULT" value="1"/>
          <define name="YAW_RATE_MODE_DEFAULT" value="1"/>
          <define name="ROLL_RATE_SETPOINT_PGAIN" value="0.75" unit="1/s"/>
          <define name="ROLL_RATE_MAX_SETPOINT" value="10"/>
          <define name="PITCH_RATE_SETPOINT_PGAIN" value="0.75" unit="1/s"/>
          <define name="PITCH_RATE_MAX_SETPOINT" value="10"/>
          <define name="YAW_RATE_SETPOINT_PGAIN" value="0.75" unit="1/s"/>
          <define name="YAW_RATE_MAX_SETPOINT" value="10"/>
          <define name="LO_THROTTLE_ROLL_RATE_PGAIN" value="3000.0"/>
          <define name="HI_THROTTLE_ROLL_RATE_PGAIN" value="3000.0"/>
          <define name="LO_THROTTLE_PITCH_RATE_PGAIN" value="9000.0"/>
          <define name="HI_THROTTLE_PITCH_RATE_PGAIN" value="9000.0"/>
          <define name="LO_THROTTLE_YAW_RATE_PGAIN" value="0"/>
          <define name="HI_THROTTLE_YAW_RATE_PGAIN" value="0"/>
          <define name="ROLL_RATE_IGAIN" value="0."/>
          <define name="ROLL_RATE_DGAIN" value="0."/>
          <define name="ROLL_RATE_SUM_NB_SAMPLES" value="16"/>
          <define name="PITCH_RATE_IGAIN" value="0."/>
          <define name="PITCH_RATE_DGAIN" value="0."/>
          <define name="PITCH_RATE_SUM_NB_SAMPLES" value="16"/>
          <define name="YAW_RATE_IGAIN" value="0."/>
          <define name="YAW_RATE_DGAIN" value="0."/>
          <define name="YAW_RATE_SUM_NB_SAMPLES" value="16"/>
        </section>
        <section name="THR">
          <define name="DASH_THR" value="0.6"/>
          <define name="LOITER_THR" value="0.52"/>
        </section>
        <section name="NAV">
          <define name="NAV_PITCH" value="0."/>
          <define name="NAV_GLIDE_PITCH_TRIM" value="0"/>
        </section>
        <section name="AGGRESSIVE" prefix="AGR_">
          <define name="BLEND_START" value="10"/>
          <define name="BLEND_END" value="3"/>
          <define name="CLIMB_THROTTLE" value="0.70"/>
          <define name="CLIMB_PITCH" value="0.0"/>
          <define name="DESCENT_THROTTLE" value="0.40"/>
          <define name="DESCENT_PITCH" value="0.0"/>
          <define name="CLIMB_NAV_RATIO" value="0.8"/>
          <define name="DESCENT_NAV_RATIO" value="1.0"/>
        </section>
        <section name="FAILSAFE" prefix="FAILSAFE_">
          <define name="DEFAULT_THROTTLE" value="0.2" unit="%"/>
          <define name="DEFAULT_ROLL" value="0.3" unit="rad"/>
          <define name="DEFAULT_PITCH" value="0.1" unit="rad"/>
          <define name="HOME_RADIUS" value="50" unit="m"/>
        </section>
        <section name="SIMU">
          <define name="ROLL_RESPONSE_FACTOR" value="2."/>
          <define name="YAW_RESPONSE_FACTOR" value="1.35"/>
          <define name="WEIGHT" value="1.3"/>
        </section>
        <section name="MISC">
          <define name="NOMINAL_AIRSPEED" value="10." unit="m/s"/>
          <define name="CARROT" value="5." unit="s"/>
          <define name="KILL_MODE_DISTANCE" value="(MAX_DIST_FROM_HOME*1.5)" unit="m"/>
          <define name="AEROCOMM_INIT" value=""/>
          <define name="NO_API_INIT" value="TRUE"/>
          <define name="TRIGGER_DELAY" value="1.1"/>
          <define name="DEFAULT_CIRCLE_RADIUS" value="100."/>
        </section>
        <section name="DATALINK" prefix="DATALINK_">
          <define name="DEVICE_TYPE" value="AEROCOMM__"/>
          <define name="DEVICE_ADDRESS" value="...."/>
        </section>
        <makefile>include $(PAPARAZZI_SRC)/conf/autopilot/tiny.makefile
FLASH_MODE=ISP
ap.CFLAGS +=  -DFBW -DAP -DCONFIG=\&quot;tiny_0_99.h\&quot; -DLED -DTIME_LED=1
ap.srcs = sys_time.c $(SRC_ARCH)/sys_time_hw.c $(SRC_ARCH)/armVIC.c main_fbw.c main_ap.c main.c
ap.srcs += commands.c
ap.CFLAGS += -DACTUATORS=\&quot;servos_4015_MAT_hw.h\&quot; -DSERVOS_4015_MAT
ap.srcs += $(SRC_ARCH)/servos_4015_MAT_hw.c actuators.c
ap.CFLAGS += -DRADIO_CONTROL -DRADIO_CONTROL_TYPE=RC_FUTABA
ap.srcs += radio_control.c $(SRC_ARCH)/ppm_hw.c  
#ap.CFLAGS += -DDOWNLINK -DDOWNLINK_TRANSPORT=PprzTransport 
#ap.srcs += downlink.c $(SRC_ARCH)/uart_hw.c datalink.c pprz_transport.c
#ap.CFLAGS += -DDOWNLINK_FBW_DEVICE=Modem 
#ap.CFLAGS += -DDOWNLINK_AP_DEVICE=Modem 
#ap.CFLAGS += -DMODEM
#ap.srcs += $(SRC_ARCH)/modem_hw.c 
#--SERIAL MODE--------
#ap.CFLAGS += -DDOWNLINK -DUSE_UART0 -DDOWNLINK_TRANSPORT=PprzTransport 
#ap.CFLAGS += -DDOWNLINK_FBW_DEVICE=Uart0 -DDOWNLINK_AP_DEVICE=Uart0 
#ap.CFLAGS += -DPPRZ_UART=Uart0 -DUART0_BAUD=B9600
#ap.srcs += downlink.c $(SRC_ARCH)/uart_hw.c datalink.c pprz_transport.c
#ap.srcs += traffic_info.c
#--API MODE-----------
ap.CFLAGS += -DDOWNLINK -DUSE_UART0 -DDOWNLINK_TRANSPORT=AerocommTransport 
ap.CFLAGS += -DDOWNLINK_FBW_DEVICE=Uart0 -DDOWNLINK_AP_DEVICE=Uart0 
ap.CFLAGS += -DAEROCOMM_UART=Uart0 -DDATALINK=AEROCOMM -DUART0_BAUD=B9600
ap.srcs += downlink.c $(SRC_ARCH)/uart_hw.c datalink.c aerocomm_new.c
ap.srcs += traffic_info.c
ap.CFLAGS += -DINTER_MCU
ap.srcs += inter_mcu.c 
ap.CFLAGS += -DADC -DUSE_ADC_0 -DUSE_ADC_1 -DUSE_ADC_2 -DUSE_ADC_3 -DUSE_ADC_4
ap.srcs += $(SRC_ARCH)/adc_hw.c
ap.CFLAGS += -DGPS -DGPS_CONFIGURE -DUBX -DUSE_UART1 -DGPS_LINK=Uart1 -DUART1_BAUD=B38400
ap.srcs += gps_ubx.c gps.c
ap.CFLAGS += -DINFRARED 
ap.srcs += infrared.c 
#ap.CFLAGS += -DALT_KALMAN 
#ap.CFLAGS += -DIR_360
ap.srcs += estimator.c
#ap.CFLAGS += -DCTL_ROLL_RATE
#ap.CFLAGS += -DCTL_PITCH_RATE
#ap.CFLAGS += -DCTL_YAW_RATE
ap.CFLAGS += -DNAV 
ap.CFLAGS += -DAGR_CLIMB 
#ap.CFLAGS += -DLOITER_TRIM
ap.srcs += nav.c fw_h_ctl.c fw_v_ctl.c
#ap.CFLAGS += -DGYRO -DADXRS150 
#ap.srcs += gyro.c nav_line.c 
#ap.srcs += chemotaxis.c anemotaxis.c discsurvey.c
#ap.CFLAGS += -DGYRO -DIDG300 
#ap.srcs += gyro.c
#ap.CFLAGS += -DACCEL -DADXL330 
#ap.srcs += accel.c
#ap.CFLAGS += -DRANGE 
#ap.CFLAGS += -DRANGE_ALT 
#ap.CFLAGS += -DAUTO2_MANUAL_HOVERING 
#ap.srcs += range.c
#ap.CFLAGS += -DKALMAN_ROLL_PITCH 
#ap.srcs += kalman_roll_pitch.c
#ap.srcs += bomb.c
# Hack to use the same tuning file than slayer1
ap.CFLAGS += -DUSE_GPIO
ap.srcs += $(SRC_ARCH)/gpio.c
# Harware In The Loop
#ap.CFLAGS += -DHITL
# Config for SITL simulation
include $(PAPARAZZI_SRC)/conf/autopilot/sitl.makefile
sim.CFLAGS += -DCONFIG=\&quot;tiny.h\&quot; -DAGR_CLIMB -DH_CTL_RATE_LOOP
sim.srcs += bomb.c
# a test program to setup actuators 
setup_actuators.ARCHDIR = $(ARCHI)
setup_actuators.ARCH = arm7tdmi
setup_actuators.TARGET = setup_actuators
setup_actuators.TARGETDIR = setup_actuators
setup_actuators.CFLAGS += -DFBW -DCONFIG=\&quot;tiny.h\&quot; -DLED -DTIME_LED=1 -DACTUATORS=\&quot;servos_4015_hw.h\&quot; -DSERVOS_4015 -DUSE_UART0 -DUART0_BAUD=B9600 -DDATALINK=PPRZ -DPPRZ_UART=Uart0
setup_actuators.srcs += sys_time.c $(SRC_ARCH)/sys_time_hw.c $(SRC_ARCH)/armVIC.c pprz_transport.c setup_actuators.c $(SRC_ARCH)/uart_hw.c $(SRC_ARCH)/servos_4015_hw.c main.c
# a test program to tunnel between both uart
tunnel.ARCHDIR = $(ARCHI)
tunnel.ARCH = arm7tdmi
tunnel.TARGET = tunnel
tunnel.TARGETDIR = tunnel
tunnel.CFLAGS += -DFBW -DCONFIG=\&quot;tiny_0_99.h\&quot; -DLED -DTIME_LED=1
tunnel.srcs += $(SRC_ARCH)/uart_tunnel.c</makefile>
      </airframe>
      <radio name="T9cap" data_min="900" data_max="2100" sync_min="5000" sync_max="15000">
        <channel ctl="right_stick_horiz" function="ROLL" min="1939" neutral="1525" max="1114" average="0"/>
        <channel ctl="right_stick_vert" function="PITCH" min="1112" neutral="1518" max="1937" average="0"/>
        <channel ctl="left_stick_vert" function="THROTTLE" min="1940" neutral="1940" max="1115" average="0"/>
        <channel ctl="left_stick_horiz" function="YAW" min="1940" neutral="1498" max="1115" average="0"/>
        <channel ctl="switch_G" function="CALIB" min="2080" neutral="1525" max="969" average="10"/>
        <channel ctl="VRA" function="GAIN1" min="970" neutral="1520" max="2078" average="10"/>
        <channel ctl="VRC" function="GAIN2" min="970" neutral="1518" max="2077" average="10"/>
        <channel ctl="switch_C" function="MODE" min="2079" neutral="1526" max="966" average="10"/>
      </radio>
    </aircraft>
    <aircraft name="irtest" ac_id="33" airframe="airframes/irtest.xml" radio="radios/T9cap.xml" telemetry="telemetry/irtest.xml" settings="settings/tuning.xml" flight_plan="flight_plans/himmel_landing_new.xml">
      <flight_plan alt="800" ground_alt="750" lat0="32.23298" lon0="-110.93243" max_dist_from_home="500" name="himmel 2" qfu="180" security_height="20" wind_dir="60" wind_mod="3">
        <waypoints>
          <waypoint alt="800." name="HOME" x="-73.5401595418" y="34.2456246042"/>
          <waypoint alt="800." name="4" x="13.5556140051" y="42.7654076088"/>
        </waypoints>
        <blocks>
          <block name="init">
            <exception cond="(RcEvent1())" deroute="landing"/>
            <exception cond="(RcEvent2())" deroute="2wp loiter"/>
            <while cond="(!launch)"/>
            <attitude pitch="0.3" roll="0.0" throttle="1.0" until="(estimator_z > SECURITY_ALT)" vmode="throttle"/>
            <deroute block="2wp loiter"/>
          </block>
          <block name="2wp loiter">
            <exception cond="(RcEvent1())" deroute="init"/>
            <exception cond="(RcEvent2())" deroute="circle"/>
            <while>
              <go pitch="0.0" wp="4" approaching_time="1" throttle="auto" vmode="alt"/>
              <go pitch="0.0" wp="HOME" approaching_time="1" throttle="auto" vmode="alt"/>
            </while>
          </block>
          <block name="circle">
            <exception cond="(RcEvent2())" deroute="2wp loiter"/>
            <exception cond="(RcEvent1())" deroute="landing"/>
            <circle alt="GROUND_ALT+50" radius="25" wp="HOME"/>
          </block>
          <block name="landing">
            <exception cond="(RcEvent2())" deroute="circle"/>
            <exception cond="(RcEvent1())" deroute="init"/>
            <go alt="GROUND_ALT+40" wp="4"/>
            <go alt="GROUND_ALT" throttle="0.20" vmode="throttle" wp="HOME"/>
          </block>
        </blocks>
      </flight_plan>
      <airframe name="Zagi with sound downlink">
        <servos>
          <servo name="GAZ" no="3" min="1000" neutral="1000" max="2000"/>
          <servo name="AILERON_LEFT" no="0" max="1200" neutral="1600" min="2000"/>
          <servo name="AILERON_RIGHT" no="1" max="1200" neutral="1600" min="2000"/>
          <servo name="CAM_ROLL" no="2" max="1816" neutral="1530" min="1220"/>
        </servos>
        <commands>
          <axis name="THROTTLE" failsafe_value="0"/>
          <axis name="ROLL" failsafe_value="0"/>
          <axis name="PITCH" failsafe_value="0"/>
          <axis name="CAM_ROLL" failsafe_value="0"/>
          <axis name="CAM_PITCH" failsafe_value="0"/>
        </commands>
        <rc_commands>
          <set command="THROTTLE" value="@THROTTLE"/>
          <set command="ROLL" value="@ROLL"/>
          <set command="PITCH" value="@PITCH"/>
        </rc_commands>
        <section name="MIXER">
          <define name="AILERON_DIFF" value="0.66"/>
          <define name="COMBI_SWITCH" value="1.0"/>
        </section>
        <command_laws>
          <set servo="GAZ" value="2*@THROTTLE"/>
          <let var="roll" value="@ROLL"/>
          <let var="pitch" value="@PITCH"/>
          <set servo="AILERON_LEFT" value="($roll > 0 ? 1 : AILERON_DIFF)*$roll-$pitch"/>
          <set servo="AILERON_RIGHT" value="($roll > 0 ? 1 : AILERON_DIFF)*$roll+$pitch"/>
          <set servo="CAM_ROLL" value="@CAM_ROLL"/>
        </command_laws>
        <section name="adc" prefix="ADC_CHANNEL_">
          <define name="IR1" value="1"/>
          <define name="IR2" value="0"/>
          <define name="IR3" value="3"/>
          <define name="IR4" value="2"/>
        </section>
        <section name="AUTO1" prefix="AUTO1_">
          <define name="MAX_ROLL" value="0.6"/>
          <define name="MAX_PITCH" value="0.6"/>
        </section>
        <section name="INFRARED" prefix="IR_">
          <define name="ROLL_NEUTRAL_DEFAULT" value="0" unit="deg"/>
          <define name="PITCH_NEUTRAL_DEFAULT" value="6" unit="deg"/>
          <define name="DEFAULT_CONTRAST" value="900"/>
          <define name="RAD_OF_IR_CONTRAST" value="0.75"/>
          <linear name="RollOfIrs" arity="4" coeff1="1" coeff2="-1" coeff3="1" coeff4="-1"/>
          <linear name="PitchOfIrs" arity="4" coeff1="-1" coeff2="-1" coeff3="1" coeff4="-1"/>
          <define name="RAD_OF_IR_MAX_VALUE" value="0.0045"/>
          <define name="RAD_OF_IR_MIN_VALUE" value="0.00075"/>
          <define name="ADC_ROLL_NEUTRAL" value="0"/>
          <define name="ADC_PITCH_NEUTRAL" value="0"/>
        </section>
        <section name="PID">
          <define name="ROLL_PGAIN" value="3500."/>
          <define name="ROLL_DGAIN" value="1200.0"/>
          <define name="ROLL_IGAIN" value="3500.0"/>
          <define name="PITCH_OF_ROLL" value="0.0"/>
          <define name="PITCH_PGAIN" value="8000."/>
          <define name="MAX_ROLL" value="0.35"/>
          <define name="MAX_PITCH" value="0.35"/>
          <define name="MIN_PITCH" value="-0.35"/>
          <define name="AILERON_OF_GAZ" value="0.0"/>
          <define name="CAMERA_PGAIN" value="8000."/>
        </section>
        <section name="ALT" prefix="CLIMB_">
          <define name="PITCH_PGAIN" value="-0.1"/>
          <define name="PITCH_IGAIN" value="0.025"/>
          <define name="PGAIN" value="-0.03"/>
          <define name="IGAIN" value="0.1"/>
          <define name="MAX" value="1."/>
          <define name="LEVEL_GAZ" value="0.75"/>
          <define name="PITCH_OF_VZ_PGAIN" value="0.05"/>
          <define name="GAZ_OF_CLIMB" value="0.2" unit="%/(m/s)"/>
        </section>
        <section name="NAV">
          <define name="COURSE_PGAIN" value="-0.5"/>
          <define name="ALTITUDE_PGAIN" value="-0.025"/>
          <define name="NAV_PITCH" value="0."/>
        </section>
        <section name="BAT">
          <define name="MILLIAMP_PER_PERCENT" value="0.86"/>
          <define name="VOLTAGE_ADC_A" value="0.0164"/>
          <define name="VOLTAGE_ADC_B" value="0.088"/>
          <define name="VoltageOfAdc(adc)" value="(VOLTAGE_ADC_A * adc + VOLTAGE_ADC_B)"/>
          <define name="LOW_BATTERY" value="9.3" unit="V"/>
        </section>
        <section name="MISC">
          <define name="NOMINAL_AIRSPEED" value="10." unit="m/s"/>
          <define name="CARROT" value="5." unit="s"/>
        </section>
        <section name="SIMU">
          <define name="ROLL_RESPONSE_FACTOR" value="2."/>
          <define name="YAW_RESPONSE_FACTOR" value="1.25"/>
          <define name="WEIGHT" value="1.3"/>
        </section>
        <section name="FAILSAFE" prefix="FAILSAFE_">
          <define name="DELAY_WITHOUT_GPS" value="2" unit="s"/>
          <define name="DEFAULT_GAZ" value="CLIMB_LEVEL_GAZ+0.05" unit="%"/>
          <define name="DEFAULT_ROLL" value="0.0" unit="rad"/>
          <define name="DEFAULT_PITCH" value="0.08" unit="rad"/>
          <define name="HOME_RADIUS" value="50" unit="m"/>
        </section>
        <makefile>include $(PAPARAZZI_SRC)/conf/autopilot/v1_2_1.makefile
include $(PAPARAZZI_SRC)/conf/autopilot/twin_mcu_avr.makefile
ap.CFLAGS += -DRADIO_CONTROL_SETTINGS -DRADIO_CONTROL_TYPE=RC_FUTABA
ap.srcs += rc_settings.c
#--MODEM-----------
#ap.CFLAGS +=  -DDOWNLINK -DDOWNLINK_TRANSPORT=PprzTransport
#ap.srcs += pprz_transport.c downlink.c
#ap.CFLAGS += -DUART0 -DDOWNLINK_AP_DEVICE=Uart0
#ap.srcs += $(SRC_ARCH)/uart_hw.c 
#ap.CFLAGS += -DMODEM  -DDOWNLINK_AP_DEVICE=Modem
#ap.srcs += $(SRC_ARCH)/modem_hw.c 
#--SERIAL MODE--------
ap.CFLAGS += -DDOWNLINK -DUSE_UART0 -DDOWNLINK_TRANSPORT=PprzTransport 
ap.CFLAGS += -DDOWNLINK_FBW_DEVICE=Uart0 -DDOWNLINK_AP_DEVICE=Uart0 
ap.CFLAGS += -DPPRZ_UART=Uart0 -DUART0_BAUD=B9600
ap.srcs += downlink.c $(SRC_ARCH)/uart_hw.c pprz_transport.c
#--API MODE-----------
#ap.CFLAGS += -DDOWNLINK -DUSE_UART0 -DDOWNLINK_TRANSPORT=XBeeTransport 
#ap.CFLAGS += -DDOWNLINK_FBW_DEVICE=Uart0 -DDOWNLINK_AP_DEVICE=Uart0 
#ap.CFLAGS += -DXBEE_UART=Uart0 -DDATALINK=XBEE -DUART0_BAUD=B9600
#ap.srcs += downlink.c $(SRC_ARCH)/uart_hw.c datalink.c xbee.c
#ap.srcs += traffic_info.c
ap.CFLAGS += -DUART1_BAUD=B38400</makefile>
      </airframe>
      <radio name="T9cap" data_min="900" data_max="2100" sync_min="5000" sync_max="15000">
        <channel ctl="right_stick_horiz" function="ROLL" min="1939" neutral="1525" max="1114" average="0"/>
        <channel ctl="right_stick_vert" function="PITCH" min="1112" neutral="1518" max="1937" average="0"/>
        <channel ctl="left_stick_vert" function="THROTTLE" min="1940" neutral="1940" max="1115" average="0"/>
        <channel ctl="left_stick_horiz" function="YAW" min="1940" neutral="1498" max="1115" average="0"/>
        <channel ctl="switch_G" function="CALIB" min="2080" neutral="1525" max="969" average="10"/>
        <channel ctl="VRA" function="GAIN1" min="970" neutral="1520" max="2078" average="10"/>
        <channel ctl="VRC" function="GAIN2" min="970" neutral="1518" max="2077" average="10"/>
        <channel ctl="switch_C" function="MODE" min="2079" neutral="1526" max="966" average="10"/>
      </radio>
    </aircraft>
    <aircraft name="acctest" ac_id="40" airframe="airframes/acctest.xml" radio="radios/T9cap.xml" telemetry="telemetry/debug.xml" settings="settings/tuning_kalman.xml" flight_plan="flight_plans/himmel_landing_new.xml">
      <flight_plan alt="800" ground_alt="750" lat0="32.23298" lon0="-110.93243" max_dist_from_home="500" name="himmel 2" qfu="180" security_height="20" wind_dir="60" wind_mod="3">
        <waypoints>
          <waypoint alt="800." name="HOME" x="-73.5401595418" y="34.2456246042"/>
          <waypoint alt="800." name="4" x="13.5556140051" y="42.7654076088"/>
        </waypoints>
        <blocks>
          <block name="init">
            <exception cond="(RcEvent1())" deroute="landing"/>
            <exception cond="(RcEvent2())" deroute="2wp loiter"/>
            <while cond="(!launch)"/>
            <attitude pitch="0.3" roll="0.0" throttle="1.0" until="(estimator_z > SECURITY_ALT)" vmode="throttle"/>
            <deroute block="2wp loiter"/>
          </block>
          <block name="2wp loiter">
            <exception cond="(RcEvent1())" deroute="init"/>
            <exception cond="(RcEvent2())" deroute="circle"/>
            <while>
              <go pitch="0.0" wp="4" approaching_time="1" throttle="auto" vmode="alt"/>
              <go pitch="0.0" wp="HOME" approaching_time="1" throttle="auto" vmode="alt"/>
            </while>
          </block>
          <block name="circle">
            <exception cond="(RcEvent2())" deroute="2wp loiter"/>
            <exception cond="(RcEvent1())" deroute="landing"/>
            <circle alt="GROUND_ALT+50" radius="25" wp="HOME"/>
          </block>
          <block name="landing">
            <exception cond="(RcEvent2())" deroute="circle"/>
            <exception cond="(RcEvent1())" deroute="init"/>
            <go alt="GROUND_ALT+40" wp="4"/>
            <go alt="GROUND_ALT" throttle="0.20" vmode="throttle" wp="HOME"/>
          </block>
        </blocks>
      </flight_plan>
      <airframe name="kalman filter test">
        <servos>
          <servo name="GAZ" no="4" min="1000" neutral="1000" max="2000"/>
          <servo name="AILERON" no="0" min="2000" neutral="1600" max="1200"/>
          <servo name="ELEVATOR" no="1" min="2000" neutral="1600" max="1200"/>
          <servo name="RUDDER" no="2" max="1220" neutral="1530" min="1816"/>
        </servos>
        <commands>
          <axis name="THROTTLE" failsafe_value="0"/>
          <axis name="ROLL" failsafe_value="0"/>
          <axis name="PITCH" failsafe_value="0"/>
        </commands>
        <rc_commands>
          <set command="THROTTLE" value="@THROTTLE"/>
          <set command="ROLL" value="@ROLL"/>
          <set command="PITCH" value="@PITCH"/>
        </rc_commands>
        <section name="MIXER">
          <define name="AILERON_DIFF" value="0.66"/>
          <define name="COMBI_SWITCH" value="1.0"/>
          <define name="PTCH_of_THRT" value="-0.05"/>
        </section>
        <command_laws>
          <set servo="GAZ" value="@THROTTLE"/>
          <set servo="AILERON" value="@ROLL"/>
          <set servo="ELEVATOR" value="@PITCH"/>
          <set servo="RUDDER" value="@YAW"/>
        </command_laws>
        <section name="adc" prefix="ADC_CHANNEL_">
          <define name="IR1" value="6"/>
          <define name="IR2" value="5"/>
          <define name="IR_NB_SAMPLES" value="16"/>
          <define name="GYRO_ROLL" value="0"/>
          <define name="GYRO_PITCH" value="1"/>
          <define name="GYRO_NB_SAMPLES" value="16"/>
          <define name="ACCEL_AX" value="4"/>
          <define name="ACCEL_AY" value="3"/>
          <define name="ACCEL_AZ" value="2"/>
          <define name="ACCEL_NB_SAMPLES" value="16"/>
        </section>
        <section name="AUTO1" prefix="AUTO1_">
          <define name="MAX_ROLL" value="RadOfDeg(40)"/>
          <define name="MAX_PITCH" value="RadOfDeg(40)"/>
        </section>
        <section name="INFRARED" prefix="IR_">
          <define name="ROLL_NEUTRAL_DEFAULT" value="6.3" unit="deg"/>
          <define name="PITCH_NEUTRAL_DEFAULT" value="-61" unit="deg"/>
          <define name="DEFAULT_CONTRAST" value="900"/>
          <define name="RAD_OF_IR_CONTRAST" value="1.7"/>
          <linear name="RollOfIrs" arity="2" coeff1="0.7" coeff2="-0.7"/>
          <linear name="PitchOfIrs" arity="2" coeff1="-0.7" coeff2="-0.7"/>
          <define name="RAD_OF_IR_MAX_VALUE" value="0.0045"/>
          <define name="RAD_OF_IR_MIN_VALUE" value="0.00075"/>
          <define name="ADC_ROLL_NEUTRAL" value="0"/>
          <define name="ADC_PITCH_NEUTRAL" value="0"/>
          <define name="ESTIMATED_PHI_PI_4" value="M_PI_4"/>
          <define name="CORRECTION_UP" value="1."/>
          <define name="CORRECTION_DOWN" value="1."/>
          <define name="CORRECTION_LEFT" value="1."/>
          <define name="CORRECTION_RIGHT" value="1."/>
        </section>
        <section name="GYRO" prefix="GYRO_">
          <define name="ADC_ROLL_NEUTRAL" value="329"/>
          <define name="ADC_PITCH_NEUTRAL" value="276"/>
          <define name="ROLL_SCALE" value="3.07"/>
          <define name="ROLL_DIRECTION" value="-1"/>
          <define name="PITCH_SCALE" value="2.52"/>
          <define name="PITCH_DIRECTION" value="1."/>
        </section>
        <section name="ACCEL" prefix="ACCEL_">
          <define name="AX_NEUTRAL" value="327"/>
          <define name="AY_NEUTRAL" value="667"/>
          <define name="AZ_NEUTRAL" value="658"/>
          <define name="AX_SCALE" value="0.03"/>
          <define name="AY_SCALE" value="0.03"/>
          <define name="AZ_SCALE" value="0.03"/>
        </section>
        <section name="BAT">
          <define name="MILLIAMP_PER_PERCENT" value="0.86"/>
          <define name="VOLTAGE_ADC_A" value="0.0177531"/>
          <define name="VOLTAGE_ADC_B" value="0.173626"/>
          <define name="VoltageOfAdc(adc)" value="(VOLTAGE_ADC_A * adc+VOLTAGE_ADC_B)"/>
          <define name="LOW_BATTERY" value="9.3" unit="V"/>
        </section>
        <section name="VERTICAL CONTROL" prefix="V_CTL_">
          <define name="ALTITUDE_PGAIN" value="-0.085"/>
          <define name="ALTITUDE_MAX_CLIMB" value="2."/>
          <define name="AUTO_THROTTLE_PGAIN" value="-0.021"/>
          <define name="AUTO_THROTTLE_IGAIN" value="0.0"/>
          <define name="AUTO_THROTTLE_PITCH_OF_VZ_PGAIN" value="0.05"/>
          <define name="AUTO_THROTTLE_DASH_TRIM" value="-1000"/>
          <define name="AUTO_THROTTLE_LOITER_TRIM" value="1500"/>
          <define name="AUTO_THROTTLE_CRUISE_THROTTLE" value="0.60"/>
          <define name="AUTO_THROTTLE_NOMINAL_CRUISE_THROTTLE" value="0.60"/>
          <define name="AUTO_THROTTLE_CLIMB_THROTTLE_INCREMENT" value="0.07" unit="%/(m/s)"/>
          <define name="AUTO_PITCH_PGAIN" value="-0.1"/>
          <define name="AUTO_PITCH_IGAIN" value="0.0"/>
          <define name="AUTO_PITCH_MAX_PITCH" value="0.35"/>
          <define name="AUTO_PITCH_MIN_PITCH" value="-0.35"/>
          <define name="THROTTLE_SLEW" value="0.05"/>
          <define name="THROTTLE_SUM_NB_SAMPLES" value="32"/>
        </section>
        <section name="HORIZONTAL CONTROL" prefix="H_CTL_">
          <define name="COURSE_PGAIN" value="0.12"/>
          <define name="ROLL_MAX_SETPOINT" value="0.6" unit="radians"/>
          <define name="PITCH_MAX_SETPOINT" value="0.5" unit="radians"/>
          <define name="PITCH_MIN_SETPOINT" value="-0.5" unit="radians"/>
          <define name="ROLL_PGAIN" value="-12000."/>
          <define name="AILERON_OF_THROTTLE" value="0.0"/>
          <define name="PITCH_PGAIN" value="-8000."/>
          <define name="PITCH_DGAIN" value="0.0"/>
          <define name="ELEVATOR_OF_ROLL" value="2250"/>
          <define name="ROLL_RATE_MODE_DEFAULT" value="1"/>
          <define name="ROLL_RATE_SETPOINT_PGAIN" value="6.0" unit="1/s"/>
          <define name="ROLL_RATE_MAX_SETPOINT" value="10"/>
          <define name="LO_THROTTLE_ROLL_RATE_PGAIN" value="1700."/>
          <define name="HI_THROTTLE_ROLL_RATE_PGAIN" value="1400."/>
          <define name="ROLL_RATE_IGAIN" value="0."/>
          <define name="ROLL_RATE_DGAIN" value="0."/>
          <define name="ROLL_RATE_SUM_NB_SAMPLES" value="64"/>
        </section>
        <section name="THR">
          <define name="DASH_THR" value="1.0"/>
          <define name="LOITER_THR" value="0.50"/>
        </section>
        <section name="NAV">
          <define name="NAV_PITCH" value="0."/>
          <define name="NAV_GLIDE_PITCH_TRIM" value="0"/>
        </section>
        <section name="AGGRESSIVE" prefix="AGR_">
          <define name="BLEND_START" value="20"/>
          <define name="BLEND_END" value="10"/>
          <define name="CLIMB_THROTTLE" value="0.95"/>
          <define name="CLIMB_PITCH" value="0.3"/>
          <define name="DESCENT_THROTTLE" value="0.1"/>
          <define name="DESCENT_PITCH" value="-0.25"/>
          <define name="CLIMB_NAV_RATIO" value="0.8"/>
          <define name="DESCENT_NAV_RATIO" value="1.0"/>
        </section>
        <section name="KALMAN" prefix="KALMAN_">
          <define name="Q_ANGLE" value="1e-1f"/>
          <define name="Q_GYRO" value="5e-1f"/>
          <define name="R_ANGLE" value="1e-3f"/>
        </section>
        <section name="MISC">
          <define name="NOMINAL_AIRSPEED" value="10." unit="m/s"/>
          <define name="CARROT" value="5." unit="s"/>
          <define name="KILL_MODE_DISTANCE" value="(MAX_DIST_FROM_HOME*1.5)" unit="m"/>
          <define name="XBEE_INIT" value="\"ATPL4\\rATRN1\\rATTT80\\rATBD3\\rATWR\\r\""/>
          <define name="UNLOCKED_HOME_MODE" value="TRUE"/>
          <define name="RC_LOST_MODE" value="PPRZ_MODE_AUTO2"/>
        </section>
        <section name="GYRO">
          <define name="GYRO_MAX_RATE" value="500."/>
          <define name="ROLLRATESUM_NB_SAMPLES" value="60"/>
          <define name="ALT_ROLL_PGAIN" value="5.5"/>
          <define name="ROLL_RATE_PGAIN" value="860.0"/>
          <define name="ROLL_RATE_IGAIN" value="0.0"/>
          <define name="ROLL_RATE_DGAIN" value="0.0"/>
          <define name="CONFIDENCE_COEFF" value="34.0"/>
          <define name="J_FILTER" value="0"/>
        </section>
        <section name="SIMU">
          <define name="ROLL_RESPONSE_FACTOR" value="60."/>
          <define name="YAW_RESPONSE_FACTOR" value="0.6"/>
          <define name="WEIGHT" value="1.280"/>
        </section>
        <section name="FAILSAFE" prefix="FAILSAFE_">
          <define name="DELAY_WITHOUT_GPS" value="2" unit="s"/>
          <define name="DEFAULT_THROTTLE" value="0.1" unit="%"/>
          <define name="DEFAULT_ROLL" value="0.3" unit="rad"/>
          <define name="DEFAULT_PITCH" value="0.08" unit="rad"/>
          <define name="HOME_RADIUS" value="50" unit="m"/>
        </section>
        <section name="CAM" prefix="CAM_">
          <define name="THETA0" value="0" unit="deg"/>
          <define name="PHI0" value="0" unit="deg"/>
        </section>
        <section name="DATALINK" prefix="DATALINK_">
          <define name="DEVICE_TYPE" value="XBEE"/>
          <define name="DEVICE_ADDRESS" value="...."/>
        </section>
        <makefile>include $(PAPARAZZI_SRC)/conf/autopilot/v1_2_1.makefile
include $(PAPARAZZI_SRC)/conf/autopilot/twin_mcu_avr.makefile
ap.srcs += $(SRC_ARCH)/sys_time_hw.c
fbw.srcs += $(SRC_ARCH)/sys_time_hw.c
#--SERIAL MODE--------
#ap.CFLAGS += -DDOWNLINK -DUSE_UART0 -DDOWNLINK_TRANSPORT=PprzTransport 
#ap.CFLAGS += -DDOWNLINK_FBW_DEVICE=Uart0 -DDOWNLINK_AP_DEVICE=Uart0 
#ap.CFLAGS += -DPPRZ_UART=Uart0 -DUART0_BAUD=B9600
#ap.srcs += downlink.c $(SRC_ARCH)/uart_hw.c pprz_transport.c
#--API MODE-----------
ap.CFLAGS += -DDOWNLINK -DUSE_UART0 -DDOWNLINK_TRANSPORT=XBeeTransport 
ap.CFLAGS += -DDOWNLINK_FBW_DEVICE=Uart0 -DDOWNLINK_AP_DEVICE=Uart0 
ap.CFLAGS += -DXBEE_UART=Uart0 -DDATALINK=XBEE -DUART0_BAUD=B9600
ap.srcs += downlink.c $(SRC_ARCH)/uart_hw.c datalink.c xbee.c
ap.srcs += traffic_info.c
#ap.CFLAGS += -DRADIO_CONTROL_SETTINGS -DRADIO_CONTROL_TYPE=RC_FUTABA
#ap.srcs += rc_settings.c
ap.CFLAGS += -DRADIO_CONTROL_TYPE=RC_FUTABA
ap.CFLAGS += -DUART1_BAUD=B38400
ap.CFLAGS += -DGYRO -DIDG300 
ap.srcs += gyro.c
ap.CFLAGS += -DACCEL -DADXL330 
ap.srcs += accel.c
ap.CFLAGS += -DKALMAN_ROLL_PITCH 
ap.srcs += kalman_roll_pitch.c
ap.CFLAGS += -DH_CTL_RATE_LOOP 
#ap.CFLAGS += -DAGR_CLIMB -DLOITER_TRIM
# Config for SITL simulation
include $(PAPARAZZI_SRC)/conf/autopilot/sitl.makefile
sim.EXTRA_SRCS += traffic_info.c datalink.c</makefile>
      </airframe>
      <radio name="T9cap" data_min="900" data_max="2100" sync_min="5000" sync_max="15000">
        <channel ctl="right_stick_horiz" function="ROLL" min="1939" neutral="1525" max="1114" average="0"/>
        <channel ctl="right_stick_vert" function="PITCH" min="1112" neutral="1518" max="1937" average="0"/>
        <channel ctl="left_stick_vert" function="THROTTLE" min="1940" neutral="1940" max="1115" average="0"/>
        <channel ctl="left_stick_horiz" function="YAW" min="1940" neutral="1498" max="1115" average="0"/>
        <channel ctl="switch_G" function="CALIB" min="2080" neutral="1525" max="969" average="10"/>
        <channel ctl="VRA" function="GAIN1" min="970" neutral="1520" max="2078" average="10"/>
        <channel ctl="VRC" function="GAIN2" min="970" neutral="1518" max="2077" average="10"/>
        <channel ctl="switch_C" function="MODE" min="2079" neutral="1526" max="966" average="10"/>
      </radio>
    </aircraft>
    <aircraft name="ver" ac_id="10" airframe="airframes/vertigo_arm.xml" radio="radios/T9cap.xml" telemetry="telemetry/debug.xml" settings="settings/tuning_ver.xml" flight_plan="flight_plans/indoors.xml">
      <flight_plan ground_alt="700." lat0="43.5389" lon0="1.2433" max_dist_from_home="1750." name="hovering indoors" qfu="180." alt="702.0" security_height="0.02" wind_dir="60" wind_mod="3">
        <header/>
        <waypoints>
          <waypoint alt="702" name="HOME" x="753.859003724" y="-51.1591526465"/>
        </waypoints>
        <blocks/>
      </flight_plan>
      <airframe name="DRAGONFLY ARM">
        <servos>
          <servo name="AILERON1" no="0" min="1000" neutral="1500" max="2000"/>
          <servo name="AILERON2" no="1" min="1000" neutral="1500" max="2000"/>
          <servo name="THROTTLE" no="3" min="1100" neutral="1200" max="2000"/>
          <servo name="RUDDER" no="4" min="1000" neutral="1500" max="2000"/>
        </servos>
        <commands>
          <axis name="THROTTLE" failsafe_value="0"/>
          <axis name="ROLL" failsafe_value="0"/>
          <axis name="PITCH" failsafe_value="0"/>
          <axis name="YAW" failsafe_value="0"/>
        </commands>
        <rc_commands>
          <set command="THROTTLE" value="@THROTTLE"/>
          <set command="ROLL" value="@ROLL"/>
          <set command="PITCH" value="@PITCH"/>
          <set command="YAW" value="@YAW"/>
        </rc_commands>
        <section name="MIXER">
          <define name="AILEVON_AILERON_RATE" value="0.8"/>
          <define name="AILEVON_ELEVATOR_RATE" value="0.8"/>
          <define name="ROLL_TGAIN" value="0.005"/>
          <define name="PITCH_TGAIN" value="-0.0"/>
        </section>
        <command_laws>
          <set servo="THROTTLE" value="@THROTTLE-(vsupply-110.0f)*vdrop2throt_coeff"/>
          <let var="roll" value="@ROLL"/>
          <let var="rollofthr" value="@THROTTLE * ROLL_TGAIN"/>
          <let var="pitch" value="@PITCH"/>
          <let var="pitchofthr" value="@THROTTLE * PITCH_TGAIN"/>
          <set servo="AILERON1" value="-$roll-$pitch"/>
          <set servo="AILERON2" value="-$roll+$pitch"/>
          <set servo="RUDDER" value="-@YAW"/>
        </command_laws>
        <section name="adc" prefix="ADC_CHANNEL_">
          <define name="GYRO_ROLL" value="ADC_0"/>
          <define name="GYRO_PITCH" value="ADC_1"/>
          <define name="GYRO_YAW" value="ADC_2"/>
          <define name="GYRO_NB_SAMPLES" value="16"/>
          <define name="RANGE" value="ADC_3"/>
          <define name="RANGE_NB_SAMPLES" value="1"/>
        </section>
        <section name="AUTO1" prefix="AUTO1_">
          <define name="MAX_ROLL" value="RadOfDeg(30)"/>
          <define name="MAX_PITCH" value="RadOfDeg(30)"/>
          <define name="MAX_YAW" value="RadOfDeg(30)"/>
        </section>
        <section name="INFRARED" prefix="IR_">
          <define name="ROLL_NEUTRAL_DEFAULT" value="DegOfRad(-0.003)" unit="deg"/>
          <define name="PITCH_NEUTRAL_DEFAULT" value="DegOfRad(-1.178)" unit="deg"/>
          <define name="DEFAULT_CONTRAST" value="900"/>
          <define name="RAD_OF_IR_CONTRAST" value="1.9"/>
          <linear name="RollOfIrs" arity="2" coeff1="0.7" coeff2="-0.7"/>
          <linear name="PitchOfIrs" arity="2" coeff1="-0.7" coeff2="-0.7"/>
          <define name="RAD_OF_IR_MAX_VALUE" value="0.0045"/>
          <define name="RAD_OF_IR_MIN_VALUE" value="0.00075"/>
          <define name="ADC_ROLL_NEUTRAL" value="0"/>
          <define name="ADC_PITCH_NEUTRAL" value="0"/>
          <define name="ESTIMATED_PHI_PI_4" value="M_PI_4*0.6"/>
          <define name="CORRECTION_UP" value="1.5"/>
          <define name="CORRECTION_DOWN" value="1.5"/>
          <define name="CORRECTION_LEFT" value="1.5"/>
          <define name="CORRECTION_RIGHT" value="1.5"/>
        </section>
        <section name="GYRO" prefix="GYRO_">
          <define name="ADC_ROLL_NEUTRAL" value="466"/>
          <define name="ADC_PITCH_NEUTRAL" value="492"/>
          <define name="ADC_YAW_NEUTRAL" value="461"/>
          <define name="ROLL_SCALE" value="0.5"/>
          <define name="ROLL_DIRECTION" value="-1"/>
          <define name="PITCH_SCALE" value="0.5"/>
          <define name="PITCH_DIRECTION" value="-1."/>
          <define name="YAW_SCALE" value="0.5"/>
          <define name="YAW_DIRECTION" value="1."/>
        </section>
        <section name="ACCEL" prefix="ACCEL_">
          <define name="AX_NEUTRAL" value="528"/>
          <define name="AY_NEUTRAL" value="516"/>
          <define name="AZ_NEUTRAL" value="509"/>
          <define name="AX_SCALE" value="0.01"/>
          <define name="AY_SCALE" value="0.01"/>
          <define name="AZ_SCALE" value="0.01"/>
        </section>
        <section name="RANGE" prefix="RANGE_">
          <define name="NEUTRAL" value="0"/>
          <define name="SCALE" value="1.35"/>
          <define name="DIRECTION" value="1."/>
        </section>
        <section name="KALMAN" prefix="KALMAN_">
          <define name="Q_ANGLE" value="1e-1f"/>
          <define name="Q_GYRO" value="5e-1f"/>
          <define name="R_ANGLE" value="1e-3f"/>
        </section>
        <section name="BAT">
          <define name="MILLIAMP_PER_PERCENT" value="0.86"/>
          <define name="ADC_CHANNEL_VSUPPLY" value="AdcBank1(6)"/>
          <define name="VoltageOfAdc(adc)" value="(0.01787109375*adc)"/>
          <define name="LOW_BATTERY" value="9.3" unit="V"/>
        </section>
        <section name="VERTICAL CONTROL" prefix="V_CTL_">
          <define name="ALTITUDE_PGAIN" value="0.3"/>
          <define name="ALTITUDE_MAX_CLIMB" value="2."/>
          <define name="AUTO_THROTTLE_MIN_CRUISE_THROTTLE" value="0.35"/>
          <define name="AUTO_THROTTLE_MAX_CRUISE_THROTTLE" value="0.45"/>
          <define name="AUTO_THROTTLE_PGAIN_PLUS" value="0.02"/>
          <define name="AUTO_THROTTLE_PGAIN_MINUS" value="0.02"/>
          <define name="AUTO_THROTTLE_IGAIN" value="0.0"/>
          <define name="AUTO_THROTTLE_IGAIN_PLUS" value="0.0"/>
          <define name="AUTO_THROTTLE_IGAIN_MINUS" value="0.0"/>
          <define name="AUTO_THROTTLE_PITCH_OF_VZ_PGAIN" value="0.0"/>
          <define name="AUTO_THROTTLE_DASH_TRIM" value="1000"/>
          <define name="AUTO_THROTTLE_LOITER_TRIM" value="1500"/>
          <define name="AUTO_THROTTLE_CRUISE_THROTTLE" value="0.488"/>
          <define name="AUTO_THROTTLE_CRUISE_THROTTLE_PGAIN" value="0.01"/>
          <define name="AUTO_THROTTLE_NOMINAL_CRUISE_THROTTLE" value="0.47"/>
          <define name="AUTO_THROTTLE_CLIMB_THROTTLE_INCREMENT_PLUS" value="0.02" unit="%/(m/s)"/>
          <define name="AUTO_THROTTLE_CLIMB_THROTTLE_INCREMENT_MINUS" value="0.02" unit="%/(m/s)"/>
          <define name="THROTTLE_SUM_NB_SAMPLES" value="32"/>
          <define name="AUTO_PITCH_PGAIN" value="0.1"/>
          <define name="AUTO_PITCH_IGAIN" value="0.0"/>
          <define name="AUTO_PITCH_MAX_PITCH" value="0.35"/>
          <define name="AUTO_PITCH_MIN_PITCH" value="-0.35"/>
          <define name="VDROP2THROTTLE" value="0"/>
          <define name="THROTTLE_SLEW" value="1.0"/>
        </section>
        <section name="HORIZONTAL CONTROL" prefix="H_CTL_">
          <define name="COURSE_PGAIN" value="0.5"/>
          <define name="ROLL_MAX_SETPOINT" value="0.3" unit="radians"/>
          <define name="YAW_MAX_SETPOINT" value="0.3" unit="radians"/>
          <define name="PITCH_MAX_SETPOINT" value="0.3" unit="radians"/>
          <define name="PITCH_MIN_SETPOINT" value="-0.1" unit="radians"/>
          <define name="ROLL_PGAIN" value="-12000."/>
          <define name="AILERON_OF_THROTTLE" value="0.0"/>
          <define name="PITCH_PGAIN" value="11950."/>
          <define name="PITCH_DGAIN" value="0.0"/>
          <define name="ELEVATOR_OF_ROLL" value="0."/>
          <define name="ROLL_RATE_MODE_DEFAULT" value="1"/>
          <define name="PITCH_RATE_MODE_DEFAULT" value="1"/>
          <define name="YAW_RATE_MODE_DEFAULT" value="1"/>
          <define name="ROLL_RATE_SETPOINT_PGAIN" value="0.75" unit="1/s"/>
          <define name="ROLL_RATE_MAX_SETPOINT" value="10"/>
          <define name="PITCH_RATE_SETPOINT_PGAIN" value="0.75" unit="1/s"/>
          <define name="PITCH_RATE_MAX_SETPOINT" value="10"/>
          <define name="YAW_RATE_SETPOINT_PGAIN" value="0.75" unit="1/s"/>
          <define name="YAW_RATE_MAX_SETPOINT" value="10"/>
          <define name="LO_THROTTLE_ROLL_RATE_PGAIN" value="20000."/>
          <define name="HI_THROTTLE_ROLL_RATE_PGAIN" value="20000."/>
          <define name="LO_THROTTLE_PITCH_RATE_PGAIN" value="13000."/>
          <define name="HI_THROTTLE_PITCH_RATE_PGAIN" value="13000."/>
          <define name="LO_THROTTLE_YAW_RATE_PGAIN" value="16000."/>
          <define name="HI_THROTTLE_YAW_RATE_PGAIN" value="16000."/>
          <define name="ROLL_RATE_IGAIN" value="0."/>
          <define name="ROLL_RATE_DGAIN" value="0."/>
          <define name="ROLL_RATE_SUM_NB_SAMPLES" value="16"/>
          <define name="PITCH_RATE_IGAIN" value="0."/>
          <define name="PITCH_RATE_DGAIN" value="0."/>
          <define name="PITCH_RATE_SUM_NB_SAMPLES" value="16"/>
          <define name="YAW_RATE_IGAIN" value="0."/>
          <define name="YAW_RATE_DGAIN" value="0."/>
          <define name="YAW_RATE_SUM_NB_SAMPLES" value="16"/>
        </section>
        <section name="THR">
          <define name="DASH_THR" value="0.6"/>
          <define name="LOITER_THR" value="0.52"/>
        </section>
        <section name="NAV">
          <define name="NAV_PITCH" value="0."/>
          <define name="NAV_GLIDE_PITCH_TRIM" value="0"/>
        </section>
        <section name="AGGRESSIVE" prefix="AGR_">
          <define name="BLEND_START" value="0.5"/>
          <define name="BLEND_END" value="0.2"/>
          <define name="CLIMB_THROTTLE" value="0.53"/>
          <define name="CLIMB_PITCH" value="0.0"/>
          <define name="DESCENT_THROTTLE" value="0.50"/>
          <define name="DESCENT_PITCH" value="0.0"/>
          <define name="CLIMB_NAV_RATIO" value="0.8"/>
          <define name="DESCENT_NAV_RATIO" value="1.0"/>
        </section>
        <section name="FAILSAFE" prefix="FAILSAFE_">
          <define name="DEFAULT_THROTTLE" value="0.2" unit="%"/>
          <define name="DEFAULT_ROLL" value="0.3" unit="rad"/>
          <define name="DEFAULT_PITCH" value="0.1" unit="rad"/>
          <define name="HOME_RADIUS" value="50" unit="m"/>
        </section>
        <section name="SIMU">
          <define name="ROLL_RESPONSE_FACTOR" value="2."/>
          <define name="YAW_RESPONSE_FACTOR" value="1.35"/>
          <define name="WEIGHT" value="1.3"/>
        </section>
        <section name="MISC">
          <define name="NOMINAL_AIRSPEED" value="3." unit="m/s"/>
          <define name="CARROT" value="5." unit="s"/>
          <define name="KILL_MODE_DISTANCE" value="(MAX_DIST_FROM_HOME*1.5)" unit="m"/>
          <define name="XBEE_INIT" value="\"ATPL4\\rATRN1\\rATTT80\\rATBD3\\rATWR\\r\""/>
          <define name="TRIGGER_DELAY" value="1.1"/>
          <define name="DEFAULT_CIRCLE_RADIUS" value="100."/>
        </section>
        <section name="DATALINK" prefix="DATALINK_">
          <define name="DEVICE_TYPE" value="XBEE"/>
          <define name="DEVICE_ADDRESS" value="...."/>
        </section>
        <makefile>include $(PAPARAZZI_SRC)/conf/autopilot/tiny.makefile
FLASH_MODE=ISP
ap.CFLAGS +=  -DFBW -DAP -DCONFIG=\&quot;tiny_0_99.h\&quot; -DLED -DTIME_LED=1
ap.srcs = sys_time.c $(SRC_ARCH)/sys_time_hw.c $(SRC_ARCH)/armVIC.c main_fbw.c main_ap.c main.c
ap.srcs += commands.c
ap.CFLAGS += -DACTUATORS=\&quot;servos_4015_MAT_hw.h\&quot; -DSERVOS_4015_MAT
ap.srcs += $(SRC_ARCH)/servos_4015_MAT_hw.c actuators.c
ap.CFLAGS += -DRADIO_CONTROL -DRADIO_CONTROL_TYPE=RC_FUTABA
ap.srcs += radio_control.c $(SRC_ARCH)/ppm_hw.c  
#ap.CFLAGS += -DDOWNLINK -DDOWNLINK_TRANSPORT=PprzTransport 
#ap.srcs += downlink.c $(SRC_ARCH)/uart_hw.c datalink.c pprz_transport.c
#ap.CFLAGS += -DDOWNLINK_FBW_DEVICE=Modem 
#ap.CFLAGS += -DDOWNLINK_AP_DEVICE=Modem 
#ap.CFLAGS += -DMODEM
#ap.srcs += $(SRC_ARCH)/modem_hw.c 
#--SERIAL MODE--------
#ap.CFLAGS += -DDOWNLINK -DUSE_UART0 -DDOWNLINK_TRANSPORT=PprzTransport 
#ap.CFLAGS += -DDOWNLINK_FBW_DEVICE=Uart0 -DDOWNLINK_AP_DEVICE=Uart0 
#ap.CFLAGS += -DPPRZ_UART=Uart0 -DUART0_BAUD=B9600
#ap.srcs += downlink.c $(SRC_ARCH)/uart_hw.c pprz_transport.c
#--API MODE-----------
ap.CFLAGS += -DDOWNLINK -DUSE_UART0 -DDOWNLINK_TRANSPORT=XBeeTransport 
ap.CFLAGS += -DDOWNLINK_FBW_DEVICE=Uart0 -DDOWNLINK_AP_DEVICE=Uart0 
ap.CFLAGS += -DXBEE_UART=Uart0 -DDATALINK=XBEE -DUART0_BAUD=B9600
ap.srcs += downlink.c $(SRC_ARCH)/uart_hw.c datalink.c xbee.c
ap.srcs += traffic_info.c
ap.CFLAGS += -DINTER_MCU
ap.srcs += inter_mcu.c 
ap.CFLAGS += -DADC -DUSE_ADC_0 -DUSE_ADC_1 -DUSE_ADC_2 -DUSE_ADC_3 -DUSE_ADC_4
ap.srcs += $(SRC_ARCH)/adc_hw.c
ap.CFLAGS += -DGPS -DGPS_CONFIGURE -DUBX -DUSE_UART1 -DGPS_LINK=Uart1 -DUART1_BAUD=B38400
ap.srcs += gps_ubx.c gps.c
#ap.CFLAGS += -DINFRARED 
#ap.srcs += infrared.c 
#ap.CFLAGS += -DALT_KALMAN 
#ap.CFLAGS += -DIR_360
ap.srcs += estimator.c
ap.CFLAGS += -DCTL_ROLL_RATE
ap.CFLAGS += -DCTL_PITCH_RATE
ap.CFLAGS += -DCTL_YAW_RATE
ap.CFLAGS += -DNAV 
#ap.CFLAGS += -DAGR_CLIMB 
#ap.CFLAGS += -DLOITER_TRIM
ap.srcs += nav.c fw_h_ctl.c fw_v_ctl.c
#ap.CFLAGS += -DGYRO -DADXRS150 
#ap.srcs += gyro.c nav_line.c 
#ap.srcs += chemotaxis.c anemotaxis.c discsurvey.c
ap.CFLAGS += -DGYRO -DIDG300 
ap.srcs += gyro.c
#ap.CFLAGS += -DACCEL -DADXL330 
#ap.srcs += accel.c
ap.CFLAGS += -DRANGE 
ap.CFLAGS += -DRANGE_ALT 
ap.CFLAGS += -DAUTO2_MANUAL_HOVERING 
ap.srcs += range.c
#ap.CFLAGS += -DKALMAN_ROLL_PITCH 
#ap.srcs += kalman_roll_pitch.c
#ap.srcs += bomb.c
# Hack to use the same tuning file than slayer1
ap.CFLAGS += -DUSE_GPIO
ap.srcs += $(SRC_ARCH)/gpio.c
# Harware In The Loop
#ap.CFLAGS += -DHITL
# Config for SITL simulation
include $(PAPARAZZI_SRC)/conf/autopilot/sitl.makefile
sim.CFLAGS += -DCONFIG=\&quot;tiny.h\&quot; -DAGR_CLIMB -DH_CTL_RATE_LOOP
sim.srcs += bomb.c
# a test program to setup actuators 
setup_actuators.ARCHDIR = $(ARCHI)
setup_actuators.ARCH = arm7tdmi
setup_actuators.TARGET = setup_actuators
setup_actuators.TARGETDIR = setup_actuators
setup_actuators.CFLAGS += -DFBW -DCONFIG=\&quot;tiny.h\&quot; -DLED -DTIME_LED=1 -DACTUATORS=\&quot;servos_4015_hw.h\&quot; -DSERVOS_4015 -DUSE_UART0 -DUART0_BAUD=B9600 -DDATALINK=PPRZ -DPPRZ_UART=Uart0
setup_actuators.srcs += sys_time.c $(SRC_ARCH)/sys_time_hw.c $(SRC_ARCH)/armVIC.c pprz_transport.c setup_actuators.c $(SRC_ARCH)/uart_hw.c $(SRC_ARCH)/servos_4015_hw.c main.c
# a test program to tunnel between both uart
tunnel.ARCHDIR = $(ARCHI)
tunnel.ARCH = arm7tdmi
tunnel.TARGET = tunnel
tunnel.TARGETDIR = tunnel
tunnel.CFLAGS += -DFBW -DCONFIG=\&quot;tiny_0_99.h\&quot; -DLED -DTIME_LED=1
tunnel.srcs += $(SRC_ARCH)/uart_tunnel.c</makefile>
      </airframe>
      <radio name="T9cap" data_min="900" data_max="2100" sync_min="5000" sync_max="15000">
        <channel ctl="right_stick_horiz" function="ROLL" min="1939" neutral="1525" max="1114" average="0"/>
        <channel ctl="right_stick_vert" function="PITCH" min="1112" neutral="1518" max="1937" average="0"/>
        <channel ctl="left_stick_vert" function="THROTTLE" min="1940" neutral="1940" max="1115" average="0"/>
        <channel ctl="left_stick_horiz" function="YAW" min="1940" neutral="1498" max="1115" average="0"/>
        <channel ctl="switch_G" function="CALIB" min="2080" neutral="1525" max="969" average="10"/>
        <channel ctl="VRA" function="GAIN1" min="970" neutral="1520" max="2078" average="10"/>
        <channel ctl="VRC" function="GAIN2" min="970" neutral="1518" max="2077" average="10"/>
        <channel ctl="switch_C" function="MODE" min="2079" neutral="1526" max="966" average="10"/>
      </radio>
    </aircraft>
    <aircraft name="ver1" ac_id="44" airframe="airframes/vertigo_arm_ir_ac_ranger.xml" radio="radios/T9cap.xml" telemetry="telemetry/debug.xml" settings="settings/tuning_ver_range.xml" flight_plan="flight_plans/indoors.xml">
      <flight_plan ground_alt="700." lat0="43.5389" lon0="1.2433" max_dist_from_home="1750." name="hovering indoors" qfu="180." alt="702.0" security_height="0.02" wind_dir="60" wind_mod="3">
        <header/>
        <waypoints>
          <waypoint alt="702" name="HOME" x="753.859003724" y="-51.1591526465"/>
        </waypoints>
        <blocks/>
      </flight_plan>
      <airframe name="DRAGONFLY ARM">
        <servos>
          <servo name="AILERON1" no="0" min="1000" neutral="1500" max="2000"/>
          <servo name="AILERON2" no="1" min="1000" neutral="1500" max="2000"/>
          <servo name="THROTTLE" no="3" min="1100" neutral="1200" max="2000"/>
          <servo name="RUDDER" no="4" min="1000" neutral="1500" max="2000"/>
        </servos>
        <commands>
          <axis name="THROTTLE" failsafe_value="0"/>
          <axis name="ROLL" failsafe_value="0"/>
          <axis name="PITCH" failsafe_value="0"/>
          <axis name="YAW" failsafe_value="0"/>
        </commands>
        <rc_commands>
          <set command="THROTTLE" value="@THROTTLE"/>
          <set command="ROLL" value="@ROLL"/>
          <set command="PITCH" value="@PITCH"/>
          <set command="YAW" value="@YAW"/>
        </rc_commands>
        <section name="MIXER">
          <define name="AILEVON_AILERON_RATE" value="0.8"/>
          <define name="AILEVON_ELEVATOR_RATE" value="0.8"/>
          <define name="ROLL_TGAIN" value="0.005"/>
          <define name="PITCH_TGAIN" value="-0.0"/>
        </section>
        <command_laws>
          <set servo="THROTTLE" value="@THROTTLE-(vsupply-110.0f)*vdrop2throt_coeff"/>
          <let var="roll" value="@ROLL"/>
          <let var="rollofthr" value="@THROTTLE * ROLL_TGAIN"/>
          <let var="pitch" value="@PITCH"/>
          <let var="pitchofthr" value="@THROTTLE * PITCH_TGAIN"/>
          <set servo="AILERON1" value="-$roll-$pitch"/>
          <set servo="AILERON2" value="-$roll+$pitch"/>
          <let var="yaw" value="@YAW"/>
          <set servo="RUDDER" value="+$yaw+0.0*$roll"/>
        </command_laws>
        <section name="adc" prefix="ADC_CHANNEL_">
          <define name="GYRO_ROLL" value="ADC_0"/>
          <define name="GYRO_PITCH" value="ADC_1"/>
          <define name="GYRO_YAW" value="ADC_2"/>
          <define name="GYRO_NB_SAMPLES" value="16"/>
          <define name="RANGE" value="ADC_3"/>
          <define name="RANGE_NB_SAMPLES" value="1"/>
        </section>
        <section name="AUTO1" prefix="AUTO1_">
          <define name="MAX_ROLL" value="RadOfDeg(30)"/>
          <define name="MAX_PITCH" value="RadOfDeg(45)"/>
          <define name="MAX_YAW" value="RadOfDeg(30)"/>
        </section>
        <section name="INFRARED" prefix="IR_">
          <define name="ROLL_NEUTRAL_DEFAULT" value="DegOfRad(0.00)" unit="deg"/>
          <define name="PITCH_NEUTRAL_DEFAULT" value="DegOfRad(-1.344)" unit="deg"/>
          <define name="DEFAULT_CONTRAST" value="900"/>
          <define name="RAD_OF_IR_CONTRAST" value="1.9"/>
          <linear name="RollOfIrs" arity="2" coeff1="0.7" coeff2="-0.7"/>
          <linear name="PitchOfIrs" arity="2" coeff1="-0.7" coeff2="-0.7"/>
          <define name="RAD_OF_IR_MAX_VALUE" value="0.0045"/>
          <define name="RAD_OF_IR_MIN_VALUE" value="0.00075"/>
          <define name="ADC_ROLL_NEUTRAL" value="0"/>
          <define name="ADC_PITCH_NEUTRAL" value="0"/>
          <define name="ESTIMATED_PHI_PI_4" value="M_PI_4*0.6"/>
          <define name="CORRECTION_UP" value="1.5"/>
          <define name="CORRECTION_DOWN" value="1.5"/>
          <define name="CORRECTION_LEFT" value="1.5"/>
          <define name="CORRECTION_RIGHT" value="1.5"/>
        </section>
        <section name="GYRO" prefix="GYRO_">
          <define name="ADC_ROLL_NEUTRAL" value="466"/>
          <define name="ADC_PITCH_NEUTRAL" value="492"/>
          <define name="ADC_YAW_NEUTRAL" value="461"/>
          <define name="ROLL_SCALE" value="0.5"/>
          <define name="ROLL_DIRECTION" value="-1"/>
          <define name="PITCH_SCALE" value="0.5"/>
          <define name="PITCH_DIRECTION" value="1."/>
          <define name="YAW_SCALE" value="0.5"/>
          <define name="YAW_DIRECTION" value="-1."/>
        </section>
        <section name="ACCEL" prefix="ACCEL_">
          <define name="AX_NEUTRAL" value="528"/>
          <define name="AY_NEUTRAL" value="516"/>
          <define name="AZ_NEUTRAL" value="509"/>
          <define name="AX_SCALE" value="0.01"/>
          <define name="AY_SCALE" value="0.01"/>
          <define name="AZ_SCALE" value="0.01"/>
        </section>
        <section name="RANGE" prefix="RANGE_">
          <define name="NEUTRAL" value="0"/>
          <define name="SCALE" value="1.35"/>
          <define name="DIRECTION" value="1."/>
        </section>
        <section name="KALMAN" prefix="KALMAN_">
          <define name="Q_ANGLE" value="1e-1f"/>
          <define name="Q_GYRO" value="5e-1f"/>
          <define name="R_ANGLE" value="1e-3f"/>
        </section>
        <section name="BAT">
          <define name="MILLIAMP_PER_PERCENT" value="0.86"/>
          <define name="ADC_CHANNEL_VSUPPLY" value="AdcBank1(6)"/>
          <define name="VoltageOfAdc(adc)" value="(0.01787109375*adc)"/>
          <define name="LOW_BATTERY" value="9.3" unit="V"/>
        </section>
        <section name="VERTICAL CONTROL" prefix="V_CTL_">
          <define name="ALTITUDE_PGAIN" value="0.3"/>
          <define name="ALTITUDE_MAX_CLIMB" value="2."/>
          <define name="AUTO_THROTTLE_MIN_CRUISE_THROTTLE" value="0.35"/>
          <define name="AUTO_THROTTLE_MAX_CRUISE_THROTTLE" value="0.45"/>
          <define name="AUTO_THROTTLE_PGAIN_PLUS" value="0.037"/>
          <define name="AUTO_THROTTLE_PGAIN_MINUS" value="0.037"/>
          <define name="AUTO_THROTTLE_IGAIN" value="0.0"/>
          <define name="AUTO_THROTTLE_IGAIN_PLUS" value="0.0"/>
          <define name="AUTO_THROTTLE_IGAIN_MINUS" value="0.0"/>
          <define name="AUTO_THROTTLE_PITCH_OF_VZ_PGAIN" value="0.0"/>
          <define name="AUTO_THROTTLE_DASH_TRIM" value="1000"/>
          <define name="AUTO_THROTTLE_LOITER_TRIM" value="1500"/>
          <define name="AUTO_THROTTLE_CRUISE_THROTTLE" value="0.4149"/>
          <define name="AUTO_THROTTLE_CRUISE_THROTTLE_PGAIN" value="0.005"/>
          <define name="AUTO_THROTTLE_NOMINAL_CRUISE_THROTTLE" value="0.47"/>
          <define name="AUTO_THROTTLE_CLIMB_THROTTLE_INCREMENT_PLUS" value="0.045" unit="%/(m/s)"/>
          <define name="AUTO_THROTTLE_CLIMB_THROTTLE_INCREMENT_MINUS" value="0.045" unit="%/(m/s)"/>
          <define name="THROTTLE_SUM_NB_SAMPLES" value="32"/>
          <define name="AUTO_PITCH_PGAIN" value="0.1"/>
          <define name="AUTO_PITCH_IGAIN" value="0.0"/>
          <define name="AUTO_PITCH_MAX_PITCH" value="0.35"/>
          <define name="AUTO_PITCH_MIN_PITCH" value="-0.35"/>
          <define name="VDROP2THROTTLE" value="0"/>
          <define name="THROTTLE_SLEW" value="1.0"/>
        </section>
        <section name="HORIZONTAL CONTROL" prefix="H_CTL_">
          <define name="COURSE_PGAIN" value="0.5"/>
          <define name="ROLL_MAX_SETPOINT" value="RadOfDeg(45)" unit="radians"/>
          <define name="PITCH_MAX_SETPOINT" value="RadOfDeg(30)" unit="radians"/>
          <define name="PITCH_MIN_SETPOINT" value="RadOfDeg(-20)" unit="radians"/>
          <define name="YAW_MAX_SETPOINT" value="RadOfDeg(30)" unit="radians"/>
          <define name="ROLL_PGAIN" value="-12000."/>
          <define name="AILERON_OF_THROTTLE" value="0.0"/>
          <define name="PITCH_PGAIN" value="11950."/>
          <define name="PITCH_DGAIN" value="0.0"/>
          <define name="ELEVATOR_OF_ROLL" value="0."/>
          <define name="ROLL_RATE_MODE_DEFAULT" value="1"/>
          <define name="PITCH_RATE_MODE_DEFAULT" value="1"/>
          <define name="YAW_RATE_MODE_DEFAULT" value="1"/>
          <define name="ROLL_RATE_SETPOINT_PGAIN" value="0.75" unit="1/s"/>
          <define name="ROLL_RATE_MAX_SETPOINT" value="10"/>
          <define name="PITCH_RATE_SETPOINT_PGAIN" value="0.75" unit="1/s"/>
          <define name="PITCH_RATE_MAX_SETPOINT" value="10"/>
          <define name="YAW_RATE_SETPOINT_PGAIN" value="0.75" unit="1/s"/>
          <define name="YAW_RATE_MAX_SETPOINT" value="10"/>
          <define name="LO_THROTTLE_ROLL_RATE_PGAIN" value="25000."/>
          <define name="HI_THROTTLE_ROLL_RATE_PGAIN" value="25000."/>
          <define name="LO_THROTTLE_PITCH_RATE_PGAIN" value="13000."/>
          <define name="HI_THROTTLE_PITCH_RATE_PGAIN" value="13000."/>
          <define name="LO_THROTTLE_YAW_RATE_PGAIN" value="18000."/>
          <define name="HI_THROTTLE_YAW_RATE_PGAIN" value="18000."/>
          <define name="ROLL_RATE_IGAIN" value="0."/>
          <define name="ROLL_RATE_DGAIN" value="0."/>
          <define name="ROLL_RATE_SUM_NB_SAMPLES" value="16"/>
          <define name="PITCH_RATE_IGAIN" value="0."/>
          <define name="PITCH_RATE_DGAIN" value="0."/>
          <define name="PITCH_RATE_SUM_NB_SAMPLES" value="16"/>
          <define name="YAW_RATE_IGAIN" value="0."/>
          <define name="YAW_RATE_DGAIN" value="0."/>
          <define name="YAW_RATE_SUM_NB_SAMPLES" value="16"/>
        </section>
        <section name="THR">
          <define name="DASH_THR" value="0.6"/>
          <define name="LOITER_THR" value="0.52"/>
        </section>
        <section name="NAV">
          <define name="NAV_PITCH" value="0."/>
          <define name="NAV_GLIDE_PITCH_TRIM" value="0"/>
        </section>
        <section name="AGGRESSIVE" prefix="AGR_">
          <define name="BLEND_START" value="0.5"/>
          <define name="BLEND_END" value="0.2"/>
          <define name="CLIMB_THROTTLE" value="0.53"/>
          <define name="CLIMB_PITCH" value="0.0"/>
          <define name="DESCENT_THROTTLE" value="0.50"/>
          <define name="DESCENT_PITCH" value="0.0"/>
          <define name="CLIMB_NAV_RATIO" value="0.8"/>
          <define name="DESCENT_NAV_RATIO" value="1.0"/>
        </section>
        <section name="FAILSAFE" prefix="FAILSAFE_">
          <define name="DEFAULT_THROTTLE" value="0.2" unit="%"/>
          <define name="DEFAULT_ROLL" value="0.3" unit="rad"/>
          <define name="DEFAULT_PITCH" value="0.1" unit="rad"/>
          <define name="HOME_RADIUS" value="50" unit="m"/>
        </section>
        <section name="SIMU">
          <define name="ROLL_RESPONSE_FACTOR" value="2."/>
          <define name="YAW_RESPONSE_FACTOR" value="1.35"/>
          <define name="WEIGHT" value="1.3"/>
        </section>
        <section name="MISC">
          <define name="NOMINAL_AIRSPEED" value="3." unit="m/s"/>
          <define name="CARROT" value="5." unit="s"/>
          <define name="KILL_MODE_DISTANCE" value="(MAX_DIST_FROM_HOME*1.5)" unit="m"/>
          <define name="AEROCOMM_INIT" value="\"ATPL4\\rATRN1\\rATTT80\\rATBD3\\rATWR\\r\""/>
          <define name="NO_API_INIT" value="TRUE"/>
          <define name="TRIGGER_DELAY" value="1.1"/>
          <define name="DEFAULT_CIRCLE_RADIUS" value="100."/>
        </section>
        <section name="DATALINK" prefix="DATALINK_">
          <define name="DEVICE_TYPE" value="AEROCOMM__"/>
          <define name="DEVICE_ADDRESS" value="...."/>
        </section>
        <makefile>include $(PAPARAZZI_SRC)/conf/autopilot/tiny.makefile
FLASH_MODE=ISP
ap.CFLAGS +=  -DFBW -DAP -DCONFIG=\&quot;tiny_0_99.h\&quot; -DLED -DTIME_LED=1
ap.srcs = sys_time.c $(SRC_ARCH)/sys_time_hw.c $(SRC_ARCH)/armVIC.c main_fbw.c main_ap.c main.c
ap.srcs += commands.c
ap.CFLAGS += -DACTUATORS=\&quot;servos_4015_MAT_hw.h\&quot; -DSERVOS_4015_MAT
ap.srcs += $(SRC_ARCH)/servos_4015_MAT_hw.c actuators.c
ap.CFLAGS += -DRADIO_CONTROL -DRADIO_CONTROL_TYPE=RC_FUTABA
ap.srcs += radio_control.c $(SRC_ARCH)/ppm_hw.c  
#ap.CFLAGS += -DDOWNLINK -DDOWNLINK_TRANSPORT=PprzTransport 
#ap.srcs += downlink.c $(SRC_ARCH)/uart_hw.c datalink.c pprz_transport.c
#ap.CFLAGS += -DDOWNLINK_FBW_DEVICE=Modem 
#ap.CFLAGS += -DDOWNLINK_AP_DEVICE=Modem 
#ap.CFLAGS += -DMODEM
#ap.srcs += $(SRC_ARCH)/modem_hw.c 
#--SERIAL MODE--------
#ap.CFLAGS += -DDOWNLINK -DUSE_UART0 -DDOWNLINK_TRANSPORT=PprzTransport 
#ap.CFLAGS += -DDOWNLINK_FBW_DEVICE=Uart0 -DDOWNLINK_AP_DEVICE=Uart0 
#ap.CFLAGS += -DPPRZ_UART=Uart0 -DUART0_BAUD=B9600
#ap.srcs += downlink.c $(SRC_ARCH)/uart_hw.c datalink.c pprz_transport.c
#ap.srcs += traffic_info.c
#--API MODE-----------
ap.CFLAGS += -DDOWNLINK -DUSE_UART0 -DDOWNLINK_TRANSPORT=AerocommTransport 
ap.CFLAGS += -DDOWNLINK_FBW_DEVICE=Uart0 -DDOWNLINK_AP_DEVICE=Uart0 
ap.CFLAGS += -DAEROCOMM_UART=Uart0 -DDATALINK=AEROCOMM -DUART0_BAUD=B9600
ap.srcs += downlink.c $(SRC_ARCH)/uart_hw.c datalink.c aerocomm_new.c
ap.srcs += traffic_info.c
#--XBee----------------
#ap.CFLAGS += -DDOWNLINK -DUSE_UART0 -DDOWNLINK_TRANSPORT=XBeeTransport 
#ap.CFLAGS += -DDOWNLINK_FBW_DEVICE=Uart0 -DDOWNLINK_AP_DEVICE=Uart0 
#ap.CFLAGS += -DXBEE_UART=Uart0 -DDATALINK=XBEE -DUART0_BAUD=B9600
#ap.srcs += downlink.c $(SRC_ARCH)/uart_hw.c datalink.c xbee.c
#ap.srcs += traffic_info.c
ap.CFLAGS += -DINTER_MCU
ap.srcs += inter_mcu.c 
ap.CFLAGS += -DADC -DUSE_ADC_0 -DUSE_ADC_1 -DUSE_ADC_2 -DUSE_ADC_3 -DUSE_ADC_4
ap.srcs += $(SRC_ARCH)/adc_hw.c
#ap.CFLAGS += -DGPS -DGPS_CONFIGURE -DUBX -DUSE_UART1 -DGPS_LINK=Uart1 -DUART1_BAUD=B38400
#ap.srcs += gps_ubx.c gps.c
#ap.CFLAGS += -DINFRARED 
#ap.srcs += infrared.c 
#ap.CFLAGS += -DALT_KALMAN 
#ap.CFLAGS += -DIR_360
ap.srcs += estimator.c
ap.CFLAGS += -DCTL_ROLL_RATE
ap.CFLAGS += -DCTL_PITCH_RATE
ap.CFLAGS += -DCTL_YAW_RATE
ap.CFLAGS += -DNAV 
#ap.CFLAGS += -DAGR_CLIMB 
#ap.CFLAGS += -DLOITER_TRIM
ap.srcs += nav.c fw_h_ctl.c fw_v_ctl.c
#ap.CFLAGS += -DGYRO -DADXRS150 
#ap.srcs += gyro.c nav_line.c 
#ap.srcs += chemotaxis.c anemotaxis.c discsurvey.c
ap.CFLAGS += -DGYRO -DIDG300 
ap.srcs += gyro.c
#ap.CFLAGS += -DACCEL -DADXL330 
#ap.srcs += accel.c
ap.CFLAGS += -DRANGE 
ap.CFLAGS += -DRANGE_ALT 
ap.CFLAGS += -DAUTO2_MANUAL_HOVERING 
ap.srcs += range.c
#ap.CFLAGS += -DKALMAN_ROLL_PITCH 
#ap.srcs += kalman_roll_pitch.c
#ap.srcs += bomb.c
# Hack to use the same tuning file than slayer1
ap.CFLAGS += -DUSE_GPIO
ap.srcs += $(SRC_ARCH)/gpio.c
# Harware In The Loop
#ap.CFLAGS += -DHITL
# Config for SITL simulation
include $(PAPARAZZI_SRC)/conf/autopilot/sitl.makefile
sim.CFLAGS += -DCONFIG=\&quot;tiny.h\&quot; -DAGR_CLIMB -DH_CTL_RATE_LOOP
sim.srcs += bomb.c
# a test program to setup actuators 
setup_actuators.ARCHDIR = $(ARCHI)
setup_actuators.ARCH = arm7tdmi
setup_actuators.TARGET = setup_actuators
setup_actuators.TARGETDIR = setup_actuators
setup_actuators.CFLAGS += -DFBW -DCONFIG=\&quot;tiny.h\&quot; -DLED -DTIME_LED=1 -DACTUATORS=\&quot;servos_4015_hw.h\&quot; -DSERVOS_4015 -DUSE_UART0 -DUART0_BAUD=B9600 -DDATALINK=PPRZ -DPPRZ_UART=Uart0
setup_actuators.srcs += sys_time.c $(SRC_ARCH)/sys_time_hw.c $(SRC_ARCH)/armVIC.c pprz_transport.c setup_actuators.c $(SRC_ARCH)/uart_hw.c $(SRC_ARCH)/servos_4015_hw.c main.c
# a test program to tunnel between both uart
tunnel.ARCHDIR = $(ARCHI)
tunnel.ARCH = arm7tdmi
tunnel.TARGET = tunnel
tunnel.TARGETDIR = tunnel
tunnel.CFLAGS += -DFBW -DCONFIG=\&quot;tiny_0_99.h\&quot; -DLED -DTIME_LED=1
tunnel.srcs += $(SRC_ARCH)/uart_tunnel.c</makefile>
      </airframe>
      <radio name="T9cap" data_min="900" data_max="2100" sync_min="5000" sync_max="15000">
        <channel ctl="right_stick_horiz" function="ROLL" min="1939" neutral="1525" max="1114" average="0"/>
        <channel ctl="right_stick_vert" function="PITCH" min="1112" neutral="1518" max="1937" average="0"/>
        <channel ctl="left_stick_vert" function="THROTTLE" min="1940" neutral="1940" max="1115" average="0"/>
        <channel ctl="left_stick_horiz" function="YAW" min="1940" neutral="1498" max="1115" average="0"/>
        <channel ctl="switch_G" function="CALIB" min="2080" neutral="1525" max="969" average="10"/>
        <channel ctl="VRA" function="GAIN1" min="970" neutral="1520" max="2078" average="10"/>
        <channel ctl="VRC" function="GAIN2" min="970" neutral="1518" max="2077" average="10"/>
        <channel ctl="switch_C" function="MODE" min="2079" neutral="1526" max="966" average="10"/>
      </radio>
    </aircraft>
    <aircraft name="ver2" ac_id="11" airframe="airframes/vertigo_arm_ir_ac.xml" radio="radios/T9cap.xml" telemetry="telemetry/debug.xml" settings="settings/tuning_ver_ir.xml" flight_plan="flight_plans/kennedy.xml">
      <flight_plan alt="751" ground_alt="746" lat0="32.184346" lon0="-111.013026" max_dist_from_home="1500" name="kennedy" qfu="180" security_height="0.3" wind_dir="60" wind_mod="3">
        <waypoints>
          <waypoint name="HOME" x="0." y="0."/>
          <waypoint name="1" x="-34.5927181506" y="22.9493057216"/>
          <waypoint name="2" x="25.9193831497" y="-31.4832800706"/>
        </waypoints>
        <blocks>
          <block name="init">
            <exception cond="(RcEvent1())" deroute="landing"/>
            <exception cond="(RcEvent2())" deroute="2wp loiter"/>
            <while cond="(!launch)"/>
            <attitude pitch="0.3" roll="0.0" throttle="1.0" until="(estimator_z > SECURITY_ALT)" vmode="throttle"/>
            <deroute block="2wp loiter"/>
          </block>
          <block name="2wp loiter">
            <exception cond="(RcEvent1())" deroute="init"/>
            <exception cond="(RcEvent2())" deroute="circle"/>
            <while>
              <go approaching_time="1" pitch="0.0" throttle="auto" vmode="alt" wp="1"/>
              <go approaching_time="1" pitch="0.0" throttle="auto" vmode="alt" wp="2"/>
            </while>
          </block>
          <block name="circle">
            <exception cond="(RcEvent2())" deroute="2wp loiter"/>
            <exception cond="(RcEvent1())" deroute="landing"/>
            <circle alt="GROUND_ALT+8" radius="10" wp="HOME"/>
          </block>
          <block name="landing">
            <exception cond="(RcEvent2())" deroute="circle"/>
            <exception cond="(RcEvent1())" deroute="init"/>
            <go alt="GROUND_ALT+2" wp="1"/>
            <go alt="GROUND_ALT" throttle="0.30" vmode="throttle" wp="2"/>
          </block>
        </blocks>
      </flight_plan>
      <airframe name="DRAGONFLY ARM">
        <servos>
          <servo name="AILERON1" no="0" min="1000" neutral="1500" max="2000"/>
          <servo name="AILERON2" no="1" min="1000" neutral="1500" max="2000"/>
          <servo name="THROTTLE" no="3" min="1100" neutral="1200" max="2000"/>
          <servo name="RUDDER" no="4" min="1000" neutral="1500" max="2000"/>
        </servos>
        <commands>
          <axis name="THROTTLE" failsafe_value="0"/>
          <axis name="ROLL" failsafe_value="0"/>
          <axis name="PITCH" failsafe_value="0"/>
          <axis name="YAW" failsafe_value="0"/>
        </commands>
        <rc_commands>
          <set command="THROTTLE" value="@THROTTLE"/>
          <set command="ROLL" value="@ROLL"/>
          <set command="PITCH" value="@PITCH"/>
          <set command="YAW" value="@YAW"/>
        </rc_commands>
        <section name="MIXER">
          <define name="AILEVON_AILERON_RATE" value="0.8"/>
          <define name="AILEVON_ELEVATOR_RATE" value="0.8"/>
          <define name="ROLL_TGAIN" value="0.005"/>
          <define name="PITCH_TGAIN" value="-0.0"/>
        </section>
        <command_laws>
          <set servo="THROTTLE" value="@THROTTLE-(vsupply-110.0f)*vdrop2throt_coeff"/>
          <let var="roll" value="@ROLL"/>
          <let var="rollofthr" value="@THROTTLE * ROLL_TGAIN"/>
          <let var="pitch" value="@PITCH"/>
          <let var="pitchofthr" value="@THROTTLE * PITCH_TGAIN"/>
          <set servo="AILERON1" value="$roll+$pitch"/>
          <set servo="AILERON2" value="$roll-$pitch"/>
          <let var="yaw" value="@YAW"/>
          <set servo="RUDDER" value="+$yaw+0.0*$roll"/>
        </command_laws>
        <section name="adc" prefix="ADC_CHANNEL_">
          <define name="GYRO_ROLL" value="ADC_0"/>
          <define name="GYRO_PITCH" value="ADC_1"/>
          <define name="GYRO_YAW" value="ADC_2"/>
          <define name="GYRO_NB_SAMPLES" value="16"/>
          <define name="IR1" value="ADC_3"/>
          <define name="IR2" value="ADC_4"/>
          <define name="IR_NB_SAMPLES" value="16"/>
        </section>
        <section name="AUTO1" prefix="AUTO1_">
          <define name="MAX_ROLL" value="RadOfDeg(30)"/>
          <define name="MAX_PITCH" value="RadOfDeg(90)"/>
          <define name="MAX_YAW" value="RadOfDeg(30)"/>
        </section>
        <section name="INFRARED" prefix="IR_">
          <define name="ROLL_NEUTRAL_DEFAULT" value="1" unit="deg"/>
          <define name="PITCH_NEUTRAL_DEFAULT" value="-61.1" unit="deg"/>
          <define name="DEFAULT_CONTRAST" value="900"/>
          <define name="RAD_OF_IR_CONTRAST" value="1.9"/>
          <linear name="RollOfIrs" arity="2" coeff1="0.7" coeff2="-0.7"/>
          <linear name="PitchOfIrs" arity="2" coeff1="-0.7" coeff2="-0.7"/>
          <define name="RAD_OF_IR_MAX_VALUE" value="0.0045"/>
          <define name="RAD_OF_IR_MIN_VALUE" value="0.00075"/>
          <define name="ADC_ROLL_NEUTRAL" value="0"/>
          <define name="ADC_PITCH_NEUTRAL" value="0"/>
          <define name="ESTIMATED_PHI_PI_4" value="M_PI_4*0.6"/>
          <define name="CORRECTION_UP" value="1.5"/>
          <define name="CORRECTION_DOWN" value="1.5"/>
          <define name="CORRECTION_LEFT" value="1.5"/>
          <define name="CORRECTION_RIGHT" value="1.5"/>
        </section>
        <section name="GYRO" prefix="GYRO_">
          <define name="ADC_ROLL_NEUTRAL" value="517"/>
          <define name="ADC_PITCH_NEUTRAL" value="482"/>
          <define name="ADC_YAW_NEUTRAL" value="455"/>
          <define name="ROLL_SCALE" value="0.5"/>
          <define name="ROLL_DIRECTION" value="-1"/>
          <define name="PITCH_SCALE" value="0.5"/>
          <define name="PITCH_DIRECTION" value="1."/>
          <define name="YAW_SCALE" value="0.5"/>
          <define name="YAW_DIRECTION" value="1."/>
        </section>
        <section name="KALMAN" prefix="KALMAN_">
          <define name="Q_ANGLE" value="1e-1f"/>
          <define name="Q_GYRO" value="5e-1f"/>
          <define name="R_ANGLE" value="1e-3f"/>
        </section>
        <section name="BAT">
          <define name="MILLIAMP_PER_PERCENT" value="0.86"/>
          <define name="ADC_CHANNEL_VSUPPLY" value="AdcBank1(6)"/>
          <define name="VoltageOfAdc(adc)" value="(0.01787109375*adc)"/>
          <define name="LOW_BATTERY" value="9.3" unit="V"/>
        </section>
        <section name="VERTICAL CONTROL" prefix="V_CTL_">
          <define name="ALTITUDE_PGAIN" value="0.228"/>
          <define name="ALTITUDE_MAX_CLIMB" value="2."/>
          <define name="AUTO_THROTTLE_MIN_CRUISE_THROTTLE" value="0.38"/>
          <define name="AUTO_THROTTLE_MAX_CRUISE_THROTTLE" value="0.45"/>
          <define name="AUTO_THROTTLE_PGAIN" value="0.023"/>
          <define name="AUTO_THROTTLE_IGAIN" value="0.001"/>
          <define name="AUTO_THROTTLE_PITCH_OF_VZ_PGAIN" value="0.01"/>
          <define name="AUTO_THROTTLE_DASH_TRIM" value="1000"/>
          <define name="AUTO_THROTTLE_LOITER_TRIM" value="1500"/>
          <define name="AUTO_THROTTLE_CRUISE_THROTTLE" value="0.423"/>
          <define name="AUTO_THROTTLE_CRUISE_THROTTLE_PGAIN" value="0"/>
          <define name="AUTO_THROTTLE_NOMINAL_CRUISE_THROTTLE" value="0.42"/>
          <define name="AUTO_THROTTLE_CLIMB_THROTTLE_INCREMENT" value="0.01" unit="%/(m/s)"/>
          <define name="THROTTLE_SUM_NB_SAMPLES" value="32"/>
          <define name="AUTO_PITCH_PGAIN" value="0.1"/>
          <define name="AUTO_PITCH_IGAIN" value="0.0"/>
          <define name="AUTO_PITCH_MAX_PITCH" value="0.35"/>
          <define name="AUTO_PITCH_MIN_PITCH" value="-0.35"/>
          <define name="VDROP2THROTTLE" value="0"/>
          <define name="THROTTLE_SLEW" value="1.0"/>
        </section>
        <section name="HORIZONTAL CONTROL" prefix="H_CTL_">
          <define name="COURSE_PGAIN" value="0.067"/>
          <define name="ROLL_MAX_SETPOINT" value="RadOfDeg(10)" unit="radians"/>
          <define name="PITCH_MAX_SETPOINT" value="RadOfDeg(50)" unit="radians"/>
          <define name="PITCH_MIN_SETPOINT" value="RadOfDeg(-50)" unit="radians"/>
          <define name="YAW_MAX_SETPOINT" value="RadOfDeg(20)" unit="radians"/>
          <define name="ROLL_PGAIN" value="-12000."/>
          <define name="AILERON_OF_THROTTLE" value="0.0"/>
          <define name="PITCH_PGAIN" value="11950."/>
          <define name="PITCH_DGAIN" value="0.0"/>
          <define name="ELEVATOR_OF_ROLL" value="0."/>
          <define name="ROLL_RATE_MODE_DEFAULT" value="1"/>
          <define name="PITCH_RATE_MODE_DEFAULT" value="1"/>
          <define name="YAW_RATE_MODE_DEFAULT" value="1"/>
          <define name="ROLL_RATE_SETPOINT_PGAIN" value="0.75" unit="1/s"/>
          <define name="ROLL_RATE_MAX_SETPOINT" value="10"/>
          <define name="PITCH_RATE_SETPOINT_PGAIN" value="0.75" unit="1/s"/>
          <define name="PITCH_RATE_MAX_SETPOINT" value="10"/>
          <define name="YAW_RATE_SETPOINT_PGAIN" value="0.75" unit="1/s"/>
          <define name="YAW_RATE_MAX_SETPOINT" value="10"/>
          <define name="LO_THROTTLE_ROLL_RATE_PGAIN" value="28400."/>
          <define name="HI_THROTTLE_ROLL_RATE_PGAIN" value="28400."/>
          <define name="LO_THROTTLE_PITCH_RATE_PGAIN" value="26800."/>
          <define name="HI_THROTTLE_PITCH_RATE_PGAIN" value="26800."/>
          <define name="LO_THROTTLE_YAW_RATE_PGAIN" value="24600."/>
          <define name="HI_THROTTLE_YAW_RATE_PGAIN" value="24600."/>
          <define name="ROLL_RATE_IGAIN" value="0."/>
          <define name="ROLL_RATE_DGAIN" value="0."/>
          <define name="ROLL_RATE_SUM_NB_SAMPLES" value="16"/>
          <define name="PITCH_RATE_IGAIN" value="0."/>
          <define name="PITCH_RATE_DGAIN" value="0."/>
          <define name="PITCH_RATE_SUM_NB_SAMPLES" value="16"/>
          <define name="YAW_RATE_IGAIN" value="0."/>
          <define name="YAW_RATE_DGAIN" value="0."/>
          <define name="YAW_RATE_SUM_NB_SAMPLES" value="16"/>
          <define name="MID_AOA_ROLL_RATE_PGAIN" value="7500."/>
          <define name="MID_AOA_PITCH_RATE_PGAIN" value="11250."/>
          <define name="MID_AOA_YAW_RATE_PGAIN" value="10000."/>
          <define name="MID_AOA_ELEVATOR_OF_ROLL" value="3000."/>
          <define name="HI_AOA_ROLL_RATE_PGAIN" value="20000."/>
          <define name="HI_AOA_PITCH_RATE_PGAIN" value="17500."/>
          <define name="HI_AOA_YAW_RATE_PGAIN" value="20000."/>
          <define name="HI_AOA_ELEVATOR_OF_ROLL" value="0."/>
          <define name="LO_AOA_ROLL_RATE_PGAIN" value="2150."/>
          <define name="LO_AOA_PITCH_RATE_PGAIN" value="5300."/>
          <define name="LO_AOA_YAW_RATE_PGAIN" value="10000."/>
          <define name="LO_AOA_ELEVATOR_OF_ROLL" value="4000."/>
        </section>
        <section name="THR">
          <define name="DASH_THR" value="0.6"/>
          <define name="LOITER_THR" value="0.52"/>
        </section>
        <section name="NAV">
          <define name="NAV_PITCH" value="0."/>
          <define name="NAV_GLIDE_PITCH_TRIM" value="0"/>
        </section>
        <section name="FAILSAFE" prefix="FAILSAFE_">
          <define name="DELAY_WITHOUT_GPS" value="5" unit="s"/>
          <define name="DEFAULT_THROTTLE" value="0.4" unit="%"/>
          <define name="DEFAULT_ROLL" value="0.3" unit="rad"/>
          <define name="DEFAULT_PITCH" value="0.1" unit="rad"/>
          <define name="HOME_RADIUS" value="50" unit="m"/>
        </section>
        <section name="SIMU">
          <define name="ROLL_RESPONSE_FACTOR" value="2."/>
          <define name="YAW_RESPONSE_FACTOR" value="1.35"/>
          <define name="WEIGHT" value="1.3"/>
        </section>
        <section name="MISC">
          <define name="NOMINAL_AIRSPEED" value="7." unit="m/s"/>
          <define name="CARROT" value="5." unit="s"/>
          <define name="KILL_MODE_DISTANCE" value="(MAX_DIST_FROM_HOME*1.5)" unit="m"/>
          <define name="AEROCOMM_INIT" value=""/>
          <define name="NO_API_INIT" value="TRUE"/>
          <define name="TRIGGER_DELAY" value="1.1"/>
          <define name="DEFAULT_CIRCLE_RADIUS" value="100."/>
        </section>
        <section name="DATALINK" prefix="DATALINK_">
          <define name="DEVICE_TYPE" value="AEROCOMM__"/>
          <define name="DEVICE_ADDRESS" value="...."/>
        </section>
        <makefile>include $(PAPARAZZI_SRC)/conf/autopilot/tiny.makefile
FLASH_MODE=ISP
ap.CFLAGS +=  -DFBW -DAP -DCONFIG=\&quot;tiny_0_99.h\&quot; -DLED -DTIME_LED=1
ap.srcs = sys_time.c $(SRC_ARCH)/sys_time_hw.c $(SRC_ARCH)/armVIC.c main_fbw.c main_ap.c main.c
ap.srcs += commands.c
ap.CFLAGS += -DACTUATORS=\&quot;servos_4015_MAT_hw.h\&quot; -DSERVOS_4015_MAT
ap.srcs += $(SRC_ARCH)/servos_4015_MAT_hw.c actuators.c
ap.CFLAGS += -DRADIO_CONTROL -DRADIO_CONTROL_TYPE=RC_FUTABA
ap.srcs += radio_control.c $(SRC_ARCH)/ppm_hw.c  
#ap.CFLAGS += -DDOWNLINK -DDOWNLINK_TRANSPORT=PprzTransport 
#ap.srcs += downlink.c $(SRC_ARCH)/uart_hw.c datalink.c pprz_transport.c
#ap.CFLAGS += -DDOWNLINK_FBW_DEVICE=Modem 
#ap.CFLAGS += -DDOWNLINK_AP_DEVICE=Modem 
#ap.CFLAGS += -DMODEM
#ap.srcs += $(SRC_ARCH)/modem_hw.c 
#--SERIAL MODE--------
#ap.CFLAGS += -DDOWNLINK -DUSE_UART0 -DDOWNLINK_TRANSPORT=PprzTransport 
#ap.CFLAGS += -DDOWNLINK_FBW_DEVICE=Uart0 -DDOWNLINK_AP_DEVICE=Uart0 
#ap.CFLAGS += -DPPRZ_UART=Uart0 -DUART0_BAUD=B9600
#ap.srcs += downlink.c $(SRC_ARCH)/uart_hw.c pprz_transport.c
#ap.srcs += traffic_info.c
#--API MODE-----------
#--XBEE-----------
#ap.CFLAGS += -DDOWNLINK -DUSE_UART0 -DDOWNLINK_TRANSPORT=XBeeTransport 
#ap.CFLAGS += -DDOWNLINK_FBW_DEVICE=Uart0 -DDOWNLINK_AP_DEVICE=Uart0 
#ap.CFLAGS += -DXBEE_UART=Uart0 -DDATALINK=XBEE -DUART0_BAUD=B9600
#ap.srcs += downlink.c $(SRC_ARCH)/uart_hw.c datalink.c xbee.c
#ap.srcs += traffic_info.c
#--AEROCOMM-----------
ap.CFLAGS += -DDOWNLINK -DUSE_UART0 -DDOWNLINK_TRANSPORT=AerocommTransport 
ap.CFLAGS += -DDOWNLINK_FBW_DEVICE=Uart0 -DDOWNLINK_AP_DEVICE=Uart0 
ap.CFLAGS += -DAEROCOMM_UART=Uart0 -DDATALINK=AEROCOMM -DUART0_BAUD=B9600
ap.srcs += downlink.c $(SRC_ARCH)/uart_hw.c datalink.c aerocomm_new.c
ap.srcs += traffic_info.c
ap.CFLAGS += -DINTER_MCU
ap.srcs += inter_mcu.c 
ap.CFLAGS += -DADC -DUSE_ADC_0 -DUSE_ADC_1 -DUSE_ADC_2 -DUSE_ADC_3 -DUSE_ADC_4
ap.srcs += $(SRC_ARCH)/adc_hw.c
ap.CFLAGS += -DGPS -DGPS_CONFIGURE -DUBX -DUSE_UART1 -DGPS_LINK=Uart1 -DUART1_BAUD=B38400
ap.srcs += gps_ubx.c gps.c
ap.CFLAGS += -DINFRARED 
ap.srcs += infrared.c 
#ap.CFLAGS += -DALT_KALMAN 
#ap.CFLAGS += -DIR_360
ap.srcs += estimator.c
ap.CFLAGS += -DCTL_ROLL_RATE
ap.CFLAGS += -DCTL_PITCH_RATE
ap.CFLAGS += -DCTL_YAW_RATE
ap.CFLAGS += -DTRANSITION
ap.CFLAGS += -DNAV 
#ap.CFLAGS += -DAGR_CLIMB 
#ap.CFLAGS += -DLOITER_TRIM
ap.srcs += nav.c fw_h_ctl.c fw_v_ctl.c
#ap.CFLAGS += -DGYRO -DADXRS150 
#ap.srcs += gyro.c nav_line.c 
#ap.srcs += chemotaxis.c anemotaxis.c discsurvey.c
ap.CFLAGS += -DGYRO -DIDG300 
ap.srcs += gyro.c
#ap.CFLAGS += -DACCEL -DADXL330 
#ap.srcs += accel.c
#ap.CFLAGS += -DRANGE 
#ap.CFLAGS += -DRANGE_ALT 
#ap.CFLAGS += -DATTITUDE_ROLL
#ap.CFLAGS += -DATTITUDE_PITCH
#ap.CFLAGS += -DAUTO2_MANUAL_HOVERING 
#ap.srcs += range.c
#ap.CFLAGS += -DKALMAN_ROLL_PITCH 
#ap.srcs += kalman_roll_pitch.c
#ap.srcs += bomb.c
# Hack to use the same tuning file than slayer1
ap.CFLAGS += -DUSE_GPIO
ap.srcs += $(SRC_ARCH)/gpio.c
# Harware In The Loop
#ap.CFLAGS += -DHITL
# Config for SITL simulation
include $(PAPARAZZI_SRC)/conf/autopilot/sitl.makefile
sim.CFLAGS += -DCONFIG=\&quot;tiny.h\&quot; -DAGR_CLIMB -DH_CTL_RATE_LOOP
# a test program to setup actuators 
setup_actuators.ARCHDIR = $(ARCHI)
setup_actuators.ARCH = arm7tdmi
setup_actuators.TARGET = setup_actuators
setup_actuators.TARGETDIR = setup_actuators
setup_actuators.CFLAGS += -DFBW -DCONFIG=\&quot;tiny.h\&quot; -DLED -DTIME_LED=1 -DACTUATORS=\&quot;servos_4015_hw.h\&quot; -DSERVOS_4015 -DUSE_UART0 -DUART0_BAUD=B9600 -DDATALINK=PPRZ -DPPRZ_UART=Uart0
setup_actuators.srcs += sys_time.c $(SRC_ARCH)/sys_time_hw.c $(SRC_ARCH)/armVIC.c pprz_transport.c setup_actuators.c $(SRC_ARCH)/uart_hw.c $(SRC_ARCH)/servos_4015_hw.c main.c
# a test program to tunnel between both uart
tunnel.ARCHDIR = $(ARCHI)
tunnel.ARCH = arm7tdmi
tunnel.TARGET = tunnel
tunnel.TARGETDIR = tunnel
tunnel.CFLAGS += -DFBW -DCONFIG=\&quot;tiny_0_99.h\&quot; -DLED -DTIME_LED=1
tunnel.srcs += $(SRC_ARCH)/uart_tunnel.c</makefile>
      </airframe>
      <radio name="T9cap" data_min="900" data_max="2100" sync_min="5000" sync_max="15000">
        <channel ctl="right_stick_horiz" function="ROLL" min="1939" neutral="1525" max="1114" average="0"/>
        <channel ctl="right_stick_vert" function="PITCH" min="1112" neutral="1518" max="1937" average="0"/>
        <channel ctl="left_stick_vert" function="THROTTLE" min="1940" neutral="1940" max="1115" average="0"/>
        <channel ctl="left_stick_horiz" function="YAW" min="1940" neutral="1498" max="1115" average="0"/>
        <channel ctl="switch_G" function="CALIB" min="2080" neutral="1525" max="969" average="10"/>
        <channel ctl="VRA" function="GAIN1" min="970" neutral="1520" max="2078" average="10"/>
        <channel ctl="VRC" function="GAIN2" min="970" neutral="1518" max="2077" average="10"/>
        <channel ctl="switch_C" function="MODE" min="2079" neutral="1526" max="966" average="10"/>
      </radio>
    </aircraft>
    <aircraft name="v1" ac_id="34" airframe="airframes/vertigo_arm_ir_ac.xml" radio="radios/T9cap.xml" telemetry="telemetry/debug_vertigo_ir.xml" settings="settings/tuning_ver_ir_transition.xml" flight_plan="flight_plans/himmel_landing_new.xml">
      <flight_plan alt="800" ground_alt="750" lat0="32.23298" lon0="-110.93243" max_dist_from_home="500" name="himmel 2" qfu="180" security_height="20" wind_dir="60" wind_mod="3">
        <waypoints>
          <waypoint alt="800." name="HOME" x="-73.5401595418" y="34.2456246042"/>
          <waypoint alt="800." name="4" x="13.5556140051" y="42.7654076088"/>
        </waypoints>
        <blocks>
          <block name="init">
            <exception cond="(RcEvent1())" deroute="landing"/>
            <exception cond="(RcEvent2())" deroute="2wp loiter"/>
            <while cond="(!launch)"/>
            <attitude pitch="0.3" roll="0.0" throttle="1.0" until="(estimator_z > SECURITY_ALT)" vmode="throttle"/>
            <deroute block="2wp loiter"/>
          </block>
          <block name="2wp loiter">
            <exception cond="(RcEvent1())" deroute="init"/>
            <exception cond="(RcEvent2())" deroute="circle"/>
            <while>
              <go pitch="0.0" wp="4" approaching_time="1" throttle="auto" vmode="alt"/>
              <go pitch="0.0" wp="HOME" approaching_time="1" throttle="auto" vmode="alt"/>
            </while>
          </block>
          <block name="circle">
            <exception cond="(RcEvent2())" deroute="2wp loiter"/>
            <exception cond="(RcEvent1())" deroute="landing"/>
            <circle alt="GROUND_ALT+50" radius="25" wp="HOME"/>
          </block>
          <block name="landing">
            <exception cond="(RcEvent2())" deroute="circle"/>
            <exception cond="(RcEvent1())" deroute="init"/>
            <go alt="GROUND_ALT+40" wp="4"/>
            <go alt="GROUND_ALT" throttle="0.20" vmode="throttle" wp="HOME"/>
          </block>
        </blocks>
      </flight_plan>
      <airframe name="DRAGONFLY ARM">
        <servos>
          <servo name="AILERON1" no="0" min="1000" neutral="1500" max="2000"/>
          <servo name="AILERON2" no="1" min="1000" neutral="1500" max="2000"/>
          <servo name="THROTTLE" no="3" min="1100" neutral="1200" max="2000"/>
          <servo name="RUDDER" no="4" min="1000" neutral="1500" max="2000"/>
        </servos>
        <commands>
          <axis name="THROTTLE" failsafe_value="0"/>
          <axis name="ROLL" failsafe_value="0"/>
          <axis name="PITCH" failsafe_value="0"/>
          <axis name="YAW" failsafe_value="0"/>
        </commands>
        <rc_commands>
          <set command="THROTTLE" value="@THROTTLE"/>
          <set command="ROLL" value="@ROLL"/>
          <set command="PITCH" value="@PITCH"/>
          <set command="YAW" value="@YAW"/>
        </rc_commands>
        <section name="MIXER">
          <define name="AILEVON_AILERON_RATE" value="0.8"/>
          <define name="AILEVON_ELEVATOR_RATE" value="0.8"/>
          <define name="ROLL_TGAIN" value="0.005"/>
          <define name="PITCH_TGAIN" value="-0.0"/>
        </section>
        <command_laws>
          <set servo="THROTTLE" value="@THROTTLE-(vsupply-110.0f)*vdrop2throt_coeff"/>
          <let var="roll" value="@ROLL"/>
          <let var="rollofthr" value="@THROTTLE * ROLL_TGAIN"/>
          <let var="pitch" value="@PITCH"/>
          <let var="pitchofthr" value="@THROTTLE * PITCH_TGAIN"/>
          <set servo="AILERON1" value="$roll+$pitch"/>
          <set servo="AILERON2" value="$roll-$pitch"/>
          <let var="yaw" value="@YAW"/>
          <set servo="RUDDER" value="+$yaw+0.0*$roll"/>
        </command_laws>
        <section name="adc" prefix="ADC_CHANNEL_">
          <define name="GYRO_ROLL" value="ADC_0"/>
          <define name="GYRO_PITCH" value="ADC_1"/>
          <define name="GYRO_YAW" value="ADC_2"/>
          <define name="GYRO_NB_SAMPLES" value="16"/>
          <define name="IR1" value="ADC_3"/>
          <define name="IR2" value="ADC_4"/>
          <define name="IR_NB_SAMPLES" value="16"/>
        </section>
        <section name="AUTO1" prefix="AUTO1_">
          <define name="MAX_ROLL" value="RadOfDeg(30)"/>
          <define name="MAX_PITCH" value="RadOfDeg(90)"/>
          <define name="MAX_YAW" value="RadOfDeg(30)"/>
        </section>
        <section name="INFRARED" prefix="IR_">
          <define name="ROLL_NEUTRAL_DEFAULT" value="1" unit="deg"/>
          <define name="PITCH_NEUTRAL_DEFAULT" value="-61.1" unit="deg"/>
          <define name="DEFAULT_CONTRAST" value="900"/>
          <define name="RAD_OF_IR_CONTRAST" value="1.9"/>
          <linear name="RollOfIrs" arity="2" coeff1="0.7" coeff2="-0.7"/>
          <linear name="PitchOfIrs" arity="2" coeff1="-0.7" coeff2="-0.7"/>
          <define name="RAD_OF_IR_MAX_VALUE" value="0.0045"/>
          <define name="RAD_OF_IR_MIN_VALUE" value="0.00075"/>
          <define name="ADC_ROLL_NEUTRAL" value="0"/>
          <define name="ADC_PITCH_NEUTRAL" value="0"/>
          <define name="ESTIMATED_PHI_PI_4" value="M_PI_4*0.6"/>
          <define name="CORRECTION_UP" value="1.5"/>
          <define name="CORRECTION_DOWN" value="1.5"/>
          <define name="CORRECTION_LEFT" value="1.5"/>
          <define name="CORRECTION_RIGHT" value="1.5"/>
        </section>
        <section name="GYRO" prefix="GYRO_">
          <define name="ADC_ROLL_NEUTRAL" value="517"/>
          <define name="ADC_PITCH_NEUTRAL" value="482"/>
          <define name="ADC_YAW_NEUTRAL" value="455"/>
          <define name="ROLL_SCALE" value="0.5"/>
          <define name="ROLL_DIRECTION" value="-1"/>
          <define name="PITCH_SCALE" value="0.5"/>
          <define name="PITCH_DIRECTION" value="1."/>
          <define name="YAW_SCALE" value="0.5"/>
          <define name="YAW_DIRECTION" value="1."/>
        </section>
        <section name="KALMAN" prefix="KALMAN_">
          <define name="Q_ANGLE" value="1e-1f"/>
          <define name="Q_GYRO" value="5e-1f"/>
          <define name="R_ANGLE" value="1e-3f"/>
        </section>
        <section name="BAT">
          <define name="MILLIAMP_PER_PERCENT" value="0.86"/>
          <define name="ADC_CHANNEL_VSUPPLY" value="AdcBank1(6)"/>
          <define name="VoltageOfAdc(adc)" value="(0.01787109375*adc)"/>
          <define name="LOW_BATTERY" value="9.3" unit="V"/>
        </section>
        <section name="VERTICAL CONTROL" prefix="V_CTL_">
          <define name="ALTITUDE_PGAIN" value="0.228"/>
          <define name="ALTITUDE_MAX_CLIMB" value="2."/>
          <define name="AUTO_THROTTLE_MIN_CRUISE_THROTTLE" value="0.38"/>
          <define name="AUTO_THROTTLE_MAX_CRUISE_THROTTLE" value="0.45"/>
          <define name="AUTO_THROTTLE_PGAIN" value="0.023"/>
          <define name="AUTO_THROTTLE_IGAIN" value="0.001"/>
          <define name="AUTO_THROTTLE_PITCH_OF_VZ_PGAIN" value="0.01"/>
          <define name="AUTO_THROTTLE_DASH_TRIM" value="1000"/>
          <define name="AUTO_THROTTLE_LOITER_TRIM" value="1500"/>
          <define name="AUTO_THROTTLE_CRUISE_THROTTLE" value="0.423"/>
          <define name="AUTO_THROTTLE_CRUISE_THROTTLE_PGAIN" value="0"/>
          <define name="AUTO_THROTTLE_NOMINAL_CRUISE_THROTTLE" value="0.42"/>
          <define name="AUTO_THROTTLE_CLIMB_THROTTLE_INCREMENT" value="0.01" unit="%/(m/s)"/>
          <define name="THROTTLE_SUM_NB_SAMPLES" value="32"/>
          <define name="AUTO_PITCH_PGAIN" value="0.1"/>
          <define name="AUTO_PITCH_IGAIN" value="0.0"/>
          <define name="AUTO_PITCH_MAX_PITCH" value="0.35"/>
          <define name="AUTO_PITCH_MIN_PITCH" value="-0.35"/>
          <define name="VDROP2THROTTLE" value="0"/>
          <define name="THROTTLE_SLEW" value="1.0"/>
        </section>
        <section name="HORIZONTAL CONTROL" prefix="H_CTL_">
          <define name="COURSE_PGAIN" value="0.067"/>
          <define name="ROLL_MAX_SETPOINT" value="RadOfDeg(10)" unit="radians"/>
          <define name="PITCH_MAX_SETPOINT" value="RadOfDeg(50)" unit="radians"/>
          <define name="PITCH_MIN_SETPOINT" value="RadOfDeg(-50)" unit="radians"/>
          <define name="YAW_MAX_SETPOINT" value="RadOfDeg(20)" unit="radians"/>
          <define name="ROLL_PGAIN" value="-12000."/>
          <define name="AILERON_OF_THROTTLE" value="0.0"/>
          <define name="PITCH_PGAIN" value="11950."/>
          <define name="PITCH_DGAIN" value="0.0"/>
          <define name="ELEVATOR_OF_ROLL" value="0."/>
          <define name="ROLL_RATE_MODE_DEFAULT" value="1"/>
          <define name="PITCH_RATE_MODE_DEFAULT" value="1"/>
          <define name="YAW_RATE_MODE_DEFAULT" value="1"/>
          <define name="ROLL_RATE_SETPOINT_PGAIN" value="0.75" unit="1/s"/>
          <define name="ROLL_RATE_MAX_SETPOINT" value="10"/>
          <define name="PITCH_RATE_SETPOINT_PGAIN" value="0.75" unit="1/s"/>
          <define name="PITCH_RATE_MAX_SETPOINT" value="10"/>
          <define name="YAW_RATE_SETPOINT_PGAIN" value="0.75" unit="1/s"/>
          <define name="YAW_RATE_MAX_SETPOINT" value="10"/>
          <define name="LO_THROTTLE_ROLL_RATE_PGAIN" value="28400."/>
          <define name="HI_THROTTLE_ROLL_RATE_PGAIN" value="28400."/>
          <define name="LO_THROTTLE_PITCH_RATE_PGAIN" value="26800."/>
          <define name="HI_THROTTLE_PITCH_RATE_PGAIN" value="26800."/>
          <define name="LO_THROTTLE_YAW_RATE_PGAIN" value="24600."/>
          <define name="HI_THROTTLE_YAW_RATE_PGAIN" value="24600."/>
          <define name="ROLL_RATE_IGAIN" value="0."/>
          <define name="ROLL_RATE_DGAIN" value="0."/>
          <define name="ROLL_RATE_SUM_NB_SAMPLES" value="16"/>
          <define name="PITCH_RATE_IGAIN" value="0."/>
          <define name="PITCH_RATE_DGAIN" value="0."/>
          <define name="PITCH_RATE_SUM_NB_SAMPLES" value="16"/>
          <define name="YAW_RATE_IGAIN" value="0."/>
          <define name="YAW_RATE_DGAIN" value="0."/>
          <define name="YAW_RATE_SUM_NB_SAMPLES" value="16"/>
          <define name="MID_AOA_ROLL_RATE_PGAIN" value="7500."/>
          <define name="MID_AOA_PITCH_RATE_PGAIN" value="11250."/>
          <define name="MID_AOA_YAW_RATE_PGAIN" value="10000."/>
          <define name="MID_AOA_ELEVATOR_OF_ROLL" value="3000."/>
          <define name="HI_AOA_ROLL_RATE_PGAIN" value="20000."/>
          <define name="HI_AOA_PITCH_RATE_PGAIN" value="17500."/>
          <define name="HI_AOA_YAW_RATE_PGAIN" value="20000."/>
          <define name="HI_AOA_ELEVATOR_OF_ROLL" value="0."/>
          <define name="LO_AOA_ROLL_RATE_PGAIN" value="2150."/>
          <define name="LO_AOA_PITCH_RATE_PGAIN" value="5300."/>
          <define name="LO_AOA_YAW_RATE_PGAIN" value="10000."/>
          <define name="LO_AOA_ELEVATOR_OF_ROLL" value="4000."/>
        </section>
        <section name="THR">
          <define name="DASH_THR" value="0.6"/>
          <define name="LOITER_THR" value="0.52"/>
        </section>
        <section name="NAV">
          <define name="NAV_PITCH" value="0."/>
          <define name="NAV_GLIDE_PITCH_TRIM" value="0"/>
        </section>
        <section name="FAILSAFE" prefix="FAILSAFE_">
          <define name="DELAY_WITHOUT_GPS" value="5" unit="s"/>
          <define name="DEFAULT_THROTTLE" value="0.4" unit="%"/>
          <define name="DEFAULT_ROLL" value="0.3" unit="rad"/>
          <define name="DEFAULT_PITCH" value="0.1" unit="rad"/>
          <define name="HOME_RADIUS" value="50" unit="m"/>
        </section>
        <section name="SIMU">
          <define name="ROLL_RESPONSE_FACTOR" value="2."/>
          <define name="YAW_RESPONSE_FACTOR" value="1.35"/>
          <define name="WEIGHT" value="1.3"/>
        </section>
        <section name="MISC">
          <define name="NOMINAL_AIRSPEED" value="7." unit="m/s"/>
          <define name="CARROT" value="5." unit="s"/>
          <define name="KILL_MODE_DISTANCE" value="(MAX_DIST_FROM_HOME*1.5)" unit="m"/>
          <define name="AEROCOMM_INIT" value=""/>
          <define name="NO_API_INIT" value="TRUE"/>
          <define name="TRIGGER_DELAY" value="1.1"/>
          <define name="DEFAULT_CIRCLE_RADIUS" value="100."/>
        </section>
        <section name="DATALINK" prefix="DATALINK_">
          <define name="DEVICE_TYPE" value="AEROCOMM__"/>
          <define name="DEVICE_ADDRESS" value="...."/>
        </section>
        <makefile>include $(PAPARAZZI_SRC)/conf/autopilot/tiny.makefile
FLASH_MODE=ISP
ap.CFLAGS +=  -DFBW -DAP -DCONFIG=\&quot;tiny_0_99.h\&quot; -DLED -DTIME_LED=1
ap.srcs = sys_time.c $(SRC_ARCH)/sys_time_hw.c $(SRC_ARCH)/armVIC.c main_fbw.c main_ap.c main.c
ap.srcs += commands.c
ap.CFLAGS += -DACTUATORS=\&quot;servos_4015_MAT_hw.h\&quot; -DSERVOS_4015_MAT
ap.srcs += $(SRC_ARCH)/servos_4015_MAT_hw.c actuators.c
ap.CFLAGS += -DRADIO_CONTROL -DRADIO_CONTROL_TYPE=RC_FUTABA
ap.srcs += radio_control.c $(SRC_ARCH)/ppm_hw.c  
#ap.CFLAGS += -DDOWNLINK -DDOWNLINK_TRANSPORT=PprzTransport 
#ap.srcs += downlink.c $(SRC_ARCH)/uart_hw.c datalink.c pprz_transport.c
#ap.CFLAGS += -DDOWNLINK_FBW_DEVICE=Modem 
#ap.CFLAGS += -DDOWNLINK_AP_DEVICE=Modem 
#ap.CFLAGS += -DMODEM
#ap.srcs += $(SRC_ARCH)/modem_hw.c 
#--SERIAL MODE--------
#ap.CFLAGS += -DDOWNLINK -DUSE_UART0 -DDOWNLINK_TRANSPORT=PprzTransport 
#ap.CFLAGS += -DDOWNLINK_FBW_DEVICE=Uart0 -DDOWNLINK_AP_DEVICE=Uart0 
#ap.CFLAGS += -DPPRZ_UART=Uart0 -DUART0_BAUD=B9600
#ap.srcs += downlink.c $(SRC_ARCH)/uart_hw.c pprz_transport.c
#ap.srcs += traffic_info.c
#--API MODE-----------
#--XBEE-----------
#ap.CFLAGS += -DDOWNLINK -DUSE_UART0 -DDOWNLINK_TRANSPORT=XBeeTransport 
#ap.CFLAGS += -DDOWNLINK_FBW_DEVICE=Uart0 -DDOWNLINK_AP_DEVICE=Uart0 
#ap.CFLAGS += -DXBEE_UART=Uart0 -DDATALINK=XBEE -DUART0_BAUD=B9600
#ap.srcs += downlink.c $(SRC_ARCH)/uart_hw.c datalink.c xbee.c
#ap.srcs += traffic_info.c
#--AEROCOMM-----------
ap.CFLAGS += -DDOWNLINK -DUSE_UART0 -DDOWNLINK_TRANSPORT=AerocommTransport 
ap.CFLAGS += -DDOWNLINK_FBW_DEVICE=Uart0 -DDOWNLINK_AP_DEVICE=Uart0 
ap.CFLAGS += -DAEROCOMM_UART=Uart0 -DDATALINK=AEROCOMM -DUART0_BAUD=B9600
ap.srcs += downlink.c $(SRC_ARCH)/uart_hw.c datalink.c aerocomm_new.c
ap.srcs += traffic_info.c
ap.CFLAGS += -DINTER_MCU
ap.srcs += inter_mcu.c 
ap.CFLAGS += -DADC -DUSE_ADC_0 -DUSE_ADC_1 -DUSE_ADC_2 -DUSE_ADC_3 -DUSE_ADC_4
ap.srcs += $(SRC_ARCH)/adc_hw.c
ap.CFLAGS += -DGPS -DGPS_CONFIGURE -DUBX -DUSE_UART1 -DGPS_LINK=Uart1 -DUART1_BAUD=B38400
ap.srcs += gps_ubx.c gps.c
ap.CFLAGS += -DINFRARED 
ap.srcs += infrared.c 
#ap.CFLAGS += -DALT_KALMAN 
#ap.CFLAGS += -DIR_360
ap.srcs += estimator.c
ap.CFLAGS += -DCTL_ROLL_RATE
ap.CFLAGS += -DCTL_PITCH_RATE
ap.CFLAGS += -DCTL_YAW_RATE
ap.CFLAGS += -DTRANSITION
ap.CFLAGS += -DNAV 
#ap.CFLAGS += -DAGR_CLIMB 
#ap.CFLAGS += -DLOITER_TRIM
ap.srcs += nav.c fw_h_ctl.c fw_v_ctl.c
#ap.CFLAGS += -DGYRO -DADXRS150 
#ap.srcs += gyro.c nav_line.c 
#ap.srcs += chemotaxis.c anemotaxis.c discsurvey.c
ap.CFLAGS += -DGYRO -DIDG300 
ap.srcs += gyro.c
#ap.CFLAGS += -DACCEL -DADXL330 
#ap.srcs += accel.c
#ap.CFLAGS += -DRANGE 
#ap.CFLAGS += -DRANGE_ALT 
#ap.CFLAGS += -DATTITUDE_ROLL
#ap.CFLAGS += -DATTITUDE_PITCH
#ap.CFLAGS += -DAUTO2_MANUAL_HOVERING 
#ap.srcs += range.c
#ap.CFLAGS += -DKALMAN_ROLL_PITCH 
#ap.srcs += kalman_roll_pitch.c
#ap.srcs += bomb.c
# Hack to use the same tuning file than slayer1
ap.CFLAGS += -DUSE_GPIO
ap.srcs += $(SRC_ARCH)/gpio.c
# Harware In The Loop
#ap.CFLAGS += -DHITL
# Config for SITL simulation
include $(PAPARAZZI_SRC)/conf/autopilot/sitl.makefile
sim.CFLAGS += -DCONFIG=\&quot;tiny.h\&quot; -DAGR_CLIMB -DH_CTL_RATE_LOOP
# a test program to setup actuators 
setup_actuators.ARCHDIR = $(ARCHI)
setup_actuators.ARCH = arm7tdmi
setup_actuators.TARGET = setup_actuators
setup_actuators.TARGETDIR = setup_actuators
setup_actuators.CFLAGS += -DFBW -DCONFIG=\&quot;tiny.h\&quot; -DLED -DTIME_LED=1 -DACTUATORS=\&quot;servos_4015_hw.h\&quot; -DSERVOS_4015 -DUSE_UART0 -DUART0_BAUD=B9600 -DDATALINK=PPRZ -DPPRZ_UART=Uart0
setup_actuators.srcs += sys_time.c $(SRC_ARCH)/sys_time_hw.c $(SRC_ARCH)/armVIC.c pprz_transport.c setup_actuators.c $(SRC_ARCH)/uart_hw.c $(SRC_ARCH)/servos_4015_hw.c main.c
# a test program to tunnel between both uart
tunnel.ARCHDIR = $(ARCHI)
tunnel.ARCH = arm7tdmi
tunnel.TARGET = tunnel
tunnel.TARGETDIR = tunnel
tunnel.CFLAGS += -DFBW -DCONFIG=\&quot;tiny_0_99.h\&quot; -DLED -DTIME_LED=1
tunnel.srcs += $(SRC_ARCH)/uart_tunnel.c</makefile>
      </airframe>
      <radio name="T9cap" data_min="900" data_max="2100" sync_min="5000" sync_max="15000">
        <channel ctl="right_stick_horiz" function="ROLL" min="1939" neutral="1525" max="1114" average="0"/>
        <channel ctl="right_stick_vert" function="PITCH" min="1112" neutral="1518" max="1937" average="0"/>
        <channel ctl="left_stick_vert" function="THROTTLE" min="1940" neutral="1940" max="1115" average="0"/>
        <channel ctl="left_stick_horiz" function="YAW" min="1940" neutral="1498" max="1115" average="0"/>
        <channel ctl="switch_G" function="CALIB" min="2080" neutral="1525" max="969" average="10"/>
        <channel ctl="VRA" function="GAIN1" min="970" neutral="1520" max="2078" average="10"/>
        <channel ctl="VRC" function="GAIN2" min="970" neutral="1518" max="2077" average="10"/>
        <channel ctl="switch_C" function="MODE" min="2079" neutral="1526" max="966" average="10"/>
      </radio>
    </aircraft>
    <aircraft name="vSpin" ac_id="66" airframe="airframes/vertigo_arm_spin.xml" radio="radios/T9cap.xml" telemetry="telemetry/debug.xml" settings="settings/tuning_ver_ir.xml" flight_plan="flight_plans/maxwell_vertigo.xml">
      <flight_plan alt="770" ground_alt="758" lat0="32.22610" lon0="-111.02574" max_dist_from_home="500" name="maxwell for vertigo" qfu="180" security_height="3" wind_dir="60" wind_mod="3">
        <waypoints>
          <waypoint name="HOME" x="11.6840794038" y="1.88159691589"/>
          <waypoint name="1" x="47.676852903" y="0.432076195721"/>
          <waypoint name="2" x="-28.6443295429" y="-2.43171868613"/>
        </waypoints>
        <blocks>
          <block name="init">
            <exception cond="(RcEvent1())" deroute="landing"/>
            <exception cond="(RcEvent2())" deroute="2wp loiter"/>
            <while cond="(!launch)"/>
            <attitude pitch="0.3" roll="0.0" throttle="1.0" until="(estimator_z > SECURITY_ALT)" vmode="throttle"/>
            <deroute block="2wp loiter"/>
          </block>
          <block name="2wp loiter">
            <exception cond="(RcEvent1())" deroute="init"/>
            <exception cond="(RcEvent2())" deroute="circle"/>
            <while>
              <go approaching_time="1" throttle="auto" vmode="alt" wp="1"/>
              <go approaching_time="1" throttle="auto" vmode="alt" wp="2"/>
            </while>
          </block>
          <block name="circle">
            <exception cond="(RcEvent2())" deroute="2wp loiter"/>
            <exception cond="(RcEvent1())" deroute="landing"/>
            <circle radius="40" wp="HOME"/>
          </block>
          <block name="landing">
            <exception cond="(RcEvent2())" deroute="circle"/>
            <exception cond="(RcEvent1())" deroute="init"/>
            <go alt="GROUND_ALT+8" wp="1"/>
            <go alt="GROUND_ALT" throttle="0.30" vmode="throttle" wp="2"/>
          </block>
        </blocks>
      </flight_plan>
      <airframe name="DRAGONFLY ARM">
        <servos>
          <servo name="AILERON1" no="0" min="1000" neutral="1500" max="2000"/>
          <servo name="AILERON2" no="1" min="1000" neutral="1500" max="2000"/>
          <servo name="THROTTLE1" no="3" min="1100" neutral="1200" max="2000"/>
          <servo name="THROTTLE2" no="5" min="1100" neutral="1200" max="2000"/>
          <servo name="RUDDER" no="4" min="1000" neutral="1500" max="2000"/>
        </servos>
        <commands>
          <axis name="THROTTLE" failsafe_value="0"/>
          <axis name="ROLL" failsafe_value="0"/>
          <axis name="PITCH" failsafe_value="0"/>
          <axis name="YAW" failsafe_value="0"/>
        </commands>
        <rc_commands>
          <set command="THROTTLE" value="@THROTTLE"/>
          <set command="ROLL" value="@ROLL"/>
          <set command="PITCH" value="@PITCH"/>
          <set command="YAW" value="@YAW"/>
        </rc_commands>
        <section name="MIXER">
          <define name="AILEVON_AILERON_RATE" value="0.8"/>
          <define name="AILEVON_ELEVATOR_RATE" value="0.8"/>
          <define name="PITCH_TGAIN" value="-0.0"/>
        </section>
        <command_laws>
          <let var="roll" value="@ROLL"/>
          <let var="pitch" value="@PITCH"/>
          <let var="pitchofthr" value="@THROTTLE * PITCH_TGAIN"/>
          <set servo="AILERON1" value="-$pitch"/>
          <set servo="AILERON2" value="$pitch"/>
          <set servo="THROTTLE1" value="@THROTTLE-(.2*$roll)"/>
          <set servo="THROTTLE2" value="@THROTTLE+(.2*$roll)"/>
          <let var="yaw" value="@YAW"/>
          <set servo="RUDDER" value="+$yaw+0.0*$roll"/>
        </command_laws>
        <section name="adc" prefix="ADC_CHANNEL_">
          <define name="GYRO_ROLL" value="ADC_0"/>
          <define name="GYRO_PITCH" value="ADC_1"/>
          <define name="GYRO_YAW" value="ADC_2"/>
          <define name="GYRO_NB_SAMPLES" value="16"/>
          <define name="IR1" value="ADC_3"/>
          <define name="IR2" value="ADC_4"/>
          <define name="IR_NB_SAMPLES" value="16"/>
          <define name="RANGE" value="ADC_3"/>
          <define name="RANGE_NB_SAMPLES" value="1"/>
        </section>
        <section name="AUTO1" prefix="AUTO1_">
          <define name="MAX_ROLL" value="RadOfDeg(30)"/>
          <define name="MAX_PITCH" value="RadOfDeg(45)"/>
          <define name="MAX_YAW" value="RadOfDeg(30)"/>
        </section>
        <section name="INFRARED" prefix="IR_">
          <define name="ROLL_NEUTRAL_DEFAULT" value="DegOfRad(0.00)" unit="deg"/>
          <define name="PITCH_NEUTRAL_DEFAULT" value="DegOfRad(-1.99)" unit="deg"/>
          <define name="DEFAULT_CONTRAST" value="900"/>
          <define name="RAD_OF_IR_CONTRAST" value="1.9"/>
          <linear name="RollOfIrs" arity="2" coeff1="0.7" coeff2="-0.7"/>
          <linear name="PitchOfIrs" arity="2" coeff1="-0.7" coeff2="-0.7"/>
          <define name="RAD_OF_IR_MAX_VALUE" value="0.0045"/>
          <define name="RAD_OF_IR_MIN_VALUE" value="0.00075"/>
          <define name="ADC_ROLL_NEUTRAL" value="0"/>
          <define name="ADC_PITCH_NEUTRAL" value="0"/>
          <define name="ESTIMATED_PHI_PI_4" value="M_PI_4*0.6"/>
          <define name="CORRECTION_UP" value="1.5"/>
          <define name="CORRECTION_DOWN" value="1.5"/>
          <define name="CORRECTION_LEFT" value="1.5"/>
          <define name="CORRECTION_RIGHT" value="1.5"/>
        </section>
        <section name="GYRO" prefix="GYRO_">
          <define name="ADC_ROLL_NEUTRAL" value="472"/>
          <define name="ADC_PITCH_NEUTRAL" value="478"/>
          <define name="ADC_YAW_NEUTRAL" value="487"/>
          <define name="ROLL_SCALE" value="0.5"/>
          <define name="ROLL_DIRECTION" value="-1"/>
          <define name="PITCH_SCALE" value="0.5"/>
          <define name="PITCH_DIRECTION" value="1."/>
          <define name="YAW_SCALE" value="0.5"/>
          <define name="YAW_DIRECTION" value="-1."/>
        </section>
        <section name="ACCEL" prefix="ACCEL_">
          <define name="AX_NEUTRAL" value="528"/>
          <define name="AY_NEUTRAL" value="516"/>
          <define name="AZ_NEUTRAL" value="509"/>
          <define name="AX_SCALE" value="0.01"/>
          <define name="AY_SCALE" value="0.01"/>
          <define name="AZ_SCALE" value="0.01"/>
        </section>
        <section name="RANGE" prefix="RANGE_">
          <define name="NEUTRAL" value="0"/>
          <define name="SCALE" value="1.35"/>
          <define name="DIRECTION" value="1."/>
        </section>
        <section name="KALMAN" prefix="KALMAN_">
          <define name="Q_ANGLE" value="1e-1f"/>
          <define name="Q_GYRO" value="5e-1f"/>
          <define name="R_ANGLE" value="1e-3f"/>
        </section>
        <section name="BAT">
          <define name="MILLIAMP_PER_PERCENT" value="0.86"/>
          <define name="ADC_CHANNEL_VSUPPLY" value="AdcBank1(6)"/>
          <define name="VoltageOfAdc(adc)" value="(0.01787109375*adc)"/>
          <define name="LOW_BATTERY" value="9.3" unit="V"/>
        </section>
        <section name="VERTICAL CONTROL" prefix="V_CTL_">
          <define name="ALTITUDE_PGAIN" value="0.3"/>
          <define name="ALTITUDE_MAX_CLIMB" value="2."/>
          <define name="AUTO_THROTTLE_MIN_CRUISE_THROTTLE" value="0.30"/>
          <define name="AUTO_THROTTLE_MAX_CRUISE_THROTTLE" value="0.60"/>
          <define name="AUTO_THROTTLE_PGAIN" value="0.02"/>
          <define name="AUTO_THROTTLE_IGAIN" value="0.0"/>
          <define name="AUTO_THROTTLE_PITCH_OF_VZ_PGAIN" value="0.0"/>
          <define name="AUTO_THROTTLE_DASH_TRIM" value="1000"/>
          <define name="AUTO_THROTTLE_LOITER_TRIM" value="1500"/>
          <define name="AUTO_THROTTLE_CRUISE_THROTTLE" value="0.488"/>
          <define name="AUTO_THROTTLE_CRUISE_THROTTLE_PGAIN" value="0.01"/>
          <define name="AUTO_THROTTLE_NOMINAL_CRUISE_THROTTLE" value="0.36"/>
          <define name="AUTO_THROTTLE_CLIMB_THROTTLE_INCREMENT" value="0.01" unit="%/(m/s)"/>
          <define name="THROTTLE_SUM_NB_SAMPLES" value="32"/>
          <define name="AUTO_PITCH_PGAIN" value="0.1"/>
          <define name="AUTO_PITCH_IGAIN" value="0.0"/>
          <define name="AUTO_PITCH_MAX_PITCH" value="0.35"/>
          <define name="AUTO_PITCH_MIN_PITCH" value="-0.35"/>
          <define name="VDROP2THROTTLE" value="0"/>
          <define name="THROTTLE_SLEW" value="1.0"/>
        </section>
        <section name="HORIZONTAL CONTROL" prefix="H_CTL_">
          <define name="COURSE_PGAIN" value="0.5"/>
          <define name="ROLL_MAX_SETPOINT" value="RadOfDeg(10)" unit="radians"/>
          <define name="PITCH_MAX_SETPOINT" value="RadOfDeg(30)" unit="radians"/>
          <define name="PITCH_MIN_SETPOINT" value="RadOfDeg(-10)" unit="radians"/>
          <define name="YAW_MAX_SETPOINT" value="RadOfDeg(20)" unit="radians"/>
          <define name="ROLL_PGAIN" value="-12000."/>
          <define name="AILERON_OF_THROTTLE" value="0.0"/>
          <define name="PITCH_PGAIN" value="11950."/>
          <define name="PITCH_DGAIN" value="0.0"/>
          <define name="ELEVATOR_OF_ROLL" value="0."/>
          <define name="ROLL_RATE_MODE_DEFAULT" value="1"/>
          <define name="PITCH_RATE_MODE_DEFAULT" value="1"/>
          <define name="YAW_RATE_MODE_DEFAULT" value="1"/>
          <define name="ROLL_RATE_SETPOINT_PGAIN" value="0.75" unit="1/s"/>
          <define name="ROLL_RATE_MAX_SETPOINT" value="10"/>
          <define name="PITCH_RATE_SETPOINT_PGAIN" value="0.75" unit="1/s"/>
          <define name="PITCH_RATE_MAX_SETPOINT" value="10"/>
          <define name="YAW_RATE_SETPOINT_PGAIN" value="0.75" unit="1/s"/>
          <define name="YAW_RATE_MAX_SETPOINT" value="10"/>
          <define name="LO_THROTTLE_ROLL_RATE_PGAIN" value="20000."/>
          <define name="HI_THROTTLE_ROLL_RATE_PGAIN" value="20000."/>
          <define name="LO_THROTTLE_PITCH_RATE_PGAIN" value="20000."/>
          <define name="HI_THROTTLE_PITCH_RATE_PGAIN" value="20000."/>
          <define name="LO_THROTTLE_YAW_RATE_PGAIN" value="10000."/>
          <define name="HI_THROTTLE_YAW_RATE_PGAIN" value="10000."/>
          <define name="ROLL_RATE_IGAIN" value="0."/>
          <define name="ROLL_RATE_DGAIN" value="0."/>
          <define name="ROLL_RATE_SUM_NB_SAMPLES" value="16"/>
          <define name="PITCH_RATE_IGAIN" value="0."/>
          <define name="PITCH_RATE_DGAIN" value="0."/>
          <define name="PITCH_RATE_SUM_NB_SAMPLES" value="16"/>
          <define name="YAW_RATE_IGAIN" value="0."/>
          <define name="YAW_RATE_DGAIN" value="0."/>
          <define name="YAW_RATE_SUM_NB_SAMPLES" value="16"/>
        </section>
        <section name="THR">
          <define name="DASH_THR" value="0.6"/>
          <define name="LOITER_THR" value="0.52"/>
        </section>
        <section name="NAV">
          <define name="NAV_PITCH" value="0."/>
          <define name="NAV_GLIDE_PITCH_TRIM" value="0"/>
        </section>
        <section name="AGGRESSIVE" prefix="AGR_">
          <define name="BLEND_START" value="5"/>
          <define name="BLEND_END" value="2"/>
          <define name="CLIMB_THROTTLE" value="0.44"/>
          <define name="CLIMB_PITCH" value="RadOfDeg(15)"/>
          <define name="DESCENT_THROTTLE" value="0.36"/>
          <define name="DESCENT_PITCH" value="0.0"/>
          <define name="CLIMB_NAV_RATIO" value="0.8"/>
          <define name="DESCENT_NAV_RATIO" value="1.0"/>
        </section>
        <section name="FAILSAFE" prefix="FAILSAFE_">
          <define name="DELAY_WITHOUT_GPS" value="5" unit="s"/>
          <define name="DEFAULT_THROTTLE" value="0.2" unit="%"/>
          <define name="DEFAULT_ROLL" value="0.3" unit="rad"/>
          <define name="DEFAULT_PITCH" value="0.1" unit="rad"/>
          <define name="HOME_RADIUS" value="50" unit="m"/>
        </section>
        <section name="SIMU">
          <define name="ROLL_RESPONSE_FACTOR" value="2."/>
          <define name="YAW_RESPONSE_FACTOR" value="1.35"/>
          <define name="WEIGHT" value="1.3"/>
        </section>
        <section name="MISC">
          <define name="NOMINAL_AIRSPEED" value="7." unit="m/s"/>
          <define name="CARROT" value="5." unit="s"/>
          <define name="KILL_MODE_DISTANCE" value="(MAX_DIST_FROM_HOME*1.5)" unit="m"/>
          <define name="AEROCOMM_INIT" value=""/>
          <define name="NO_API_INIT" value="TRUE"/>
          <define name="TRIGGER_DELAY" value="1.1"/>
          <define name="DEFAULT_CIRCLE_RADIUS" value="100."/>
        </section>
        <section name="DATALINK" prefix="DATALINK_">
          <define name="DEVICE_TYPE" value="XBEE__"/>
          <define name="DEVICE_ADDRESS" value="...."/>
        </section>
        <makefile>include $(PAPARAZZI_SRC)/conf/autopilot/tiny.makefile
FLASH_MODE=ISP
ap.CFLAGS +=  -DFBW -DAP -DCONFIG=\&quot;tiny_0_99.h\&quot; -DLED -DTIME_LED=1
ap.srcs = sys_time.c $(SRC_ARCH)/sys_time_hw.c $(SRC_ARCH)/armVIC.c main_fbw.c main_ap.c main.c
ap.srcs += commands.c
ap.CFLAGS += -DACTUATORS=\&quot;servos_4015_MAT_hw.h\&quot; -DSERVOS_4015_MAT
ap.srcs += $(SRC_ARCH)/servos_4015_MAT_hw.c actuators.c
ap.CFLAGS += -DRADIO_CONTROL -DRADIO_CONTROL_TYPE=RC_FUTABA
ap.srcs += radio_control.c $(SRC_ARCH)/ppm_hw.c  
#ap.CFLAGS += -DDOWNLINK -DDOWNLINK_TRANSPORT=PprzTransport 
#ap.srcs += downlink.c $(SRC_ARCH)/uart_hw.c datalink.c pprz_transport.c
#ap.CFLAGS += -DDOWNLINK_FBW_DEVICE=Modem 
#ap.CFLAGS += -DDOWNLINK_AP_DEVICE=Modem 
#ap.CFLAGS += -DMODEM
#ap.srcs += $(SRC_ARCH)/modem_hw.c 
#--SERIAL MODE--------
#ap.CFLAGS += -DDOWNLINK -DUSE_UART0 -DDOWNLINK_TRANSPORT=PprzTransport 
#ap.CFLAGS += -DDOWNLINK_FBW_DEVICE=Uart0 -DDOWNLINK_AP_DEVICE=Uart0 
#ap.CFLAGS += -DPPRZ_UART=Uart0 -DUART0_BAUD=h_cB9600
#ap.srcs += downlink.c $(SRC_ARCH)/uart_hw.c pprz_transport.c
#ap.srcs += traffic_info.c
#--API MODE-----------
#--XBEE-----------
ap.CFLAGS += -DDOWNLINK -DUSE_UART0 -DDOWNLINK_TRANSPORT=XBeeTransport 
ap.CFLAGS += -DDOWNLINK_FBW_DEVICE=Uart0 -DDOWNLINK_AP_DEVICE=Uart0 
ap.CFLAGS += -DXBEE_UART=Uart0 -DDATALINK=XBEE -DUART0_BAUD=B9600
ap.srcs += downlink.c $(SRC_ARCH)/uart_hw.c datalink.c xbee.c
ap.srcs += traffic_info.c
#--AEROCOMM-----------
#ap.CFLAGS += -DDOWNLINK -DUSE_UART0 -DDOWNLINK_TRANSPORT=AerocommTransport 
#ap.CFLAGS += -DDOWNLINK_FBW_DEVICE=Uart0 -DDOWNLINK_AP_DEVICE=Uart0 
#ap.CFLAGS += -DAEROCOMM_UART=Uart0 -DDATALINK=AEROCOMM -DUART0_BAUD=B9600
#ap.srcs += downlink.c $(SRC_ARCH)/uart_hw.c datalink.c aerocomm_new.c
#ap.srcs += traffic_info.c
ap.CFLAGS += -DINTER_MCU
ap.srcs += inter_mcu.c 
ap.CFLAGS += -DADC -DUSE_ADC_0 -DUSE_ADC_1 -DUSE_ADC_2 -DUSE_ADC_3 -DUSE_ADC_4
ap.srcs += $(SRC_ARCH)/adc_hw.c
ap.CFLAGS += -DGPS -DGPS_CONFIGURE -DUBX -DUSE_UART1 -DGPS_LINK=Uart1 -DUART1_BAUD=B38400
ap.srcs += gps_ubx.c gps.c
ap.CFLAGS += -DINFRARED 
ap.srcs += infrared.c 
#ap.CFLAGS += -DALT_KALMAN 
#ap.CFLAGS += -DIR_360
ap.srcs += estimator.c
ap.CFLAGS += -DCTL_ROLL_RATE
ap.CFLAGS += -DCTL_PITCH_RATE
ap.CFLAGS += -DCTL_YAW_RATE
ap.CFLAGS += -DNAV 
ap.CFLAGS += -DAGR_CLIMB 
#ap.CFLAGS += -DLOITER_TRIM
ap.srcs += nav.c fw_h_ctl.c fw_v_ctl.c
#ap.CFLAGS += -DGYRO -DADXRS150 
#ap.srcs += gyro.c nav_line.c 
#ap.srcs += chemotaxis.c anemotaxis.c discsurvey.c
ap.CFLAGS += -DGYRO -DIDG300 
ap.srcs += gyro.c
#ap.CFLAGS += -DACCEL -DADXL330 
#ap.srcs += accel.c
#ap.CFLAGS += -DRANGE 
#ap.CFLAGS += -DRANGE_ALT 
ap.CFLAGS += -DATTITUDE_ROLL
ap.CFLAGS += -DATTITUDE_PITCH
#ap.CFLAGS += -DAUTO2_MANUAL_HOVERING 
#ap.srcs += range.c
#ap.CFLAGS += -DKALMAN_ROLL_PITCH 
#ap.srcs += kalman_roll_pitch.c
#ap.srcs += bomb.c
# Hack to use the same tuning file than slayer1
ap.CFLAGS += -DUSE_GPIO
ap.srcs += $(SRC_ARCH)/gpio.c
# Harware In The Loop
#ap.CFLAGS += -DHITL
# Config for SITL simulation
include $(PAPARAZZI_SRC)/conf/autopilot/sitl.makefile
sim.CFLAGS += -DCONFIG=\&quot;tiny.h\&quot; -DAGR_CLIMB -DH_CTL_RATE_LOOP
# a test program to setup actuators 
setup_actuators.ARCHDIR = $(ARCHI)
setup_actuators.ARCH = arm7tdmi
setup_actuators.TARGET = setup_actuators
setup_actuators.TARGETDIR = setup_actuators
setup_actuators.CFLAGS += -DFBW -DCONFIG=\&quot;tiny.h\&quot; -DLED -DTIME_LED=1 -DACTUATORS=\&quot;servos_4015_hw.h\&quot; -DSERVOS_4015 -DUSE_UART0 -DUART0_BAUD=B9600 -DDATALINK=PPRZ -DPPRZ_UART=Uart0
setup_actuators.srcs += sys_time.c $(SRC_ARCH)/sys_time_hw.c $(SRC_ARCH)/armVIC.c pprz_transport.c setup_actuators.c $(SRC_ARCH)/uart_hw.c $(SRC_ARCH)/servos_4015_hw.c main.c
# a test program to tunnel between both uart
tunnel.ARCHDIR = $(ARCHI)
tunnel.ARCH = arm7tdmi
tunnel.TARGET = tunnel
tunnel.TARGETDIR = tunnel
tunnel.CFLAGS += -DFBW -DCONFIG=\&quot;tiny_0_99.h\&quot; -DLED -DTIME_LED=1
tunnel.srcs += $(SRC_ARCH)/uart_tunnel.c</makefile>
      </airframe>
      <radio name="T9cap" data_min="900" data_max="2100" sync_min="5000" sync_max="15000">
        <channel ctl="right_stick_horiz" function="ROLL" min="1939" neutral="1525" max="1114" average="0"/>
        <channel ctl="right_stick_vert" function="PITCH" min="1112" neutral="1518" max="1937" average="0"/>
        <channel ctl="left_stick_vert" function="THROTTLE" min="1940" neutral="1940" max="1115" average="0"/>
        <channel ctl="left_stick_horiz" function="YAW" min="1940" neutral="1498" max="1115" average="0"/>
        <channel ctl="switch_G" function="CALIB" min="2080" neutral="1525" max="969" average="10"/>
        <channel ctl="VRA" function="GAIN1" min="970" neutral="1520" max="2078" average="10"/>
        <channel ctl="VRC" function="GAIN2" min="970" neutral="1518" max="2077" average="10"/>
        <channel ctl="switch_C" function="MODE" min="2079" neutral="1526" max="966" average="10"/>
      </radio>
    </aircraft>
    <aircraft name="v2" ac_id="4" airframe="airframes/vertigo_arm_ir_ac.xml" radio="radios/T9cap.xml" telemetry="telemetry/debug.xml" settings="settings/tuning_ver_ir.xml" flight_plan="flight_plans/mav08.xml">
      <flight_plan alt="215" ground_alt="164" lat0="27.096278" lon0="77.913667" max_dist_from_home="750" name="MAV08" qfu="270" security_height="0.2">
        <waypoints>
          <waypoint name="HOME" x="389.461688587" y="148.170916001"/>
          <waypoint name="1" x="348.968909955" y="-184.804119437"/>
          <waypoint name="2" x="483.165581494" y="-285.670723305"/>
          <waypoint name="Red Team Halt Point" x="204.79074888" y="679.384209533"/>
          <waypoint name="Test Point" x="99.9999998533" y="299.999997493"/>
          <waypoint name="Ingress Point" x="333.603316023" y="-358.913462905"/>
          <waypoint name="Launch/Landing Point" x="366.595119859" y="-351.937109483"/>
          <waypoint name="Ground Station" x="322.804592876" y="-368.369171719"/>
          <waypoint name="NF29" x="496.029520577" y="485.961978898"/>
          <waypoint name="NF28" x="616.911424299" y="383.964742707"/>
          <waypoint name="NF27" x="819.756595135" y="197.70035002"/>
          <waypoint name="NF26" x="906.504879931" y="27.1484701075"/>
          <waypoint name="NF25" x="869.429696922" y="-158.482337067"/>
          <waypoint name="NF24" x="755.026445652" y="-339.810450893"/>
          <waypoint name="NF23" x="629.636936471" y="-518.397859649"/>
          <waypoint name="NF22" x="506.828964912" y="-453.4869281"/>
          <waypoint name="NF21" x="241.868821618" y="-323.99974884"/>
          <waypoint name="NF20" x="71.7823259701" y="-244.765992408"/>
          <waypoint name="NF19" x="-145.059489499" y="-49.6092875903"/>
          <waypoint name="NF18" x="-76.3313883272" y="81.4090984818"/>
          <waypoint name="NF17" x="13.1781753246" y="262.151580174"/>
          <waypoint name="NF16" x="100.006394217" y="442.832846336"/>
          <waypoint name="NF15" x="280.264277112" y="634.888435312"/>
          <waypoint name="NF14" x="276.771388466" y="665.638972087"/>
          <waypoint name="NF13" x="259.847215367" y="680.661954578"/>
          <waypoint name="NF12" x="243.0943165" y="692.583588628"/>
          <waypoint name="NF11" x="234.689423253" y="695.493865295"/>
          <waypoint name="NF10" x="198.805945337" y="697.766465149"/>
          <waypoint name="NF9" x="179.633032238" y="694.216225675"/>
          <waypoint name="NF8" x="174.291267993" y="684.887164239"/>
          <waypoint name="NF7" x="180.132004976" y="672.712236741"/>
          <waypoint name="NF5" x="165.494338091" y="589.193877008"/>
          <waypoint name="NF6" x="144.543954508" y="542.46045385"/>
          <waypoint name="NF4" x="183.483192007" y="648.058185512"/>
          <waypoint name="NF3" x="186.588578913" y="629.720015074"/>
          <waypoint name="NF2" x="364.684984678" y="559.880062356"/>
          <waypoint name="NF1" x="291.988322978" y="604.439863"/>
          <waypoint name="A1" x="267.736035163" y="-249.536940346"/>
          <waypoint name="B1" x="108.6623204" y="-170.048237436"/>
          <waypoint name="C2" x="162.385448536" y="12.9707708214"/>
          <waypoint name="C1" x="-4.98257577419e-08" y="-8.36793333292e-07"/>
          <waypoint name="D2" x="169.396282919" y="185.70138739"/>
          <waypoint name="D1" x="59.0384800886" y="189.241514152"/>
          <waypoint name="E2" x="178.82939895" y="373.793152962"/>
          <waypoint name="E1" x="120.696083476" y="381.012203858"/>
          <waypoint name="B2" x="298.056134547" y="-131.717770102"/>
          <waypoint name="C3" x="317.865250565" y="-35.7688661949"/>
          <waypoint name="D3" x="294.045373599" y="160.867418844"/>
          <waypoint name="E3" x="261.823286676" y="360.303162226"/>
          <waypoint name="F1" x="182.634534781" y="564.859762785"/>
          <waypoint name="F2" x="229.74328388" y="553.642454231"/>
        </waypoints>
        <blocks>
          <block name="init">
            <exception cond="(RcEvent1())" deroute="landing"/>
            <exception cond="(RcEvent2())" deroute="2wp loiter"/>
            <while cond="(!launch)"/>
            <attitude pitch="0.3" roll="0.0" throttle="1.0" until="(estimator_z > SECURITY_ALT)" vmode="throttle"/>
            <deroute block="2wp loiter"/>
          </block>
          <block name="2wp loiter">
            <exception cond="(RcEvent1())" deroute="init"/>
            <exception cond="(RcEvent2())" deroute="circle"/>
            <while>
              <go approaching_time="1" pitch="0.0" throttle="auto" vmode="alt" wp="1"/>
              <go approaching_time="1" pitch="0.0" throttle="auto" vmode="alt" wp="2"/>
            </while>
          </block>
          <block name="circle">
            <exception cond="(RcEvent2())" deroute="2wp loiter"/>
            <exception cond="(RcEvent1())" deroute="landing"/>
            <circle radius="50" wp="HOME"/>
          </block>
          <block name="landing">
            <exception cond="(RcEvent2())" deroute="circle"/>
            <exception cond="(RcEvent1())" deroute="init"/>
            <go alt="GROUND_ALT+2" wp="1"/>
            <go alt="GROUND_ALT" throttle="0.10" vmode="throttle" wp="2"/>
          </block>
        </blocks>
      </flight_plan>
      <airframe name="DRAGONFLY ARM">
        <servos>
          <servo name="AILERON1" no="0" min="1000" neutral="1500" max="2000"/>
          <servo name="AILERON2" no="1" min="1000" neutral="1500" max="2000"/>
          <servo name="THROTTLE" no="3" min="1100" neutral="1200" max="2000"/>
          <servo name="RUDDER" no="4" min="1000" neutral="1500" max="2000"/>
        </servos>
        <commands>
          <axis name="THROTTLE" failsafe_value="0"/>
          <axis name="ROLL" failsafe_value="0"/>
          <axis name="PITCH" failsafe_value="0"/>
          <axis name="YAW" failsafe_value="0"/>
        </commands>
        <rc_commands>
          <set command="THROTTLE" value="@THROTTLE"/>
          <set command="ROLL" value="@ROLL"/>
          <set command="PITCH" value="@PITCH"/>
          <set command="YAW" value="@YAW"/>
        </rc_commands>
        <section name="MIXER">
          <define name="AILEVON_AILERON_RATE" value="0.8"/>
          <define name="AILEVON_ELEVATOR_RATE" value="0.8"/>
          <define name="ROLL_TGAIN" value="0.005"/>
          <define name="PITCH_TGAIN" value="-0.0"/>
        </section>
        <command_laws>
          <set servo="THROTTLE" value="@THROTTLE-(vsupply-110.0f)*vdrop2throt_coeff"/>
          <let var="roll" value="@ROLL"/>
          <let var="rollofthr" value="@THROTTLE * ROLL_TGAIN"/>
          <let var="pitch" value="@PITCH"/>
          <let var="pitchofthr" value="@THROTTLE * PITCH_TGAIN"/>
          <set servo="AILERON1" value="$roll+$pitch"/>
          <set servo="AILERON2" value="$roll-$pitch"/>
          <let var="yaw" value="@YAW"/>
          <set servo="RUDDER" value="+$yaw+0.0*$roll"/>
        </command_laws>
        <section name="adc" prefix="ADC_CHANNEL_">
          <define name="GYRO_ROLL" value="ADC_0"/>
          <define name="GYRO_PITCH" value="ADC_1"/>
          <define name="GYRO_YAW" value="ADC_2"/>
          <define name="GYRO_NB_SAMPLES" value="16"/>
          <define name="IR1" value="ADC_3"/>
          <define name="IR2" value="ADC_4"/>
          <define name="IR_NB_SAMPLES" value="16"/>
        </section>
        <section name="AUTO1" prefix="AUTO1_">
          <define name="MAX_ROLL" value="RadOfDeg(30)"/>
          <define name="MAX_PITCH" value="RadOfDeg(90)"/>
          <define name="MAX_YAW" value="RadOfDeg(30)"/>
        </section>
        <section name="INFRARED" prefix="IR_">
          <define name="ROLL_NEUTRAL_DEFAULT" value="1" unit="deg"/>
          <define name="PITCH_NEUTRAL_DEFAULT" value="-61.1" unit="deg"/>
          <define name="DEFAULT_CONTRAST" value="900"/>
          <define name="RAD_OF_IR_CONTRAST" value="1.9"/>
          <linear name="RollOfIrs" arity="2" coeff1="0.7" coeff2="-0.7"/>
          <linear name="PitchOfIrs" arity="2" coeff1="-0.7" coeff2="-0.7"/>
          <define name="RAD_OF_IR_MAX_VALUE" value="0.0045"/>
          <define name="RAD_OF_IR_MIN_VALUE" value="0.00075"/>
          <define name="ADC_ROLL_NEUTRAL" value="0"/>
          <define name="ADC_PITCH_NEUTRAL" value="0"/>
          <define name="ESTIMATED_PHI_PI_4" value="M_PI_4*0.6"/>
          <define name="CORRECTION_UP" value="1.5"/>
          <define name="CORRECTION_DOWN" value="1.5"/>
          <define name="CORRECTION_LEFT" value="1.5"/>
          <define name="CORRECTION_RIGHT" value="1.5"/>
        </section>
        <section name="GYRO" prefix="GYRO_">
          <define name="ADC_ROLL_NEUTRAL" value="517"/>
          <define name="ADC_PITCH_NEUTRAL" value="482"/>
          <define name="ADC_YAW_NEUTRAL" value="455"/>
          <define name="ROLL_SCALE" value="0.5"/>
          <define name="ROLL_DIRECTION" value="-1"/>
          <define name="PITCH_SCALE" value="0.5"/>
          <define name="PITCH_DIRECTION" value="1."/>
          <define name="YAW_SCALE" value="0.5"/>
          <define name="YAW_DIRECTION" value="1."/>
        </section>
        <section name="KALMAN" prefix="KALMAN_">
          <define name="Q_ANGLE" value="1e-1f"/>
          <define name="Q_GYRO" value="5e-1f"/>
          <define name="R_ANGLE" value="1e-3f"/>
        </section>
        <section name="BAT">
          <define name="MILLIAMP_PER_PERCENT" value="0.86"/>
          <define name="ADC_CHANNEL_VSUPPLY" value="AdcBank1(6)"/>
          <define name="VoltageOfAdc(adc)" value="(0.01787109375*adc)"/>
          <define name="LOW_BATTERY" value="9.3" unit="V"/>
        </section>
        <section name="VERTICAL CONTROL" prefix="V_CTL_">
          <define name="ALTITUDE_PGAIN" value="0.228"/>
          <define name="ALTITUDE_MAX_CLIMB" value="2."/>
          <define name="AUTO_THROTTLE_MIN_CRUISE_THROTTLE" value="0.38"/>
          <define name="AUTO_THROTTLE_MAX_CRUISE_THROTTLE" value="0.45"/>
          <define name="AUTO_THROTTLE_PGAIN" value="0.023"/>
          <define name="AUTO_THROTTLE_IGAIN" value="0.001"/>
          <define name="AUTO_THROTTLE_PITCH_OF_VZ_PGAIN" value="0.01"/>
          <define name="AUTO_THROTTLE_DASH_TRIM" value="1000"/>
          <define name="AUTO_THROTTLE_LOITER_TRIM" value="1500"/>
          <define name="AUTO_THROTTLE_CRUISE_THROTTLE" value="0.423"/>
          <define name="AUTO_THROTTLE_CRUISE_THROTTLE_PGAIN" value="0"/>
          <define name="AUTO_THROTTLE_NOMINAL_CRUISE_THROTTLE" value="0.42"/>
          <define name="AUTO_THROTTLE_CLIMB_THROTTLE_INCREMENT" value="0.01" unit="%/(m/s)"/>
          <define name="THROTTLE_SUM_NB_SAMPLES" value="32"/>
          <define name="AUTO_PITCH_PGAIN" value="0.1"/>
          <define name="AUTO_PITCH_IGAIN" value="0.0"/>
          <define name="AUTO_PITCH_MAX_PITCH" value="0.35"/>
          <define name="AUTO_PITCH_MIN_PITCH" value="-0.35"/>
          <define name="VDROP2THROTTLE" value="0"/>
          <define name="THROTTLE_SLEW" value="1.0"/>
        </section>
        <section name="HORIZONTAL CONTROL" prefix="H_CTL_">
          <define name="COURSE_PGAIN" value="0.067"/>
          <define name="ROLL_MAX_SETPOINT" value="RadOfDeg(10)" unit="radians"/>
          <define name="PITCH_MAX_SETPOINT" value="RadOfDeg(50)" unit="radians"/>
          <define name="PITCH_MIN_SETPOINT" value="RadOfDeg(-50)" unit="radians"/>
          <define name="YAW_MAX_SETPOINT" value="RadOfDeg(20)" unit="radians"/>
          <define name="ROLL_PGAIN" value="-12000."/>
          <define name="AILERON_OF_THROTTLE" value="0.0"/>
          <define name="PITCH_PGAIN" value="11950."/>
          <define name="PITCH_DGAIN" value="0.0"/>
          <define name="ELEVATOR_OF_ROLL" value="0."/>
          <define name="ROLL_RATE_MODE_DEFAULT" value="1"/>
          <define name="PITCH_RATE_MODE_DEFAULT" value="1"/>
          <define name="YAW_RATE_MODE_DEFAULT" value="1"/>
          <define name="ROLL_RATE_SETPOINT_PGAIN" value="0.75" unit="1/s"/>
          <define name="ROLL_RATE_MAX_SETPOINT" value="10"/>
          <define name="PITCH_RATE_SETPOINT_PGAIN" value="0.75" unit="1/s"/>
          <define name="PITCH_RATE_MAX_SETPOINT" value="10"/>
          <define name="YAW_RATE_SETPOINT_PGAIN" value="0.75" unit="1/s"/>
          <define name="YAW_RATE_MAX_SETPOINT" value="10"/>
          <define name="LO_THROTTLE_ROLL_RATE_PGAIN" value="28400."/>
          <define name="HI_THROTTLE_ROLL_RATE_PGAIN" value="28400."/>
          <define name="LO_THROTTLE_PITCH_RATE_PGAIN" value="26800."/>
          <define name="HI_THROTTLE_PITCH_RATE_PGAIN" value="26800."/>
          <define name="LO_THROTTLE_YAW_RATE_PGAIN" value="24600."/>
          <define name="HI_THROTTLE_YAW_RATE_PGAIN" value="24600."/>
          <define name="ROLL_RATE_IGAIN" value="0."/>
          <define name="ROLL_RATE_DGAIN" value="0."/>
          <define name="ROLL_RATE_SUM_NB_SAMPLES" value="16"/>
          <define name="PITCH_RATE_IGAIN" value="0."/>
          <define name="PITCH_RATE_DGAIN" value="0."/>
          <define name="PITCH_RATE_SUM_NB_SAMPLES" value="16"/>
          <define name="YAW_RATE_IGAIN" value="0."/>
          <define name="YAW_RATE_DGAIN" value="0."/>
          <define name="YAW_RATE_SUM_NB_SAMPLES" value="16"/>
          <define name="MID_AOA_ROLL_RATE_PGAIN" value="7500."/>
          <define name="MID_AOA_PITCH_RATE_PGAIN" value="11250."/>
          <define name="MID_AOA_YAW_RATE_PGAIN" value="10000."/>
          <define name="MID_AOA_ELEVATOR_OF_ROLL" value="3000."/>
          <define name="HI_AOA_ROLL_RATE_PGAIN" value="20000."/>
          <define name="HI_AOA_PITCH_RATE_PGAIN" value="17500."/>
          <define name="HI_AOA_YAW_RATE_PGAIN" value="20000."/>
          <define name="HI_AOA_ELEVATOR_OF_ROLL" value="0."/>
          <define name="LO_AOA_ROLL_RATE_PGAIN" value="2150."/>
          <define name="LO_AOA_PITCH_RATE_PGAIN" value="5300."/>
          <define name="LO_AOA_YAW_RATE_PGAIN" value="10000."/>
          <define name="LO_AOA_ELEVATOR_OF_ROLL" value="4000."/>
        </section>
        <section name="THR">
          <define name="DASH_THR" value="0.6"/>
          <define name="LOITER_THR" value="0.52"/>
        </section>
        <section name="NAV">
          <define name="NAV_PITCH" value="0."/>
          <define name="NAV_GLIDE_PITCH_TRIM" value="0"/>
        </section>
        <section name="FAILSAFE" prefix="FAILSAFE_">
          <define name="DELAY_WITHOUT_GPS" value="5" unit="s"/>
          <define name="DEFAULT_THROTTLE" value="0.4" unit="%"/>
          <define name="DEFAULT_ROLL" value="0.3" unit="rad"/>
          <define name="DEFAULT_PITCH" value="0.1" unit="rad"/>
          <define name="HOME_RADIUS" value="50" unit="m"/>
        </section>
        <section name="SIMU">
          <define name="ROLL_RESPONSE_FACTOR" value="2."/>
          <define name="YAW_RESPONSE_FACTOR" value="1.35"/>
          <define name="WEIGHT" value="1.3"/>
        </section>
        <section name="MISC">
          <define name="NOMINAL_AIRSPEED" value="7." unit="m/s"/>
          <define name="CARROT" value="5." unit="s"/>
          <define name="KILL_MODE_DISTANCE" value="(MAX_DIST_FROM_HOME*1.5)" unit="m"/>
          <define name="AEROCOMM_INIT" value=""/>
          <define name="NO_API_INIT" value="TRUE"/>
          <define name="TRIGGER_DELAY" value="1.1"/>
          <define name="DEFAULT_CIRCLE_RADIUS" value="100."/>
        </section>
        <section name="DATALINK" prefix="DATALINK_">
          <define name="DEVICE_TYPE" value="AEROCOMM__"/>
          <define name="DEVICE_ADDRESS" value="...."/>
        </section>
        <makefile>include $(PAPARAZZI_SRC)/conf/autopilot/tiny.makefile
FLASH_MODE=ISP
ap.CFLAGS +=  -DFBW -DAP -DCONFIG=\&quot;tiny_0_99.h\&quot; -DLED -DTIME_LED=1
ap.srcs = sys_time.c $(SRC_ARCH)/sys_time_hw.c $(SRC_ARCH)/armVIC.c main_fbw.c main_ap.c main.c
ap.srcs += commands.c
ap.CFLAGS += -DACTUATORS=\&quot;servos_4015_MAT_hw.h\&quot; -DSERVOS_4015_MAT
ap.srcs += $(SRC_ARCH)/servos_4015_MAT_hw.c actuators.c
ap.CFLAGS += -DRADIO_CONTROL -DRADIO_CONTROL_TYPE=RC_FUTABA
ap.srcs += radio_control.c $(SRC_ARCH)/ppm_hw.c  
#ap.CFLAGS += -DDOWNLINK -DDOWNLINK_TRANSPORT=PprzTransport 
#ap.srcs += downlink.c $(SRC_ARCH)/uart_hw.c datalink.c pprz_transport.c
#ap.CFLAGS += -DDOWNLINK_FBW_DEVICE=Modem 
#ap.CFLAGS += -DDOWNLINK_AP_DEVICE=Modem 
#ap.CFLAGS += -DMODEM
#ap.srcs += $(SRC_ARCH)/modem_hw.c 
#--SERIAL MODE--------
#ap.CFLAGS += -DDOWNLINK -DUSE_UART0 -DDOWNLINK_TRANSPORT=PprzTransport 
#ap.CFLAGS += -DDOWNLINK_FBW_DEVICE=Uart0 -DDOWNLINK_AP_DEVICE=Uart0 
#ap.CFLAGS += -DPPRZ_UART=Uart0 -DUART0_BAUD=B9600
#ap.srcs += downlink.c $(SRC_ARCH)/uart_hw.c pprz_transport.c
#ap.srcs += traffic_info.c
#--API MODE-----------
#--XBEE-----------
#ap.CFLAGS += -DDOWNLINK -DUSE_UART0 -DDOWNLINK_TRANSPORT=XBeeTransport 
#ap.CFLAGS += -DDOWNLINK_FBW_DEVICE=Uart0 -DDOWNLINK_AP_DEVICE=Uart0 
#ap.CFLAGS += -DXBEE_UART=Uart0 -DDATALINK=XBEE -DUART0_BAUD=B9600
#ap.srcs += downlink.c $(SRC_ARCH)/uart_hw.c datalink.c xbee.c
#ap.srcs += traffic_info.c
#--AEROCOMM-----------
ap.CFLAGS += -DDOWNLINK -DUSE_UART0 -DDOWNLINK_TRANSPORT=AerocommTransport 
ap.CFLAGS += -DDOWNLINK_FBW_DEVICE=Uart0 -DDOWNLINK_AP_DEVICE=Uart0 
ap.CFLAGS += -DAEROCOMM_UART=Uart0 -DDATALINK=AEROCOMM -DUART0_BAUD=B9600
ap.srcs += downlink.c $(SRC_ARCH)/uart_hw.c datalink.c aerocomm_new.c
ap.srcs += traffic_info.c
ap.CFLAGS += -DINTER_MCU
ap.srcs += inter_mcu.c 
ap.CFLAGS += -DADC -DUSE_ADC_0 -DUSE_ADC_1 -DUSE_ADC_2 -DUSE_ADC_3 -DUSE_ADC_4
ap.srcs += $(SRC_ARCH)/adc_hw.c
ap.CFLAGS += -DGPS -DGPS_CONFIGURE -DUBX -DUSE_UART1 -DGPS_LINK=Uart1 -DUART1_BAUD=B38400
ap.srcs += gps_ubx.c gps.c
ap.CFLAGS += -DINFRARED 
ap.srcs += infrared.c 
#ap.CFLAGS += -DALT_KALMAN 
#ap.CFLAGS += -DIR_360
ap.srcs += estimator.c
ap.CFLAGS += -DCTL_ROLL_RATE
ap.CFLAGS += -DCTL_PITCH_RATE
ap.CFLAGS += -DCTL_YAW_RATE
ap.CFLAGS += -DTRANSITION
ap.CFLAGS += -DNAV 
#ap.CFLAGS += -DAGR_CLIMB 
#ap.CFLAGS += -DLOITER_TRIM
ap.srcs += nav.c fw_h_ctl.c fw_v_ctl.c
#ap.CFLAGS += -DGYRO -DADXRS150 
#ap.srcs += gyro.c nav_line.c 
#ap.srcs += chemotaxis.c anemotaxis.c discsurvey.c
ap.CFLAGS += -DGYRO -DIDG300 
ap.srcs += gyro.c
#ap.CFLAGS += -DACCEL -DADXL330 
#ap.srcs += accel.c
#ap.CFLAGS += -DRANGE 
#ap.CFLAGS += -DRANGE_ALT 
#ap.CFLAGS += -DATTITUDE_ROLL
#ap.CFLAGS += -DATTITUDE_PITCH
#ap.CFLAGS += -DAUTO2_MANUAL_HOVERING 
#ap.srcs += range.c
#ap.CFLAGS += -DKALMAN_ROLL_PITCH 
#ap.srcs += kalman_roll_pitch.c
#ap.srcs += bomb.c
# Hack to use the same tuning file than slayer1
ap.CFLAGS += -DUSE_GPIO
ap.srcs += $(SRC_ARCH)/gpio.c
# Harware In The Loop
#ap.CFLAGS += -DHITL
# Config for SITL simulation
include $(PAPARAZZI_SRC)/conf/autopilot/sitl.makefile
sim.CFLAGS += -DCONFIG=\&quot;tiny.h\&quot; -DAGR_CLIMB -DH_CTL_RATE_LOOP
# a test program to setup actuators 
setup_actuators.ARCHDIR = $(ARCHI)
setup_actuators.ARCH = arm7tdmi
setup_actuators.TARGET = setup_actuators
setup_actuators.TARGETDIR = setup_actuators
setup_actuators.CFLAGS += -DFBW -DCONFIG=\&quot;tiny.h\&quot; -DLED -DTIME_LED=1 -DACTUATORS=\&quot;servos_4015_hw.h\&quot; -DSERVOS_4015 -DUSE_UART0 -DUART0_BAUD=B9600 -DDATALINK=PPRZ -DPPRZ_UART=Uart0
setup_actuators.srcs += sys_time.c $(SRC_ARCH)/sys_time_hw.c $(SRC_ARCH)/armVIC.c pprz_transport.c setup_actuators.c $(SRC_ARCH)/uart_hw.c $(SRC_ARCH)/servos_4015_hw.c main.c
# a test program to tunnel between both uart
tunnel.ARCHDIR = $(ARCHI)
tunnel.ARCH = arm7tdmi
tunnel.TARGET = tunnel
tunnel.TARGETDIR = tunnel
tunnel.CFLAGS += -DFBW -DCONFIG=\&quot;tiny_0_99.h\&quot; -DLED -DTIME_LED=1
tunnel.srcs += $(SRC_ARCH)/uart_tunnel.c</makefile>
      </airframe>
      <radio name="T9cap" data_min="900" data_max="2100" sync_min="5000" sync_max="15000">
        <channel ctl="right_stick_horiz" function="ROLL" min="1939" neutral="1525" max="1114" average="0"/>
        <channel ctl="right_stick_vert" function="PITCH" min="1112" neutral="1518" max="1937" average="0"/>
        <channel ctl="left_stick_vert" function="THROTTLE" min="1940" neutral="1940" max="1115" average="0"/>
        <channel ctl="left_stick_horiz" function="YAW" min="1940" neutral="1498" max="1115" average="0"/>
        <channel ctl="switch_G" function="CALIB" min="2080" neutral="1525" max="969" average="10"/>
        <channel ctl="VRA" function="GAIN1" min="970" neutral="1520" max="2078" average="10"/>
        <channel ctl="VRC" function="GAIN2" min="970" neutral="1518" max="2077" average="10"/>
        <channel ctl="switch_C" function="MODE" min="2079" neutral="1526" max="966" average="10"/>
      </radio>
    </aircraft>
    <aircraft name="v3" ac_id="5" airframe="airframes/vertigo_arm_ir_ac.xml" radio="radios/T9cap.xml" telemetry="telemetry/debug.xml" settings="settings/tuning_ver_ir.xml" flight_plan="flight_plans/maxwell_vertigo.xml">
      <flight_plan alt="770" ground_alt="758" lat0="32.22610" lon0="-111.02574" max_dist_from_home="500" name="maxwell for vertigo" qfu="180" security_height="3" wind_dir="60" wind_mod="3">
        <waypoints>
          <waypoint name="HOME" x="11.6840794038" y="1.88159691589"/>
          <waypoint name="1" x="47.676852903" y="0.432076195721"/>
          <waypoint name="2" x="-28.6443295429" y="-2.43171868613"/>
        </waypoints>
        <blocks>
          <block name="init">
            <exception cond="(RcEvent1())" deroute="landing"/>
            <exception cond="(RcEvent2())" deroute="2wp loiter"/>
            <while cond="(!launch)"/>
            <attitude pitch="0.3" roll="0.0" throttle="1.0" until="(estimator_z > SECURITY_ALT)" vmode="throttle"/>
            <deroute block="2wp loiter"/>
          </block>
          <block name="2wp loiter">
            <exception cond="(RcEvent1())" deroute="init"/>
            <exception cond="(RcEvent2())" deroute="circle"/>
            <while>
              <go approaching_time="1" throttle="auto" vmode="alt" wp="1"/>
              <go approaching_time="1" throttle="auto" vmode="alt" wp="2"/>
            </while>
          </block>
          <block name="circle">
            <exception cond="(RcEvent2())" deroute="2wp loiter"/>
            <exception cond="(RcEvent1())" deroute="landing"/>
            <circle radius="40" wp="HOME"/>
          </block>
          <block name="landing">
            <exception cond="(RcEvent2())" deroute="circle"/>
            <exception cond="(RcEvent1())" deroute="init"/>
            <go alt="GROUND_ALT+8" wp="1"/>
            <go alt="GROUND_ALT" throttle="0.30" vmode="throttle" wp="2"/>
          </block>
        </blocks>
      </flight_plan>
      <airframe name="DRAGONFLY ARM">
        <servos>
          <servo name="AILERON1" no="0" min="1000" neutral="1500" max="2000"/>
          <servo name="AILERON2" no="1" min="1000" neutral="1500" max="2000"/>
          <servo name="THROTTLE" no="3" min="1100" neutral="1200" max="2000"/>
          <servo name="RUDDER" no="4" min="1000" neutral="1500" max="2000"/>
        </servos>
        <commands>
          <axis name="THROTTLE" failsafe_value="0"/>
          <axis name="ROLL" failsafe_value="0"/>
          <axis name="PITCH" failsafe_value="0"/>
          <axis name="YAW" failsafe_value="0"/>
        </commands>
        <rc_commands>
          <set command="THROTTLE" value="@THROTTLE"/>
          <set command="ROLL" value="@ROLL"/>
          <set command="PITCH" value="@PITCH"/>
          <set command="YAW" value="@YAW"/>
        </rc_commands>
        <section name="MIXER">
          <define name="AILEVON_AILERON_RATE" value="0.8"/>
          <define name="AILEVON_ELEVATOR_RATE" value="0.8"/>
          <define name="ROLL_TGAIN" value="0.005"/>
          <define name="PITCH_TGAIN" value="-0.0"/>
        </section>
        <command_laws>
          <set servo="THROTTLE" value="@THROTTLE-(vsupply-110.0f)*vdrop2throt_coeff"/>
          <let var="roll" value="@ROLL"/>
          <let var="rollofthr" value="@THROTTLE * ROLL_TGAIN"/>
          <let var="pitch" value="@PITCH"/>
          <let var="pitchofthr" value="@THROTTLE * PITCH_TGAIN"/>
          <set servo="AILERON1" value="$roll+$pitch"/>
          <set servo="AILERON2" value="$roll-$pitch"/>
          <let var="yaw" value="@YAW"/>
          <set servo="RUDDER" value="+$yaw+0.0*$roll"/>
        </command_laws>
        <section name="adc" prefix="ADC_CHANNEL_">
          <define name="GYRO_ROLL" value="ADC_0"/>
          <define name="GYRO_PITCH" value="ADC_1"/>
          <define name="GYRO_YAW" value="ADC_2"/>
          <define name="GYRO_NB_SAMPLES" value="16"/>
          <define name="IR1" value="ADC_3"/>
          <define name="IR2" value="ADC_4"/>
          <define name="IR_NB_SAMPLES" value="16"/>
        </section>
        <section name="AUTO1" prefix="AUTO1_">
          <define name="MAX_ROLL" value="RadOfDeg(30)"/>
          <define name="MAX_PITCH" value="RadOfDeg(90)"/>
          <define name="MAX_YAW" value="RadOfDeg(30)"/>
        </section>
        <section name="INFRARED" prefix="IR_">
          <define name="ROLL_NEUTRAL_DEFAULT" value="1" unit="deg"/>
          <define name="PITCH_NEUTRAL_DEFAULT" value="-61.1" unit="deg"/>
          <define name="DEFAULT_CONTRAST" value="900"/>
          <define name="RAD_OF_IR_CONTRAST" value="1.9"/>
          <linear name="RollOfIrs" arity="2" coeff1="0.7" coeff2="-0.7"/>
          <linear name="PitchOfIrs" arity="2" coeff1="-0.7" coeff2="-0.7"/>
          <define name="RAD_OF_IR_MAX_VALUE" value="0.0045"/>
          <define name="RAD_OF_IR_MIN_VALUE" value="0.00075"/>
          <define name="ADC_ROLL_NEUTRAL" value="0"/>
          <define name="ADC_PITCH_NEUTRAL" value="0"/>
          <define name="ESTIMATED_PHI_PI_4" value="M_PI_4*0.6"/>
          <define name="CORRECTION_UP" value="1.5"/>
          <define name="CORRECTION_DOWN" value="1.5"/>
          <define name="CORRECTION_LEFT" value="1.5"/>
          <define name="CORRECTION_RIGHT" value="1.5"/>
        </section>
        <section name="GYRO" prefix="GYRO_">
          <define name="ADC_ROLL_NEUTRAL" value="517"/>
          <define name="ADC_PITCH_NEUTRAL" value="482"/>
          <define name="ADC_YAW_NEUTRAL" value="455"/>
          <define name="ROLL_SCALE" value="0.5"/>
          <define name="ROLL_DIRECTION" value="-1"/>
          <define name="PITCH_SCALE" value="0.5"/>
          <define name="PITCH_DIRECTION" value="1."/>
          <define name="YAW_SCALE" value="0.5"/>
          <define name="YAW_DIRECTION" value="1."/>
        </section>
        <section name="KALMAN" prefix="KALMAN_">
          <define name="Q_ANGLE" value="1e-1f"/>
          <define name="Q_GYRO" value="5e-1f"/>
          <define name="R_ANGLE" value="1e-3f"/>
        </section>
        <section name="BAT">
          <define name="MILLIAMP_PER_PERCENT" value="0.86"/>
          <define name="ADC_CHANNEL_VSUPPLY" value="AdcBank1(6)"/>
          <define name="VoltageOfAdc(adc)" value="(0.01787109375*adc)"/>
          <define name="LOW_BATTERY" value="9.3" unit="V"/>
        </section>
        <section name="VERTICAL CONTROL" prefix="V_CTL_">
          <define name="ALTITUDE_PGAIN" value="0.228"/>
          <define name="ALTITUDE_MAX_CLIMB" value="2."/>
          <define name="AUTO_THROTTLE_MIN_CRUISE_THROTTLE" value="0.38"/>
          <define name="AUTO_THROTTLE_MAX_CRUISE_THROTTLE" value="0.45"/>
          <define name="AUTO_THROTTLE_PGAIN" value="0.023"/>
          <define name="AUTO_THROTTLE_IGAIN" value="0.001"/>
          <define name="AUTO_THROTTLE_PITCH_OF_VZ_PGAIN" value="0.01"/>
          <define name="AUTO_THROTTLE_DASH_TRIM" value="1000"/>
          <define name="AUTO_THROTTLE_LOITER_TRIM" value="1500"/>
          <define name="AUTO_THROTTLE_CRUISE_THROTTLE" value="0.423"/>
          <define name="AUTO_THROTTLE_CRUISE_THROTTLE_PGAIN" value="0"/>
          <define name="AUTO_THROTTLE_NOMINAL_CRUISE_THROTTLE" value="0.42"/>
          <define name="AUTO_THROTTLE_CLIMB_THROTTLE_INCREMENT" value="0.01" unit="%/(m/s)"/>
          <define name="THROTTLE_SUM_NB_SAMPLES" value="32"/>
          <define name="AUTO_PITCH_PGAIN" value="0.1"/>
          <define name="AUTO_PITCH_IGAIN" value="0.0"/>
          <define name="AUTO_PITCH_MAX_PITCH" value="0.35"/>
          <define name="AUTO_PITCH_MIN_PITCH" value="-0.35"/>
          <define name="VDROP2THROTTLE" value="0"/>
          <define name="THROTTLE_SLEW" value="1.0"/>
        </section>
        <section name="HORIZONTAL CONTROL" prefix="H_CTL_">
          <define name="COURSE_PGAIN" value="0.067"/>
          <define name="ROLL_MAX_SETPOINT" value="RadOfDeg(10)" unit="radians"/>
          <define name="PITCH_MAX_SETPOINT" value="RadOfDeg(50)" unit="radians"/>
          <define name="PITCH_MIN_SETPOINT" value="RadOfDeg(-50)" unit="radians"/>
          <define name="YAW_MAX_SETPOINT" value="RadOfDeg(20)" unit="radians"/>
          <define name="ROLL_PGAIN" value="-12000."/>
          <define name="AILERON_OF_THROTTLE" value="0.0"/>
          <define name="PITCH_PGAIN" value="11950."/>
          <define name="PITCH_DGAIN" value="0.0"/>
          <define name="ELEVATOR_OF_ROLL" value="0."/>
          <define name="ROLL_RATE_MODE_DEFAULT" value="1"/>
          <define name="PITCH_RATE_MODE_DEFAULT" value="1"/>
          <define name="YAW_RATE_MODE_DEFAULT" value="1"/>
          <define name="ROLL_RATE_SETPOINT_PGAIN" value="0.75" unit="1/s"/>
          <define name="ROLL_RATE_MAX_SETPOINT" value="10"/>
          <define name="PITCH_RATE_SETPOINT_PGAIN" value="0.75" unit="1/s"/>
          <define name="PITCH_RATE_MAX_SETPOINT" value="10"/>
          <define name="YAW_RATE_SETPOINT_PGAIN" value="0.75" unit="1/s"/>
          <define name="YAW_RATE_MAX_SETPOINT" value="10"/>
          <define name="LO_THROTTLE_ROLL_RATE_PGAIN" value="28400."/>
          <define name="HI_THROTTLE_ROLL_RATE_PGAIN" value="28400."/>
          <define name="LO_THROTTLE_PITCH_RATE_PGAIN" value="26800."/>
          <define name="HI_THROTTLE_PITCH_RATE_PGAIN" value="26800."/>
          <define name="LO_THROTTLE_YAW_RATE_PGAIN" value="24600."/>
          <define name="HI_THROTTLE_YAW_RATE_PGAIN" value="24600."/>
          <define name="ROLL_RATE_IGAIN" value="0."/>
          <define name="ROLL_RATE_DGAIN" value="0."/>
          <define name="ROLL_RATE_SUM_NB_SAMPLES" value="16"/>
          <define name="PITCH_RATE_IGAIN" value="0."/>
          <define name="PITCH_RATE_DGAIN" value="0."/>
          <define name="PITCH_RATE_SUM_NB_SAMPLES" value="16"/>
          <define name="YAW_RATE_IGAIN" value="0."/>
          <define name="YAW_RATE_DGAIN" value="0."/>
          <define name="YAW_RATE_SUM_NB_SAMPLES" value="16"/>
          <define name="MID_AOA_ROLL_RATE_PGAIN" value="7500."/>
          <define name="MID_AOA_PITCH_RATE_PGAIN" value="11250."/>
          <define name="MID_AOA_YAW_RATE_PGAIN" value="10000."/>
          <define name="MID_AOA_ELEVATOR_OF_ROLL" value="3000."/>
          <define name="HI_AOA_ROLL_RATE_PGAIN" value="20000."/>
          <define name="HI_AOA_PITCH_RATE_PGAIN" value="17500."/>
          <define name="HI_AOA_YAW_RATE_PGAIN" value="20000."/>
          <define name="HI_AOA_ELEVATOR_OF_ROLL" value="0."/>
          <define name="LO_AOA_ROLL_RATE_PGAIN" value="2150."/>
          <define name="LO_AOA_PITCH_RATE_PGAIN" value="5300."/>
          <define name="LO_AOA_YAW_RATE_PGAIN" value="10000."/>
          <define name="LO_AOA_ELEVATOR_OF_ROLL" value="4000."/>
        </section>
        <section name="THR">
          <define name="DASH_THR" value="0.6"/>
          <define name="LOITER_THR" value="0.52"/>
        </section>
        <section name="NAV">
          <define name="NAV_PITCH" value="0."/>
          <define name="NAV_GLIDE_PITCH_TRIM" value="0"/>
        </section>
        <section name="FAILSAFE" prefix="FAILSAFE_">
          <define name="DELAY_WITHOUT_GPS" value="5" unit="s"/>
          <define name="DEFAULT_THROTTLE" value="0.4" unit="%"/>
          <define name="DEFAULT_ROLL" value="0.3" unit="rad"/>
          <define name="DEFAULT_PITCH" value="0.1" unit="rad"/>
          <define name="HOME_RADIUS" value="50" unit="m"/>
        </section>
        <section name="SIMU">
          <define name="ROLL_RESPONSE_FACTOR" value="2."/>
          <define name="YAW_RESPONSE_FACTOR" value="1.35"/>
          <define name="WEIGHT" value="1.3"/>
        </section>
        <section name="MISC">
          <define name="NOMINAL_AIRSPEED" value="7." unit="m/s"/>
          <define name="CARROT" value="5." unit="s"/>
          <define name="KILL_MODE_DISTANCE" value="(MAX_DIST_FROM_HOME*1.5)" unit="m"/>
          <define name="AEROCOMM_INIT" value=""/>
          <define name="NO_API_INIT" value="TRUE"/>
          <define name="TRIGGER_DELAY" value="1.1"/>
          <define name="DEFAULT_CIRCLE_RADIUS" value="100."/>
        </section>
        <section name="DATALINK" prefix="DATALINK_">
          <define name="DEVICE_TYPE" value="AEROCOMM__"/>
          <define name="DEVICE_ADDRESS" value="...."/>
        </section>
        <makefile>include $(PAPARAZZI_SRC)/conf/autopilot/tiny.makefile
FLASH_MODE=ISP
ap.CFLAGS +=  -DFBW -DAP -DCONFIG=\&quot;tiny_0_99.h\&quot; -DLED -DTIME_LED=1
ap.srcs = sys_time.c $(SRC_ARCH)/sys_time_hw.c $(SRC_ARCH)/armVIC.c main_fbw.c main_ap.c main.c
ap.srcs += commands.c
ap.CFLAGS += -DACTUATORS=\&quot;servos_4015_MAT_hw.h\&quot; -DSERVOS_4015_MAT
ap.srcs += $(SRC_ARCH)/servos_4015_MAT_hw.c actuators.c
ap.CFLAGS += -DRADIO_CONTROL -DRADIO_CONTROL_TYPE=RC_FUTABA
ap.srcs += radio_control.c $(SRC_ARCH)/ppm_hw.c  
#ap.CFLAGS += -DDOWNLINK -DDOWNLINK_TRANSPORT=PprzTransport 
#ap.srcs += downlink.c $(SRC_ARCH)/uart_hw.c datalink.c pprz_transport.c
#ap.CFLAGS += -DDOWNLINK_FBW_DEVICE=Modem 
#ap.CFLAGS += -DDOWNLINK_AP_DEVICE=Modem 
#ap.CFLAGS += -DMODEM
#ap.srcs += $(SRC_ARCH)/modem_hw.c 
#--SERIAL MODE--------
#ap.CFLAGS += -DDOWNLINK -DUSE_UART0 -DDOWNLINK_TRANSPORT=PprzTransport 
#ap.CFLAGS += -DDOWNLINK_FBW_DEVICE=Uart0 -DDOWNLINK_AP_DEVICE=Uart0 
#ap.CFLAGS += -DPPRZ_UART=Uart0 -DUART0_BAUD=B9600
#ap.srcs += downlink.c $(SRC_ARCH)/uart_hw.c pprz_transport.c
#ap.srcs += traffic_info.c
#--API MODE-----------
#--XBEE-----------
#ap.CFLAGS += -DDOWNLINK -DUSE_UART0 -DDOWNLINK_TRANSPORT=XBeeTransport 
#ap.CFLAGS += -DDOWNLINK_FBW_DEVICE=Uart0 -DDOWNLINK_AP_DEVICE=Uart0 
#ap.CFLAGS += -DXBEE_UART=Uart0 -DDATALINK=XBEE -DUART0_BAUD=B9600
#ap.srcs += downlink.c $(SRC_ARCH)/uart_hw.c datalink.c xbee.c
#ap.srcs += traffic_info.c
#--AEROCOMM-----------
ap.CFLAGS += -DDOWNLINK -DUSE_UART0 -DDOWNLINK_TRANSPORT=AerocommTransport 
ap.CFLAGS += -DDOWNLINK_FBW_DEVICE=Uart0 -DDOWNLINK_AP_DEVICE=Uart0 
ap.CFLAGS += -DAEROCOMM_UART=Uart0 -DDATALINK=AEROCOMM -DUART0_BAUD=B9600
ap.srcs += downlink.c $(SRC_ARCH)/uart_hw.c datalink.c aerocomm_new.c
ap.srcs += traffic_info.c
ap.CFLAGS += -DINTER_MCU
ap.srcs += inter_mcu.c 
ap.CFLAGS += -DADC -DUSE_ADC_0 -DUSE_ADC_1 -DUSE_ADC_2 -DUSE_ADC_3 -DUSE_ADC_4
ap.srcs += $(SRC_ARCH)/adc_hw.c
ap.CFLAGS += -DGPS -DGPS_CONFIGURE -DUBX -DUSE_UART1 -DGPS_LINK=Uart1 -DUART1_BAUD=B38400
ap.srcs += gps_ubx.c gps.c
ap.CFLAGS += -DINFRARED 
ap.srcs += infrared.c 
#ap.CFLAGS += -DALT_KALMAN 
#ap.CFLAGS += -DIR_360
ap.srcs += estimator.c
ap.CFLAGS += -DCTL_ROLL_RATE
ap.CFLAGS += -DCTL_PITCH_RATE
ap.CFLAGS += -DCTL_YAW_RATE
ap.CFLAGS += -DTRANSITION
ap.CFLAGS += -DNAV 
#ap.CFLAGS += -DAGR_CLIMB 
#ap.CFLAGS += -DLOITER_TRIM
ap.srcs += nav.c fw_h_ctl.c fw_v_ctl.c
#ap.CFLAGS += -DGYRO -DADXRS150 
#ap.srcs += gyro.c nav_line.c 
#ap.srcs += chemotaxis.c anemotaxis.c discsurvey.c
ap.CFLAGS += -DGYRO -DIDG300 
ap.srcs += gyro.c
#ap.CFLAGS += -DACCEL -DADXL330 
#ap.srcs += accel.c
#ap.CFLAGS += -DRANGE 
#ap.CFLAGS += -DRANGE_ALT 
#ap.CFLAGS += -DATTITUDE_ROLL
#ap.CFLAGS += -DATTITUDE_PITCH
#ap.CFLAGS += -DAUTO2_MANUAL_HOVERING 
#ap.srcs += range.c
#ap.CFLAGS += -DKALMAN_ROLL_PITCH 
#ap.srcs += kalman_roll_pitch.c
#ap.srcs += bomb.c
# Hack to use the same tuning file than slayer1
ap.CFLAGS += -DUSE_GPIO
ap.srcs += $(SRC_ARCH)/gpio.c
# Harware In The Loop
#ap.CFLAGS += -DHITL
# Config for SITL simulation
include $(PAPARAZZI_SRC)/conf/autopilot/sitl.makefile
sim.CFLAGS += -DCONFIG=\&quot;tiny.h\&quot; -DAGR_CLIMB -DH_CTL_RATE_LOOP
# a test program to setup actuators 
setup_actuators.ARCHDIR = $(ARCHI)
setup_actuators.ARCH = arm7tdmi
setup_actuators.TARGET = setup_actuators
setup_actuators.TARGETDIR = setup_actuators
setup_actuators.CFLAGS += -DFBW -DCONFIG=\&quot;tiny.h\&quot; -DLED -DTIME_LED=1 -DACTUATORS=\&quot;servos_4015_hw.h\&quot; -DSERVOS_4015 -DUSE_UART0 -DUART0_BAUD=B9600 -DDATALINK=PPRZ -DPPRZ_UART=Uart0
setup_actuators.srcs += sys_time.c $(SRC_ARCH)/sys_time_hw.c $(SRC_ARCH)/armVIC.c pprz_transport.c setup_actuators.c $(SRC_ARCH)/uart_hw.c $(SRC_ARCH)/servos_4015_hw.c main.c
# a test program to tunnel between both uart
tunnel.ARCHDIR = $(ARCHI)
tunnel.ARCH = arm7tdmi
tunnel.TARGET = tunnel
tunnel.TARGETDIR = tunnel
tunnel.CFLAGS += -DFBW -DCONFIG=\&quot;tiny_0_99.h\&quot; -DLED -DTIME_LED=1
tunnel.srcs += $(SRC_ARCH)/uart_tunnel.c</makefile>
      </airframe>
      <radio name="T9cap" data_min="900" data_max="2100" sync_min="5000" sync_max="15000">
        <channel ctl="right_stick_horiz" function="ROLL" min="1939" neutral="1525" max="1114" average="0"/>
        <channel ctl="right_stick_vert" function="PITCH" min="1112" neutral="1518" max="1937" average="0"/>
        <channel ctl="left_stick_vert" function="THROTTLE" min="1940" neutral="1940" max="1115" average="0"/>
        <channel ctl="left_stick_horiz" function="YAW" min="1940" neutral="1498" max="1115" average="0"/>
        <channel ctl="switch_G" function="CALIB" min="2080" neutral="1525" max="969" average="10"/>
        <channel ctl="VRA" function="GAIN1" min="970" neutral="1520" max="2078" average="10"/>
        <channel ctl="VRC" function="GAIN2" min="970" neutral="1518" max="2077" average="10"/>
        <channel ctl="switch_C" function="MODE" min="2079" neutral="1526" max="966" average="10"/>
      </radio>
    </aircraft>
    <aircraft name="v1_i2c" ac_id="8" airframe="airframes/vertigo_arm_ir_ac_i2c.xml" radio="radios/T9cap.xml" telemetry="telemetry/debug.xml" settings="settings/tuning_ver_ir.xml" flight_plan="flight_plans/maxwell_vertigo.xml">
      <flight_plan alt="770" ground_alt="758" lat0="32.22610" lon0="-111.02574" max_dist_from_home="500" name="maxwell for vertigo" qfu="180" security_height="3" wind_dir="60" wind_mod="3">
        <waypoints>
          <waypoint name="HOME" x="11.6840794038" y="1.88159691589"/>
          <waypoint name="1" x="47.676852903" y="0.432076195721"/>
          <waypoint name="2" x="-28.6443295429" y="-2.43171868613"/>
        </waypoints>
        <blocks>
          <block name="init">
            <exception cond="(RcEvent1())" deroute="landing"/>
            <exception cond="(RcEvent2())" deroute="2wp loiter"/>
            <while cond="(!launch)"/>
            <attitude pitch="0.3" roll="0.0" throttle="1.0" until="(estimator_z > SECURITY_ALT)" vmode="throttle"/>
            <deroute block="2wp loiter"/>
          </block>
          <block name="2wp loiter">
            <exception cond="(RcEvent1())" deroute="init"/>
            <exception cond="(RcEvent2())" deroute="circle"/>
            <while>
              <go approaching_time="1" throttle="auto" vmode="alt" wp="1"/>
              <go approaching_time="1" throttle="auto" vmode="alt" wp="2"/>
            </while>
          </block>
          <block name="circle">
            <exception cond="(RcEvent2())" deroute="2wp loiter"/>
            <exception cond="(RcEvent1())" deroute="landing"/>
            <circle radius="40" wp="HOME"/>
          </block>
          <block name="landing">
            <exception cond="(RcEvent2())" deroute="circle"/>
            <exception cond="(RcEvent1())" deroute="init"/>
            <go alt="GROUND_ALT+8" wp="1"/>
            <go alt="GROUND_ALT" throttle="0.30" vmode="throttle" wp="2"/>
          </block>
        </blocks>
      </flight_plan>
      <airframe name="DRAGONFLY ARM">
        <servos>
          <servo name="AILERON1" no="0" min="1000" neutral="1500" max="2000"/>
          <servo name="AILERON2" no="1" min="1000" neutral="1500" max="2000"/>
          <servo name="THROTTLE" no="3" min="1100" neutral="1200" max="2000"/>
          <servo name="RUDDER" no="4" min="1000" neutral="1500" max="2000"/>
        </servos>
        <commands>
          <axis name="THROTTLE" failsafe_value="0"/>
          <axis name="ROLL" failsafe_value="0"/>
          <axis name="PITCH" failsafe_value="0"/>
          <axis name="YAW" failsafe_value="0"/>
        </commands>
        <rc_commands>
          <set command="THROTTLE" value="@THROTTLE"/>
          <set command="ROLL" value="@ROLL"/>
          <set command="PITCH" value="@PITCH"/>
          <set command="YAW" value="@YAW"/>
        </rc_commands>
        <section name="MIXER">
          <define name="AILEVON_AILERON_RATE" value="0.8"/>
          <define name="AILEVON_ELEVATOR_RATE" value="0.8"/>
          <define name="ROLL_TGAIN" value="0.005"/>
          <define name="PITCH_TGAIN" value="-0.0"/>
        </section>
        <command_laws>
          <set servo="THROTTLE" value="@THROTTLE-(vsupply-110.0f)*vdrop2throt_coeff"/>
          <let var="roll" value="@ROLL"/>
          <let var="rollofthr" value="@THROTTLE * ROLL_TGAIN"/>
          <let var="pitch" value="@PITCH"/>
          <let var="pitchofthr" value="@THROTTLE * PITCH_TGAIN"/>
          <set servo="AILERON1" value="$roll+$pitch"/>
          <set servo="AILERON2" value="$roll-$pitch"/>
          <let var="yaw" value="@YAW"/>
          <set servo="RUDDER" value="+$yaw+0.0*$roll"/>
        </command_laws>
        <section name="adc" prefix="ADC_CHANNEL_">
          <define name="GYRO_ROLL" value="ADC_0"/>
          <define name="GYRO_PITCH" value="ADC_1"/>
          <define name="GYRO_YAW" value="ADC_2"/>
          <define name="GYRO_NB_SAMPLES" value="16"/>
          <define name="IR1" value="ADC_3"/>
          <define name="IR2" value="ADC_4"/>
          <define name="IR_NB_SAMPLES" value="16"/>
          <define name="RANGE" value="ADC_3"/>
          <define name="RANGE_NB_SAMPLES" value="1"/>
        </section>
        <section name="AUTO1" prefix="AUTO1_">
          <define name="MAX_ROLL" value="RadOfDeg(30)"/>
          <define name="MAX_PITCH" value="RadOfDeg(45)"/>
          <define name="MAX_YAW" value="RadOfDeg(30)"/>
        </section>
        <section name="INFRARED" prefix="IR_">
          <define name="ROLL_NEUTRAL_DEFAULT" value="DegOfRad(0.00)" unit="deg"/>
          <define name="PITCH_NEUTRAL_DEFAULT" value="DegOfRad(-1.5)" unit="deg"/>
          <define name="DEFAULT_CONTRAST" value="900"/>
          <define name="RAD_OF_IR_CONTRAST" value="1.9"/>
          <linear name="RollOfIrs" arity="2" coeff1="0.7" coeff2="-0.7"/>
          <linear name="PitchOfIrs" arity="2" coeff1="-0.7" coeff2="-0.7"/>
          <define name="RAD_OF_IR_MAX_VALUE" value="0.0045"/>
          <define name="RAD_OF_IR_MIN_VALUE" value="0.00075"/>
          <define name="ADC_ROLL_NEUTRAL" value="0"/>
          <define name="ADC_PITCH_NEUTRAL" value="0"/>
          <define name="ESTIMATED_PHI_PI_4" value="M_PI_4*0.6"/>
          <define name="CORRECTION_UP" value="1.5"/>
          <define name="CORRECTION_DOWN" value="1.5"/>
          <define name="CORRECTION_LEFT" value="1.5"/>
          <define name="CORRECTION_RIGHT" value="1.5"/>
        </section>
        <section name="GYRO" prefix="GYRO_">
          <define name="ADC_ROLL_NEUTRAL" value="470"/>
          <define name="ADC_PITCH_NEUTRAL" value="405"/>
          <define name="ADC_YAW_NEUTRAL" value="473"/>
          <define name="ROLL_SCALE" value="0.5"/>
          <define name="ROLL_DIRECTION" value="-1"/>
          <define name="PITCH_SCALE" value="0.5"/>
          <define name="PITCH_DIRECTION" value="1."/>
          <define name="YAW_SCALE" value="0.5"/>
          <define name="YAW_DIRECTION" value="-1."/>
        </section>
        <section name="ACCEL" prefix="ACCEL_">
          <define name="AX_NEUTRAL" value="528"/>
          <define name="AY_NEUTRAL" value="516"/>
          <define name="AZ_NEUTRAL" value="509"/>
          <define name="AX_SCALE" value="0.01"/>
          <define name="AY_SCALE" value="0.01"/>
          <define name="AZ_SCALE" value="0.01"/>
        </section>
        <section name="RANGE" prefix="RANGE_">
          <define name="NEUTRAL" value="0"/>
          <define name="SCALE" value="1.35"/>
          <define name="DIRECTION" value="1."/>
        </section>
        <section name="KALMAN" prefix="KALMAN_">
          <define name="Q_ANGLE" value="1e-1f"/>
          <define name="Q_GYRO" value="5e-1f"/>
          <define name="R_ANGLE" value="1e-3f"/>
        </section>
        <section name="BAT">
          <define name="MILLIAMP_PER_PERCENT" value="0.86"/>
          <define name="ADC_CHANNEL_VSUPPLY" value="AdcBank1(6)"/>
          <define name="VoltageOfAdc(adc)" value="(0.01787109375*adc)"/>
          <define name="LOW_BATTERY" value="9.3" unit="V"/>
        </section>
        <section name="VERTICAL CONTROL" prefix="V_CTL_">
          <define name="ALTITUDE_PGAIN" value="0.3"/>
          <define name="ALTITUDE_MAX_CLIMB" value="2."/>
          <define name="AUTO_THROTTLE_MIN_CRUISE_THROTTLE" value="0.30"/>
          <define name="AUTO_THROTTLE_MAX_CRUISE_THROTTLE" value="0.60"/>
          <define name="AUTO_THROTTLE_PGAIN" value="0.02"/>
          <define name="AUTO_THROTTLE_IGAIN" value="0.0"/>
          <define name="AUTO_THROTTLE_PITCH_OF_VZ_PGAIN" value="0.0"/>
          <define name="AUTO_THROTTLE_DASH_TRIM" value="1000"/>
          <define name="AUTO_THROTTLE_LOITER_TRIM" value="1500"/>
          <define name="AUTO_THROTTLE_CRUISE_THROTTLE" value="0.488"/>
          <define name="AUTO_THROTTLE_CRUISE_THROTTLE_PGAIN" value="0.01"/>
          <define name="AUTO_THROTTLE_NOMINAL_CRUISE_THROTTLE" value="0.36"/>
          <define name="AUTO_THROTTLE_CLIMB_THROTTLE_INCREMENT" value="0.01" unit="%/(m/s)"/>
          <define name="THROTTLE_SUM_NB_SAMPLES" value="32"/>
          <define name="AUTO_PITCH_PGAIN" value="0.1"/>
          <define name="AUTO_PITCH_IGAIN" value="0.0"/>
          <define name="AUTO_PITCH_MAX_PITCH" value="0.35"/>
          <define name="AUTO_PITCH_MIN_PITCH" value="-0.35"/>
          <define name="VDROP2THROTTLE" value="0"/>
          <define name="THROTTLE_SLEW" value="1.0"/>
        </section>
        <section name="HORIZONTAL CONTROL" prefix="H_CTL_">
          <define name="COURSE_PGAIN" value="0.5"/>
          <define name="ROLL_MAX_SETPOINT" value="RadOfDeg(10)" unit="radians"/>
          <define name="PITCH_MAX_SETPOINT" value="RadOfDeg(30)" unit="radians"/>
          <define name="PITCH_MIN_SETPOINT" value="RadOfDeg(-10)" unit="radians"/>
          <define name="YAW_MAX_SETPOINT" value="RadOfDeg(20)" unit="radians"/>
          <define name="ROLL_PGAIN" value="-12000."/>
          <define name="AILERON_OF_THROTTLE" value="0.0"/>
          <define name="PITCH_PGAIN" value="11950."/>
          <define name="PITCH_DGAIN" value="0.0"/>
          <define name="ELEVATOR_OF_ROLL" value="0."/>
          <define name="ROLL_RATE_MODE_DEFAULT" value="1"/>
          <define name="PITCH_RATE_MODE_DEFAULT" value="1"/>
          <define name="YAW_RATE_MODE_DEFAULT" value="1"/>
          <define name="ROLL_RATE_SETPOINT_PGAIN" value="0.75" unit="1/s"/>
          <define name="ROLL_RATE_MAX_SETPOINT" value="10"/>
          <define name="PITCH_RATE_SETPOINT_PGAIN" value="0.75" unit="1/s"/>
          <define name="PITCH_RATE_MAX_SETPOINT" value="10"/>
          <define name="YAW_RATE_SETPOINT_PGAIN" value="0.75" unit="1/s"/>
          <define name="YAW_RATE_MAX_SETPOINT" value="10"/>
          <define name="LO_THROTTLE_ROLL_RATE_PGAIN" value="20000."/>
          <define name="HI_THROTTLE_ROLL_RATE_PGAIN" value="20000."/>
          <define name="LO_THROTTLE_PITCH_RATE_PGAIN" value="20000."/>
          <define name="HI_THROTTLE_PITCH_RATE_PGAIN" value="20000."/>
          <define name="LO_THROTTLE_YAW_RATE_PGAIN" value="10000."/>
          <define name="HI_THROTTLE_YAW_RATE_PGAIN" value="10000."/>
          <define name="ROLL_RATE_IGAIN" value="0."/>
          <define name="ROLL_RATE_DGAIN" value="0."/>
          <define name="ROLL_RATE_SUM_NB_SAMPLES" value="16"/>
          <define name="PITCH_RATE_IGAIN" value="0."/>
          <define name="PITCH_RATE_DGAIN" value="0."/>
          <define name="PITCH_RATE_SUM_NB_SAMPLES" value="16"/>
          <define name="YAW_RATE_IGAIN" value="0."/>
          <define name="YAW_RATE_DGAIN" value="0."/>
          <define name="YAW_RATE_SUM_NB_SAMPLES" value="16"/>
        </section>
        <section name="THR">
          <define name="DASH_THR" value="0.6"/>
          <define name="LOITER_THR" value="0.52"/>
        </section>
        <section name="NAV">
          <define name="NAV_PITCH" value="0."/>
          <define name="NAV_GLIDE_PITCH_TRIM" value="0"/>
        </section>
        <section name="AGGRESSIVE" prefix="AGR_">
          <define name="BLEND_START" value="5"/>
          <define name="BLEND_END" value="2"/>
          <define name="CLIMB_THROTTLE" value="0.44"/>
          <define name="CLIMB_PITCH" value="RadOfDeg(15)"/>
          <define name="DESCENT_THROTTLE" value="0.36"/>
          <define name="DESCENT_PITCH" value="0.0"/>
          <define name="CLIMB_NAV_RATIO" value="0.8"/>
          <define name="DESCENT_NAV_RATIO" value="1.0"/>
        </section>
        <section name="FAILSAFE" prefix="FAILSAFE_">
          <define name="DELAY_WITHOUT_GPS" value="5" unit="s"/>
          <define name="DEFAULT_THROTTLE" value="0.2" unit="%"/>
          <define name="DEFAULT_ROLL" value="0.3" unit="rad"/>
          <define name="DEFAULT_PITCH" value="0.1" unit="rad"/>
          <define name="HOME_RADIUS" value="50" unit="m"/>
        </section>
        <section name="SIMU">
          <define name="ROLL_RESPONSE_FACTOR" value="2."/>
          <define name="YAW_RESPONSE_FACTOR" value="1.35"/>
          <define name="WEIGHT" value="1.3"/>
        </section>
        <section name="MISC">
          <define name="NOMINAL_AIRSPEED" value="7." unit="m/s"/>
          <define name="CARROT" value="5." unit="s"/>
          <define name="KILL_MODE_DISTANCE" value="(MAX_DIST_FROM_HOME*1.5)" unit="m"/>
          <define name="AEROCOMM_INIT" value=""/>
          <define name="NO_API_INIT" value="TRUE"/>
          <define name="TRIGGER_DELAY" value="1.1"/>
          <define name="DEFAULT_CIRCLE_RADIUS" value="100."/>
        </section>
        <section name="DATALINK" prefix="DATALINK_">
          <define name="DEVICE_TYPE" value="XBEE"/>
          <define name="DEVICE_ADDRESS" value="...."/>
        </section>
        <makefile>include $(PAPARAZZI_SRC)/conf/autopilot/tiny.makefile
FLASH_MODE=ISP
ap.CFLAGS +=  -DFBW -DAP -DCONFIG=\&quot;tiny_0_99.h\&quot; -DLED -DTIME_LED=1
ap.srcs = sys_time.c $(SRC_ARCH)/sys_time_hw.c $(SRC_ARCH)/armVIC.c main_fbw.c main_ap.c main.c
ap.srcs += commands.c
ap.CFLAGS += -DACTUATORS=\&quot;servos_4015_MAT_hw.h\&quot; -DSERVOS_4015_MAT
ap.srcs += $(SRC_ARCH)/servos_4015_MAT_hw.c actuators.c
ap.CFLAGS += -DRADIO_CONTROL -DRADIO_CONTROL_TYPE=RC_FUTABA
ap.srcs += radio_control.c $(SRC_ARCH)/ppm_hw.c  
#ap.CFLAGS += -DDOWNLINK -DDOWNLINK_TRANSPORT=PprzTransport 
#ap.srcs += downlink.c $(SRC_ARCH)/uart_hw.c datalink.c pprz_transport.c
#ap.CFLAGS += -DDOWNLINK_FBW_DEVICE=Modem 
#ap.CFLAGS += -DDOWNLINK_AP_DEVICE=Modem 
#ap.CFLAGS += -DMODEM
#ap.srcs += $(SRC_ARCH)/modem_hw.c 
#--SERIAL MODE--------
#ap.CFLAGS += -DDOWNLINK -DUSE_UART0 -DDOWNLINK_TRANSPORT=PprzTransport 
#ap.CFLAGS += -DDOWNLINK_FBW_DEVICE=Uart0 -DDOWNLINK_AP_DEVICE=Uart0 
#ap.CFLAGS += -DPPRZ_UART=Uart0 -DUART0_BAUD=B9600
#ap.srcs += downlink.c $(SRC_ARCH)/uart_hw.c pprz_transport.c
#ap.srcs += traffic_info.c
#--API MODE-----------
#--XBEE-----------
ap.CFLAGS += -DDOWNLINK -DUSE_UART0 -DDOWNLINK_TRANSPORT=XBeeTransport 
ap.CFLAGS += -DDOWNLINK_FBW_DEVICE=Uart0 -DDOWNLINK_AP_DEVICE=Uart0 
ap.CFLAGS += -DXBEE_UART=Uart0 -DDATALINK=XBEE -DUART0_BAUD=B9600
ap.srcs += downlink.c $(SRC_ARCH)/uart_hw.c datalink.c xbee.c
ap.srcs += traffic_info.c
#--AEROCOMM-----------
#ap.CFLAGS += -DDOWNLINK -DUSE_UART0 -DDOWNLINK_TRANSPORT=AerocommTransport 
#ap.CFLAGS += -DDOWNLINK_FBW_DEVICE=Uart0 -DDOWNLINK_AP_DEVICE=Uart0 
#ap.CFLAGS += -DAEROCOMM_UART=Uart0 -DDATALINK=AEROCOMM -DUART0_BAUD=B9600
#ap.srcs += downlink.c $(SRC_ARCH)/uart_hw.c datalink.c aerocomm_new.c
#ap.srcs += traffic_info.c
ap.CFLAGS += -DINTER_MCU
ap.srcs += inter_mcu.c 
ap.CFLAGS += -DADC -DUSE_ADC_0 -DUSE_ADC_1 -DUSE_ADC_2 -DUSE_ADC_3 -DUSE_ADC_4
ap.srcs += $(SRC_ARCH)/adc_hw.c
ap.CFLAGS += -DGPS -DGPS_CONFIGURE -DUBX -DUSE_UART1 -DGPS_LINK=Uart1 -DUART1_BAUD=B38400
ap.srcs += gps_ubx.c gps.c
ap.CFLAGS += -DINFRARED 
ap.srcs += infrared.c 
#ap.CFLAGS += -DALT_KALMAN 
#ap.CFLAGS += -DIR_360
ap.srcs += estimator.c
ap.CFLAGS += -DCTL_ROLL_RATE
ap.CFLAGS += -DCTL_PITCH_RATE
ap.CFLAGS += -DCTL_YAW_RATE
ap.CFLAGS += -DNAV 
ap.CFLAGS += -DAGR_CLIMB 
#ap.CFLAGS += -DLOITER_TRIM
ap.srcs += nav.c fw_h_ctl.c fw_v_ctl.c
#ap.CFLAGS += -DGYRO -DADXRS150 
#ap.srcs += gyro.c nav_line.c 
#ap.srcs += chemotaxis.c anemotaxis.c discsurvey.c
ap.CFLAGS += -DGYRO -DIDG300 
ap.srcs += gyro.c
#ap.CFLAGS += -DACCEL -DADXL330 
#ap.srcs += accel.c
#ap.CFLAGS += -DRANGE 
#ap.CFLAGS += -DRANGE_ALT 
ap.CFLAGS += -DATTITUDE_ROLL
ap.CFLAGS += -DATTITUDE_PITCH
#ap.CFLAGS += -DAUTO2_MANUAL_HOVERING 
#ap.srcs += range.c
#ap.CFLAGS += -DKALMAN_ROLL_PITCH 
#ap.srcs += kalman_roll_pitch.c
#ap.srcs += bomb.c
# Hack to use the same tuning file than slayer1
ap.CFLAGS += -DUSE_GPIO
ap.srcs += $(SRC_ARCH)/gpio.c
# Harware In The Loop
#ap.CFLAGS += -DHITL
########## Chemo sensor (I2C)\par
ap.srcs += i2c.c arm7/i2c_hw.c enose.c
ap.CFLAGS += -DUSE_I2C -DENOSE
# Config for SITL simulation
include $(PAPARAZZI_SRC)/conf/autopilot/sitl.makefile
sim.CFLAGS += -DCONFIG=\&quot;tiny.h\&quot; -DAGR_CLIMB -DH_CTL_RATE_LOOP
# a test program to setup actuators 
setup_actuators.ARCHDIR = $(ARCHI)
setup_actuators.ARCH = arm7tdmi
setup_actuators.TARGET = setup_actuators
setup_actuators.TARGETDIR = setup_actuators
setup_actuators.CFLAGS += -DFBW -DCONFIG=\&quot;tiny.h\&quot; -DLED -DTIME_LED=1 -DACTUATORS=\&quot;servos_4015_hw.h\&quot; -DSERVOS_4015 -DUSE_UART0 -DUART0_BAUD=B9600 -DDATALINK=PPRZ -DPPRZ_UART=Uart0
setup_actuators.srcs += sys_time.c $(SRC_ARCH)/sys_time_hw.c $(SRC_ARCH)/armVIC.c pprz_transport.c setup_actuators.c $(SRC_ARCH)/uart_hw.c $(SRC_ARCH)/servos_4015_hw.c main.c
# a test program to tunnel between both uart
tunnel.ARCHDIR = $(ARCHI)
tunnel.ARCH = arm7tdmi
tunnel.TARGET = tunnel
tunnel.TARGETDIR = tunnel
tunnel.CFLAGS += -DFBW -DCONFIG=\&quot;tiny_0_99.h\&quot; -DLED -DTIME_LED=1
tunnel.srcs += $(SRC_ARCH)/uart_tunnel.c</makefile>
      </airframe>
      <radio name="T9cap" data_min="900" data_max="2100" sync_min="5000" sync_max="15000">
        <channel ctl="right_stick_horiz" function="ROLL" min="1939" neutral="1525" max="1114" average="0"/>
        <channel ctl="right_stick_vert" function="PITCH" min="1112" neutral="1518" max="1937" average="0"/>
        <channel ctl="left_stick_vert" function="THROTTLE" min="1940" neutral="1940" max="1115" average="0"/>
        <channel ctl="left_stick_horiz" function="YAW" min="1940" neutral="1498" max="1115" average="0"/>
        <channel ctl="switch_G" function="CALIB" min="2080" neutral="1525" max="969" average="10"/>
        <channel ctl="VRA" function="GAIN1" min="970" neutral="1520" max="2078" average="10"/>
        <channel ctl="VRC" function="GAIN2" min="970" neutral="1518" max="2077" average="10"/>
        <channel ctl="switch_C" function="MODE" min="2079" neutral="1526" max="966" average="10"/>
      </radio>
    </aircraft>
    <aircraft name="v1_range" ac_id="9" airframe="airframes/vertigo_arm_ir_ac_ranger.xml" radio="radios/T9cap.xml" telemetry="telemetry/debug.xml" settings="settings/tuning_ver_range.xml" flight_plan="flight_plans/maxwell_vertigo.xml">
      <flight_plan alt="770" ground_alt="758" lat0="32.22610" lon0="-111.02574" max_dist_from_home="500" name="maxwell for vertigo" qfu="180" security_height="3" wind_dir="60" wind_mod="3">
        <waypoints>
          <waypoint name="HOME" x="11.6840794038" y="1.88159691589"/>
          <waypoint name="1" x="47.676852903" y="0.432076195721"/>
          <waypoint name="2" x="-28.6443295429" y="-2.43171868613"/>
        </waypoints>
        <blocks>
          <block name="init">
            <exception cond="(RcEvent1())" deroute="landing"/>
            <exception cond="(RcEvent2())" deroute="2wp loiter"/>
            <while cond="(!launch)"/>
            <attitude pitch="0.3" roll="0.0" throttle="1.0" until="(estimator_z > SECURITY_ALT)" vmode="throttle"/>
            <deroute block="2wp loiter"/>
          </block>
          <block name="2wp loiter">
            <exception cond="(RcEvent1())" deroute="init"/>
            <exception cond="(RcEvent2())" deroute="circle"/>
            <while>
              <go approaching_time="1" throttle="auto" vmode="alt" wp="1"/>
              <go approaching_time="1" throttle="auto" vmode="alt" wp="2"/>
            </while>
          </block>
          <block name="circle">
            <exception cond="(RcEvent2())" deroute="2wp loiter"/>
            <exception cond="(RcEvent1())" deroute="landing"/>
            <circle radius="40" wp="HOME"/>
          </block>
          <block name="landing">
            <exception cond="(RcEvent2())" deroute="circle"/>
            <exception cond="(RcEvent1())" deroute="init"/>
            <go alt="GROUND_ALT+8" wp="1"/>
            <go alt="GROUND_ALT" throttle="0.30" vmode="throttle" wp="2"/>
          </block>
        </blocks>
      </flight_plan>
      <airframe name="DRAGONFLY ARM">
        <servos>
          <servo name="AILERON1" no="0" min="1000" neutral="1500" max="2000"/>
          <servo name="AILERON2" no="1" min="1000" neutral="1500" max="2000"/>
          <servo name="THROTTLE" no="3" min="1100" neutral="1200" max="2000"/>
          <servo name="RUDDER" no="4" min="1000" neutral="1500" max="2000"/>
        </servos>
        <commands>
          <axis name="THROTTLE" failsafe_value="0"/>
          <axis name="ROLL" failsafe_value="0"/>
          <axis name="PITCH" failsafe_value="0"/>
          <axis name="YAW" failsafe_value="0"/>
        </commands>
        <rc_commands>
          <set command="THROTTLE" value="@THROTTLE"/>
          <set command="ROLL" value="@ROLL"/>
          <set command="PITCH" value="@PITCH"/>
          <set command="YAW" value="@YAW"/>
        </rc_commands>
        <section name="MIXER">
          <define name="AILEVON_AILERON_RATE" value="0.8"/>
          <define name="AILEVON_ELEVATOR_RATE" value="0.8"/>
          <define name="ROLL_TGAIN" value="0.005"/>
          <define name="PITCH_TGAIN" value="-0.0"/>
        </section>
        <command_laws>
          <set servo="THROTTLE" value="@THROTTLE-(vsupply-110.0f)*vdrop2throt_coeff"/>
          <let var="roll" value="@ROLL"/>
          <let var="rollofthr" value="@THROTTLE * ROLL_TGAIN"/>
          <let var="pitch" value="@PITCH"/>
          <let var="pitchofthr" value="@THROTTLE * PITCH_TGAIN"/>
          <set servo="AILERON1" value="-$roll-$pitch"/>
          <set servo="AILERON2" value="-$roll+$pitch"/>
          <let var="yaw" value="@YAW"/>
          <set servo="RUDDER" value="+$yaw+0.0*$roll"/>
        </command_laws>
        <section name="adc" prefix="ADC_CHANNEL_">
          <define name="GYRO_ROLL" value="ADC_0"/>
          <define name="GYRO_PITCH" value="ADC_1"/>
          <define name="GYRO_YAW" value="ADC_2"/>
          <define name="GYRO_NB_SAMPLES" value="16"/>
          <define name="RANGE" value="ADC_3"/>
          <define name="RANGE_NB_SAMPLES" value="1"/>
        </section>
        <section name="AUTO1" prefix="AUTO1_">
          <define name="MAX_ROLL" value="RadOfDeg(30)"/>
          <define name="MAX_PITCH" value="RadOfDeg(45)"/>
          <define name="MAX_YAW" value="RadOfDeg(30)"/>
        </section>
        <section name="INFRARED" prefix="IR_">
          <define name="ROLL_NEUTRAL_DEFAULT" value="DegOfRad(0.00)" unit="deg"/>
          <define name="PITCH_NEUTRAL_DEFAULT" value="DegOfRad(-1.344)" unit="deg"/>
          <define name="DEFAULT_CONTRAST" value="900"/>
          <define name="RAD_OF_IR_CONTRAST" value="1.9"/>
          <linear name="RollOfIrs" arity="2" coeff1="0.7" coeff2="-0.7"/>
          <linear name="PitchOfIrs" arity="2" coeff1="-0.7" coeff2="-0.7"/>
          <define name="RAD_OF_IR_MAX_VALUE" value="0.0045"/>
          <define name="RAD_OF_IR_MIN_VALUE" value="0.00075"/>
          <define name="ADC_ROLL_NEUTRAL" value="0"/>
          <define name="ADC_PITCH_NEUTRAL" value="0"/>
          <define name="ESTIMATED_PHI_PI_4" value="M_PI_4*0.6"/>
          <define name="CORRECTION_UP" value="1.5"/>
          <define name="CORRECTION_DOWN" value="1.5"/>
          <define name="CORRECTION_LEFT" value="1.5"/>
          <define name="CORRECTION_RIGHT" value="1.5"/>
        </section>
        <section name="GYRO" prefix="GYRO_">
          <define name="ADC_ROLL_NEUTRAL" value="466"/>
          <define name="ADC_PITCH_NEUTRAL" value="492"/>
          <define name="ADC_YAW_NEUTRAL" value="461"/>
          <define name="ROLL_SCALE" value="0.5"/>
          <define name="ROLL_DIRECTION" value="-1"/>
          <define name="PITCH_SCALE" value="0.5"/>
          <define name="PITCH_DIRECTION" value="1."/>
          <define name="YAW_SCALE" value="0.5"/>
          <define name="YAW_DIRECTION" value="-1."/>
        </section>
        <section name="ACCEL" prefix="ACCEL_">
          <define name="AX_NEUTRAL" value="528"/>
          <define name="AY_NEUTRAL" value="516"/>
          <define name="AZ_NEUTRAL" value="509"/>
          <define name="AX_SCALE" value="0.01"/>
          <define name="AY_SCALE" value="0.01"/>
          <define name="AZ_SCALE" value="0.01"/>
        </section>
        <section name="RANGE" prefix="RANGE_">
          <define name="NEUTRAL" value="0"/>
          <define name="SCALE" value="1.35"/>
          <define name="DIRECTION" value="1."/>
        </section>
        <section name="KALMAN" prefix="KALMAN_">
          <define name="Q_ANGLE" value="1e-1f"/>
          <define name="Q_GYRO" value="5e-1f"/>
          <define name="R_ANGLE" value="1e-3f"/>
        </section>
        <section name="BAT">
          <define name="MILLIAMP_PER_PERCENT" value="0.86"/>
          <define name="ADC_CHANNEL_VSUPPLY" value="AdcBank1(6)"/>
          <define name="VoltageOfAdc(adc)" value="(0.01787109375*adc)"/>
          <define name="LOW_BATTERY" value="9.3" unit="V"/>
        </section>
        <section name="VERTICAL CONTROL" prefix="V_CTL_">
          <define name="ALTITUDE_PGAIN" value="0.3"/>
          <define name="ALTITUDE_MAX_CLIMB" value="2."/>
          <define name="AUTO_THROTTLE_MIN_CRUISE_THROTTLE" value="0.35"/>
          <define name="AUTO_THROTTLE_MAX_CRUISE_THROTTLE" value="0.45"/>
          <define name="AUTO_THROTTLE_PGAIN_PLUS" value="0.037"/>
          <define name="AUTO_THROTTLE_PGAIN_MINUS" value="0.037"/>
          <define name="AUTO_THROTTLE_IGAIN" value="0.0"/>
          <define name="AUTO_THROTTLE_IGAIN_PLUS" value="0.0"/>
          <define name="AUTO_THROTTLE_IGAIN_MINUS" value="0.0"/>
          <define name="AUTO_THROTTLE_PITCH_OF_VZ_PGAIN" value="0.0"/>
          <define name="AUTO_THROTTLE_DASH_TRIM" value="1000"/>
          <define name="AUTO_THROTTLE_LOITER_TRIM" value="1500"/>
          <define name="AUTO_THROTTLE_CRUISE_THROTTLE" value="0.4149"/>
          <define name="AUTO_THROTTLE_CRUISE_THROTTLE_PGAIN" value="0.005"/>
          <define name="AUTO_THROTTLE_NOMINAL_CRUISE_THROTTLE" value="0.47"/>
          <define name="AUTO_THROTTLE_CLIMB_THROTTLE_INCREMENT_PLUS" value="0.045" unit="%/(m/s)"/>
          <define name="AUTO_THROTTLE_CLIMB_THROTTLE_INCREMENT_MINUS" value="0.045" unit="%/(m/s)"/>
          <define name="THROTTLE_SUM_NB_SAMPLES" value="32"/>
          <define name="AUTO_PITCH_PGAIN" value="0.1"/>
          <define name="AUTO_PITCH_IGAIN" value="0.0"/>
          <define name="AUTO_PITCH_MAX_PITCH" value="0.35"/>
          <define name="AUTO_PITCH_MIN_PITCH" value="-0.35"/>
          <define name="VDROP2THROTTLE" value="0"/>
          <define name="THROTTLE_SLEW" value="1.0"/>
        </section>
        <section name="HORIZONTAL CONTROL" prefix="H_CTL_">
          <define name="COURSE_PGAIN" value="0.5"/>
          <define name="ROLL_MAX_SETPOINT" value="RadOfDeg(45)" unit="radians"/>
          <define name="PITCH_MAX_SETPOINT" value="RadOfDeg(30)" unit="radians"/>
          <define name="PITCH_MIN_SETPOINT" value="RadOfDeg(-20)" unit="radians"/>
          <define name="YAW_MAX_SETPOINT" value="RadOfDeg(30)" unit="radians"/>
          <define name="ROLL_PGAIN" value="-12000."/>
          <define name="AILERON_OF_THROTTLE" value="0.0"/>
          <define name="PITCH_PGAIN" value="11950."/>
          <define name="PITCH_DGAIN" value="0.0"/>
          <define name="ELEVATOR_OF_ROLL" value="0."/>
          <define name="ROLL_RATE_MODE_DEFAULT" value="1"/>
          <define name="PITCH_RATE_MODE_DEFAULT" value="1"/>
          <define name="YAW_RATE_MODE_DEFAULT" value="1"/>
          <define name="ROLL_RATE_SETPOINT_PGAIN" value="0.75" unit="1/s"/>
          <define name="ROLL_RATE_MAX_SETPOINT" value="10"/>
          <define name="PITCH_RATE_SETPOINT_PGAIN" value="0.75" unit="1/s"/>
          <define name="PITCH_RATE_MAX_SETPOINT" value="10"/>
          <define name="YAW_RATE_SETPOINT_PGAIN" value="0.75" unit="1/s"/>
          <define name="YAW_RATE_MAX_SETPOINT" value="10"/>
          <define name="LO_THROTTLE_ROLL_RATE_PGAIN" value="25000."/>
          <define name="HI_THROTTLE_ROLL_RATE_PGAIN" value="25000."/>
          <define name="LO_THROTTLE_PITCH_RATE_PGAIN" value="13000."/>
          <define name="HI_THROTTLE_PITCH_RATE_PGAIN" value="13000."/>
          <define name="LO_THROTTLE_YAW_RATE_PGAIN" value="18000."/>
          <define name="HI_THROTTLE_YAW_RATE_PGAIN" value="18000."/>
          <define name="ROLL_RATE_IGAIN" value="0."/>
          <define name="ROLL_RATE_DGAIN" value="0."/>
          <define name="ROLL_RATE_SUM_NB_SAMPLES" value="16"/>
          <define name="PITCH_RATE_IGAIN" value="0."/>
          <define name="PITCH_RATE_DGAIN" value="0."/>
          <define name="PITCH_RATE_SUM_NB_SAMPLES" value="16"/>
          <define name="YAW_RATE_IGAIN" value="0."/>
          <define name="YAW_RATE_DGAIN" value="0."/>
          <define name="YAW_RATE_SUM_NB_SAMPLES" value="16"/>
        </section>
        <section name="THR">
          <define name="DASH_THR" value="0.6"/>
          <define name="LOITER_THR" value="0.52"/>
        </section>
        <section name="NAV">
          <define name="NAV_PITCH" value="0."/>
          <define name="NAV_GLIDE_PITCH_TRIM" value="0"/>
        </section>
        <section name="AGGRESSIVE" prefix="AGR_">
          <define name="BLEND_START" value="0.5"/>
          <define name="BLEND_END" value="0.2"/>
          <define name="CLIMB_THROTTLE" value="0.53"/>
          <define name="CLIMB_PITCH" value="0.0"/>
          <define name="DESCENT_THROTTLE" value="0.50"/>
          <define name="DESCENT_PITCH" value="0.0"/>
          <define name="CLIMB_NAV_RATIO" value="0.8"/>
          <define name="DESCENT_NAV_RATIO" value="1.0"/>
        </section>
        <section name="FAILSAFE" prefix="FAILSAFE_">
          <define name="DEFAULT_THROTTLE" value="0.2" unit="%"/>
          <define name="DEFAULT_ROLL" value="0.3" unit="rad"/>
          <define name="DEFAULT_PITCH" value="0.1" unit="rad"/>
          <define name="HOME_RADIUS" value="50" unit="m"/>
        </section>
        <section name="SIMU">
          <define name="ROLL_RESPONSE_FACTOR" value="2."/>
          <define name="YAW_RESPONSE_FACTOR" value="1.35"/>
          <define name="WEIGHT" value="1.3"/>
        </section>
        <section name="MISC">
          <define name="NOMINAL_AIRSPEED" value="3." unit="m/s"/>
          <define name="CARROT" value="5." unit="s"/>
          <define name="KILL_MODE_DISTANCE" value="(MAX_DIST_FROM_HOME*1.5)" unit="m"/>
          <define name="AEROCOMM_INIT" value="\"ATPL4\\rATRN1\\rATTT80\\rATBD3\\rATWR\\r\""/>
          <define name="NO_API_INIT" value="TRUE"/>
          <define name="TRIGGER_DELAY" value="1.1"/>
          <define name="DEFAULT_CIRCLE_RADIUS" value="100."/>
        </section>
        <section name="DATALINK" prefix="DATALINK_">
          <define name="DEVICE_TYPE" value="AEROCOMM__"/>
          <define name="DEVICE_ADDRESS" value="...."/>
        </section>
        <makefile>include $(PAPARAZZI_SRC)/conf/autopilot/tiny.makefile
FLASH_MODE=ISP
ap.CFLAGS +=  -DFBW -DAP -DCONFIG=\&quot;tiny_0_99.h\&quot; -DLED -DTIME_LED=1
ap.srcs = sys_time.c $(SRC_ARCH)/sys_time_hw.c $(SRC_ARCH)/armVIC.c main_fbw.c main_ap.c main.c
ap.srcs += commands.c
ap.CFLAGS += -DACTUATORS=\&quot;servos_4015_MAT_hw.h\&quot; -DSERVOS_4015_MAT
ap.srcs += $(SRC_ARCH)/servos_4015_MAT_hw.c actuators.c
ap.CFLAGS += -DRADIO_CONTROL -DRADIO_CONTROL_TYPE=RC_FUTABA
ap.srcs += radio_control.c $(SRC_ARCH)/ppm_hw.c  
#ap.CFLAGS += -DDOWNLINK -DDOWNLINK_TRANSPORT=PprzTransport 
#ap.srcs += downlink.c $(SRC_ARCH)/uart_hw.c datalink.c pprz_transport.c
#ap.CFLAGS += -DDOWNLINK_FBW_DEVICE=Modem 
#ap.CFLAGS += -DDOWNLINK_AP_DEVICE=Modem 
#ap.CFLAGS += -DMODEM
#ap.srcs += $(SRC_ARCH)/modem_hw.c 
#--SERIAL MODE--------
#ap.CFLAGS += -DDOWNLINK -DUSE_UART0 -DDOWNLINK_TRANSPORT=PprzTransport 
#ap.CFLAGS += -DDOWNLINK_FBW_DEVICE=Uart0 -DDOWNLINK_AP_DEVICE=Uart0 
#ap.CFLAGS += -DPPRZ_UART=Uart0 -DUART0_BAUD=B9600
#ap.srcs += downlink.c $(SRC_ARCH)/uart_hw.c datalink.c pprz_transport.c
#ap.srcs += traffic_info.c
#--API MODE-----------
ap.CFLAGS += -DDOWNLINK -DUSE_UART0 -DDOWNLINK_TRANSPORT=AerocommTransport 
ap.CFLAGS += -DDOWNLINK_FBW_DEVICE=Uart0 -DDOWNLINK_AP_DEVICE=Uart0 
ap.CFLAGS += -DAEROCOMM_UART=Uart0 -DDATALINK=AEROCOMM -DUART0_BAUD=B9600
ap.srcs += downlink.c $(SRC_ARCH)/uart_hw.c datalink.c aerocomm_new.c
ap.srcs += traffic_info.c
#--XBee----------------
#ap.CFLAGS += -DDOWNLINK -DUSE_UART0 -DDOWNLINK_TRANSPORT=XBeeTransport 
#ap.CFLAGS += -DDOWNLINK_FBW_DEVICE=Uart0 -DDOWNLINK_AP_DEVICE=Uart0 
#ap.CFLAGS += -DXBEE_UART=Uart0 -DDATALINK=XBEE -DUART0_BAUD=B9600
#ap.srcs += downlink.c $(SRC_ARCH)/uart_hw.c datalink.c xbee.c
#ap.srcs += traffic_info.c
ap.CFLAGS += -DINTER_MCU
ap.srcs += inter_mcu.c 
ap.CFLAGS += -DADC -DUSE_ADC_0 -DUSE_ADC_1 -DUSE_ADC_2 -DUSE_ADC_3 -DUSE_ADC_4
ap.srcs += $(SRC_ARCH)/adc_hw.c
#ap.CFLAGS += -DGPS -DGPS_CONFIGURE -DUBX -DUSE_UART1 -DGPS_LINK=Uart1 -DUART1_BAUD=B38400
#ap.srcs += gps_ubx.c gps.c
#ap.CFLAGS += -DINFRARED 
#ap.srcs += infrared.c 
#ap.CFLAGS += -DALT_KALMAN 
#ap.CFLAGS += -DIR_360
ap.srcs += estimator.c
ap.CFLAGS += -DCTL_ROLL_RATE
ap.CFLAGS += -DCTL_PITCH_RATE
ap.CFLAGS += -DCTL_YAW_RATE
ap.CFLAGS += -DNAV 
#ap.CFLAGS += -DAGR_CLIMB 
#ap.CFLAGS += -DLOITER_TRIM
ap.srcs += nav.c fw_h_ctl.c fw_v_ctl.c
#ap.CFLAGS += -DGYRO -DADXRS150 
#ap.srcs += gyro.c nav_line.c 
#ap.srcs += chemotaxis.c anemotaxis.c discsurvey.c
ap.CFLAGS += -DGYRO -DIDG300 
ap.srcs += gyro.c
#ap.CFLAGS += -DACCEL -DADXL330 
#ap.srcs += accel.c
ap.CFLAGS += -DRANGE 
ap.CFLAGS += -DRANGE_ALT 
ap.CFLAGS += -DAUTO2_MANUAL_HOVERING 
ap.srcs += range.c
#ap.CFLAGS += -DKALMAN_ROLL_PITCH 
#ap.srcs += kalman_roll_pitch.c
#ap.srcs += bomb.c
# Hack to use the same tuning file than slayer1
ap.CFLAGS += -DUSE_GPIO
ap.srcs += $(SRC_ARCH)/gpio.c
# Harware In The Loop
#ap.CFLAGS += -DHITL
# Config for SITL simulation
include $(PAPARAZZI_SRC)/conf/autopilot/sitl.makefile
sim.CFLAGS += -DCONFIG=\&quot;tiny.h\&quot; -DAGR_CLIMB -DH_CTL_RATE_LOOP
sim.srcs += bomb.c
# a test program to setup actuators 
setup_actuators.ARCHDIR = $(ARCHI)
setup_actuators.ARCH = arm7tdmi
setup_actuators.TARGET = setup_actuators
setup_actuators.TARGETDIR = setup_actuators
setup_actuators.CFLAGS += -DFBW -DCONFIG=\&quot;tiny.h\&quot; -DLED -DTIME_LED=1 -DACTUATORS=\&quot;servos_4015_hw.h\&quot; -DSERVOS_4015 -DUSE_UART0 -DUART0_BAUD=B9600 -DDATALINK=PPRZ -DPPRZ_UART=Uart0
setup_actuators.srcs += sys_time.c $(SRC_ARCH)/sys_time_hw.c $(SRC_ARCH)/armVIC.c pprz_transport.c setup_actuators.c $(SRC_ARCH)/uart_hw.c $(SRC_ARCH)/servos_4015_hw.c main.c
# a test program to tunnel between both uart
tunnel.ARCHDIR = $(ARCHI)
tunnel.ARCH = arm7tdmi
tunnel.TARGET = tunnel
tunnel.TARGETDIR = tunnel
tunnel.CFLAGS += -DFBW -DCONFIG=\&quot;tiny_0_99.h\&quot; -DLED -DTIME_LED=1
tunnel.srcs += $(SRC_ARCH)/uart_tunnel.c</makefile>
      </airframe>
      <radio name="T9cap" data_min="900" data_max="2100" sync_min="5000" sync_max="15000">
        <channel ctl="right_stick_horiz" function="ROLL" min="1939" neutral="1525" max="1114" average="0"/>
        <channel ctl="right_stick_vert" function="PITCH" min="1112" neutral="1518" max="1937" average="0"/>
        <channel ctl="left_stick_vert" function="THROTTLE" min="1940" neutral="1940" max="1115" average="0"/>
        <channel ctl="left_stick_horiz" function="YAW" min="1940" neutral="1498" max="1115" average="0"/>
        <channel ctl="switch_G" function="CALIB" min="2080" neutral="1525" max="969" average="10"/>
        <channel ctl="VRA" function="GAIN1" min="970" neutral="1520" max="2078" average="10"/>
        <channel ctl="VRC" function="GAIN2" min="970" neutral="1518" max="2077" average="10"/>
        <channel ctl="switch_C" function="MODE" min="2079" neutral="1526" max="966" average="10"/>
      </radio>
    </aircraft>
    <aircraft name="verir" ac_id="13" airframe="airframes/vertigo_arm_ir.xml" radio="radios/T9cap.xml" telemetry="telemetry/debug.xml" settings="settings/tuning_ver_ir.xml" flight_plan="flight_plans/maxwell.xml">
      <flight_plan alt="833" ground_alt="758" lat0="32.22610" lon0="-111.02574" max_dist_from_home="500" name="maxwell" qfu="180" security_height="20" wind_dir="60" wind_mod="3">
        <waypoints>
          <waypoint name="HOME" x="11.6840794038" y="1.88159691589"/>
          <waypoint name="1" x="47.676852903" y="0.432076195721"/>
          <waypoint name="2" x="-28.6443295429" y="-2.43171868613"/>
        </waypoints>
        <blocks>
          <block name="init">
            <exception cond="(RcEvent1())" deroute="landing"/>
            <exception cond="(RcEvent2())" deroute="2wp loiter"/>
            <while cond="(!launch)"/>
            <attitude pitch="0.3" roll="0.0" throttle="1.0" until="(estimator_z > SECURITY_ALT)" vmode="throttle"/>
            <deroute block="2wp loiter"/>
          </block>
          <block name="2wp loiter">
            <exception cond="(RcEvent1())" deroute="init"/>
            <exception cond="(RcEvent2())" deroute="circle"/>
            <while>
              <go approaching_time="1" throttle="auto" vmode="alt" wp="1"/>
              <go approaching_time="1" throttle="auto" vmode="alt" wp="2"/>
            </while>
          </block>
          <block name="circle">
            <exception cond="(RcEvent2())" deroute="2wp loiter"/>
            <exception cond="(RcEvent1())" deroute="landing"/>
            <circle radius="40" wp="HOME"/>
          </block>
          <block name="landing">
            <exception cond="(RcEvent2())" deroute="circle"/>
            <exception cond="(RcEvent1())" deroute="init"/>
            <go alt="GROUND_ALT+8" wp="1"/>
            <go alt="GROUND_ALT" throttle="0.30" vmode="throttle" wp="2"/>
          </block>
        </blocks>
      </flight_plan>
      <airframe name="DRAGONFLY ARM">
        <servos>
          <servo name="AILERON1" no="0" min="1000" neutral="1500" max="2000"/>
          <servo name="AILERON2" no="1" min="1000" neutral="1500" max="2000"/>
          <servo name="THROTTLE" no="3" min="1100" neutral="1200" max="2000"/>
          <servo name="RUDDER" no="4" min="1000" neutral="1500" max="2000"/>
        </servos>
        <commands>
          <axis name="THROTTLE" failsafe_value="0"/>
          <axis name="ROLL" failsafe_value="0"/>
          <axis name="PITCH" failsafe_value="0"/>
          <axis name="YAW" failsafe_value="0"/>
        </commands>
        <rc_commands>
          <set command="THROTTLE" value="@THROTTLE"/>
          <set command="ROLL" value="@ROLL"/>
          <set command="PITCH" value="@PITCH"/>
          <set command="YAW" value="@YAW"/>
        </rc_commands>
        <section name="MIXER">
          <define name="AILEVON_AILERON_RATE" value="0.8"/>
          <define name="AILEVON_ELEVATOR_RATE" value="0.8"/>
          <define name="ROLL_TGAIN" value="0.005"/>
          <define name="PITCH_TGAIN" value="-0.0"/>
        </section>
        <command_laws>
          <set servo="THROTTLE" value="@THROTTLE-(vsupply-110.0f)*vdrop2throt_coeff"/>
          <let var="roll" value="@ROLL"/>
          <let var="rollofthr" value="@THROTTLE * ROLL_TGAIN"/>
          <let var="pitch" value="@PITCH"/>
          <let var="pitchofthr" value="@THROTTLE * PITCH_TGAIN"/>
          <set servo="AILERON1" value="-$roll+$pitch"/>
          <set servo="AILERON2" value="-$roll-$pitch"/>
          <let var="yaw" value="@YAW"/>
          <set servo="RUDDER" value="+$yaw+0.0*$roll"/>
        </command_laws>
        <section name="adc" prefix="ADC_CHANNEL_">
          <define name="GYRO_ROLL" value="ADC_0"/>
          <define name="GYRO_PITCH" value="ADC_1"/>
          <define name="GYRO_YAW" value="ADC_2"/>
          <define name="GYRO_NB_SAMPLES" value="16"/>
          <define name="IR1" value="ADC_3"/>
          <define name="IR2" value="ADC_4"/>
          <define name="IR_NB_SAMPLES" value="16"/>
          <define name="RANGE" value="ADC_3"/>
          <define name="RANGE_NB_SAMPLES" value="1"/>
        </section>
        <section name="AUTO1" prefix="AUTO1_">
          <define name="MAX_ROLL" value="RadOfDeg(30)"/>
          <define name="MAX_PITCH" value="RadOfDeg(45)"/>
          <define name="MAX_YAW" value="RadOfDeg(30)"/>
        </section>
        <section name="INFRARED" prefix="IR_">
          <define name="ROLL_NEUTRAL_DEFAULT" value="DegOfRad(0.00)" unit="deg"/>
          <define name="PITCH_NEUTRAL_DEFAULT" value="DegOfRad(-1.344)" unit="deg"/>
          <define name="DEFAULT_CONTRAST" value="900"/>
          <define name="RAD_OF_IR_CONTRAST" value="1.9"/>
          <linear name="RollOfIrs" arity="2" coeff1="0.7" coeff2="-0.7"/>
          <linear name="PitchOfIrs" arity="2" coeff1="-0.7" coeff2="-0.7"/>
          <define name="RAD_OF_IR_MAX_VALUE" value="0.0045"/>
          <define name="RAD_OF_IR_MIN_VALUE" value="0.00075"/>
          <define name="ADC_ROLL_NEUTRAL" value="0"/>
          <define name="ADC_PITCH_NEUTRAL" value="0"/>
          <define name="ESTIMATED_PHI_PI_4" value="M_PI_4*0.6"/>
          <define name="CORRECTION_UP" value="1.5"/>
          <define name="CORRECTION_DOWN" value="1.5"/>
          <define name="CORRECTION_LEFT" value="1.5"/>
          <define name="CORRECTION_RIGHT" value="1.5"/>
        </section>
        <section name="GYRO" prefix="GYRO_">
          <define name="ADC_ROLL_NEUTRAL" value="458"/>
          <define name="ADC_PITCH_NEUTRAL" value="462"/>
          <define name="ADC_YAW_NEUTRAL" value="537"/>
          <define name="ROLL_SCALE" value="0.5"/>
          <define name="ROLL_DIRECTION" value="-1"/>
          <define name="PITCH_SCALE" value="0.5"/>
          <define name="PITCH_DIRECTION" value="1."/>
          <define name="YAW_SCALE" value="0.5"/>
          <define name="YAW_DIRECTION" value="-1."/>
        </section>
        <section name="ACCEL" prefix="ACCEL_">
          <define name="AX_NEUTRAL" value="528"/>
          <define name="AY_NEUTRAL" value="516"/>
          <define name="AZ_NEUTRAL" value="509"/>
          <define name="AX_SCALE" value="0.01"/>
          <define name="AY_SCALE" value="0.01"/>
          <define name="AZ_SCALE" value="0.01"/>
        </section>
        <section name="RANGE" prefix="RANGE_">
          <define name="NEUTRAL" value="0"/>
          <define name="SCALE" value="1.35"/>
          <define name="DIRECTION" value="1."/>
        </section>
        <section name="KALMAN" prefix="KALMAN_">
          <define name="Q_ANGLE" value="1e-1f"/>
          <define name="Q_GYRO" value="5e-1f"/>
          <define name="R_ANGLE" value="1e-3f"/>
        </section>
        <section name="BAT">
          <define name="MILLIAMP_PER_PERCENT" value="0.86"/>
          <define name="ADC_CHANNEL_VSUPPLY" value="AdcBank1(6)"/>
          <define name="VoltageOfAdc(adc)" value="(0.01787109375*adc)"/>
          <define name="LOW_BATTERY" value="9.3" unit="V"/>
        </section>
        <section name="VERTICAL CONTROL" prefix="V_CTL_">
          <define name="ALTITUDE_PGAIN" value="0.3"/>
          <define name="ALTITUDE_MAX_CLIMB" value="2."/>
          <define name="AUTO_THROTTLE_MIN_CRUISE_THROTTLE" value="0.35"/>
          <define name="AUTO_THROTTLE_MAX_CRUISE_THROTTLE" value="0.45"/>
          <define name="AUTO_THROTTLE_PGAIN" value="0.02"/>
          <define name="AUTO_THROTTLE_IGAIN" value="0.0"/>
          <define name="AUTO_THROTTLE_PITCH_OF_VZ_PGAIN" value="0.0"/>
          <define name="AUTO_THROTTLE_DASH_TRIM" value="1000"/>
          <define name="AUTO_THROTTLE_LOITER_TRIM" value="1500"/>
          <define name="AUTO_THROTTLE_CRUISE_THROTTLE" value="0.488"/>
          <define name="AUTO_THROTTLE_CRUISE_THROTTLE_PGAIN" value="0.01"/>
          <define name="AUTO_THROTTLE_NOMINAL_CRUISE_THROTTLE" value="0.47"/>
          <define name="AUTO_THROTTLE_CLIMB_THROTTLE_INCREMENT" value="0.02" unit="%/(m/s)"/>
          <define name="THROTTLE_SUM_NB_SAMPLES" value="32"/>
          <define name="AUTO_PITCH_PGAIN" value="0.1"/>
          <define name="AUTO_PITCH_IGAIN" value="0.0"/>
          <define name="AUTO_PITCH_MAX_PITCH" value="0.35"/>
          <define name="AUTO_PITCH_MIN_PITCH" value="-0.35"/>
          <define name="VDROP2THROTTLE" value="0"/>
          <define name="THROTTLE_SLEW" value="1.0"/>
        </section>
        <section name="HORIZONTAL CONTROL" prefix="H_CTL_">
          <define name="COURSE_PGAIN" value="0.5"/>
          <define name="ROLL_MAX_SETPOINT" value="RadOfDeg(45)" unit="radians"/>
          <define name="PITCH_MAX_SETPOINT" value="RadOfDeg(30)" unit="radians"/>
          <define name="PITCH_MIN_SETPOINT" value="RadOfDeg(-20)" unit="radians"/>
          <define name="YAW_MAX_SETPOINT" value="RadOfDeg(20)" unit="radians"/>
          <define name="ROLL_PGAIN" value="-12000."/>
          <define name="AILERON_OF_THROTTLE" value="0.0"/>
          <define name="PITCH_PGAIN" value="11950."/>
          <define name="PITCH_DGAIN" value="0.0"/>
          <define name="ELEVATOR_OF_ROLL" value="0."/>
          <define name="ROLL_RATE_MODE_DEFAULT" value="1"/>
          <define name="PITCH_RATE_MODE_DEFAULT" value="1"/>
          <define name="YAW_RATE_MODE_DEFAULT" value="1"/>
          <define name="ROLL_RATE_SETPOINT_PGAIN" value="0.75" unit="1/s"/>
          <define name="ROLL_RATE_MAX_SETPOINT" value="10"/>
          <define name="PITCH_RATE_SETPOINT_PGAIN" value="0.75" unit="1/s"/>
          <define name="PITCH_RATE_MAX_SETPOINT" value="10"/>
          <define name="YAW_RATE_SETPOINT_PGAIN" value="0.75" unit="1/s"/>
          <define name="YAW_RATE_MAX_SETPOINT" value="10"/>
          <define name="LO_THROTTLE_ROLL_RATE_PGAIN" value="25000."/>
          <define name="HI_THROTTLE_ROLL_RATE_PGAIN" value="25000."/>
          <define name="LO_THROTTLE_PITCH_RATE_PGAIN" value="13000."/>
          <define name="HI_THROTTLE_PITCH_RATE_PGAIN" value="13000."/>
          <define name="LO_THROTTLE_YAW_RATE_PGAIN" value="18000."/>
          <define name="HI_THROTTLE_YAW_RATE_PGAIN" value="18000."/>
          <define name="ROLL_RATE_IGAIN" value="0."/>
          <define name="ROLL_RATE_DGAIN" value="0."/>
          <define name="ROLL_RATE_SUM_NB_SAMPLES" value="16"/>
          <define name="PITCH_RATE_IGAIN" value="0."/>
          <define name="PITCH_RATE_DGAIN" value="0."/>
          <define name="PITCH_RATE_SUM_NB_SAMPLES" value="16"/>
          <define name="YAW_RATE_IGAIN" value="0."/>
          <define name="YAW_RATE_DGAIN" value="0."/>
          <define name="YAW_RATE_SUM_NB_SAMPLES" value="16"/>
        </section>
        <section name="THR">
          <define name="DASH_THR" value="0.6"/>
          <define name="LOITER_THR" value="0.52"/>
        </section>
        <section name="NAV">
          <define name="NAV_PITCH" value="0."/>
          <define name="NAV_GLIDE_PITCH_TRIM" value="0"/>
        </section>
        <section name="AGGRESSIVE" prefix="AGR_">
          <define name="BLEND_START" value="0.5"/>
          <define name="BLEND_END" value="0.2"/>
          <define name="CLIMB_THROTTLE" value="0.53"/>
          <define name="CLIMB_PITCH" value="0.0"/>
          <define name="DESCENT_THROTTLE" value="0.50"/>
          <define name="DESCENT_PITCH" value="0.0"/>
          <define name="CLIMB_NAV_RATIO" value="0.8"/>
          <define name="DESCENT_NAV_RATIO" value="1.0"/>
        </section>
        <section name="FAILSAFE" prefix="FAILSAFE_">
          <define name="DELAY_WITHOUT_GPS" value="5" unit="s"/>
          <define name="DEFAULT_THROTTLE" value="0.2" unit="%"/>
          <define name="DEFAULT_ROLL" value="0.3" unit="rad"/>
          <define name="DEFAULT_PITCH" value="0.1" unit="rad"/>
          <define name="HOME_RADIUS" value="50" unit="m"/>
        </section>
        <section name="SIMU">
          <define name="ROLL_RESPONSE_FACTOR" value="2."/>
          <define name="YAW_RESPONSE_FACTOR" value="1.35"/>
          <define name="WEIGHT" value="1.3"/>
        </section>
        <section name="MISC">
          <define name="NOMINAL_AIRSPEED" value="3." unit="m/s"/>
          <define name="CARROT" value="5." unit="s"/>
          <define name="KILL_MODE_DISTANCE" value="(MAX_DIST_FROM_HOME*1.5)" unit="m"/>
          <define name="XBEE_INIT" value="\"ATPL4\\rATRN1\\rATTT80\\rATBD3\\rATWR\\r\""/>
          <define name="TRIGGER_DELAY" value="1.1"/>
          <define name="DEFAULT_CIRCLE_RADIUS" value="100."/>
        </section>
        <section name="DATALINK" prefix="DATALINK_">
          <define name="DEVICE_TYPE" value="XBEE"/>
          <define name="DEVICE_ADDRESS" value="...."/>
        </section>
        <makefile>include $(PAPARAZZI_SRC)/conf/autopilot/tiny.makefile
FLASH_MODE=ISP
ap.CFLAGS +=  -DFBW -DAP -DCONFIG=\&quot;tiny_0_99.h\&quot; -DLED -DTIME_LED=1
ap.srcs = sys_time.c $(SRC_ARCH)/sys_time_hw.c $(SRC_ARCH)/armVIC.c main_fbw.c main_ap.c main.c
ap.srcs += commands.c
ap.CFLAGS += -DACTUATORS=\&quot;servos_4015_MAT_hw.h\&quot; -DSERVOS_4015_MAT
ap.srcs += $(SRC_ARCH)/servos_4015_MAT_hw.c actuators.c
ap.CFLAGS += -DRADIO_CONTROL -DRADIO_CONTROL_TYPE=RC_FUTABA
ap.srcs += radio_control.c $(SRC_ARCH)/ppm_hw.c  
#ap.CFLAGS += -DDOWNLINK -DDOWNLINK_TRANSPORT=PprzTransport 
#ap.srcs += downlink.c $(SRC_ARCH)/uart_hw.c datalink.c pprz_transport.c
#ap.CFLAGS += -DDOWNLINK_FBW_DEVICE=Modem 
#ap.CFLAGS += -DDOWNLINK_AP_DEVICE=Modem 
#ap.CFLAGS += -DMODEM
#ap.srcs += $(SRC_ARCH)/modem_hw.c 
#--SERIAL MODE--------
#ap.CFLAGS += -DDOWNLINK -DUSE_UART0 -DDOWNLINK_TRANSPORT=PprzTransport 
#ap.CFLAGS += -DDOWNLINK_FBW_DEVICE=Uart0 -DDOWNLINK_AP_DEVICE=Uart0 
#ap.CFLAGS += -DPPRZ_UART=Uart0 -DUART0_BAUD=B9600
#ap.srcs += downlink.c $(SRC_ARCH)/uart_hw.c pprz_transport.c
#ap.srcs += traffic_info.c
#--API MODE-----------
#--XBEE-----------
ap.CFLAGS += -DDOWNLINK -DUSE_UART0 -DDOWNLINK_TRANSPORT=XBeeTransport 
ap.CFLAGS += -DDOWNLINK_FBW_DEVICE=Uart0 -DDOWNLINK_AP_DEVICE=Uart0 
ap.CFLAGS += -DXBEE_UART=Uart0 -DDATALINK=XBEE -DUART0_BAUD=B9600
ap.srcs += downlink.c $(SRC_ARCH)/uart_hw.c datalink.c xbee.c
ap.srcs += traffic_info.c
#--AEROCOMM-----------
#ap.CFLAGS += -DDOWNLINK -DUSE_UART0 -DDOWNLINK_TRANSPORT=AerocommTransport 
#ap.CFLAGS += -DDOWNLINK_FBW_DEVICE=Uart0 -DDOWNLINK_AP_DEVICE=Uart0 
#ap.CFLAGS += -DAEROCOMM_UART=Uart0 -DDATALINK=AEROCOMM -DUART0_BAUD=B57600
#ap.srcs += downlink.c $(SRC_ARCH)/uart_hw.c datalink.c aerocomm.c
#ap.srcs += traffic_info.c
ap.CFLAGS += -DINTER_MCU
ap.srcs += inter_mcu.c 
ap.CFLAGS += -DADC -DUSE_ADC_0 -DUSE_ADC_1 -DUSE_ADC_2 -DUSE_ADC_3 -DUSE_ADC_4
ap.srcs += $(SRC_ARCH)/adc_hw.c
ap.CFLAGS += -DGPS -DGPS_CONFIGURE -DUBX -DUSE_UART1 -DGPS_LINK=Uart1 -DUART1_BAUD=B38400
ap.srcs += gps_ubx.c gps.c
ap.CFLAGS += -DINFRARED 
ap.srcs += infrared.c 
#ap.CFLAGS += -DALT_KALMAN 
#ap.CFLAGS += -DIR_360
ap.srcs += estimator.c
ap.CFLAGS += -DCTL_ROLL_RATE
ap.CFLAGS += -DCTL_PITCH_RATE
ap.CFLAGS += -DCTL_YAW_RATE
ap.CFLAGS += -DNAV 
#ap.CFLAGS += -DAGR_CLIMB 
#ap.CFLAGS += -DLOITER_TRIM
ap.srcs += nav.c fw_h_ctl.c fw_v_ctl.c
#ap.CFLAGS += -DGYRO -DADXRS150 
#ap.srcs += gyro.c nav_line.c 
#ap.srcs += chemotaxis.c anemotaxis.c discsurvey.c
ap.CFLAGS += -DGYRO -DIDG300 
ap.srcs += gyro.c
#ap.CFLAGS += -DACCEL -DADXL330 
#ap.srcs += accel.c
#ap.CFLAGS += -DRANGE 
#ap.CFLAGS += -DRANGE_ALT 
ap.CFLAGS += -DATTITUDE_ROLL
ap.CFLAGS += -DATTITUDE_PITCH
#ap.CFLAGS += -DAUTO2_MANUAL_HOVERING 
#ap.srcs += range.c
#ap.CFLAGS += -DKALMAN_ROLL_PITCH 
#ap.srcs += kalman_roll_pitch.c
#ap.srcs += bomb.c
# Hack to use the same tuning file than slayer1
ap.CFLAGS += -DUSE_GPIO
ap.srcs += $(SRC_ARCH)/gpio.c
# Harware In The Loop
#ap.CFLAGS += -DHITL
# Config for SITL simulation
include $(PAPARAZZI_SRC)/conf/autopilot/sitl.makefile
sim.CFLAGS += -DCONFIG=\&quot;tiny.h\&quot; -DAGR_CLIMB -DH_CTL_RATE_LOOP
# a test program to setup actuators 
setup_actuators.ARCHDIR = $(ARCHI)
setup_actuators.ARCH = arm7tdmi
setup_actuators.TARGET = setup_actuators
setup_actuators.TARGETDIR = setup_actuators
setup_actuators.CFLAGS += -DFBW -DCONFIG=\&quot;tiny.h\&quot; -DLED -DTIME_LED=1 -DACTUATORS=\&quot;servos_4015_hw.h\&quot; -DSERVOS_4015 -DUSE_UART0 -DUART0_BAUD=B9600 -DDATALINK=PPRZ -DPPRZ_UART=Uart0
setup_actuators.srcs += sys_time.c $(SRC_ARCH)/sys_time_hw.c $(SRC_ARCH)/armVIC.c pprz_transport.c setup_actuators.c $(SRC_ARCH)/uart_hw.c $(SRC_ARCH)/servos_4015_hw.c main.c
# a test program to tunnel between both uart
tunnel.ARCHDIR = $(ARCHI)
tunnel.ARCH = arm7tdmi
tunnel.TARGET = tunnel
tunnel.TARGETDIR = tunnel
tunnel.CFLAGS += -DFBW -DCONFIG=\&quot;tiny_0_99.h\&quot; -DLED -DTIME_LED=1
tunnel.srcs += $(SRC_ARCH)/uart_tunnel.c</makefile>
      </airframe>
      <radio name="T9cap" data_min="900" data_max="2100" sync_min="5000" sync_max="15000">
        <channel ctl="right_stick_horiz" function="ROLL" min="1939" neutral="1525" max="1114" average="0"/>
        <channel ctl="right_stick_vert" function="PITCH" min="1112" neutral="1518" max="1937" average="0"/>
        <channel ctl="left_stick_vert" function="THROTTLE" min="1940" neutral="1940" max="1115" average="0"/>
        <channel ctl="left_stick_horiz" function="YAW" min="1940" neutral="1498" max="1115" average="0"/>
        <channel ctl="switch_G" function="CALIB" min="2080" neutral="1525" max="969" average="10"/>
        <channel ctl="VRA" function="GAIN1" min="970" neutral="1520" max="2078" average="10"/>
        <channel ctl="VRC" function="GAIN2" min="970" neutral="1518" max="2077" average="10"/>
        <channel ctl="switch_C" function="MODE" min="2079" neutral="1526" max="966" average="10"/>
      </radio>
    </aircraft>
    <aircraft name="del" ac_id="3" airframe="airframes/dragonfly_aerocomm_api.xml" radio="radios/T9cap.xml" telemetry="telemetry/debug.xml" settings="settings/tuning_nogyro.xml" flight_plan="flight_plans/mav08.xml">
      <flight_plan alt="215" ground_alt="164" lat0="27.096278" lon0="77.913667" max_dist_from_home="750" name="MAV08" qfu="270" security_height="0.2">
        <waypoints>
          <waypoint name="HOME" x="389.461688587" y="148.170916001"/>
          <waypoint name="1" x="348.968909955" y="-184.804119437"/>
          <waypoint name="2" x="483.165581494" y="-285.670723305"/>
          <waypoint name="Red Team Halt Point" x="204.79074888" y="679.384209533"/>
          <waypoint name="Test Point" x="99.9999998533" y="299.999997493"/>
          <waypoint name="Ingress Point" x="333.603316023" y="-358.913462905"/>
          <waypoint name="Launch/Landing Point" x="366.595119859" y="-351.937109483"/>
          <waypoint name="Ground Station" x="322.804592876" y="-368.369171719"/>
          <waypoint name="NF29" x="496.029520577" y="485.961978898"/>
          <waypoint name="NF28" x="616.911424299" y="383.964742707"/>
          <waypoint name="NF27" x="819.756595135" y="197.70035002"/>
          <waypoint name="NF26" x="906.504879931" y="27.1484701075"/>
          <waypoint name="NF25" x="869.429696922" y="-158.482337067"/>
          <waypoint name="NF24" x="755.026445652" y="-339.810450893"/>
          <waypoint name="NF23" x="629.636936471" y="-518.397859649"/>
          <waypoint name="NF22" x="506.828964912" y="-453.4869281"/>
          <waypoint name="NF21" x="241.868821618" y="-323.99974884"/>
          <waypoint name="NF20" x="71.7823259701" y="-244.765992408"/>
          <waypoint name="NF19" x="-145.059489499" y="-49.6092875903"/>
          <waypoint name="NF18" x="-76.3313883272" y="81.4090984818"/>
          <waypoint name="NF17" x="13.1781753246" y="262.151580174"/>
          <waypoint name="NF16" x="100.006394217" y="442.832846336"/>
          <waypoint name="NF15" x="280.264277112" y="634.888435312"/>
          <waypoint name="NF14" x="276.771388466" y="665.638972087"/>
          <waypoint name="NF13" x="259.847215367" y="680.661954578"/>
          <waypoint name="NF12" x="243.0943165" y="692.583588628"/>
          <waypoint name="NF11" x="234.689423253" y="695.493865295"/>
          <waypoint name="NF10" x="198.805945337" y="697.766465149"/>
          <waypoint name="NF9" x="179.633032238" y="694.216225675"/>
          <waypoint name="NF8" x="174.291267993" y="684.887164239"/>
          <waypoint name="NF7" x="180.132004976" y="672.712236741"/>
          <waypoint name="NF5" x="165.494338091" y="589.193877008"/>
          <waypoint name="NF6" x="144.543954508" y="542.46045385"/>
          <waypoint name="NF4" x="183.483192007" y="648.058185512"/>
          <waypoint name="NF3" x="186.588578913" y="629.720015074"/>
          <waypoint name="NF2" x="364.684984678" y="559.880062356"/>
          <waypoint name="NF1" x="291.988322978" y="604.439863"/>
          <waypoint name="A1" x="267.736035163" y="-249.536940346"/>
          <waypoint name="B1" x="108.6623204" y="-170.048237436"/>
          <waypoint name="C2" x="162.385448536" y="12.9707708214"/>
          <waypoint name="C1" x="-4.98257577419e-08" y="-8.36793333292e-07"/>
          <waypoint name="D2" x="169.396282919" y="185.70138739"/>
          <waypoint name="D1" x="59.0384800886" y="189.241514152"/>
          <waypoint name="E2" x="178.82939895" y="373.793152962"/>
          <waypoint name="E1" x="120.696083476" y="381.012203858"/>
          <waypoint name="B2" x="298.056134547" y="-131.717770102"/>
          <waypoint name="C3" x="317.865250565" y="-35.7688661949"/>
          <waypoint name="D3" x="294.045373599" y="160.867418844"/>
          <waypoint name="E3" x="261.823286676" y="360.303162226"/>
          <waypoint name="F1" x="182.634534781" y="564.859762785"/>
          <waypoint name="F2" x="229.74328388" y="553.642454231"/>
        </waypoints>
        <blocks>
          <block name="init">
            <exception cond="(RcEvent1())" deroute="landing"/>
            <exception cond="(RcEvent2())" deroute="2wp loiter"/>
            <while cond="(!launch)"/>
            <attitude pitch="0.3" roll="0.0" throttle="1.0" until="(estimator_z > SECURITY_ALT)" vmode="throttle"/>
            <deroute block="2wp loiter"/>
          </block>
          <block name="2wp loiter">
            <exception cond="(RcEvent1())" deroute="init"/>
            <exception cond="(RcEvent2())" deroute="circle"/>
            <while>
              <go approaching_time="1" pitch="0.0" throttle="auto" vmode="alt" wp="1"/>
              <go approaching_time="1" pitch="0.0" throttle="auto" vmode="alt" wp="2"/>
            </while>
          </block>
          <block name="circle">
            <exception cond="(RcEvent2())" deroute="2wp loiter"/>
            <exception cond="(RcEvent1())" deroute="landing"/>
            <circle radius="50" wp="HOME"/>
          </block>
          <block name="landing">
            <exception cond="(RcEvent2())" deroute="circle"/>
            <exception cond="(RcEvent1())" deroute="init"/>
            <go alt="GROUND_ALT+2" wp="1"/>
            <go alt="GROUND_ALT" throttle="0.10" vmode="throttle" wp="2"/>
          </block>
        </blocks>
      </flight_plan>
      <airframe name="DRAGONFLY ARM">
        <servos>
          <servo name="ELEVATOR" no="0" min="1000" neutral="1500" max="2000"/>
          <servo name="AILERON" no="1" min="1000" neutral="1500" max="2000"/>
          <servo name="THROTTLE" no="3" min="1100" neutral="1200" max="2000"/>
        </servos>
        <commands>
          <axis name="THROTTLE" failsafe_value="0"/>
          <axis name="ROLL" failsafe_value="0"/>
          <axis name="PITCH" failsafe_value="0"/>
        </commands>
        <rc_commands>
          <set command="THROTTLE" value="@THROTTLE"/>
          <set command="ROLL" value="@ROLL"/>
          <set command="PITCH" value="@PITCH"/>
        </rc_commands>
        <section name="MIXER">
          <define name="AILEVON_AILERON_RATE" value="0.8"/>
          <define name="AILEVON_ELEVATOR_RATE" value="0.8"/>
          <define name="ROLL_TGAIN" value="0"/>
          <define name="PITCH_TGAIN" value="0"/>
        </section>
        <command_laws>
          <set servo="THROTTLE" value="@THROTTLE"/>
          <let var="roll" value="@ROLL"/>
          <let var="rollofthr" value="@THROTTLE * ROLL_TGAIN"/>
          <let var="pitch" value="@PITCH"/>
          <let var="pitchofthr" value="@THROTTLE * PITCH_TGAIN"/>
          <set servo="ELEVATOR" value="$pitch - $pitchofthr"/>
          <set servo="AILERON" value="$roll + $rollofthr"/>
        </command_laws>
        <section name="adc" prefix="ADC_CHANNEL_">
          <define name="IR1" value="ADC_3"/>
          <define name="IR2" value="ADC_4"/>
          <define name="IR_NB_SAMPLES" value="16"/>
        </section>
        <section name="AUTO1" prefix="AUTO1_">
          <define name="MAX_ROLL" value="RadOfDeg(20)"/>
          <define name="MAX_PITCH" value="RadOfDeg(15)"/>
          <define name="MAX_YAW" value="RadOfDeg(30)"/>
        </section>
        <section name="INFRARED" prefix="IR_">
          <define name="ROLL_NEUTRAL_DEFAULT" value="DegOfRad(0.00)" unit="deg"/>
          <define name="PITCH_NEUTRAL_DEFAULT" value="DegOfRad(-1.498)" unit="deg"/>
          <define name="DEFAULT_CONTRAST" value="900"/>
          <define name="RAD_OF_IR_CONTRAST" value="1.9"/>
          <linear name="RollOfIrs" arity="2" coeff1="0.7" coeff2="-0.7"/>
          <linear name="PitchOfIrs" arity="2" coeff1="-0.7" coeff2="-0.7"/>
          <define name="RAD_OF_IR_MAX_VALUE" value="0.0045"/>
          <define name="RAD_OF_IR_MIN_VALUE" value="0.00075"/>
          <define name="ADC_ROLL_NEUTRAL" value="0"/>
          <define name="ADC_PITCH_NEUTRAL" value="0"/>
          <define name="ESTIMATED_PHI_PI_4" value="M_PI_4*0.6"/>
          <define name="CORRECTION_UP" value="4.504"/>
          <define name="CORRECTION_DOWN" value="3.844"/>
          <define name="CORRECTION_LEFT" value="2.7"/>
          <define name="CORRECTION_RIGHT" value="2.7"/>
        </section>
        <section name="BAT">
          <define name="MILLIAMP_PER_PERCENT" value="0.86"/>
          <define name="ADC_CHANNEL_VSUPPLY" value="AdcBank1(6)"/>
          <define name="VoltageOfAdc(adc)" value="(0.01787109375*adc)"/>
          <define name="LOW_BATTERY" value="9.3" unit="V"/>
        </section>
        <section name="VERTICAL CONTROL" prefix="V_CTL_">
          <define name="ALTITUDE_PGAIN" value="0.25"/>
          <define name="ALTITUDE_MAX_CLIMB" value="2."/>
          <define name="AUTO_THROTTLE_MIN_CRUISE_THROTTLE" value="0.35"/>
          <define name="AUTO_THROTTLE_MAX_CRUISE_THROTTLE" value="0.7"/>
          <define name="AUTO_THROTTLE_PGAIN" value="0.037"/>
          <define name="AUTO_THROTTLE_IGAIN" value="0.001"/>
          <define name="AUTO_THROTTLE_PITCH_OF_VZ_PGAIN" value="0.0"/>
          <define name="AUTO_THROTTLE_DASH_TRIM" value="1000"/>
          <define name="AUTO_THROTTLE_LOITER_TRIM" value="1500"/>
          <define name="AUTO_THROTTLE_CRUISE_THROTTLE" value="0.52"/>
          <define name="AUTO_THROTTLE_CRUISE_THROTTLE_PGAIN" value="0.001"/>
          <define name="AUTO_THROTTLE_NOMINAL_CRUISE_THROTTLE" value="0.42"/>
          <define name="AUTO_THROTTLE_CLIMB_THROTTLE_INCREMENT" value="0.051" unit="%/(m/s)"/>
          <define name="THROTTLE_SUM_NB_SAMPLES" value="32"/>
          <define name="AUTO_PITCH_PGAIN" value="0.1"/>
          <define name="AUTO_PITCH_IGAIN" value="0.0"/>
          <define name="AUTO_PITCH_MAX_PITCH" value="0.35"/>
          <define name="AUTO_PITCH_MIN_PITCH" value="-0.35"/>
          <define name="VDROP2THROTTLE" value="0"/>
          <define name="THROTTLE_SLEW" value="1.0"/>
        </section>
        <section name="HORIZONTAL CONTROL" prefix="H_CTL_">
          <define name="COURSE_PGAIN" value="0.25"/>
          <define name="ROLL_MAX_SETPOINT" value="RadOfDeg(20)" unit="radians"/>
          <define name="PITCH_MAX_SETPOINT" value="RadOfDeg(10)" unit="radians"/>
          <define name="PITCH_MIN_SETPOINT" value="RadOfDeg(0)" unit="radians"/>
          <define name="YAW_MAX_SETPOINT" value="RadOfDeg(30)" unit="radians"/>
          <define name="ROLL_PGAIN" value="-12000."/>
          <define name="AILERON_OF_THROTTLE" value="0.0"/>
          <define name="PITCH_PGAIN" value="11950."/>
          <define name="PITCH_DGAIN" value="0.0"/>
          <define name="ELEVATOR_OF_ROLL" value="0."/>
          <define name="ROLL_RATE_MODE_DEFAULT" value="1"/>
          <define name="PITCH_RATE_MODE_DEFAULT" value="1"/>
          <define name="YAW_RATE_MODE_DEFAULT" value="1"/>
          <define name="ROLL_RATE_SETPOINT_PGAIN" value="0.75" unit="1/s"/>
          <define name="ROLL_RATE_MAX_SETPOINT" value="10"/>
          <define name="PITCH_RATE_SETPOINT_PGAIN" value="0.75" unit="1/s"/>
          <define name="PITCH_RATE_MAX_SETPOINT" value="10"/>
          <define name="YAW_RATE_SETPOINT_PGAIN" value="0.75" unit="1/s"/>
          <define name="YAW_RATE_MAX_SETPOINT" value="10"/>
          <define name="LO_THROTTLE_ROLL_RATE_PGAIN" value="6284.421"/>
          <define name="HI_THROTTLE_ROLL_RATE_PGAIN" value="6167.147"/>
          <define name="LO_THROTTLE_PITCH_RATE_PGAIN" value="9394.8"/>
          <define name="HI_THROTTLE_PITCH_RATE_PGAIN" value="9394.8"/>
          <define name="LO_THROTTLE_YAW_RATE_PGAIN" value="0"/>
          <define name="HI_THROTTLE_YAW_RATE_PGAIN" value="0"/>
          <define name="ROLL_RATE_IGAIN" value="0."/>
          <define name="ROLL_RATE_DGAIN" value="0."/>
          <define name="ROLL_RATE_SUM_NB_SAMPLES" value="16"/>
          <define name="PITCH_RATE_IGAIN" value="0."/>
          <define name="PITCH_RATE_DGAIN" value="0."/>
          <define name="PITCH_RATE_SUM_NB_SAMPLES" value="16"/>
          <define name="YAW_RATE_IGAIN" value="0."/>
          <define name="YAW_RATE_DGAIN" value="0."/>
          <define name="YAW_RATE_SUM_NB_SAMPLES" value="16"/>
        </section>
        <section name="THR">
          <define name="DASH_THR" value="0.6"/>
          <define name="LOITER_THR" value="0.52"/>
        </section>
        <section name="NAV">
          <define name="NAV_PITCH" value="0."/>
          <define name="NAV_GLIDE_PITCH_TRIM" value="0"/>
        </section>
        <section name="AGGRESSIVE" prefix="AGR_">
          <define name="BLEND_START" value="0.5"/>
          <define name="BLEND_END" value="0.2"/>
          <define name="CLIMB_THROTTLE" value="0.53"/>
          <define name="CLIMB_PITCH" value="0.0"/>
          <define name="DESCENT_THROTTLE" value="0.50"/>
          <define name="DESCENT_PITCH" value="0.0"/>
          <define name="CLIMB_NAV_RATIO" value="0.8"/>
          <define name="DESCENT_NAV_RATIO" value="1.0"/>
        </section>
        <section name="FAILSAFE" prefix="FAILSAFE_">
          <define name="DEFAULT_THROTTLE" value="0.2" unit="%"/>
          <define name="DEFAULT_ROLL" value="0.3" unit="rad"/>
          <define name="DEFAULT_PITCH" value="0.1" unit="rad"/>
          <define name="HOME_RADIUS" value="50" unit="m"/>
        </section>
        <section name="SIMU">
          <define name="ROLL_RESPONSE_FACTOR" value="2."/>
          <define name="YAW_RESPONSE_FACTOR" value="1.35"/>
          <define name="WEIGHT" value="1.3"/>
        </section>
        <section name="MISC">
          <define name="NOMINAL_AIRSPEED" value="3." unit="m/s"/>
          <define name="CARROT" value="5." unit="s"/>
          <define name="KILL_MODE_DISTANCE" value="(MAX_DIST_FROM_HOME*1.5)" unit="m"/>
          <define name="AEROCOMM_INIT" value=""/>
          <define name="NO_API_INIT" value="TRUE"/>
          <define name="TRIGGER_DELAY" value="1.1"/>
          <define name="DEFAULT_CIRCLE_RADIUS" value="100."/>
        </section>
        <section name="DATALINK" prefix="DATALINK_">
          <define name="DEVICE_TYPE" value="AEROCOMM__"/>
          <define name="DEVICE_ADDRESS" value="...."/>
        </section>
        <makefile>include $(PAPARAZZI_SRC)/conf/autopilot/tiny.makefile
FLASH_MODE=ISP
ap.CFLAGS +=  -DFBW -DAP -DCONFIG=\&quot;tiny_0_99.h\&quot; -DLED -DTIME_LED=1
ap.srcs = sys_time.c $(SRC_ARCH)/sys_time_hw.c $(SRC_ARCH)/armVIC.c main_fbw.c main_ap.c main.c
ap.srcs += commands.c
ap.CFLAGS += -DACTUATORS=\&quot;servos_4015_MAT_hw.h\&quot; -DSERVOS_4015_MAT
ap.srcs += $(SRC_ARCH)/servos_4015_MAT_hw.c actuators.c
ap.CFLAGS += -DRADIO_CONTROL -DRADIO_CONTROL_TYPE=RC_FUTABA
ap.srcs += radio_control.c $(SRC_ARCH)/ppm_hw.c  
#ap.CFLAGS += -DDOWNLINK -DDOWNLINK_TRANSPORT=PprzTransport 
#ap.srcs += downlink.c $(SRC_ARCH)/uart_hw.c datalink.c pprz_transport.c
#ap.CFLAGS += -DDOWNLINK_FBW_DEVICE=Modem 
#ap.CFLAGS += -DDOWNLINK_AP_DEVICE=Modem 
#ap.CFLAGS += -DMODEM
#ap.srcs += $(SRC_ARCH)/modem_hw.c 
#--SERIAL MODE--------
#ap.CFLAGS += -DDOWNLINK -DUSE_UART0 -DDOWNLINK_TRANSPORT=PprzTransport 
#ap.CFLAGS += -DDOWNLINK_FBW_DEVICE=Uart0 -DDOWNLINK_AP_DEVICE=Uart0 
#ap.CFLAGS += -DPPRZ_UART=Uart0 -DUART0_BAUD=B9600
#ap.srcs += downlink.c $(SRC_ARCH)/uart_hw.c datalink.c pprz_transport.c
#ap.srcs += traffic_info.c
#--API MODE-----------
ap.CFLAGS += -DDOWNLINK -DUSE_UART0 -DDOWNLINK_TRANSPORT=AerocommTransport 
ap.CFLAGS += -DDOWNLINK_FBW_DEVICE=Uart0 -DDOWNLINK_AP_DEVICE=Uart0 
ap.CFLAGS += -DAEROCOMM_UART=Uart0 -DDATALINK=AEROCOMM -DUART0_BAUD=B9600
ap.srcs += downlink.c $(SRC_ARCH)/uart_hw.c datalink.c aerocomm_new.c
ap.srcs += traffic_info.c
ap.CFLAGS += -DINTER_MCU
ap.srcs += inter_mcu.c 
ap.CFLAGS += -DADC -DUSE_ADC_0 -DUSE_ADC_1 -DUSE_ADC_2 -DUSE_ADC_3 -DUSE_ADC_4
ap.srcs += $(SRC_ARCH)/adc_hw.c
ap.CFLAGS += -DGPS -DGPS_CONFIGURE -DUBX -DUSE_UART1 -DGPS_LINK=Uart1 -DUART1_BAUD=B38400
ap.srcs += gps_ubx.c gps.c
ap.CFLAGS += -DINFRARED 
ap.srcs += infrared.c 
#ap.CFLAGS += -DALT_KALMAN 
#ap.CFLAGS += -DIR_360
ap.srcs += estimator.c
#ap.CFLAGS += -DCTL_ROLL_RATE
#ap.CFLAGS += -DCTL_PITCH_RATE
#ap.CFLAGS += -DCTL_YAW_RATE
ap.CFLAGS += -DNAV 
#ap.CFLAGS += -DAGR_CLIMB 
#ap.CFLAGS += -DLOITER_TRIM
ap.srcs += nav.c fw_h_ctl.c fw_v_ctl.c
#ap.CFLAGS += -DGYRO -DADXRS150 
#ap.srcs += gyro.c nav_line.c 
#ap.srcs += chemotaxis.c anemotaxis.c discsurvey.c
#ap.CFLAGS += -DGYRO -DIDG300 
#ap.srcs += gyro.c
#ap.CFLAGS += -DACCEL -DADXL330 
#ap.srcs += accel.c
#ap.CFLAGS += -DRANGE 
#ap.CFLAGS += -DRANGE_ALT 
#ap.CFLAGS += -DAUTO2_MANUAL_HOVERING 
#ap.srcs += range.c
#ap.CFLAGS += -DKALMAN_ROLL_PITCH 
#ap.srcs += kalman_roll_pitch.c
#ap.srcs += bomb.c
# Hack to use the same tuning file than slayer1
ap.CFLAGS += -DUSE_GPIO
ap.srcs += $(SRC_ARCH)/gpio.c
# Harware In The Loop
#ap.CFLAGS += -DHITL
# Config for SITL simulation
include $(PAPARAZZI_SRC)/conf/autopilot/sitl.makefile
sim.CFLAGS += -DCONFIG=\&quot;tiny.h\&quot; -DAGR_CLIMB -DH_CTL_RATE_LOOP
sim.srcs += bomb.c
# a test program to setup actuators 
setup_actuators.ARCHDIR = $(ARCHI)
setup_actuators.ARCH = arm7tdmi
setup_actuators.TARGET = setup_actuators
setup_actuators.TARGETDIR = setup_actuators
setup_actuators.CFLAGS += -DFBW -DCONFIG=\&quot;tiny.h\&quot; -DLED -DTIME_LED=1 -DACTUATORS=\&quot;servos_4015_hw.h\&quot; -DSERVOS_4015 -DUSE_UART0 -DUART0_BAUD=B9600 -DDATALINK=PPRZ -DPPRZ_UART=Uart0
setup_actuators.srcs += sys_time.c $(SRC_ARCH)/sys_time_hw.c $(SRC_ARCH)/armVIC.c pprz_transport.c setup_actuators.c $(SRC_ARCH)/uart_hw.c $(SRC_ARCH)/servos_4015_hw.c main.c
# a test program to tunnel between both uart
tunnel.ARCHDIR = $(ARCHI)
tunnel.ARCH = arm7tdmi
tunnel.TARGET = tunnel
tunnel.TARGETDIR = tunnel
tunnel.CFLAGS += -DFBW -DCONFIG=\&quot;tiny_0_99.h\&quot; -DLED -DTIME_LED=1
tunnel.srcs += $(SRC_ARCH)/uart_tunnel.c</makefile>
      </airframe>
      <radio name="T9cap" data_min="900" data_max="2100" sync_min="5000" sync_max="15000">
        <channel ctl="right_stick_horiz" function="ROLL" min="1939" neutral="1525" max="1114" average="0"/>
        <channel ctl="right_stick_vert" function="PITCH" min="1112" neutral="1518" max="1937" average="0"/>
        <channel ctl="left_stick_vert" function="THROTTLE" min="1940" neutral="1940" max="1115" average="0"/>
        <channel ctl="left_stick_horiz" function="YAW" min="1940" neutral="1498" max="1115" average="0"/>
        <channel ctl="switch_G" function="CALIB" min="2080" neutral="1525" max="969" average="10"/>
        <channel ctl="VRA" function="GAIN1" min="970" neutral="1520" max="2078" average="10"/>
        <channel ctl="VRC" function="GAIN2" min="970" neutral="1518" max="2077" average="10"/>
        <channel ctl="switch_C" function="MODE" min="2079" neutral="1526" max="966" average="10"/>
      </radio>
    </aircraft>
    <aircraft name="zagixbee" ac_id="35" airframe="airframes/zagi_xbee.xml" radio="radios/T9cap.xml" telemetry="telemetry/default.xml" settings="settings/tuning.xml" flight_plan="flight_plans/himmel_landing_new.xml">
      <flight_plan alt="800" ground_alt="750" lat0="32.23298" lon0="-110.93243" max_dist_from_home="500" name="himmel 2" qfu="180" security_height="20" wind_dir="60" wind_mod="3">
        <waypoints>
          <waypoint alt="800." name="HOME" x="-73.5401595418" y="34.2456246042"/>
          <waypoint alt="800." name="4" x="13.5556140051" y="42.7654076088"/>
        </waypoints>
        <blocks>
          <block name="init">
            <exception cond="(RcEvent1())" deroute="landing"/>
            <exception cond="(RcEvent2())" deroute="2wp loiter"/>
            <while cond="(!launch)"/>
            <attitude pitch="0.3" roll="0.0" throttle="1.0" until="(estimator_z > SECURITY_ALT)" vmode="throttle"/>
            <deroute block="2wp loiter"/>
          </block>
          <block name="2wp loiter">
            <exception cond="(RcEvent1())" deroute="init"/>
            <exception cond="(RcEvent2())" deroute="circle"/>
            <while>
              <go pitch="0.0" wp="4" approaching_time="1" throttle="auto" vmode="alt"/>
              <go pitch="0.0" wp="HOME" approaching_time="1" throttle="auto" vmode="alt"/>
            </while>
          </block>
          <block name="circle">
            <exception cond="(RcEvent2())" deroute="2wp loiter"/>
            <exception cond="(RcEvent1())" deroute="landing"/>
            <circle alt="GROUND_ALT+50" radius="25" wp="HOME"/>
          </block>
          <block name="landing">
            <exception cond="(RcEvent2())" deroute="circle"/>
            <exception cond="(RcEvent1())" deroute="init"/>
            <go alt="GROUND_ALT+40" wp="4"/>
            <go alt="GROUND_ALT" throttle="0.20" vmode="throttle" wp="HOME"/>
          </block>
        </blocks>
      </flight_plan>
      <airframe name="Zagi with xbee">
        <servos>
          <servo name="GAZ" no="2" min="1000" neutral="1000" max="2000"/>
          <servo name="AILERON_LEFT" no="1" min="1200" neutral="1600" max="2000"/>
          <servo name="AILERON_RIGHT" no="0" min="1200" neutral="1600" max="2000"/>
          <servo name="CAM_ROLL" no="3" max="1816" neutral="1530" min="1220"/>
        </servos>
        <commands>
          <axis name="THROTTLE" failsafe_value="0"/>
          <axis name="ROLL" failsafe_value="0"/>
          <axis name="PITCH" failsafe_value="0"/>
          <axis name="CAM_ROLL" failsafe_value="0"/>
          <axis name="CAM_PITCH" failsafe_value="0"/>
        </commands>
        <rc_commands>
          <set command="THROTTLE" value="@THROTTLE"/>
          <set command="ROLL" value="@ROLL"/>
          <set command="PITCH" value="@PITCH"/>
          <set command="CAM_ROLL" value="@YAW"/>
        </rc_commands>
        <section name="MIXER">
          <define name="AILERON_DIFF" value="0.66"/>
          <define name="COMBI_SWITCH" value="1.0"/>
          <define name="PTCH_of_THRT" value="-0.05"/>
        </section>
        <command_laws>
          <set servo="GAZ" value="@THROTTLE"/>
          <let var="roll" value="@ROLL"/>
          <let var="pitch" value="@PITCH"/>
          <set servo="AILERON_LEFT" value="($roll > 0 ? 1 : AILERON_DIFF)*$roll-$pitch"/>
          <set servo="AILERON_RIGHT" value="($roll > 0 ? 1 : AILERON_DIFF)*$roll+$pitch"/>
          <set servo="CAM_ROLL" value="@CAM_ROLL"/>
        </command_laws>
        <section name="adc" prefix="ADC_CHANNEL_">
          <define name="IR1" value="1"/>
          <define name="IR2" value="0"/>
          <define name="IR_NB_SAMPLES" value="16"/>
          <define name="GYRO_ROLL" value="2"/>
          <define name="GYRO_PITCH" value="3"/>
          <define name="GYRO_NB_SAMPLES" value="16"/>
        </section>
        <section name="AUTO1" prefix="AUTO1_">
          <define name="MAX_ROLL" value="RadOfDeg(40)"/>
          <define name="MAX_PITCH" value="RadOfDeg(40)"/>
        </section>
        <section name="INFRARED" prefix="IR_">
          <define name="ROLL_NEUTRAL_DEFAULT" value="0" unit="deg"/>
          <define name="PITCH_NEUTRAL_DEFAULT" value="-59" unit="deg"/>
          <define name="DEFAULT_CONTRAST" value="900"/>
          <define name="RAD_OF_IR_CONTRAST" value="1.7"/>
          <linear name="RollOfIrs" arity="2" coeff1="0.7" coeff2="-0.7"/>
          <linear name="PitchOfIrs" arity="2" coeff1="-0.7" coeff2="-0.7"/>
          <define name="RAD_OF_IR_MAX_VALUE" value="0.0045"/>
          <define name="RAD_OF_IR_MIN_VALUE" value="0.00075"/>
          <define name="ADC_ROLL_NEUTRAL" value="0"/>
          <define name="ADC_PITCH_NEUTRAL" value="0"/>
          <define name="ESTIMATED_PHI_PI_4" value="M_PI_4"/>
          <define name="CORRECTION_UP" value="1."/>
          <define name="CORRECTION_DOWN" value="1."/>
          <define name="CORRECTION_LEFT" value="1."/>
          <define name="CORRECTION_RIGHT" value="1."/>
        </section>
        <section name="GYRO" prefix="GYRO_">
          <define name="ADC_ROLL_NEUTRAL" value="329"/>
          <define name="ADC_PITCH_NEUTRAL" value="276"/>
          <define name="ROLL_SCALE" value="3.07"/>
          <define name="ROLL_DIRECTION" value="-1"/>
          <define name="PITCH_SCALE" value="2.52"/>
          <define name="PITCH_DIRECTION" value="1."/>
        </section>
        <section name="BAT">
          <define name="MILLIAMP_PER_PERCENT" value="0.86"/>
          <define name="VOLTAGE_ADC_A" value="0.0177531"/>
          <define name="VOLTAGE_ADC_B" value="0.173626"/>
          <define name="VoltageOfAdc(adc)" value="(VOLTAGE_ADC_A * adc+VOLTAGE_ADC_B)"/>
          <define name="LOW_BATTERY" value="9.3" unit="V"/>
        </section>
        <section name="VERTICAL CONTROL" prefix="V_CTL_">
          <define name="ALTITUDE_PGAIN" value="-0.1"/>
          <define name="ALTITUDE_MAX_CLIMB" value="2."/>
          <define name="AUTO_THROTTLE_PGAIN" value="-0.1"/>
          <define name="AUTO_THROTTLE_IGAIN" value="0.1"/>
          <define name="AUTO_THROTTLE_PITCH_OF_VZ_PGAIN" value="0.05"/>
          <define name="AUTO_THROTTLE_DASH_TRIM" value="-1000"/>
          <define name="AUTO_THROTTLE_LOITER_TRIM" value="1500"/>
          <define name="AUTO_THROTTLE_CRUISE_THROTTLE" value="0.50"/>
          <define name="AUTO_THROTTLE_NOMINAL_CRUISE_THROTTLE" value="0.35"/>
          <define name="AUTO_THROTTLE_CLIMB_THROTTLE_INCREMENT" value="0.15" unit="%/(m/s)"/>
          <define name="AUTO_PITCH_PGAIN" value="-0.1"/>
          <define name="AUTO_PITCH_IGAIN" value="0.0"/>
          <define name="AUTO_PITCH_MAX_PITCH" value="0.35"/>
          <define name="AUTO_PITCH_MIN_PITCH" value="-0.35"/>
          <define name="THROTTLE_SLEW" value="0.05"/>
        </section>
        <section name="HORIZONTAL CONTROL" prefix="H_CTL_">
          <define name="COURSE_PGAIN" value="0.2"/>
          <define name="ROLL_MAX_SETPOINT" value="0.6" unit="radians"/>
          <define name="PITCH_MAX_SETPOINT" value="0.5" unit="radians"/>
          <define name="PITCH_MIN_SETPOINT" value="-0.5" unit="radians"/>
          <define name="YAW_MAX_SETPOINT" value="0.5" unit="radians"/>
          <define name="ROLL_PGAIN" value="-12000."/>
          <define name="AILERON_OF_THROTTLE" value="0.0"/>
          <define name="PITCH_PGAIN" value="-8000."/>
          <define name="PITCH_DGAIN" value="0.0"/>
          <define name="ELEVATOR_OF_ROLL" value="1250"/>
          <define name="ROLL_RATE_MODE_DEFAULT" value="1"/>
          <define name="ROLL_RATE_SETPOINT_PGAIN" value="2.5" unit="1/s"/>
          <define name="ROLL_RATE_MAX_SETPOINT" value="10"/>
          <define name="LO_THROTTLE_ROLL_RATE_PGAIN" value="4000."/>
          <define name="HI_THROTTLE_ROLL_RATE_PGAIN" value="1400."/>
          <define name="ROLL_RATE_IGAIN" value="0."/>
          <define name="ROLL_RATE_DGAIN" value="0."/>
          <define name="ROLL_RATE_SUM_NB_SAMPLES" value="64"/>
        </section>
        <section name="THR">
          <define name="DASH_THR" value="1.0"/>
          <define name="LOITER_THR" value="0.50"/>
        </section>
        <section name="NAV">
          <define name="NAV_PITCH" value="0."/>
          <define name="NAV_GLIDE_PITCH_TRIM" value="0"/>
        </section>
        <section name="AGGRESSIVE" prefix="AGR_">
          <define name="BLEND_START" value="20"/>
          <define name="BLEND_END" value="10"/>
          <define name="CLIMB_THROTTLE" value="0.95"/>
          <define name="CLIMB_PITCH" value="0.3"/>
          <define name="DESCENT_THROTTLE" value="0.1"/>
          <define name="DESCENT_PITCH" value="-0.25"/>
          <define name="CLIMB_NAV_RATIO" value="0.8"/>
          <define name="DESCENT_NAV_RATIO" value="1.0"/>
        </section>
        <section name="MISC">
          <define name="NOMINAL_AIRSPEED" value="10." unit="m/s"/>
          <define name="CARROT" value="5." unit="s"/>
          <define name="KILL_MODE_DISTANCE" value="(MAX_DIST_FROM_HOME*1.5)" unit="m"/>
          <define name="XBEE_INIT" value="\"ATPL4\\rATRN1\\rATTT80\\rATBD3\\rATWR\\r\""/>
          <define name="NO_XBEE_API_INIT" value="TRUE"/>
        </section>
        <section name="GYRO">
          <define name="GYRO_MAX_RATE" value="500."/>
          <define name="ROLLRATESUM_NB_SAMPLES" value="60"/>
          <define name="ALT_ROLL_PGAIN" value="5.5"/>
          <define name="ROLL_RATE_PGAIN" value="860.0"/>
          <define name="ROLL_RATE_IGAIN" value="0.0"/>
          <define name="ROLL_RATE_DGAIN" value="0.0"/>
          <define name="CONFIDENCE_COEFF" value="34.0"/>
          <define name="J_FILTER" value="0"/>
        </section>
        <section name="SIMU">
          <define name="ROLL_RESPONSE_FACTOR" value="60."/>
          <define name="YAW_RESPONSE_FACTOR" value="0.6"/>
          <define name="WEIGHT" value="1.280"/>
        </section>
        <section name="FAILSAFE" prefix="FAILSAFE_">
          <define name="DELAY_WITHOUT_GPS" value="2" unit="s"/>
          <define name="DEFAULT_THROTTLE" value="0.1" unit="%"/>
          <define name="DEFAULT_ROLL" value="0.3" unit="rad"/>
          <define name="DEFAULT_PITCH" value="0.08" unit="rad"/>
          <define name="HOME_RADIUS" value="50" unit="m"/>
        </section>
        <section name="CAM" prefix="CAM_">
          <define name="THETA0" value="0" unit="deg"/>
          <define name="PHI0" value="0" unit="deg"/>
        </section>
        <section name="DATALINK" prefix="DATALINK_">
          <define name="DEVICE_TYPE" value="XBEE"/>
          <define name="DEVICE_ADDRESS" value="...."/>
        </section>
        <makefile>include $(PAPARAZZI_SRC)/conf/autopilot/v1_2_1.makefile
include $(PAPARAZZI_SRC)/conf/autopilot/twin_mcu_avr.makefile
ap.srcs += $(SRC_ARCH)/sys_time_hw.c
fbw.srcs += $(SRC_ARCH)/sys_time_hw.c
#--SERIAL MODE--------
#ap.CFLAGS += -DDOWNLINK -DUSE_UART0 -DDOWNLINK_TRANSPORT=PprzTransport 
#ap.CFLAGS += -DDOWNLINK_FBW_DEVICE=Uart0 -DDOWNLINK_AP_DEVICE=Uart0 
#ap.CFLAGS += -DPPRZ_UART=Uart0 -DUART0_BAUD=B9600
#ap.srcs += downlink.c $(SRC_ARCH)/uart_hw.c pprz_transport.c
#--API MODE-----------
ap.CFLAGS += -DDOWNLINK -DUSE_UART0 -DDOWNLINK_TRANSPORT=XBeeTransport 
ap.CFLAGS += -DDOWNLINK_FBW_DEVICE=Uart0 -DDOWNLINK_AP_DEVICE=Uart0 
ap.CFLAGS += -DXBEE_UART=Uart0 -DDATALINK=XBEE -DUART0_BAUD=B9600
ap.srcs += downlink.c $(SRC_ARCH)/uart_hw.c datalink.c xbee.c
ap.srcs += traffic_info.c
#ap.CFLAGS += -DRADIO_CONTROL_SETTINGS -DRADIO_CONTROL_TYPE=RC_FUTABA
#ap.srcs += rc_settings.c
ap.CFLAGS += -DRADIO_CONTROL_TYPE=RC_FUTABA
ap.CFLAGS += -DUART1_BAUD=B38400
ap.CFLAGS += -DGYRO -DIDG300 
ap.srcs += gyro.c
ap.CFLAGS += -DH_CTL_RATE_LOOP 
#ap.CFLAGS += -DAGR_CLIMB -DLOITER_TRIM
# Config for SITL simulation
include $(PAPARAZZI_SRC)/conf/autopilot/sitl.makefile
sim.EXTRA_SRCS += traffic_info.c datalink.c</makefile>
      </airframe>
      <radio name="T9cap" data_min="900" data_max="2100" sync_min="5000" sync_max="15000">
        <channel ctl="right_stick_horiz" function="ROLL" min="1939" neutral="1525" max="1114" average="0"/>
        <channel ctl="right_stick_vert" function="PITCH" min="1112" neutral="1518" max="1937" average="0"/>
        <channel ctl="left_stick_vert" function="THROTTLE" min="1940" neutral="1940" max="1115" average="0"/>
        <channel ctl="left_stick_horiz" function="YAW" min="1940" neutral="1498" max="1115" average="0"/>
        <channel ctl="switch_G" function="CALIB" min="2080" neutral="1525" max="969" average="10"/>
        <channel ctl="VRA" function="GAIN1" min="970" neutral="1520" max="2078" average="10"/>
        <channel ctl="VRC" function="GAIN2" min="970" neutral="1518" max="2077" average="10"/>
        <channel ctl="switch_C" function="MODE" min="2079" neutral="1526" max="966" average="10"/>
      </radio>
    </aircraft>
    <aircraft name="del2" ac_id="37" airframe="airframes/del2.xml" radio="radios/T9cap.xml" telemetry="telemetry/debug.xml" settings="settings/tuning_rc.xml" flight_plan="flight_plans/practice.xml">
      <flight_plan alt="220." ground_alt="170." lat0="43.462918" lon0="1.272874" max_dist_from_home="1750." name="MAV07" qfu="180." security_height="2" wind_dir="60" wind_mod="3">
        <header>#include &quot;bomb.h&quot;</header>
        <waypoints>
          <waypoint alt="210" name="HOME" x="753.859003724" y="-51.1591526465"/>
          <waypoint alt="185" name="arch_end" x="179.046764883" y="-48.7412322229"/>
          <waypoint alt="173" name="arch1" x="341.911346778" y="115.007166854"/>
          <waypoint alt="173" name="arch2" x="250.199286528" y="24.3853619993"/>
          <waypoint alt="185" name="arch_begin" x="480.827210398" y="223.887485793"/>
          <waypoint name="no_flight_0" x="0." y="0."/>
          <waypoint name="no_flight_1" x="299.289766307" y="393.682997511"/>
          <waypoint name="no_flight_2" x="643.74554738" y="630.872654988"/>
          <waypoint name="no_flight_3" x="1653.57829881" y="609.706564201"/>
          <waypoint name="no_flight_4" x="1406.70066794" y="-374.012941903"/>
          <waypoint name="no_flight_5" x="1181.56548784" y="-702.63091506"/>
          <waypoint alt="200" name="target1_0" x="524.68052623" y="265.490340538"/>
          <waypoint alt="200" name="target1_1" x="604.20580033" y="-76.0402953709"/>
          <waypoint alt="220" name="search_0" x="898.404943033" y="-112.697568386"/>
          <waypoint alt="220" name="search_1" x="1122.85485324" y="-117.405561016"/>
          <waypoint alt="220" name="search_2" x="1128.02718789" y="129.37311292"/>
          <waypoint alt="220" name="search_3" x="903.585527941" y="134.081124628"/>
          <waypoint alt="200" name="target2_0" x="1004.80605541" y="-392.706182453"/>
          <waypoint alt="200" name="target2_1" x="1054.25736695" y="-177.744815784"/>
          <waypoint alt="200." name="BASELEG" x="586.379358206" y="86.4412197703"/>
          <waypoint alt="200." name="TARGET" x="423.371151849" y="67.3115331577"/>
          <waypoint alt="200." name="START" x="515.385176622" y="136.134358133"/>
          <waypoint alt="200" name="RELEASE" x="316.849883628" y="-7.90878006071"/>
          <waypoint alt="200." name="CLIMB" x="380.75125501" y="-52.3279377595"/>
          <waypoint alt="170" name="land" x="274.610839868" y="116.42597836"/>
          <waypoint alt="190" name="land_approach" x="422.998154359" y="245.388613055"/>
        </waypoints>
        <blocks>
          <block name="init">
            <while cond="(!launch)"/>
            <attitude pitch="0.3" roll="0.0" throttle="0.8" until="(estimator_z > SECURITY_HEIGHT)" vmode="throttle"/>
            <deroute block="wait"/>
          </block>
          <block name="wait" strip_button="Wait">
            <circle alt="ground_alt+50" radius="50" wp="RELEASE"/>
            <deroute block="wait"/>
          </block>
          <block name="arch">
            <go approaching_time="1" from="arch_end" wp="arch_begin"/>
            <go approaching_time="1" from="arch_begin" hmode="route" wp="arch1"/>
            <go approaching_time="1" from="arch1" hmode="route" wp="arch2"/>
            <go approaching_time="1" wp="arch_end"/>
            <deroute block="arch"/>
          </block>
          <block name="bomb" strip_button="Bomb">
            <set value="BombComputeApproach()" var="unit"/>
            <circle radius="BOMB_RADIUS" until="NavQdrCloseTo(DegOfRad(bomb_start_qdr)-10)" wp="TARGET"/>
          </block>
          <block name="align">
            <exception cond="BombUpdateRelease()" deroute="kill"/>
            <go approaching_time="bomb_trigger_delay" from="TARGET" hmode="route" wp="CLIMB"/>
          </block>
          <block name="shoot">
            <set value="BombShoot()" var="unit"/>
            <go approaching_time="0" from="CLIMB" hmode="route" wp="target2_0"/>
          </block>
          <block name="search">
            <exception cond="block_time > 300" deroute="wait"/>
            <go approaching_time="1" from="search_3" wp="search_0"/>
            <go approaching_time="1" from="search_0" hmode="route" wp="search_1"/>
            <go approaching_time="1" from="search_1" hmode="route" wp="search_2"/>
            <go approaching_time="1" wp="search_3"/>
            <deroute block="search"/>
          </block>
          <block name="target1">
            <exception cond="block_time > 300" deroute="wait"/>
            <circle radius="50" until="nav_circle_radians>4*M_PI" wp="target1_0"/>
            <circle radius="50" until="nav_circle_radians>4*M_PI" wp="target1_1"/>
            <deroute block="target1"/>
          </block>
          <block name="target2">
            <exception cond="block_time > 300" deroute="wait"/>
            <circle radius="50" until="nav_circle_radians>4*M_PI" wp="target2_0"/>
            <circle radius="50" until="nav_circle_radians>4*M_PI" wp="target2_1"/>
            <deroute block="target2"/>
          </block>
          <block name="landing">
            <go wp="land_approach"/>
            <go throttle="0.15" vmode="throttle" wp="land"/>
          </block>
          <block name="kill">
            <attitude pitch="0.0" roll="0.0" throttle="0.0" vmode="throttle"/>
            <deroute block="kill"/>
          </block>
        </blocks>
      </flight_plan>
      <airframe name="del2 with sound downlink">
        <servos>
          <servo name="GAZ" no="3" min="1000" neutral="1000" max="2000"/>
          <servo name="AILERON" no="1" min="1200" neutral="1600" max="2000"/>
          <servo name="ELEVATOR" no="0" min="1200" neutral="1600" max="2000"/>
          <servo name="CAM_ROLL" no="2" min="900" neutral="1600" max="2100"/>
        </servos>
        <commands>
          <axis name="THROTTLE" failsafe_value="0"/>
          <axis name="ROLL" failsafe_value="0"/>
          <axis name="PITCH" failsafe_value="0"/>
          <axis name="CAM_ROLL" failsafe_value="0"/>
          <axis name="CAM_PITCH" failsafe_value="0"/>
        </commands>
        <rc_commands>
          <set command="THROTTLE" value="@THROTTLE"/>
          <set command="ROLL" value="@ROLL"/>
          <set command="PITCH" value="@PITCH"/>
          <set command="CAM_ROLL" value="@YAW"/>
        </rc_commands>
        <section name="MIXER">
          <define name="ROLL_TGAIN" value="0.005"/>
          <define name="PITCH_TGAIN" value="-0.0"/>
        </section>
        <command_laws>
          <set servo="GAZ" value="@THROTTLE"/>
          <let var="roll" value="@ROLL"/>
          <let var="rollofthr" value="@THROTTLE * ROLL_TGAIN"/>
          <let var="pitch" value="@PITCH"/>
          <let var="pitchofthr" value="@THROTTLE * PITCH_TGAIN"/>
          <set servo="ELEVATOR" value="$pitch + $pitchofthr"/>
          <set servo="AILERON" value="$roll + $rollofthr"/>
          <set servo="CAM_ROLL" value="@CAM_ROLL"/>
        </command_laws>
        <section name="adc" prefix="ADC_CHANNEL_">
          <define name="IR1" value="1"/>
          <define name="IR2" value="0"/>
          <define name="VSUPPLY" value="3"/>
          <define name="IR_NB_SAMPLES" value="16"/>
        </section>
        <section name="AUTO1" prefix="AUTO1_">
          <define name="MAX_ROLL" value="0.6"/>
          <define name="MAX_PITCH" value="0.6"/>
        </section>
        <section name="INFRARED" prefix="IR_">
          <define name="ROLL_NEUTRAL_DEFAULT" value="0.0" unit="deg"/>
          <define name="PITCH_NEUTRAL_DEFAULT" value="75.0" unit="deg"/>
          <define name="DEFAULT_CONTRAST" value="900"/>
          <define name="RAD_OF_IR_CONTRAST" value="1.0"/>
          <linear name="RollOfIrs" arity="2" coeff1="0.7" coeff2="-0.7"/>
          <linear name="PitchOfIrs" arity="2" coeff1="0.7" coeff2="0.7"/>
          <define name="RAD_OF_IR_MAX_VALUE" value="0.0045"/>
          <define name="RAD_OF_IR_MIN_VALUE" value="0.00075"/>
          <define name="ADC_ROLL_NEUTRAL" value="0"/>
          <define name="ADC_PITCH_NEUTRAL" value="0"/>
          <define name="ESTIMATED_PHI_PI_4" value="M_PI_4"/>
        </section>
        <section name="PID">
          <define name="ROLL_PGAIN" value="6000."/>
          <define name="ROLL_DGAIN" value="-8000."/>
          <define name="ROLL_IGAIN" value="3500.0"/>
          <define name="PITCH_OF_ROLL" value="0.6"/>
          <define name="PITCH_PGAIN" value="8000."/>
          <define name="MAX_ROLL" value=".52"/>
          <define name="MAX_PITCH" value="0.17"/>
          <define name="MIN_PITCH" value="-0.085"/>
          <define name="AILERON_OF_GAZ" value="0.0"/>
          <define name="CAMERA_PGAIN" value="8000."/>
        </section>
        <section name="ALT" prefix="CLIMB_">
          <define name="PITCH_PGAIN" value="-0.1"/>
          <define name="PITCH_IGAIN" value="0.0"/>
          <define name="PGAIN" value="-0.1"/>
          <define name="IGAIN" value="0.0"/>
          <define name="MAX" value="5."/>
          <define name="LEVEL_GAZ" value="0.5"/>
          <define name="PITCH_OF_VZ_PGAIN" value="0.05"/>
          <define name="GAZ_OF_CLIMB" value="0.2" unit="%/(m/s)"/>
          <define name="MAX_DIFF_GAZ" value="0.05" unit="%"/>
        </section>
        <section name="NAV">
          <define name="COURSE_PGAIN" value="-0.5"/>
          <define name="ALTITUDE_PGAIN" value="-0.065"/>
          <define name="NAV_PITCH" value="0."/>
        </section>
        <section name="BAT">
          <define name="MILLIAMP_PER_PERCENT" value="0.86"/>
          <define name="VOLTAGE_ADC_A" value="0.0164"/>
          <define name="VOLTAGE_ADC_B" value="0.088"/>
          <define name="VoltageOfAdc(adc)" value="(VOLTAGE_ADC_A * adc + VOLTAGE_ADC_B)"/>
          <define name="LOW_BATTERY" value="9.3" unit="V"/>
        </section>
        <section name="MISC">
          <define name="NOMINAL_AIRSPEED" value="16." unit="m/s"/>
          <define name="CARROT" value="5." unit="s"/>
          <define name="KILL_MODE_DISTANCE" value="(MAX_DIST_FROM_HOME*1.5)" unit="m"/>
        </section>
        <section name="SIMU">
          <define name="ROLL_RESPONSE_FACTOR" value="60."/>
          <define name="YAW_RESPONSE_FACTOR" value="0.6"/>
          <define name="WEIGHT" value="1.280"/>
        </section>
        <section name="FAILSAFE" prefix="FAILSAFE_">
          <define name="DELAY_WITHOUT_GPS" value="2" unit="s"/>
          <define name="DEFAULT_GAZ" value="0.1" unit="%"/>
          <define name="DEFAULT_ROLL" value="0.3" unit="rad"/>
          <define name="DEFAULT_PITCH" value="0.08" unit="rad"/>
          <define name="HOME_RADIUS" value="50" unit="m"/>
        </section>
        <section name="CAM" prefix="CAM_">
          <define name="THETA0" value="0" unit="deg"/>
          <define name="PHI0" value="0" unit="deg"/>
        </section>
        <makefile>include $(PAPARAZZI_SRC)/conf/autopilot/v1_2_1.makefile
include $(PAPARAZZI_SRC)/conf/autopilot/twin_mcu_avr.makefile
ap.CFLAGS +=  -DDOWNLINK -DDOWNLINK_TRANSPORT=PprzTransport
ap.srcs += pprz_transport.c downlink.c
#ap.CFLAGS += -DUART0 -DDOWNLINK_AP_DEVICE=Uart0
#ap.srcs += $(SRC_ARCH)/uart_hw.c 
ap.CFLAGS += -DMODEM  -DDOWNLINK_AP_DEVICE=Modem
ap.srcs += $(SRC_ARCH)/modem_hw.c 
ap.CFLAGS += -DRADIO_CONTROL_SETTINGS -DRADIO_CONTROL_TYPE=RC_FUTABA
ap.srcs += rc_settings.c
ap.CFLAGS += -DDATALINK=PPRZ
ap.srcs +=  traffic_info.c datalink.c
ap.CFLAGS += -DPPRZ_UART=Uart0 -DUSE_UART0 -DUART0_BAUD=B9600
ap.CFLAGS += -DUART1_BAUD=B38400
ap.CFLAGS += -DMOBILE_CAM
# Config for SITL simulation
include $(PAPARAZZI_SRC)/conf/autopilot/sitl.makefile
sim.CFLAGS += -DMOBILE_CAM
sim.EXTRA_SRCS += traffic_info.c datalink.c</makefile>
      </airframe>
      <radio name="T9cap" data_min="900" data_max="2100" sync_min="5000" sync_max="15000">
        <channel ctl="right_stick_horiz" function="ROLL" min="1939" neutral="1525" max="1114" average="0"/>
        <channel ctl="right_stick_vert" function="PITCH" min="1112" neutral="1518" max="1937" average="0"/>
        <channel ctl="left_stick_vert" function="THROTTLE" min="1940" neutral="1940" max="1115" average="0"/>
        <channel ctl="left_stick_horiz" function="YAW" min="1940" neutral="1498" max="1115" average="0"/>
        <channel ctl="switch_G" function="CALIB" min="2080" neutral="1525" max="969" average="10"/>
        <channel ctl="VRA" function="GAIN1" min="970" neutral="1520" max="2078" average="10"/>
        <channel ctl="VRC" function="GAIN2" min="970" neutral="1518" max="2077" average="10"/>
        <channel ctl="switch_C" function="MODE" min="2079" neutral="1526" max="966" average="10"/>
      </radio>
    </aircraft>
    <aircraft name="orni" ac_id="39" airframe="airframes/orni_mdm.xml" radio="radios/T9cap.xml" telemetry="telemetry/reduced.xml" settings="settings/tuning_orni.xml" flight_plan="flight_plans/maxwell.xml">
      <flight_plan alt="833" ground_alt="758" lat0="32.22610" lon0="-111.02574" max_dist_from_home="500" name="maxwell" qfu="180" security_height="20" wind_dir="60" wind_mod="3">
        <waypoints>
          <waypoint name="HOME" x="11.6840794038" y="1.88159691589"/>
          <waypoint name="1" x="47.676852903" y="0.432076195721"/>
          <waypoint name="2" x="-28.6443295429" y="-2.43171868613"/>
        </waypoints>
        <blocks>
          <block name="init">
            <exception cond="(RcEvent1())" deroute="landing"/>
            <exception cond="(RcEvent2())" deroute="2wp loiter"/>
            <while cond="(!launch)"/>
            <attitude pitch="0.3" roll="0.0" throttle="1.0" until="(estimator_z > SECURITY_ALT)" vmode="throttle"/>
            <deroute block="2wp loiter"/>
          </block>
          <block name="2wp loiter">
            <exception cond="(RcEvent1())" deroute="init"/>
            <exception cond="(RcEvent2())" deroute="circle"/>
            <while>
              <go approaching_time="1" throttle="auto" vmode="alt" wp="1"/>
              <go approaching_time="1" throttle="auto" vmode="alt" wp="2"/>
            </while>
          </block>
          <block name="circle">
            <exception cond="(RcEvent2())" deroute="2wp loiter"/>
            <exception cond="(RcEvent1())" deroute="landing"/>
            <circle radius="40" wp="HOME"/>
          </block>
          <block name="landing">
            <exception cond="(RcEvent2())" deroute="circle"/>
            <exception cond="(RcEvent1())" deroute="init"/>
            <go alt="GROUND_ALT+8" wp="1"/>
            <go alt="GROUND_ALT" throttle="0.30" vmode="throttle" wp="2"/>
          </block>
        </blocks>
      </flight_plan>
      <airframe name="CYBIRD ORNITHOPTER">
        <servos>
          <servo name="ELEVON1" no="0" min="1000" neutral="1500" max="2000"/>
          <servo name="ELEVON2" no="1" min="1000" neutral="1500" max="2000"/>
          <servo name="THR" no="3" min="1000" neutral="1000" max="2000"/>
        </servos>
        <commands>
          <axis name="THROTTLE" failsafe_value="0"/>
          <axis name="ROLL" failsafe_value="0"/>
          <axis name="PITCH" failsafe_value="0"/>
        </commands>
        <rc_commands>
          <set command="THROTTLE" value="@THROTTLE"/>
          <set command="ROLL" value="@ROLL"/>
          <set command="PITCH" value="@PITCH"/>
        </rc_commands>
        <section name="MIXER"/>
        <command_laws>
          <set servo="THR" value="@THROTTLE"/>
          <set servo="ELEVON1" value="-@PITCH+0.45*@THROTTLE-@ROLL"/>
          <set servo="ELEVON2" value="+@PITCH-0.45*@THROTTLE-@ROLL"/>
        </command_laws>
        <section name="adc" prefix="ADC_CHANNEL_">
          <define name="IR1" value="ADC_3"/>
          <define name="IR2" value="ADC_4"/>
          <define name="IR_NB_SAMPLES" value="16"/>
        </section>
        <section name="AUTO1" prefix="AUTO1_">
          <define name="MAX_ROLL" value="RadOfDeg(45)"/>
          <define name="MAX_PITCH" value="RadOfDeg(15)"/>
        </section>
        <section name="INFRARED" prefix="IR_">
          <define name="ROLL_NEUTRAL_DEFAULT" value="DegOfRad(0.)" unit="deg"/>
          <define name="PITCH_NEUTRAL_DEFAULT" value="DegOfRad(0.)" unit="deg"/>
          <define name="DEFAULT_CONTRAST" value="900"/>
          <define name="RAD_OF_IR_CONTRAST" value="1.9"/>
          <linear name="RollOfIrs" arity="2" coeff1="0.7" coeff2="-0.7"/>
          <linear name="PitchOfIrs" arity="2" coeff1="-0.7" coeff2="-0.7"/>
          <define name="RAD_OF_IR_MAX_VALUE" value="0.0045"/>
          <define name="RAD_OF_IR_MIN_VALUE" value="0.00075"/>
          <define name="ADC_ROLL_NEUTRAL" value="0"/>
          <define name="ADC_PITCH_NEUTRAL" value="0"/>
          <define name="ESTIMATED_PHI_PI_4" value="M_PI_4*0.6"/>
          <define name="CORRECTION_UP" value="1."/>
          <define name="CORRECTION_DOWN" value="1."/>
          <define name="CORRECTION_LEFT" value="1."/>
          <define name="CORRECTION_RIGHT" value="1."/>
        </section>
        <section name="GYRO" prefix="GYRO_">
          <define name="ADC_ROLL_NEUTRAL" value="426"/>
          <define name="ADC_PITCH_NEUTRAL" value="535"/>
          <define name="ROLL_SCALE" value="0.5"/>
          <define name="ROLL_DIRECTION" value="-1"/>
          <define name="PITCH_SCALE" value="0.5"/>
          <define name="PITCH_DIRECTION" value="1."/>
        </section>
        <section name="ACCEL" prefix="ACCEL_">
          <define name="AX_NEUTRAL" value="528"/>
          <define name="AY_NEUTRAL" value="516"/>
          <define name="AZ_NEUTRAL" value="509"/>
          <define name="AX_SCALE" value="0.01"/>
          <define name="AY_SCALE" value="0.01"/>
          <define name="AZ_SCALE" value="0.01"/>
        </section>
        <section name="KALMAN" prefix="KALMAN_">
          <define name="Q_ANGLE" value="1e-1f"/>
          <define name="Q_GYRO" value="5e-1f"/>
          <define name="R_ANGLE" value="1e-3f"/>
        </section>
        <section name="BAT">
          <define name="MILLIAMP_PER_PERCENT" value="0.86"/>
          <define name="ADC_CHANNEL_VSUPPLY" value="AdcBank1(6)"/>
          <define name="VoltageOfAdc(adc)" value="(0.01787109375*adc)"/>
          <define name="LOW_BATTERY" value="9.3" unit="V"/>
        </section>
        <section name="VERTICAL CONTROL" prefix="V_CTL_">
          <define name="ALTITUDE_PGAIN" value="0.5"/>
          <define name="ALTITUDE_MAX_CLIMB" value="2."/>
          <define name="AUTO_THROTTLE_MIN_CRUISE_THROTTLE" value="0.35"/>
          <define name="AUTO_THROTTLE_MAX_CRUISE_THROTTLE" value="0.45"/>
          <define name="AUTO_THROTTLE_PGAIN" value="0.042"/>
          <define name="AUTO_THROTTLE_IGAIN" value="0.0"/>
          <define name="AUTO_THROTTLE_PITCH_OF_VZ_PGAIN" value="0.05"/>
          <define name="AUTO_THROTTLE_DASH_TRIM" value="1000"/>
          <define name="AUTO_THROTTLE_LOITER_TRIM" value="1500"/>
          <define name="AUTO_THROTTLE_CRUISE_THROTTLE" value="0.25"/>
          <define name="AUTO_THROTTLE_NOMINAL_CRUISE_THROTTLE" value="0.641"/>
          <define name="AUTO_THROTTLE_CLIMB_THROTTLE_INCREMENT" value="0.127" unit="%/(m/s)"/>
          <define name="AUTO_PITCH_PGAIN" value="0.1"/>
          <define name="AUTO_PITCH_IGAIN" value="0.0"/>
          <define name="AUTO_PITCH_MAX_PITCH" value="0.35"/>
          <define name="AUTO_PITCH_MIN_PITCH" value="-0.35"/>
          <define name="THROTTLE_SLEW" value="0.01"/>
        </section>
        <section name="HORIZONTAL CONTROL" prefix="H_CTL_">
          <define name="COURSE_PGAIN" value="0.5"/>
          <define name="ROLL_MAX_SETPOINT" value="RadOfDeg(45)" unit="radians"/>
          <define name="PITCH_MAX_SETPOINT" value="RadOfDeg(30)" unit="radians"/>
          <define name="PITCH_MIN_SETPOINT" value="RadOfDeg(-20)" unit="radians"/>
          <define name="YAW_MAX_SETPOINT" value="RadOfDeg(30)" unit="radians"/>
          <define name="ROLL_PGAIN" value="-12000."/>
          <define name="AILERON_OF_THROTTLE" value="0.0"/>
          <define name="PITCH_PGAIN" value="9302"/>
          <define name="PITCH_DGAIN" value="0.0"/>
          <define name="ELEVATOR_OF_ROLL" value="1540"/>
          <define name="ROLL_RATE_MODE_DEFAULT" value="1"/>
          <define name="ROLL_RATE_SETPOINT_PGAIN" value="6." unit="1/s"/>
          <define name="ROLL_RATE_MAX_SETPOINT" value="10"/>
          <define name="LO_THROTTLE_ROLL_RATE_PGAIN" value="3123"/>
          <define name="HI_THROTTLE_ROLL_RATE_PGAIN" value="3023"/>
          <define name="LO_THROTTLE_PITCH_RATE_PGAIN" value="13000."/>
          <define name="HI_THROTTLE_PITCH_RATE_PGAIN" value="13000."/>
          <define name="ROLL_RATE_IGAIN" value="0."/>
          <define name="ROLL_RATE_DGAIN" value="0."/>
          <define name="ROLL_RATE_SUM_NB_SAMPLES" value="64"/>
        </section>
        <section name="THR">
          <define name="DASH_THR" value="0.6"/>
          <define name="LOITER_THR" value="0.52"/>
        </section>
        <section name="NAV">
          <define name="NAV_PITCH" value="0."/>
          <define name="NAV_GLIDE_PITCH_TRIM" value="0"/>
        </section>
        <section name="AGGRESSIVE" prefix="AGR_">
          <define name="BLEND_START" value="20"/>
          <define name="BLEND_END" value="10"/>
          <define name="CLIMB_THROTTLE" value="0.8"/>
          <define name="CLIMB_PITCH" value="0.2"/>
          <define name="DESCENT_THROTTLE" value="0.5"/>
          <define name="DESCENT_PITCH" value="0.0"/>
          <define name="CLIMB_NAV_RATIO" value="0.8"/>
          <define name="DESCENT_NAV_RATIO" value="1.0"/>
        </section>
        <section name="FAILSAFE" prefix="FAILSAFE_">
          <define name="DELAY_WITHOUT_GPS" value="5" unit="s"/>
          <define name="DEFAULT_THROTTLE" value="0.2" unit="%"/>
          <define name="DEFAULT_ROLL" value="0.3" unit="rad"/>
          <define name="DEFAULT_PITCH" value="0.1" unit="rad"/>
          <define name="HOME_RADIUS" value="50" unit="m"/>
        </section>
        <section name="SIMU">
          <define name="ROLL_RESPONSE_FACTOR" value="2."/>
          <define name="YAW_RESPONSE_FACTOR" value="1.35"/>
          <define name="WEIGHT" value="1.3"/>
        </section>
        <section name="MISC">
          <define name="NOMINAL_AIRSPEED" value="10." unit="m/s"/>
          <define name="CARROT" value="5." unit="s"/>
          <define name="KILL_MODE_DISTANCE" value="(MAX_DIST_FROM_HOME*1.5)" unit="m"/>
          <define name="API_INIT" value=""/>
          <define name="NO_API_INIT" value="TRUE"/>
        </section>
        <section name="DATALINK" prefix="DATALINK_">
          <define name="DEVICE_TYPE" value="AEROCOMM__"/>
          <define name="DEVICE_ADDRESS" value="...."/>
        </section>
        <makefile>include $(PAPARAZZI_SRC)/conf/autopilot/tiny.makefile
FLASH_MODE=ISP
ap.CFLAGS +=  -DFBW -DAP -DCONFIG=\&quot;tiny_0_99.h\&quot; -DLED -DTIME_LED=1
ap.srcs = sys_time.c $(SRC_ARCH)/sys_time_hw.c $(SRC_ARCH)/armVIC.c main_fbw.c main_ap.c main.c
ap.srcs += commands.c
ap.CFLAGS += -DACTUATORS=\&quot;servos_4015_MAT_hw.h\&quot; -DSERVOS_4015_MAT
ap.srcs += $(SRC_ARCH)/servos_4015_MAT_hw.c actuators.c
ap.CFLAGS += -DRADIO_CONTROL -DRADIO_CONTROL_TYPE=RC_FUTABA
ap.srcs += radio_control.c $(SRC_ARCH)/ppm_hw.c  
#ap.CFLAGS += -DDOWNLINK -DDOWNLINK_TRANSPORT=PprzTransport 
#ap.srcs += downlink.c $(SRC_ARCH)/uart_hw.c datalink.c pprz_transport.c
#ap.CFLAGS += -DDOWNLINK_FBW_DEVICE=Modem 
#ap.CFLAGS += -DDOWNLINK_AP_DEVICE=Modem 
#ap.CFLAGS += -DMODEM
#ap.srcs += $(SRC_ARCH)/modem_hw.c 
#--SERIAL MODE--------
#ap.CFLAGS += -DDOWNLINK -DUSE_UART0 -DDOWNLINK_TRANSPORT=PprzTransport 
#ap.CFLAGS += -DDOWNLINK_FBW_DEVICE=Uart0 -DDOWNLINK_AP_DEVICE=Uart0 
#ap.CFLAGS += -DPPRZ_UART=Uart0 -DUART0_BAUD=B9600
#ap.srcs += downlink.c $(SRC_ARCH)/uart_hw.c pprz_transport.c
#--AEROCOMM-----------
ap.CFLAGS += -DDOWNLINK -DUSE_UART0 -DDOWNLINK_TRANSPORT=AerocommTransport 
ap.CFLAGS += -DDOWNLINK_FBW_DEVICE=Uart0 -DDOWNLINK_AP_DEVICE=Uart0 
ap.CFLAGS += -DAEROCOMM_UART=Uart0 -DDATALINK=AEROCOMM -DUART0_BAUD=B38400
ap.srcs += downlink.c $(SRC_ARCH)/uart_hw.c datalink.c aerocomm_new.c
ap.srcs += traffic_info.c
ap.CFLAGS += -DINTER_MCU
ap.srcs += inter_mcu.c 
ap.CFLAGS += -DADC -DUSE_ADC_0 -DUSE_ADC_1 -DUSE_ADC_2 -DUSE_ADC_3 -DUSE_ADC_4
ap.srcs += $(SRC_ARCH)/adc_hw.c
ap.CFLAGS += -DGPS -DGPS_CONFIGURE -DUBX -DUSE_UART1 -DGPS_LINK=Uart1 -DUART1_BAUD=B38400
ap.srcs += gps_ubx.c gps.c
ap.CFLAGS += -DINFRARED 
ap.srcs += infrared.c 
#ap.CFLAGS += -DALT_KALMAN 
#ap.CFLAGS += -DIR_360
ap.srcs += estimator.c
ap.CFLAGS += -DNAV -DAGR_CLIMB 
#ap.CFLAGS += -DLOITER_TRIM
ap.srcs += nav.c fw_h_ctl.c fw_v_ctl.c
#ap.CFLAGS += -DGYRO -DADXRS150 
#ap.CFLAGS += -DH_CTL_RATE_LOOP
#ap.srcs += gyro.c nav_line.c chemotaxis.c anemotaxis.c discsurvey.c
#ap.CFLAGS += -DGYRO -DIDG300 
#ap.srcs += gyro.c
#ap.CFLAGS += -DACCEL -DADXL330 
#ap.srcs += accel.c
#ap.CFLAGS += -DKALMAN_ROLL_PITCH 
#ap.srcs += kalman_roll_pitch.c
#ap.srcs += bomb.c
# Hack to use the same tuning file than slayer1
ap.CFLAGS += -DUSE_GPIO
ap.srcs += $(SRC_ARCH)/gpio.c
# Harware In The Loop
#ap.CFLAGS += -DHITL
# Config for SITL simulation
include $(PAPARAZZI_SRC)/conf/autopilot/sitl.makefile
sim.CFLAGS += -DCONFIG=\&quot;tiny.h\&quot; -DAGR_CLIMB -DH_CTL_RATE_LOOP
#sim.srcs += bomb.c
# a test program to setup actuators 
setup_actuators.ARCHDIR = $(ARCHI)
setup_actuators.ARCH = arm7tdmi
setup_actuators.TARGET = setup_actuators
setup_actuators.TARGETDIR = setup_actuators
setup_actuators.CFLAGS += -DFBW -DCONFIG=\&quot;tiny.h\&quot; -DLED -DTIME_LED=1 -DACTUATORS=\&quot;servos_4015_hw.h\&quot; -DSERVOS_4015 -DUSE_UART0 -DUART0_BAUD=B9600 -DDATALINK=PPRZ -DPPRZ_UART=Uart0
setup_actuators.srcs += sys_time.c $(SRC_ARCH)/sys_time_hw.c $(SRC_ARCH)/armVIC.c pprz_transport.c setup_actuators.c $(SRC_ARCH)/uart_hw.c $(SRC_ARCH)/servos_4015_hw.c main.c
# a test program to tunnel between both uart
tunnel.ARCHDIR = $(ARCHI)
tunnel.ARCH = arm7tdmi
tunnel.TARGET = tunnel
tunnel.TARGETDIR = tunnel
tunnel.CFLAGS += -DFBW -DCONFIG=\&quot;tiny_0_99.h\&quot; -DLED -DTIME_LED=1
tunnel.srcs += $(SRC_ARCH)/uart_tunnel.c</makefile>
      </airframe>
      <radio name="T9cap" data_min="900" data_max="2100" sync_min="5000" sync_max="15000">
        <channel ctl="right_stick_horiz" function="ROLL" min="1939" neutral="1525" max="1114" average="0"/>
        <channel ctl="right_stick_vert" function="PITCH" min="1112" neutral="1518" max="1937" average="0"/>
        <channel ctl="left_stick_vert" function="THROTTLE" min="1940" neutral="1940" max="1115" average="0"/>
        <channel ctl="left_stick_horiz" function="YAW" min="1940" neutral="1498" max="1115" average="0"/>
        <channel ctl="switch_G" function="CALIB" min="2080" neutral="1525" max="969" average="10"/>
        <channel ctl="VRA" function="GAIN1" min="970" neutral="1520" max="2078" average="10"/>
        <channel ctl="VRC" function="GAIN2" min="970" neutral="1518" max="2077" average="10"/>
        <channel ctl="switch_C" function="MODE" min="2079" neutral="1526" max="966" average="10"/>
      </radio>
    </aircraft>
    <aircraft name="ornismall" ac_id="41" airframe="airframes/orni_small_mdm.xml" radio="radios/T9cap.xml" telemetry="telemetry/debug.xml" settings="settings/tuning.xml" flight_plan="flight_plans/ame.xml">
      <flight_plan NAME="ame" WIND_MOD="3" WIND_DIR="60" LON0="-110.951954" MAX_DIST_FROM_HOME="1500" GROUND_ALT="750" SECURITY_HEIGHT="60" QFU="180" ALT="850" LAT0="32.236525">
        <waypoints>
          <waypoint name="HOME" x="-94.522471131" y="17.319972877" alt="850."/>
        </waypoints>
        <blocks>
          <block name="init">
            <while COND="(!launch)"/>
            <attitude roll="0.0" until="(estimator_z > SECURITY_ALT)" vmode="throttle" throttle="1.0" pitch="0.3"/>
          </block>
        </blocks>
      </flight_plan>
      <airframe name="Dragonfly III">
        <servos>
          <servo name="ELEVON1" no="4" min="1000" neutral="1500" max="2000"/>
          <servo name="ELEVON2" no="3" min="1000" neutral="1500" max="2000"/>
          <servo name="THR" no="1" min="1000" neutral="1000" max="2000"/>
        </servos>
        <commands>
          <axis name="THROTTLE" failsafe_value="0"/>
          <axis name="ROLL" failsafe_value="0"/>
          <axis name="PITCH" failsafe_value="0"/>
        </commands>
        <rc_commands>
          <set command="THROTTLE" value="@THROTTLE"/>
          <set command="ROLL" value="@ROLL"/>
          <set command="PITCH" value="@PITCH"/>
        </rc_commands>
        <section name="MIXER"/>
        <command_laws>
          <set servo="THR" value="@THROTTLE"/>
          <set servo="ELEVON1" value="-@PITCH+@ROLL"/>
          <set servo="ELEVON2" value="+@PITCH+@ROLL"/>
        </command_laws>
        <section name="adc" prefix="ADC_CHANNEL_">
          <define name="IR1" value="ADC_1"/>
          <define name="IR2" value="ADC_0"/>
          <define name="IR_NB_SAMPLES" value="16"/>
          <define name="GYRO_ROLL" value="ADC_2"/>
          <define name="GYRO_PITCH" value="ADC_3"/>
          <define name="GYRO_NB_SAMPLES" value="16"/>
          <define name="ACCEL_AX" value="ADC_6"/>
          <define name="ACCEL_AY" value="ADC_5"/>
          <define name="ACCEL_AZ" value="ADC_4"/>
          <define name="ACCEL_NB_SAMPLES" value="16"/>
        </section>
        <section name="AUTO1" prefix="AUTO1_">
          <define name="MAX_ROLL" value="RadOfDeg(25)"/>
          <define name="MAX_PITCH" value="RadOfDeg(25)"/>
        </section>
        <section name="INFRARED" prefix="IR_">
          <define name="ROLL_NEUTRAL_DEFAULT" value="6.3" unit="deg"/>
          <define name="PITCH_NEUTRAL_DEFAULT" value="-61" unit="deg"/>
          <define name="DEFAULT_CONTRAST" value="900"/>
          <define name="RAD_OF_IR_CONTRAST" value="1.7"/>
          <linear name="RollOfIrs" arity="2" coeff1="0.7" coeff2="-0.7"/>
          <linear name="PitchOfIrs" arity="2" coeff1="-0.7" coeff2="-0.7"/>
          <define name="RAD_OF_IR_MAX_VALUE" value="0.0045"/>
          <define name="RAD_OF_IR_MIN_VALUE" value="0.00075"/>
          <define name="ADC_ROLL_NEUTRAL" value="0"/>
          <define name="ADC_PITCH_NEUTRAL" value="0"/>
          <define name="ESTIMATED_PHI_PI_4" value="M_PI_4"/>
          <define name="CORRECTION_UP" value="1."/>
          <define name="CORRECTION_DOWN" value="1."/>
          <define name="CORRECTION_LEFT" value="1."/>
          <define name="CORRECTION_RIGHT" value="1."/>
        </section>
        <section name="GYRO" prefix="GYRO_">
          <define name="ADC_ROLL_NEUTRAL" value="344"/>
          <define name="ADC_PITCH_NEUTRAL" value="287"/>
          <define name="ROLL_SCALE" value="3.07"/>
          <define name="ROLL_DIRECTION" value="-1"/>
          <define name="PITCH_SCALE" value="2.52"/>
          <define name="PITCH_DIRECTION" value="1."/>
        </section>
        <section name="ACCEL" prefix="ACCEL_">
          <define name="AX_NEUTRAL" value="327"/>
          <define name="AY_NEUTRAL" value="667"/>
          <define name="AZ_NEUTRAL" value="658"/>
          <define name="AX_SCALE" value="0.03"/>
          <define name="AY_SCALE" value="0.03"/>
          <define name="AZ_SCALE" value="0.03"/>
        </section>
        <section name="BAT">
          <define name="MILLIAMP_PER_PERCENT" value="0.86"/>
          <define name="ADC_CHANNEL_VSUPPLY" value="AdcBank1(6)"/>
          <define name="VoltageOfAdc(adc)" value="(0.01787109375*adc)"/>
          <define name="LOW_BATTERY" value="6.2" unit="V"/>
        </section>
        <section name="VERTICAL CONTROL" prefix="V_CTL_">
          <define name="ALTITUDE_PGAIN" value="-0.065"/>
          <define name="ALTITUDE_MAX_CLIMB" value="2."/>
          <define name="AUTO_THROTTLE_MIN_CRUISE_THROTTLE" value="0.10"/>
          <define name="AUTO_THROTTLE_MAX_CRUISE_THROTTLE" value="0.50"/>
          <define name="AUTO_THROTTLE_PGAIN" value="-0.01"/>
          <define name="AUTO_THROTTLE_IGAIN" value="0.1"/>
          <define name="AUTO_THROTTLE_PITCH_OF_VZ_PGAIN" value="0.05"/>
          <define name="AUTO_THROTTLE_DASH_TRIM" value="-1000"/>
          <define name="AUTO_THROTTLE_LOITER_TRIM" value="1500"/>
          <define name="AUTO_THROTTLE_CRUISE_THROTTLE" value="0.50"/>
          <define name="AUTO_THROTTLE_NOMINAL_CRUISE_THROTTLE" value="0.35"/>
          <define name="AUTO_THROTTLE_CLIMB_THROTTLE_INCREMENT" value="0.15" unit="%/(m/s)"/>
          <define name="AUTO_PITCH_PGAIN" value="-0.1"/>
          <define name="AUTO_PITCH_IGAIN" value="0.0"/>
          <define name="AUTO_PITCH_MAX_PITCH" value="0.35"/>
          <define name="AUTO_PITCH_MIN_PITCH" value="-0.35"/>
          <define name="THROTTLE_SLEW" value="0.05"/>
        </section>
        <section name="HORIZONTAL CONTROL" prefix="H_CTL_">
          <define name="COURSE_PGAIN" value="0.5"/>
          <define name="ROLL_MAX_SETPOINT" value="0.6" unit="radians"/>
          <define name="PITCH_MAX_SETPOINT" value="0.5" unit="radians"/>
          <define name="PITCH_MIN_SETPOINT" value="-0.5" unit="radians"/>
          <define name="ROLL_PGAIN" value="-12000."/>
          <define name="AILERON_OF_THROTTLE" value="0.0"/>
          <define name="PITCH_PGAIN" value="-8000."/>
          <define name="PITCH_DGAIN" value="0.0"/>
          <define name="ELEVATOR_OF_ROLL" value="1250"/>
          <define name="ROLL_RATE_MODE_DEFAULT" value="1"/>
          <define name="ROLL_RATE_SETPOINT_PGAIN" value="-5." unit="1/s"/>
          <define name="ROLL_RATE_MAX_SETPOINT" value="10"/>
          <define name="LO_THROTTLE_ROLL_RATE_PGAIN" value="-12000."/>
          <define name="HI_THROTTLE_ROLL_RATE_PGAIN" value="-3000."/>
          <define name="ROLL_RATE_IGAIN" value="0."/>
          <define name="ROLL_RATE_DGAIN" value="0."/>
          <define name="ROLL_RATE_SUM_NB_SAMPLES" value="64"/>
        </section>
        <section name="THR">
          <define name="DASH_THR" value="0.4"/>
          <define name="LOITER_THR" value="0.15"/>
        </section>
        <section name="NAV">
          <define name="NAV_PITCH" value="0."/>
          <define name="NAV_GLIDE_PITCH_TRIM" value="0"/>
        </section>
        <section name="AGGRESSIVE" prefix="AGR_">
          <define name="BLEND_START" value="20"/>
          <define name="BLEND_END" value="10"/>
          <define name="CLIMB_THROTTLE" value="0.45"/>
          <define name="CLIMB_PITCH" value="-0.1"/>
          <define name="DESCENT_THROTTLE" value="0.06"/>
          <define name="DESCENT_PITCH" value="0.1"/>
          <define name="CLIMB_NAV_RATIO" value="0.8"/>
          <define name="DESCENT_NAV_RATIO" value="1.0"/>
        </section>
        <section name="FAILSAFE" prefix="FAILSAFE_">
          <define name="DELAY_WITHOUT_GPS" value="1" unit="s"/>
          <define name="DEFAULT_THROTTLE" value="0.0" unit="%"/>
          <define name="DEFAULT_ROLL" value="0.6" unit="rad"/>
          <define name="DEFAULT_PITCH" value="0.5" unit="rad"/>
          <define name="HOME_RADIUS" value="100" unit="m"/>
        </section>
        <section name="SIMU">
          <define name="ROLL_RESPONSE_FACTOR" value="2."/>
          <define name="YAW_RESPONSE_FACTOR" value="1.35"/>
          <define name="WEIGHT" value="1.3"/>
        </section>
        <section name="MISC">
          <define name="NOMINAL_AIRSPEED" value="10." unit="m/s"/>
          <define name="CARROT" value="5." unit="s"/>
          <define name="KILL_MODE_DISTANCE" value="(MAX_DIST_FROM_HOME*1.5)" unit="m"/>
          <define name="XBEE_INIT" value="\"ATPL4\\rATRN1\\rATTT80\\rATBD3\\rATWR\\r\""/>
        </section>
        <section name="DATALINK" prefix="DATALINK_">
          <define name="DEVICE_TYPE" value="XBEE"/>
          <define name="DEVICE_ADDRESS" value="...."/>
        </section>
        <makefile>include $(PAPARAZZI_SRC)/conf/autopilot/tiny.makefile
FLASH_MODE=IAP
ap.CFLAGS +=  -DFBW -DAP -DCONFIG=\&quot;tiny_0_99.h\&quot; -DLED -DTIME_LED=1
ap.srcs = sys_time.c $(SRC_ARCH)/sys_time_hw.c $(SRC_ARCH)/armVIC.c main_fbw.c main_ap.c main.c
ap.srcs += commands.c
ap.CFLAGS += -DACTUATORS=\&quot;servos_4015_MAT_hw.h\&quot; -DSERVOS_4015_MAT
ap.srcs += $(SRC_ARCH)/servos_4015_MAT_hw.c actuators.c
ap.CFLAGS += -DRADIO_CONTROL -DRADIO_CONTROL_TYPE=RC_FUTABA
ap.srcs += radio_control.c $(SRC_ARCH)/ppm_hw.c  
#ap.CFLAGS += -DDOWNLINK -DDOWNLINK_TRANSPORT=PprzTransport 
#ap.srcs += downlink.c $(SRC_ARCH)/uart_hw.c datalink.c pprz_transport.c
#ap.CFLAGS += -DDOWNLINK_FBW_DEVICE=Modem 
#ap.CFLAGS += -DDOWNLINK_AP_DEVICE=Modem 
#ap.CFLAGS += -DMODEM
#ap.srcs += $(SRC_ARCH)/modem_hw.c 
#--SERIAL MODE--------
#ap.CFLAGS += -DDOWNLINK -DUSE_UART0 -DDOWNLINK_TRANSPORT=PprzTransport 
#ap.CFLAGS += -DDOWNLINK_FBW_DEVICE=Uart0 -DDOWNLINK_AP_DEVICE=Uart0 
#ap.CFLAGS += -DPPRZ_UART=Uart0 -DUART0_BAUD=B9600
#ap.srcs += downlink.c $(SRC_ARCH)/uart_hw.c pprz_transport.c
#--API MODE-----------
ap.CFLAGS += -DDOWNLINK -DUSE_UART0 -DDOWNLINK_TRANSPORT=XBeeTransport 
ap.CFLAGS += -DDOWNLINK_FBW_DEVICE=Uart0 -DDOWNLINK_AP_DEVICE=Uart0 
ap.CFLAGS += -DXBEE_UART=Uart0 -DDATALINK=XBEE -DUART0_BAUD=B9600
ap.srcs += downlink.c $(SRC_ARCH)/uart_hw.c datalink.c xbee.c
ap.srcs += traffic_info.c
ap.CFLAGS += -DINTER_MCU
ap.srcs += inter_mcu.c 
ap.CFLAGS += -DADC -DUSE_ADC_0 -DUSE_ADC_1 -DUSE_ADC_4 -DUSE_ADC_5 -DUSE_ADC_6
ap.srcs += $(SRC_ARCH)/adc_hw.c
ap.CFLAGS += -DGPS -DUBX -DUSE_UART1 -DGPS_LINK=Uart1 -DUART1_BAUD=B19200
ap.srcs += gps_ubx.c gps.c
ap.CFLAGS += -DINFRARED -DALT_KALMAN 
#ap.CFLAGS += -DIR_360
ap.srcs += infrared.c estimator.c
ap.CFLAGS += -DNAV -DH_CTL_RATE_LOOP -DAGR_CLIMB -DLOITER_TRIM
ap.srcs += nav.c fw_h_ctl.c fw_v_ctl.c
#ap.CFLAGS += -DGYRO -DADXRS150
#ap.srcs += gyro.c nav_line.c chemotaxis.c anemotaxis.c discsurvey.c
ap.CFLAGS += -DGYRO -DIDG300 
ap.srcs += gyro.c
ap.CFLAGS += -DACCEL -DADXL330 
ap.srcs += accel.c
#ap.srcs += bomb.c
# Hack to use the same tuning file than slayer1
ap.CFLAGS += -DUSE_GPIO
ap.srcs += $(SRC_ARCH)/gpio.c
# Harware In The Loop
#ap.CFLAGS += -DHITL
# Config for SITL simulation
include $(PAPARAZZI_SRC)/conf/autopilot/sitl.makefile
sim.CFLAGS += -DCONFIG=\&quot;tiny.h\&quot; -DAGR_CLIMB -DH_CTL_RATE_LOOP
#sim.srcs += bomb.c
# a test program to setup actuators 
setup_actuators.ARCHDIR = $(ARCHI)
setup_actuators.ARCH = arm7tdmi
setup_actuators.TARGET = setup_actuators
setup_actuators.TARGETDIR = setup_actuators
setup_actuators.CFLAGS += -DFBW -DCONFIG=\&quot;tiny.h\&quot; -DLED -DTIME_LED=1 -DACTUATORS=\&quot;servos_4015_hw.h\&quot; -DSERVOS_4015 -DUSE_UART0 -DUART0_BAUD=B9600 -DDATALINK=PPRZ -DPPRZ_UART=Uart0
setup_actuators.srcs += sys_time.c $(SRC_ARCH)/sys_time_hw.c $(SRC_ARCH)/armVIC.c pprz_transport.c setup_actuators.c $(SRC_ARCH)/uart_hw.c $(SRC_ARCH)/servos_4015_hw.c main.c
# a test program to tunnel between both uart
tunnel.ARCHDIR = $(ARCHI)
tunnel.ARCH = arm7tdmi
tunnel.TARGET = tunnel
tunnel.TARGETDIR = tunnel
tunnel.CFLAGS += -DFBW -DCONFIG=\&quot;tiny.h\&quot; -DLED -DTIME_LED=1
tunnel.srcs += $(SRC_ARCH)/uart_tunnel.c</makefile>
      </airframe>
      <radio name="T9cap" data_min="900" data_max="2100" sync_min="5000" sync_max="15000">
        <channel ctl="right_stick_horiz" function="ROLL" min="1939" neutral="1525" max="1114" average="0"/>
        <channel ctl="right_stick_vert" function="PITCH" min="1112" neutral="1518" max="1937" average="0"/>
        <channel ctl="left_stick_vert" function="THROTTLE" min="1940" neutral="1940" max="1115" average="0"/>
        <channel ctl="left_stick_horiz" function="YAW" min="1940" neutral="1498" max="1115" average="0"/>
        <channel ctl="switch_G" function="CALIB" min="2080" neutral="1525" max="969" average="10"/>
        <channel ctl="VRA" function="GAIN1" min="970" neutral="1520" max="2078" average="10"/>
        <channel ctl="VRC" function="GAIN2" min="970" neutral="1518" max="2077" average="10"/>
        <channel ctl="switch_C" function="MODE" min="2079" neutral="1526" max="966" average="10"/>
      </radio>
    </aircraft>
    <aircraft name="d3" ac_id="38" airframe="airframes/d3.xml" radio="radios/T9cap.xml" telemetry="telemetry/debug.xml" settings="settings/tuning_rc.xml" flight_plan="flight_plans/ame.xml">
      <flight_plan NAME="ame" WIND_MOD="3" WIND_DIR="60" LON0="-110.951954" MAX_DIST_FROM_HOME="1500" GROUND_ALT="750" SECURITY_HEIGHT="60" QFU="180" ALT="850" LAT0="32.236525">
        <waypoints>
          <waypoint name="HOME" x="-94.522471131" y="17.319972877" alt="850."/>
        </waypoints>
        <blocks>
          <block name="init">
            <while COND="(!launch)"/>
            <attitude roll="0.0" until="(estimator_z > SECURITY_ALT)" vmode="throttle" throttle="1.0" pitch="0.3"/>
          </block>
        </blocks>
      </flight_plan>
      <airframe name="Dragonfly III">
        <servos>
          <servo name="ELEVATOR" no="0" min="1000" neutral="1500" max="2000"/>
          <servo name="AILERON" no="1" min="1000" neutral="1500" max="2000"/>
          <servo name="GAZ" no="3" min="1100" neutral="1200" max="2000"/>
          <servo name="CAM_ROLL" no="5" min="1200" neutral="1550" max="1900"/>
        </servos>
        <commands>
          <axis name="THROTTLE" failsafe_value="0"/>
          <axis name="ROLL" failsafe_value="0"/>
          <axis name="PITCH" failsafe_value="0"/>
          <axis name="CAM_ROLL" failsafe_value="0"/>
          <axis name="CAM_PITCH" failsafe_value="0"/>
          <axis name="PAYPLOAD" failsafe_value="0"/>
        </commands>
        <rc_commands>
          <set command="THROTTLE" value="@THROTTLE"/>
          <set command="ROLL" value="@ROLL"/>
          <set command="PITCH" value="@PITCH"/>
        </rc_commands>
        <section name="MIXER">
          <define name="AILEVON_AILERON_RATE" value="0.8"/>
          <define name="AILEVON_ELEVATOR_RATE" value="0.8"/>
          <define name="ROLL_TGAIN" value="0.005"/>
          <define name="PITCH_TGAIN" value="-0.0"/>
        </section>
        <command_laws>
          <set servo="GAZ" value="@THROTTLE"/>
          <let var="roll" value="@ROLL"/>
          <let var="rollofthr" value="@THROTTLE * ROLL_TGAIN"/>
          <let var="pitch" value="@PITCH"/>
          <let var="pitchofthr" value="@THROTTLE * PITCH_TGAIN"/>
          <set servo="ELEVATOR" value="$pitch + $pitchofthr"/>
          <set servo="AILERON" value="$roll + $rollofthr"/>
          <set servo="CAM_ROLL" value="@CAM_ROLL"/>
        </command_laws>
        <section name="AUTO1" prefix="AUTO1_">
          <define name="MAX_ROLL" value="0.96"/>
          <define name="MAX_PITCH" value="0.8"/>
        </section>
        <section name="adc" prefix="ADC_CHANNEL_">
          <define name="IR1" value="ADC_1"/>
          <define name="IR2" value="ADC_0"/>
          <define name="IR_NB_SAMPLES" value="16"/>
        </section>
        <section name="INFRARED" prefix="IR_">
          <define name="ROLL_NEUTRAL_DEFAULT" value="0" unit="deg"/>
          <define name="PITCH_NEUTRAL_DEFAULT" value="75.0" unit="deg"/>
          <define name="DEFAULT_CONTRAST" value="900"/>
          <define name="RAD_OF_IR_CONTRAST" value="1.0"/>
          <linear name="RollOfIrs" arity="2" coeff1="0.7" coeff2="-0.7"/>
          <linear name="PitchOfIrs" arity="2" coeff1="0.7" coeff2="0.7"/>
          <define name="RAD_OF_IR_MAX_VALUE" value="0.0045"/>
          <define name="RAD_OF_IR_MIN_VALUE" value="0.00075"/>
          <define name="ADC_ROLL_NEUTRAL" value="0"/>
          <define name="ADC_PITCH_NEUTRAL" value="0"/>
          <define name="ESTIMATED_PHI_PI_4" value="M_PI_4"/>
        </section>
        <section name="BAT">
          <define name="MILLIAMP_PER_PERCENT" value="0.86"/>
          <define name="ADC_CHANNEL_VSUPPLY" value="AdcBank1(6)"/>
          <define name="VoltageOfAdc(adc)" value="(0.01787109375*adc)"/>
          <define name="LOW_BATTERY" value="9.3" unit="V"/>
        </section>
        <section name="VERTICAL CONTROL" prefix="V_CTL_">
          <define name="ALTITUDE_PGAIN" value="-0.065"/>
          <define name="ALTITUDE_MAX_CLIMB" value="2."/>
          <define name="AUTO_THROTTLE_PGAIN" value="-0.01"/>
          <define name="AUTO_THROTTLE_IGAIN" value="0.1"/>
          <define name="AUTO_THROTTLE_PITCH_OF_VZ_PGAIN" value="0.05"/>
          <define name="AUTO_THROTTLE_DASH_TRIM" value="-1000"/>
          <define name="AUTO_THROTTLE_LOITER_TRIM" value="1500"/>
          <define name="AUTO_THROTTLE_CRUISE_THROTTLE" value="0.50"/>
          <define name="AUTO_THROTTLE_NOMINAL_CRUISE_THROTTLE" value="0.35"/>
          <define name="AUTO_THROTTLE_CLIMB_THROTTLE_INCREMENT" value="0.15" unit="%/(m/s)"/>
          <define name="AUTO_PITCH_PGAIN" value="-0.1"/>
          <define name="AUTO_PITCH_IGAIN" value="0.0"/>
          <define name="AUTO_PITCH_MAX_PITCH" value="0.35"/>
          <define name="AUTO_PITCH_MIN_PITCH" value="-0.35"/>
          <define name="THROTTLE_SLEW" value="0.05"/>
        </section>
        <section name="HORIZONTAL CONTROL" prefix="H_CTL_">
          <define name="COURSE_PGAIN" value="0.5"/>
          <define name="ROLL_MAX_SETPOINT" value="0.6" unit="radians"/>
          <define name="PITCH_MAX_SETPOINT" value="0.5" unit="radians"/>
          <define name="PITCH_MIN_SETPOINT" value="-0.5" unit="radians"/>
          <define name="ROLL_PGAIN" value="-12000."/>
          <define name="AILERON_OF_THROTTLE" value="0.0"/>
          <define name="PITCH_PGAIN" value="-8000."/>
          <define name="PITCH_DGAIN" value="0.0"/>
          <define name="ELEVATOR_OF_ROLL" value="1250"/>
          <define name="ROLL_RATE_MODE_DEFAULT" value="1"/>
          <define name="ROLL_RATE_SETPOINT_PGAIN" value="-5." unit="1/s"/>
          <define name="ROLL_RATE_MAX_SETPOINT" value="10"/>
          <define name="LO_THROTTLE_ROLL_RATE_PGAIN" value="-9000."/>
          <define name="HI_THROTTLE_ROLL_RATE_PGAIN" value="-12000."/>
          <define name="ROLL_RATE_IGAIN" value="0."/>
          <define name="ROLL_RATE_DGAIN" value="0."/>
          <define name="ROLL_RATE_SUM_NB_SAMPLES" value="64"/>
        </section>
        <section name="THR">
          <define name="DASH_THR" value="1.0"/>
          <define name="LOITER_THR" value="0.50"/>
        </section>
        <section name="NAV">
          <define name="NAV_PITCH" value="0."/>
          <define name="NAV_GLIDE_PITCH_TRIM" value="0"/>
        </section>
        <section name="AGGRESSIVE" prefix="AGR_">
          <define name="BLEND_START" value="20"/>
          <define name="BLEND_END" value="10"/>
          <define name="CLIMB_THROTTLE" value="0.95"/>
          <define name="CLIMB_PITCH" value="0.3"/>
          <define name="DESCENT_THROTTLE" value="0.1"/>
          <define name="DESCENT_PITCH" value="-0.25"/>
          <define name="CLIMB_NAV_RATIO" value="0.8"/>
          <define name="DESCENT_NAV_RATIO" value="1.0"/>
        </section>
        <section name="FAILSAFE" prefix="FAILSAFE_">
          <define name="DELAY_WITHOUT_GPS" value="1" unit="s"/>
          <define name="DEFAULT_THROTTLE" value="0.0" unit="%"/>
          <define name="DEFAULT_ROLL" value="0.6" unit="rad"/>
          <define name="DEFAULT_PITCH" value="0.5" unit="rad"/>
          <define name="HOME_RADIUS" value="100" unit="m"/>
        </section>
        <section name="SIMU">
          <define name="ROLL_RESPONSE_FACTOR" value="2."/>
          <define name="YAW_RESPONSE_FACTOR" value="1.35"/>
          <define name="WEIGHT" value="1.3"/>
        </section>
        <section name="MISC">
          <define name="NOMINAL_AIRSPEED" value="10." unit="m/s"/>
          <define name="CARROT" value="5." unit="s"/>
          <define name="KILL_MODE_DISTANCE" value="(MAX_DIST_FROM_HOME*1.5)" unit="m"/>
          <define name="XBEE_INIT" value="\"ATPL4\\rATRN1\\rATTT80\\rATBD3\\rATWR\\r\""/>
          <define name="NO_XBEE_API_INIT" value="TRUE"/>
        </section>
        <section name="DATALINK" prefix="DATALINK_">
          <define name="DEVICE_TYPE" value="XBEE"/>
          <define name="DEVICE_ADDRESS" value="...."/>
        </section>
        <makefile>include $(PAPARAZZI_SRC)/conf/autopilot/tiny.makefile
FLASH_MODE=ISP
#ap.CFLAGS +=  -DFBW -DAP -DCONFIG=\&quot;tiny_0_99.h\&quot; -DLED -DTIME_LED=1
ap.CFLAGS +=  -DFBW -DAP -DCONFIG=\&quot;tiny_1_1.h\&quot; -DLED -DTIME_LED=1
ap.srcs = sys_time.c $(SRC_ARCH)/sys_time_hw.c $(SRC_ARCH)/armVIC.c main_fbw.c main_ap.c main.c
ap.srcs += commands.c
ap.CFLAGS += -DACTUATORS=\&quot;servos_4015_MAT_hw.h\&quot; -DSERVOS_4015_MAT
ap.srcs += $(SRC_ARCH)/servos_4015_MAT_hw.c actuators.c
ap.CFLAGS += -DRADIO_CONTROL -DRADIO_CONTROL_TYPE=RC_FUTABA
ap.srcs += radio_control.c $(SRC_ARCH)/ppm_hw.c  
ap.CFLAGS += -DDOWNLINK -DUSE_UART0 -DDOWNLINK_TRANSPORT=PprzTransport -DDOWNLINK_FBW_DEVICE=Uart0 -DDOWNLINK_AP_DEVICE=Uart0 -DPPRZ_UART=Uart0 -DDATALINK=PPRZ -DUART0_BAUD=B9600
ap.srcs += downlink.c $(SRC_ARCH)/uart_hw.c datalink.c pprz_transport.c traffic_info.c
#ap.CFLAGS += -DDOWNLINK -DDOWNLINK_TRANSPORT=PprzTransport 
#ap.srcs += downlink.c $(SRC_ARCH)/uart_hw.c datalink.c pprz_transport.c traffic_info.c
#ap.CFLAGS += -DDOWNLINK_FBW_DEVICE=Modem 
#ap.CFLAGS += -DDOWNLINK_AP_DEVICE=Modem 
#ap.CFLAGS += -DMODEM
#ap.srcs += $(SRC_ARCH)/modem_hw.c 
ap.CFLAGS += -DINTER_MCU
ap.srcs += inter_mcu.c 
ap.CFLAGS += -DADC -DUSE_ADC_0 -DUSE_ADC_1 -DUSE_ADC_4 -DUSE_ADC_5 -DUSE_ADC_6 
ap.srcs += $(SRC_ARCH)/adc_hw.c
ap.CFLAGS += -DGPS -DUBX -DUSE_UART1 -DGPS_LINK=Uart1 -DUART1_BAUD=B19200
ap.srcs += gps_ubx.c gps.c
ap.CFLAGS += -DINFRARED
ap.srcs += infrared.c estimator.c
ap.CFLAGS += -DNAV -DH_CTL_RATE_LOOP -DAGR_CLIMB
ap.srcs += nav.c fw_h_ctl.c fw_v_ctl.c
#ap.CFLAGS += -DMOBILE_CAM
#ap.srcs += cam.c
#ap.CFLAGS += -DBOMB
# Harware In The Loop
#ap.CFLAGS += -DHITL
# Config for SITL simulation
include $(PAPARAZZI_SRC)/conf/autopilot/sitl.makefile
sim.CFLAGS += -DCONFIG=\&quot;tiny.h\&quot; -DAGR_CLIMB -DH_CTL_RATE_LOOP
#sim.CFLAGS += -DMOBILE_CAM
#sim.srcs += cam.c
# a test program to setup actuators 
setup_actuators.ARCHDIR = $(ARCHI)
setup_actuators.ARCH = arm7tdmi
setup_actuators.TARGET = setup_actuators
setup_actuators.TARGETDIR = setup_actuators
setup_actuators.CFLAGS += -DFBW -DCONFIG=\&quot;tiny_0_99.h\&quot; -DLED -DTIME_LED=1 -DACTUATORS=\&quot;servos_4015_MAT_hw.h\&quot; -DSERVOS_4015_MAT 
setup_actuators.srcs += sys_time.c $(SRC_ARCH)/sys_time_hw.c $(SRC_ARCH)/armVIC.c pprz_transport.c setup_actuators.c $(SRC_ARCH)/servos_4015_MAT_hw.c $(SRC_ARCH)/adc_hw.c main.c
setup_actuators.CFLAGS += -DDOWNLINK -DDOWNLINK_TRANSPORT=PprzTransport 
setup_actuators.srcs += downlink.c datalink.c pprz_transport.c traffic_info.c
setup_actuators.CFLAGS += -DDOWNLINK_FBW_DEVICE=Modem 
setup_actuators.CFLAGS += -DMODEM
setup_actuators.srcs += $(SRC_ARCH)/modem_hw.c 
# a test program to tunnel between both uart
tunnel.ARCHDIR = $(ARCHI)
tunnel.ARCH = arm7tdmi
tunnel.TARGET = tunnel
tunnel.TARGETDIR = tunnel
tunnel.CFLAGS += -DFBW -DCONFIG=\&quot;tiny_0_99.h\&quot; -DLED -DTIME_LED=1
tunnel.srcs += $(SRC_ARCH)/uart_tunnel.c</makefile>
      </airframe>
      <radio name="T9cap" data_min="900" data_max="2100" sync_min="5000" sync_max="15000">
        <channel ctl="right_stick_horiz" function="ROLL" min="1939" neutral="1525" max="1114" average="0"/>
        <channel ctl="right_stick_vert" function="PITCH" min="1112" neutral="1518" max="1937" average="0"/>
        <channel ctl="left_stick_vert" function="THROTTLE" min="1940" neutral="1940" max="1115" average="0"/>
        <channel ctl="left_stick_horiz" function="YAW" min="1940" neutral="1498" max="1115" average="0"/>
        <channel ctl="switch_G" function="CALIB" min="2080" neutral="1525" max="969" average="10"/>
        <channel ctl="VRA" function="GAIN1" min="970" neutral="1520" max="2078" average="10"/>
        <channel ctl="VRC" function="GAIN2" min="970" neutral="1518" max="2077" average="10"/>
        <channel ctl="switch_C" function="MODE" min="2079" neutral="1526" max="966" average="10"/>
      </radio>
    </aircraft>
    <aircraft name="d3mdm" ac_id="43" airframe="airframes/d3_mdm.xml" radio="radios/T9cap.xml" telemetry="telemetry/debug.xml" settings="settings/tuning.xml" flight_plan="flight_plans/ame.xml">
      <flight_plan NAME="ame" WIND_MOD="3" WIND_DIR="60" LON0="-110.951954" MAX_DIST_FROM_HOME="1500" GROUND_ALT="750" SECURITY_HEIGHT="60" QFU="180" ALT="850" LAT0="32.236525">
        <waypoints>
          <waypoint name="HOME" x="-94.522471131" y="17.319972877" alt="850."/>
        </waypoints>
        <blocks>
          <block name="init">
            <while COND="(!launch)"/>
            <attitude roll="0.0" until="(estimator_z > SECURITY_ALT)" vmode="throttle" throttle="1.0" pitch="0.3"/>
          </block>
        </blocks>
      </flight_plan>
      <airframe name="Dragonfly III">
        <servos>
          <servo name="ELEVATOR" no="0" min="1000" neutral="1500" max="2000"/>
          <servo name="AILERON" no="1" min="1000" neutral="1500" max="2000"/>
          <servo name="GAZ" no="3" min="1100" neutral="1200" max="2000"/>
          <servo name="CAM_ROLL" no="5" min="1200" neutral="1550" max="1900"/>
        </servos>
        <commands>
          <axis name="THROTTLE" failsafe_value="0"/>
          <axis name="ROLL" failsafe_value="0"/>
          <axis name="PITCH" failsafe_value="0"/>
          <axis name="CAM_ROLL" failsafe_value="0"/>
          <axis name="CAM_PITCH" failsafe_value="0"/>
          <axis name="PAYPLOAD" failsafe_value="0"/>
        </commands>
        <rc_commands>
          <set command="THROTTLE" value="@THROTTLE"/>
          <set command="ROLL" value="@ROLL"/>
          <set command="PITCH" value="@PITCH"/>
        </rc_commands>
        <section name="MIXER">
          <define name="AILEVON_AILERON_RATE" value="0.8"/>
          <define name="AILEVON_ELEVATOR_RATE" value="0.8"/>
          <define name="ROLL_TGAIN" value="0.005"/>
          <define name="PITCH_TGAIN" value="-0.0"/>
        </section>
        <command_laws>
          <set servo="GAZ" value="@THROTTLE"/>
          <let var="roll" value="@ROLL"/>
          <let var="rollofthr" value="@THROTTLE * ROLL_TGAIN"/>
          <let var="pitch" value="@PITCH"/>
          <let var="pitchofthr" value="@THROTTLE * PITCH_TGAIN"/>
          <set servo="ELEVATOR" value="$pitch + $pitchofthr"/>
          <set servo="AILERON" value="$roll + $rollofthr"/>
          <set servo="CAM_ROLL" value="@CAM_ROLL"/>
        </command_laws>
        <section name="adc" prefix="ADC_CHANNEL_">
          <define name="IR1" value="1"/>
          <define name="IR2" value="0"/>
          <define name="IR_NB_SAMPLES" value="16"/>
          <define name="GYRO_ROLL" value="2"/>
          <define name="GYRO_PITCH" value="3"/>
          <define name="GYRO_NB_SAMPLES" value="16"/>
          <define name="ACCEL_AX" value="6"/>
          <define name="ACCEL_AY" value="5"/>
          <define name="ACCEL_AZ" value="4"/>
          <define name="ACCEL_NB_SAMPLES" value="16"/>
        </section>
        <section name="AUTO1" prefix="AUTO1_">
          <define name="MAX_ROLL" value="RadOfDeg(25)"/>
          <define name="MAX_PITCH" value="RadOfDeg(25)"/>
        </section>
        <section name="INFRARED" prefix="IR_">
          <define name="ROLL_NEUTRAL_DEFAULT" value="6.3" unit="deg"/>
          <define name="PITCH_NEUTRAL_DEFAULT" value="-61" unit="deg"/>
          <define name="DEFAULT_CONTRAST" value="900"/>
          <define name="RAD_OF_IR_CONTRAST" value="1.7"/>
          <linear name="RollOfIrs" arity="2" coeff1="0.7" coeff2="-0.7"/>
          <linear name="PitchOfIrs" arity="2" coeff1="-0.7" coeff2="-0.7"/>
          <define name="RAD_OF_IR_MAX_VALUE" value="0.0045"/>
          <define name="RAD_OF_IR_MIN_VALUE" value="0.00075"/>
          <define name="ADC_ROLL_NEUTRAL" value="0"/>
          <define name="ADC_PITCH_NEUTRAL" value="0"/>
          <define name="ESTIMATED_PHI_PI_4" value="M_PI_4"/>
          <define name="CORRECTION_UP" value="1."/>
          <define name="CORRECTION_DOWN" value="1."/>
          <define name="CORRECTION_LEFT" value="1."/>
          <define name="CORRECTION_RIGHT" value="1."/>
        </section>
        <section name="GYRO" prefix="GYRO_">
          <define name="ADC_ROLL_NEUTRAL" value="344"/>
          <define name="ADC_PITCH_NEUTRAL" value="287"/>
          <define name="ROLL_SCALE" value="3.07"/>
          <define name="ROLL_DIRECTION" value="-1"/>
          <define name="PITCH_SCALE" value="2.52"/>
          <define name="PITCH_DIRECTION" value="1."/>
        </section>
        <section name="ACCEL" prefix="ACCEL_">
          <define name="AX_NEUTRAL" value="327"/>
          <define name="AY_NEUTRAL" value="667"/>
          <define name="AZ_NEUTRAL" value="658"/>
          <define name="AX_SCALE" value="0.03"/>
          <define name="AY_SCALE" value="0.03"/>
          <define name="AZ_SCALE" value="0.03"/>
        </section>
        <section name="BAT">
          <define name="MILLIAMP_PER_PERCENT" value="0.86"/>
          <define name="ADC_CHANNEL_VSUPPLY" value="AdcBank1(6)"/>
          <define name="VoltageOfAdc(adc)" value="(0.01787109375*adc)"/>
          <define name="LOW_BATTERY" value="9.3" unit="V"/>
        </section>
        <section name="VERTICAL CONTROL" prefix="V_CTL_">
          <define name="ALTITUDE_PGAIN" value="-0.065"/>
          <define name="ALTITUDE_MAX_CLIMB" value="2."/>
          <define name="AUTO_THROTTLE_PGAIN" value="-0.01"/>
          <define name="AUTO_THROTTLE_IGAIN" value="0.1"/>
          <define name="AUTO_THROTTLE_PITCH_OF_VZ_PGAIN" value="0.05"/>
          <define name="AUTO_THROTTLE_DASH_TRIM" value="-1000"/>
          <define name="AUTO_THROTTLE_LOITER_TRIM" value="1500"/>
          <define name="AUTO_THROTTLE_CRUISE_THROTTLE" value="0.50"/>
          <define name="AUTO_THROTTLE_NOMINAL_CRUISE_THROTTLE" value="0.35"/>
          <define name="AUTO_THROTTLE_CLIMB_THROTTLE_INCREMENT" value="0.15" unit="%/(m/s)"/>
          <define name="AUTO_PITCH_PGAIN" value="-0.1"/>
          <define name="AUTO_PITCH_IGAIN" value="0.0"/>
          <define name="AUTO_PITCH_MAX_PITCH" value="0.35"/>
          <define name="AUTO_PITCH_MIN_PITCH" value="-0.35"/>
          <define name="THROTTLE_SLEW" value="0.05"/>
        </section>
        <section name="HORIZONTAL CONTROL" prefix="H_CTL_">
          <define name="COURSE_PGAIN" value="0.5"/>
          <define name="ROLL_MAX_SETPOINT" value="0.6" unit="radians"/>
          <define name="PITCH_MAX_SETPOINT" value="0.5" unit="radians"/>
          <define name="PITCH_MIN_SETPOINT" value="-0.5" unit="radians"/>
          <define name="ROLL_PGAIN" value="-12000."/>
          <define name="AILERON_OF_THROTTLE" value="0.0"/>
          <define name="PITCH_PGAIN" value="-8000."/>
          <define name="PITCH_DGAIN" value="0.0"/>
          <define name="ELEVATOR_OF_ROLL" value="1250"/>
          <define name="ROLL_RATE_MODE_DEFAULT" value="1"/>
          <define name="ROLL_RATE_SETPOINT_PGAIN" value="-5." unit="1/s"/>
          <define name="ROLL_RATE_MAX_SETPOINT" value="10"/>
          <define name="LO_THROTTLE_ROLL_RATE_PGAIN" value="-9000."/>
          <define name="HI_THROTTLE_ROLL_RATE_PGAIN" value="-12000."/>
          <define name="ROLL_RATE_IGAIN" value="0."/>
          <define name="ROLL_RATE_DGAIN" value="0."/>
          <define name="ROLL_RATE_SUM_NB_SAMPLES" value="64"/>
        </section>
        <section name="THR">
          <define name="DASH_THR" value="1.0"/>
          <define name="LOITER_THR" value="0.50"/>
        </section>
        <section name="NAV">
          <define name="NAV_PITCH" value="0."/>
          <define name="NAV_GLIDE_PITCH_TRIM" value="0"/>
        </section>
        <section name="AGGRESSIVE" prefix="AGR_">
          <define name="BLEND_START" value="20"/>
          <define name="BLEND_END" value="10"/>
          <define name="CLIMB_THROTTLE" value="0.95"/>
          <define name="CLIMB_PITCH" value="0.3"/>
          <define name="DESCENT_THROTTLE" value="0.1"/>
          <define name="DESCENT_PITCH" value="-0.25"/>
          <define name="CLIMB_NAV_RATIO" value="0.8"/>
          <define name="DESCENT_NAV_RATIO" value="1.0"/>
        </section>
        <section name="FAILSAFE" prefix="FAILSAFE_">
          <define name="DELAY_WITHOUT_GPS" value="1" unit="s"/>
          <define name="DEFAULT_THROTTLE" value="0.0" unit="%"/>
          <define name="DEFAULT_ROLL" value="0.6" unit="rad"/>
          <define name="DEFAULT_PITCH" value="0.5" unit="rad"/>
          <define name="HOME_RADIUS" value="100" unit="m"/>
        </section>
        <section name="SIMU">
          <define name="ROLL_RESPONSE_FACTOR" value="2."/>
          <define name="YAW_RESPONSE_FACTOR" value="1.35"/>
          <define name="WEIGHT" value="1.3"/>
        </section>
        <section name="MISC">
          <define name="NOMINAL_AIRSPEED" value="10." unit="m/s"/>
          <define name="CARROT" value="5." unit="s"/>
          <define name="KILL_MODE_DISTANCE" value="(MAX_DIST_FROM_HOME*1.5)" unit="m"/>
          <define name="XBEE_INIT" value="\"ATPL4\\rATRN1\\rATTT80\\rATBD3\\rATWR\\r\""/>
        </section>
        <section name="DATALINK" prefix="DATALINK_">
          <define name="DEVICE_TYPE" value="XBEE"/>
          <define name="DEVICE_ADDRESS" value="...."/>
        </section>
        <makefile>include $(PAPARAZZI_SRC)/conf/autopilot/tiny.makefile
FLASH_MODE=IAP
#ap.CFLAGS +=  -DFBW -DAP -DCONFIG=\&quot;tiny_0_99.h\&quot; -DLED -DTIME_LED=1
ap.CFLAGS +=  -DFBW -DAP -DCONFIG=\&quot;tiny_1_1.h\&quot; -DLED -DTIME_LED=1
ap.srcs = sys_time.c $(SRC_ARCH)/sys_time_hw.c $(SRC_ARCH)/armVIC.c main_fbw.c main_ap.c main.c
ap.srcs += commands.c
ap.CFLAGS += -DACTUATORS=\&quot;servos_4015_MAT_hw.h\&quot; -DSERVOS_4015_MAT
ap.srcs += $(SRC_ARCH)/servos_4015_MAT_hw.c actuators.c
ap.CFLAGS += -DRADIO_CONTROL -DRADIO_CONTROL_TYPE=RC_FUTABA
ap.srcs += radio_control.c $(SRC_ARCH)/ppm_hw.c  
#ap.CFLAGS += -DDOWNLINK -DUSE_UART0 -DDOWNLINK_TRANSPORT=PprzTransport 
#ap.CFLAGS += -DDOWNLINK_FBW_DEVICE=Uart0 -DDOWNLINK_AP_DEVICE=Uart0 
#ap.CFLAGS += -DPPRZ_UART=Uart0 -DDATALINK=PPRZ -DUART0_BAUD=B9600
#ap.srcs += downlink.c $(SRC_ARCH)/uart_hw.c pprz_transport.c datalink.c
ap.CFLAGS += -DDOWNLINK -DUSE_UART0 -DDOWNLINK_TRANSPORT=XBeeTransport 
ap.CFLAGS += -DDOWNLINK_FBW_DEVICE=Uart0 -DDOWNLINK_AP_DEVICE=Uart0 
ap.CFLAGS += -DXBEE_UART=Uart0 -DDATALINK=XBEE -DUART0_BAUD=B9600
ap.srcs += downlink.c $(SRC_ARCH)/uart_hw.c datalink.c xbee.c
ap.srcs += traffic_info.c
ap.CFLAGS += -DINTER_MCU
ap.srcs += inter_mcu.c 
ap.CFLAGS += -DADC -DUSE_ADC_0 -DUSE_ADC_1 -DUSE_ADC_4 -DUSE_ADC_5 -DUSE_ADC_6 
ap.srcs += $(SRC_ARCH)/adc_hw.c
ap.CFLAGS += -DGPS -DUBX -DUSE_UART1 -DGPS_LINK=Uart1 -DUART1_BAUD=B38400 -DGPS_CONFIGURE
ap.srcs += gps_ubx.c gps.c
ap.CFLAGS += -DINFRARED
ap.srcs += infrared.c estimator.c
ap.CFLAGS += -DNAV -DH_CTL_RATE_LOOP -DAGR_CLIMB
ap.srcs += nav.c fw_h_ctl.c fw_v_ctl.c
ap.CFLAGS += -DGYRO -DIDG300 
ap.srcs += gyro.c
ap.CFLAGS += -DACCEL -DADXL330 
ap.srcs += accel.c
ap.CFLAGS += -DKALMAN_ROLL_PITCH 
ap.srcs += kalman_roll_pitch.c
#ap.CFLAGS += -DMOBILE_CAM
#ap.srcs += cam.c
#ap.CFLAGS += -DBOMB
# Harware In The Loop
#ap.CFLAGS += -DHITL
# Config for SITL simulation
include $(PAPARAZZI_SRC)/conf/autopilot/sitl.makefile
sim.CFLAGS += -DCONFIG=\&quot;tiny.h\&quot; -DAGR_CLIMB -DH_CTL_RATE_LOOP
#sim.CFLAGS += -DMOBILE_CAM
#sim.srcs += cam.c
# a test program to setup actuators 
setup_actuators.ARCHDIR = $(ARCHI)
setup_actuators.ARCH = arm7tdmi
setup_actuators.TARGET = setup_actuators
setup_actuators.TARGETDIR = setup_actuators
setup_actuators.CFLAGS += -DFBW -DCONFIG=\&quot;tiny_0_99.h\&quot; -DLED -DTIME_LED=1 -DACTUATORS=\&quot;servos_4015_MAT_hw.h\&quot; -DSERVOS_4015_MAT 
setup_actuators.srcs += sys_time.c $(SRC_ARCH)/sys_time_hw.c $(SRC_ARCH)/armVIC.c pprz_transport.c setup_actuators.c $(SRC_ARCH)/servos_4015_MAT_hw.c $(SRC_ARCH)/adc_hw.c main.c
setup_actuators.CFLAGS += -DDOWNLINK -DDOWNLINK_TRANSPORT=PprzTransport 
setup_actuators.srcs += downlink.c datalink.c pprz_transport.c traffic_info.c
setup_actuators.CFLAGS += -DDOWNLINK_FBW_DEVICE=Modem 
setup_actuators.CFLAGS += -DMODEM
setup_actuators.srcs += $(SRC_ARCH)/modem_hw.c 
# a test program to tunnel between both uart
tunnel.ARCHDIR = $(ARCHI)
tunnel.ARCH = arm7tdmi
tunnel.TARGET = tunnel
tunnel.TARGETDIR = tunnel
tunnel.CFLAGS += -DFBW -DCONFIG=\&quot;tiny_1_1.h\&quot; -DLED -DTIME_LED=1
tunnel.srcs += $(SRC_ARCH)/uart_tunnel.c</makefile>
      </airframe>
      <radio name="T9cap" data_min="900" data_max="2100" sync_min="5000" sync_max="15000">
        <channel ctl="right_stick_horiz" function="ROLL" min="1939" neutral="1525" max="1114" average="0"/>
        <channel ctl="right_stick_vert" function="PITCH" min="1112" neutral="1518" max="1937" average="0"/>
        <channel ctl="left_stick_vert" function="THROTTLE" min="1940" neutral="1940" max="1115" average="0"/>
        <channel ctl="left_stick_horiz" function="YAW" min="1940" neutral="1498" max="1115" average="0"/>
        <channel ctl="switch_G" function="CALIB" min="2080" neutral="1525" max="969" average="10"/>
        <channel ctl="VRA" function="GAIN1" min="970" neutral="1520" max="2078" average="10"/>
        <channel ctl="VRC" function="GAIN2" min="970" neutral="1518" max="2077" average="10"/>
        <channel ctl="switch_C" function="MODE" min="2079" neutral="1526" max="966" average="10"/>
      </radio>
    </aircraft>
    <aircraft name="Twin1" ac_id="1" airframe="airframes/twinstar1.xml" radio="radios/mc3030.xml" flight_plan="flight_plans/mav05_cw.xml" telemetry="telemetry/default.xml" gui_color="blue">
      <flight_plan SECURITY_HEIGHT="25" lat0="47.4820" lon0="11.0945" ground_alt="730" qfu="280" alt="780" max_dist_from_home="300" name="Garmisch">
        <waypoints>
          <waypoint name="HOME" x="-30" y="30" alt="730."/>
        </waypoints>
        <include name="zz" procedure="zigzag.xml" x="0" y="0" rotate="0">
          <arg name="alt" value="GROUND_ALT+30"/>
          <arg name="rad" value="30"/>
          <with from="end" to="init"/>
        </include>
        <blocks>
          <block NAME="init">
            <deroute BLOCK="zz.takeoff"/>
          </block>
        </blocks>
      </flight_plan>
      <airframe name="Twin1">
        <servos>
          <servo name="GAZ" no="9" min="1000" neutral="1000" max="2000"/>
          <servo name="AILERON_LEFT" no="2" min="1100" neutral="1492" max="2000"/>
          <servo name="AILERON_RIGHT" no="6" min="1000" neutral="1385" max="1833"/>
          <servo name="ELEVATOR" no="7" min="1816" neutral="1586" max="1220"/>
          <servo name="RUDDER" no="3" min="1270" neutral="1546" max="1850"/>
        </servos>
        <commands>
          <axis name="THROTTLE" failsafe_value="0"/>
          <axis name="ROLL" failsafe_value="0"/>
          <axis name="PITCH" failsafe_value="0"/>
          <axis name="YAW" failsafe_value="0"/>
        </commands>
        <rc_commands>
          <set command="THROTTLE" value="@THROTTLE"/>
          <set command="ROLL" value="@ROLL"/>
          <set command="PITCH" value="@PITCH"/>
          <set command="YAW" value="@YAW"/>
        </rc_commands>
        <section name="MIXER">
          <define name="AILERON_DIFF" value="0.66"/>
          <define name="COMBI_SWITCH" value="1.0"/>
        </section>
        <command_laws>
          <set servo="GAZ" value="@THROTTLE"/>
          <set servo="ELEVATOR" value="@PITCH"/>
          <let var="roll" value="@ROLL"/>
          <set servo="AILERON_LEFT" value="($roll > 0 ? 1 : AILERON_DIFF) * $roll"/>
          <set servo="AILERON_RIGHT" value="($roll > 0 ? AILERON_DIFF : 1) * $roll"/>
          <set servo="RUDDER" value="@YAW + @ROLL*COMBI_SWITCH"/>
        </command_laws>
        <section name="adc" prefix="ADC_CHANNEL_">
          <define name="IR1" value="1"/>
          <define name="IR2" value="2"/>
          <define name="VSUPPLY" value="3"/>
        </section>
        <section name="AUTO1" prefix="AUTO1_">
          <define name="MAX_ROLL" value="0.6"/>
          <define name="MAX_PITCH" value="0.6"/>
        </section>
        <section name="INFRARED" prefix="IR_">
          <define name="ROLL_NEUTRAL_DEFAULT" value="0" unit="deg"/>
          <define name="PITCH_NEUTRAL_DEFAULT" value="0" unit="deg"/>
          <define name="ADC_ROLL_NEUTRAL" value="-1005"/>
          <define name="ADC_PITCH_NEUTRAL" value="75"/>
          <define name="DEFAULT_CONTRAST" value="200"/>
          <define name="RAD_OF_IR_CONTRAST" value="0.75"/>
          <linear name="RollOfIrs" arity="2" coeff1="-1" coeff2="-1"/>
          <linear name="PitchOfIrs" arity="2" coeff1="-1" coeff2="1"/>
        </section>
        <section name="PID">
          <define name="ROLL_PGAIN" value="10000."/>
          <define name="PITCH_OF_ROLL" value="0.0"/>
          <define name="PITCH_PGAIN" value="15000."/>
          <define name="MAX_ROLL" value="0.55"/>
          <define name="MAX_PITCH" value="0.35"/>
          <define name="MIN_PITCH" value="-0.35"/>
          <define name="AILERON_OF_GAZ" value="0"/>
          <define name="CRUISE_THROTTLE" value="0.45"/>
        </section>
        <section name="ALT" prefix="CLIMB_">
          <define name="PITCH_PGAIN" value="-0.1"/>
          <define name="PITCH_IGAIN" value="0.025"/>
          <define name="PGAIN" value="-0.03"/>
          <define name="IGAIN" value="0.1"/>
          <define name="MAX" value="1."/>
          <define name="GAZ_OF_CLIMB" value="0.2" unit="%/(m/s)"/>
          <define name="PITCH_OF_VZ_PGAIN" value="0.00"/>
        </section>
        <section name="HORIZONTAL CONTROL" prefix="H_CTL_">
          <define name="COURSE_PGAIN" value="-0.4"/>
          <define name="COURSE_PRE_BANK_CORRECTION" value="1."/>
          <define name="ROLL_MAX_SETPOINT" value="0.73" unit="radians"/>
          <define name="PITCH_MAX_SETPOINT" value="0.5" unit="radians"/>
          <define name="PITCH_MIN_SETPOINT" value="-0.5" unit="radians"/>
          <define name="ROLL_PGAIN" value="10000."/>
          <define name="AILERON_OF_THROTTLE" value="0.0"/>
          <define name="PITCH_PGAIN" value="-6000."/>
          <define name="PITCH_DGAIN" value="0."/>
          <define name="ELEVATOR_OF_ROLL" value="0"/>
          <define name="ROLL_RATE_MODE_DEFAULT" value="1"/>
          <define name="ROLL_RATE_SETPOINT_PGAIN" value="-5.5"/>
          <define name="ROLL_RATE_MAX_SETPOINT" value="10"/>
          <define name="LO_THROTTLE_ROLL_RATE_PGAIN" value="1500."/>
          <define name="HI_THROTTLE_ROLL_RATE_PGAIN" value="900."/>
          <define name="ROLL_RATE_IGAIN" value="0."/>
          <define name="ROLL_RATE_DGAIN" value="0."/>
          <define name="ROLL_RATE_SUM_NB_SAMPLES" value="64"/>
        </section>
        <section name="VERTICAL CONTROL" prefix="V_CTL_">
          <define name="ALTITUDE_PGAIN" value="-0.025"/>
          <define name="ALTITUDE_MAX_CLIMB" value="3."/>
          <define name="AUTO_THROTTLE_NOMINAL_CRUISE_THROTTLE" value="0.60"/>
          <define name="AUTO_THROTTLE_MIN_CRUISE_THROTTLE" value=".45"/>
          <define name="AUTO_THROTTLE_MAX_CRUISE_THROTTLE" value="1"/>
          <define name="AUTO_THROTTLE_LOITER_TRIM" value="2000"/>
          <define name="AUTO_THROTTLE_DASH_TRIM" value="-1500"/>
          <define name="AUTO_THROTTLE_CLIMB_THROTTLE_INCREMENT" value="0.15" unit="%/(m/s)"/>
          <define name="AUTO_THROTTLE_PGAIN" value="-0.008"/>
          <define name="AUTO_THROTTLE_IGAIN" value="0.25"/>
          <define name="AUTO_THROTTLE_PITCH_OF_VZ_PGAIN" value="0.14"/>
          <define name="AUTO_PITCH_PGAIN" value="-0.1"/>
          <define name="AUTO_PITCH_IGAIN" value="0.025"/>
          <define name="AUTO_PITCH_MAX_PITCH" value="0.5"/>
          <define name="AUTO_PITCH_MIN_PITCH" value="-0.5"/>
          <define name="THROTTLE_SLEW" value="0.05"/>
        </section>
        <section name="NAV">
          <define name="NAV_PITCH" value="0."/>
          <define name="NAV_GLIDE_PITCH_TRIM" value="0"/>
        </section>
        <section name="BAT">
          <define name="MILLIAMP_PER_PERCENT" value="2.16"/>
          <define name="VOLTAGE_ADC_A" value="0.0175"/>
          <define name="VOLTAGE_ADC_B" value="0.088"/>
          <define name="VoltageOfAdc(adc)" value="(VOLTAGE_ADC_A * adc + VOLTAGE_ADC_B)"/>
          <define name="LOW_BATTERY" value="9.3" unit="V"/>
        </section>
        <section name="MISC">
          <define name="NOMINAL_AIRSPEED" value="12." unit="m/s"/>
          <define name="CARROT" value="5." unit="s"/>
        </section>
        <section name="SIMU">
          <define name="ROLL_RESPONSE_FACTOR" value="2."/>
          <define name="YAW_RESPONSE_FACTOR" value="1.35"/>
          <define name="WEIGHT" value="1.3"/>
        </section>
        <section name="FAILSAFE" prefix="FAILSAFE_">
          <define name="DELAY_WITHOUT_GPS" value="2" unit="s"/>
          <define name="DEFAULT_THROTTLE" value="CRUISE_THROTTLE+0.05" unit="%"/>
          <define name="DEFAULT_ROLL" value="0.17" unit="rad"/>
          <define name="DEFAULT_PITCH" value="0.08" unit="rad"/>
          <define name="HOME_RADIUS" value="50" unit="m"/>
        </section>
        <section name="CAM" prefix="CAM_">
          <define name="THETA0" value="0" unit="deg"/>
          <define name="PHI0" value="30" unit="deg"/>
        </section>
        <makefile># Virtual AC
# Config for HITL simulation on a V1_2_1 bi-AVR board
include $(PAPARAZZI_SRC)/conf/autopilot/v1_2_1.makefile
include $(PAPARAZZI_SRC)/conf/autopilot/twin_mcu_avr.makefile
# Harware In The Loop
ap.CFLAGS += -DHITL
# Downlink on uart0
ap.CFLAGS += -DUSE_UART0 -DDOWNLINK -DDOWNLINK_TRANSPORT=PprzTransport -DDOWNLINK_AP_DEVICE=Uart0 -DUART0_BAUD=B38400
ap.EXTRA_SRCS += pprz_transport.c downlink.c
# Datalink (on uart0) used to emulate sensors (infrared and gps)
ap.EXTRA_SRCS += traffic_info.c datalink.c
ap.CFLAGS += -DDATALINK -DPPRZ_INPUT -DPPRZ_UART=Uart0
# Config for SITL simulation
include $(PAPARAZZI_SRC)/conf/autopilot/sitl.makefile</makefile>
      </airframe>
      <radio DATA_MAX="2200" SYNC_MAX="15000" NAME="mc3030" DATA_MIN="800" SYNC_MIN="5000">
        <channel CTL="D" NEUTRAL="1000" MAX="2200" FUNCTION="THROTTLE" MIN="1000" AVERAGE="0"/>
        <channel CTL="C" NEUTRAL="1600" MAX="2200" FUNCTION="ROLL" MIN="1000" AVERAGE="0"/>
        <channel CTL="B" NEUTRAL="1600" MAX="2200" FUNCTION="PITCH" MIN="1000" AVERAGE="0"/>
        <channel CTL="A" NEUTRAL="1600" MAX="2200" FUNCTION="YAW" MIN="1000" AVERAGE="0"/>
        <channel CTL="G" NEUTRAL="1600" MAX="2200" FUNCTION="MODE" MIN="1000" AVERAGE="1"/>
        <channel CTL="E" NEUTRAL="1600" MAX="2200" FUNCTION="GAIN1" MIN="1000" AVERAGE="1"/>
        <channel CTL="F" NEUTRAL="1600" MAX="2200" FUNCTION="GAIN2" MIN="1000" AVERAGE="1"/>
        <channel CTL="H" NEUTRAL="1600" MAX="2200" FUNCTION="SWITCH1" MIN="1000" AVERAGE="1"/>
        <channel CTL="I" NEUTRAL="1600" MAX="2200" FUNCTION="CALIB" MIN="1000" AVERAGE="1"/>
      </radio>
    </aircraft>
    <aircraft name="Plaster" ac_id="2" airframe="airframes/plaster1.xml" radio="radios/cockpitMM.xml" telemetry="telemetry/default.xml" flight_plan="flight_plans/kennedy.xml">
      <flight_plan alt="751" ground_alt="746" lat0="32.184346" lon0="-111.013026" max_dist_from_home="1500" name="kennedy" qfu="180" security_height="0.3" wind_dir="60" wind_mod="3">
        <waypoints>
          <waypoint name="HOME" x="0." y="0."/>
          <waypoint name="1" x="-34.5927181506" y="22.9493057216"/>
          <waypoint name="2" x="25.9193831497" y="-31.4832800706"/>
        </waypoints>
        <blocks>
          <block name="init">
            <exception cond="(RcEvent1())" deroute="landing"/>
            <exception cond="(RcEvent2())" deroute="2wp loiter"/>
            <while cond="(!launch)"/>
            <attitude pitch="0.3" roll="0.0" throttle="1.0" until="(estimator_z > SECURITY_ALT)" vmode="throttle"/>
            <deroute block="2wp loiter"/>
          </block>
          <block name="2wp loiter">
            <exception cond="(RcEvent1())" deroute="init"/>
            <exception cond="(RcEvent2())" deroute="circle"/>
            <while>
              <go approaching_time="1" pitch="0.0" throttle="auto" vmode="alt" wp="1"/>
              <go approaching_time="1" pitch="0.0" throttle="auto" vmode="alt" wp="2"/>
            </while>
          </block>
          <block name="circle">
            <exception cond="(RcEvent2())" deroute="2wp loiter"/>
            <exception cond="(RcEvent1())" deroute="landing"/>
            <circle alt="GROUND_ALT+8" radius="10" wp="HOME"/>
          </block>
          <block name="landing">
            <exception cond="(RcEvent2())" deroute="circle"/>
            <exception cond="(RcEvent1())" deroute="init"/>
            <go alt="GROUND_ALT+2" wp="1"/>
            <go alt="GROUND_ALT" throttle="0.30" vmode="throttle" wp="2"/>
          </block>
        </blocks>
      </flight_plan>
      <airframe name="Plaster White 1">
        <section name="adc" prefix="ADC_CHANNEL_">
          <define name="IR1" value="1"/>
          <define name="IR2" value="0"/>
          <define name="VSUPPLY" value="3"/>
          <define name="IR_NB_SAMPLES" value="16"/>
        </section>
        <servos>
          <servo name="GAZ" no="0" min="1000" neutral="1000" max="1750"/>
          <servo name="AILEVON_RIGHT" no="2" min="1800" neutral="1480" max="1200"/>
          <servo name="AILEVON_LEFT" no="6" min="1800" neutral="1440" max="1200"/>
        </servos>
        <commands>
          <axis name="THROTTLE" failsafe_value="0"/>
          <axis name="ROLL" failsafe_value="0"/>
          <axis name="PITCH" failsafe_value="0"/>
        </commands>
        <rc_commands>
          <set command="THROTTLE" value="@THROTTLE"/>
          <set command="ROLL" value="@ROLL"/>
          <set command="PITCH" value="@PITCH"/>
        </rc_commands>
        <command_laws>
          <set servo="GAZ" value="@THROTTLE"/>
          <let var="aileron" value="@ROLL * AILEVON_AILERON_RATE"/>
          <let var="elevator" value="@PITCH * AILEVON_ELEVATOR_RATE"/>
          <set servo="AILEVON_LEFT" value="$aileron + $elevator"/>
          <set servo="AILEVON_RIGHT" value="$aileron - $elevator"/>
        </command_laws>
        <section name="MIXER">
          <define name="AILEVON_AILERON_RATE" value="0.55"/>
          <define name="AILEVON_ELEVATOR_RATE" value="0.75"/>
        </section>
        <section name="AUTO1" prefix="AUTO1_">
          <define name="MAX_ROLL" value="0.8"/>
          <define name="MAX_PITCH" value="0.6"/>
        </section>
        <section name="INFRARED" prefix="IR_">
          <define name="ROLL_NEUTRAL_DEFAULT" value="-4.3" unit="deg"/>
          <define name="PITCH_NEUTRAL_DEFAULT" value="3" unit="deg"/>
          <define name="DEFAULT_CONTRAST" value="400"/>
          <define name="RAD_OF_IR_CONTRAST" value="0.6"/>
          <define name="RAD_OF_IR_MIN_VALUE" value="0.0008"/>
          <define name="RAD_OF_IR_MAX_VALUE" value="0.008"/>
          <define name="RollOfIrs(i1, i2)" value="(-i1 -i2)"/>
          <define name="PitchOfIrs(i1, i2)" value="(i2-i1)"/>
          <define name="ADC_ROLL_NEUTRAL" value="-1042"/>
          <define name="ADC_PITCH_NEUTRAL" value="10"/>
        </section>
        <section name="PID">
          <define name="ROLL_PGAIN" value="6000."/>
          <define name="PITCH_OF_ROLL" value="0.2"/>
          <define name="PITCH_PGAIN" value="9000."/>
          <define name="MAX_ROLL" value="0.4"/>
          <define name="MAX_PITCH" value="0.25"/>
          <define name="MIN_PITCH" value="-0.35"/>
          <define name="AILERON_OF_GAZ" value="-0.13"/>
          <define name="CRUISE_THROTTLE" value="0.50"/>
        </section>
        <section name="ALT" prefix="CLIMB_">
          <define name="PITCH_PGAIN" value="-0.1"/>
          <define name="PITCH_IGAIN" value="1.0"/>
          <define name="PGAIN" value="-0.025"/>
          <define name="IGAIN" value="0.01"/>
          <define name="MAX" value="1."/>
          <define name="GAZ_OF_CLIMB" value="0.15" unit="% / m/s"/>
          <define name="PITCH_OF_VZ_PGAIN" value="0.1"/>
        </section>
        <section name="NAV">
          <define name="COURSE_PGAIN" value="-0.2"/>
          <define name="ALTITUDE_PGAIN" value="-0.05"/>
          <define name="NAV_PITCH" value="0."/>
          <define name="NAV_GLIDE_PITCH_TRIM" value="0"/>
        </section>
        <section name="BAT">
          <define name="MILLIAMP_PER_PERCENT" value="1.24"/>
          <define name="VOLTAGE_ADC_A" value="0.01727"/>
          <define name="VOLTAGE_ADC_B" value="0.2965"/>
          <define name="VoltageOfAdc(adc)" value="(VOLTAGE_ADC_A * adc + VOLTAGE_ADC_B)"/>
          <define name="LOW_BATTERY" value="9" unit="V"/>
        </section>
        <section name="SERVOS">
          <define name="SERVOS_VOLTAGE_ADC_A" value="0.005661"/>
          <define name="SERVOS_VOLTAGE_ADC_B" value="0.014948"/>
          <define name="ServosVoltageOfAdc(adc)" value="(VOLTAGE_ADC_A * adc + VOLTAGE_ADC_B)"/>
        </section>
        <section name="VERTICAL CONTROL" prefix="V_CTL_">
          <define name="ALTITUDE_PGAIN" value="0.3"/>
          <define name="ALTITUDE_MAX_CLIMB" value="2."/>
          <define name="AUTO_THROTTLE_MIN_CRUISE_THROTTLE" value="0.35"/>
          <define name="AUTO_THROTTLE_MAX_CRUISE_THROTTLE" value="0.45"/>
          <define name="AUTO_THROTTLE_PGAIN" value="0.02"/>
          <define name="AUTO_THROTTLE_IGAIN" value="0.0"/>
          <define name="AUTO_THROTTLE_PITCH_OF_VZ_PGAIN" value="0.0"/>
          <define name="AUTO_THROTTLE_DASH_TRIM" value="1000"/>
          <define name="AUTO_THROTTLE_LOITER_TRIM" value="1500"/>
          <define name="AUTO_THROTTLE_CRUISE_THROTTLE" value="0.488"/>
          <define name="AUTO_THROTTLE_CRUISE_THROTTLE_PGAIN" value="0.01"/>
          <define name="AUTO_THROTTLE_NOMINAL_CRUISE_THROTTLE" value="0.47"/>
          <define name="AUTO_THROTTLE_CLIMB_THROTTLE_INCREMENT" value="0.02" unit="%/(m/s)"/>
          <define name="THROTTLE_SUM_NB_SAMPLES" value="32"/>
          <define name="AUTO_PITCH_PGAIN" value="0.1"/>
          <define name="AUTO_PITCH_IGAIN" value="0.0"/>
          <define name="AUTO_PITCH_MAX_PITCH" value="0.35"/>
          <define name="AUTO_PITCH_MIN_PITCH" value="-0.35"/>
          <define name="VDROP2THROTTLE" value="0"/>
          <define name="THROTTLE_SLEW" value="1.0"/>
        </section>
        <section name="HORIZONTAL CONTROL" prefix="H_CTL_">
          <define name="COURSE_PGAIN" value="0.5"/>
          <define name="ROLL_MAX_SETPOINT" value="RadOfDeg(45)" unit="radians"/>
          <define name="PITCH_MAX_SETPOINT" value="RadOfDeg(30)" unit="radians"/>
          <define name="PITCH_MIN_SETPOINT" value="RadOfDeg(-20)" unit="radians"/>
          <define name="YAW_MAX_SETPOINT" value="RadOfDeg(20)" unit="radians"/>
          <define name="ROLL_PGAIN" value="-12000."/>
          <define name="AILERON_OF_THROTTLE" value="0.0"/>
          <define name="PITCH_PGAIN" value="11950."/>
          <define name="PITCH_DGAIN" value="0.0"/>
          <define name="ELEVATOR_OF_ROLL" value="0."/>
          <define name="ROLL_RATE_MODE_DEFAULT" value="1"/>
          <define name="PITCH_RATE_MODE_DEFAULT" value="1"/>
          <define name="YAW_RATE_MODE_DEFAULT" value="1"/>
          <define name="ROLL_RATE_SETPOINT_PGAIN" value="0.75" unit="1/s"/>
          <define name="ROLL_RATE_MAX_SETPOINT" value="10"/>
          <define name="PITCH_RATE_SETPOINT_PGAIN" value="0.75" unit="1/s"/>
          <define name="PITCH_RATE_MAX_SETPOINT" value="10"/>
          <define name="YAW_RATE_SETPOINT_PGAIN" value="0.75" unit="1/s"/>
          <define name="YAW_RATE_MAX_SETPOINT" value="10"/>
          <define name="LO_THROTTLE_ROLL_RATE_PGAIN" value="25000."/>
          <define name="HI_THROTTLE_ROLL_RATE_PGAIN" value="25000."/>
          <define name="LO_THROTTLE_PITCH_RATE_PGAIN" value="13000."/>
          <define name="HI_THROTTLE_PITCH_RATE_PGAIN" value="13000."/>
          <define name="LO_THROTTLE_YAW_RATE_PGAIN" value="18000."/>
          <define name="HI_THROTTLE_YAW_RATE_PGAIN" value="18000."/>
          <define name="ROLL_RATE_IGAIN" value="0."/>
          <define name="ROLL_RATE_DGAIN" value="0."/>
          <define name="ROLL_RATE_SUM_NB_SAMPLES" value="16"/>
          <define name="PITCH_RATE_IGAIN" value="0."/>
          <define name="PITCH_RATE_DGAIN" value="0."/>
          <define name="PITCH_RATE_SUM_NB_SAMPLES" value="16"/>
          <define name="YAW_RATE_IGAIN" value="0."/>
          <define name="YAW_RATE_DGAIN" value="0."/>
          <define name="YAW_RATE_SUM_NB_SAMPLES" value="16"/>
        </section>
        <section name="MISC">
          <define name="NOMINAL_AIRSPEED" value="12."/>
          <define name="CARROT" value="5." unit="s"/>
          <define name="KILL_MODE_DISTANCE" value="(MAX_DIST_FROM_HOME*1.5)" unit="m"/>
        </section>
        <section name="SIMU">
          <define name="ROLL_RESPONSE_FACTOR" value="14."/>
          <define name="YAW_RESPONSE_FACTOR" value="1."/>
          <define name="WEIGHT" value="0.3"/>
        </section>
        <section name="FAILSAFE" prefix="FAILSAFE_">
          <define name="DELAY_WITHOUT_GPS" value="2" unit="s"/>
          <define name="DEFAULT_GAZ" value="CRUISE_THROTTLE+0.05" unit="%"/>
          <define name="DEFAULT_ROLL" value="0.17" unit="rad"/>
          <define name="DEFAULT_PITCH" value="0.08" unit="rad"/>
          <define name="HOME_RADIUS" value="50" unit="m"/>
          <define name="DEFAULT_THROTTLE" value="0.2" unit="%"/>
        </section>
        <section name="CAM" prefix="CAM_">
          <define name="THETA0" value="45" unit="deg"/>
          <define name="PHI0" value="-45" unit="deg"/>
        </section>
        <section name="DATALINK" prefix="DATALINK_">
          <define name="DEVICE_TYPE" value="XBEE"/>
          <define name="DEVICE_ADDRESS" value=""/>
        </section>
        <section name="AGGRESSIVE" prefix="AGR_">
          <define name="CLIMB_GAZ" value="0.8"/>
          <define name="DESCENT_GAZ" value="0.1"/>
          <define name="CLIMB_PITCH" value="0.2"/>
          <define name="DESCENT_PITCH" value="-0.2"/>
          <define name="BLEND_START" value="15"/>
          <define name="BLEND_END" value="8"/>
          <define name="CLIMB_NAV_RATIO" value="0.8"/>
          <define name="DESCENT_NAV_RATIO" value="1.0"/>
        </section>
        <makefile target="sitl"># Config for SITL simulation
include $(PAPARAZZI_SRC)/conf/autopilot/sitl.makefile</makefile>
        <makefile target="tunnel">tunnel.srcs += $(SRC_ARCH)/uart_tunnel.c</makefile>
        <makefile target="ac">include $(PAPARAZZI_SRC)/conf/autopilot/v1_2_1.makefile
include $(PAPARAZZI_SRC)/conf/autopilot/twin_mcu_avr.makefile
# fbw.CFLAGS += -DTELEMETRY_MODE_FBW=1
ap.CFLAGS += -DDOWNLINK -DDOWNLINK_TRANSPORT=XBeeTransport
ap.srcs += downlink.c
ap.CFLAGS += -DUSE_UART0 -DDOWNLINK_AP_DEVICE=Uart0
#ap.CFLAGS += -DMODEM  -DDOWNLINK_AP_DEVICE=Modem
#ap.srcs += $(SRC_ARCH)/modem_hw.c 
#ap.CFLAGS += -DRADIO_CONTROL_CALIB
#ap.srcs += rc_settings.c
ap.CFLAGS += -DDATALINK=XBEE
ap.srcs += traffic_info.c datalink.c xbee.c
ap.CFLAGS += -DXBEE_UART=Uart0 -DUART0_BAUD=B9600</makefile>
      </airframe>
      <radio name="cockpitMM" data_min="900" data_max="2100" sync_min="5000" sync_max="15000">
        <channel ctl="D" function="ROLL" min="2000" neutral="1498" max="1000" average="0"/>
        <channel ctl="C" function="PITCH" min="2000" neutral="1498" max="1000" average="0"/>
        <channel ctl="B" function="YAW" min="2000" neutral="1498" max="1000" average="0"/>
        <channel ctl="A" function="THROTTLE" min="1120" neutral="1120" max="2000" average="0"/>
        <channel ctl="G" function="GAIN1" min="2000" neutral="1498" max="1000" average="1"/>
        <channel ctl="E" function="MODE" min="2000" neutral="1500" max="1000" average="1"/>
        <channel ctl="F" function="CALIB" min="2000" neutral="1500" max="1000" average="1"/>
      </radio>
    </aircraft>
    <aircraft name="MJ7" ac_id="7" airframe="airframes/microjet7.xml" radio="radios/T9cap.xml" telemetry="telemetry/default.xml" flight_plan="flight_plans/muret_demo_1.xml" gui_color="#6293ba">
      <flight_plan NAME="demo 1" LON0="1.27289" MAX_DIST_FROM_HOME="400" GROUND_ALT="185" SECURITY_HEIGHT="25" QFU="270" ALT="250" LAT0="43.46223">
        <waypoints>
          <waypoint Y="30.0" NAME="HOME" X="0.0" ALT="250."/>
          <waypoint name="road_start" x="-337" y="17" alt="250."/>
          <waypoint name="road_end" x="238" y="-30" alt="250."/>
          <waypoint name="too far" x="529" y="-23" alt="250."/>
        </waypoints>
        <blocks>
          <block name="survey road 1">
            <go wp="road_start"/>
            <go wp="road_end"/>
          </block>
          <block NAME="survey road 2">
            <while cond="TRUE">
              <go wp="road_start" from="road_end" hmode="route"/>
              <go wp="road_end" from="road_start" hmode="route"/>
            </while>
          </block>
          <block name="circle">
            <circle wp="road_end" ALT="ground_alt+50" radius="75"/>
          </block>
          <block name="go too far">
            <go wp="too far"/>
            <circle wp="too far" radius="50"/>
          </block>
        </blocks>
      </flight_plan>
      <airframe name="Microjet7 Tiny 1.1">
        <servos>
          <servo name="GAZ" no="0" min="1000" neutral="1000" max="2000"/>
          <servo name="AILEVON_LEFT" no="6" min="1075" neutral="1480" max="2025"/>
          <servo name="AILEVON_RIGHT" no="3" min="1975" neutral="1515" max="975"/>
          <servo name="HATCH" no="2" max="2000" neutral="1000" min="1000"/>
        </servos>
        <commands>
          <axis name="THROTTLE" failsafe_value="0"/>
          <axis name="ROLL" failsafe_value="0"/>
          <axis name="PITCH" failsafe_value="0"/>
          <axis name="HATCH" failsafe_value="0"/>
        </commands>
        <rc_commands>
          <set command="THROTTLE" value="@THROTTLE"/>
          <set command="ROLL" value="@ROLL"/>
          <set command="PITCH" value="@PITCH"/>
          <set command="HATCH" value="@GAIN1"/>
        </rc_commands>
        <section name="MIXER">
          <define name="AILEVON_AILERON_RATE" value="0.3"/>
          <define name="AILEVON_ELEVATOR_RATE" value="0.7"/>
        </section>
        <command_laws>
          <let var="aileron" value="@ROLL  * AILEVON_AILERON_RATE"/>
          <let var="elevator" value="@PITCH * AILEVON_ELEVATOR_RATE"/>
          <set servo="GAZ" value="@THROTTLE"/>
          <set servo="AILEVON_LEFT" value="$elevator + $aileron"/>
          <set servo="AILEVON_RIGHT" value="$elevator - $aileron"/>
          <set servo="HATCH" value="@HATCH"/>
        </command_laws>
        <section name="AUTO1" prefix="AUTO1_">
          <define name="MAX_ROLL" value="0.6"/>
          <define name="MAX_PITCH" value="0.6"/>
        </section>
        <section name="adc" prefix="ADC_CHANNEL_">
          <define name="IR1" value="ADC_0"/>
          <define name="IR2" value="ADC_1"/>
          <define name="IR_TOP" value="ADC_6"/>
          <define name="IR_NB_SAMPLES" value="16"/>
          <define name="GYRO_ROLL" value="ADC_4"/>
          <define name="GYRO_TEMP" value="ADC_5"/>
          <define name="GYRO_NB_SAMPLES" value="16"/>
        </section>
        <section name="INFRARED" prefix="IR_">
          <define name="ROLL_NEUTRAL_DEFAULT" value="0" unit="deg"/>
          <define name="PITCH_NEUTRAL_DEFAULT" value="10" unit="deg"/>
          <define name="DEFAULT_CONTRAST" value="200"/>
          <define name="RAD_OF_IR_CONTRAST" value="0.75"/>
          <linear name="RollOfIrs" arity="2" coeff1="-0.7" coeff2="0.7"/>
          <linear name="PitchOfIrs" arity="2" coeff1="-0.7" coeff2="-0.7"/>
          <linear name="TopOfIr" arity="1" coeff1="1"/>
          <define name="RAD_OF_IR_MAX_VALUE" value="0.0045"/>
          <define name="RAD_OF_IR_MIN_VALUE" value="0.00075"/>
          <define name="ADC_ROLL_NEUTRAL" value="0"/>
          <define name="ADC_PITCH_NEUTRAL" value="-716"/>
          <define name="ADC_TOP_NEUTRAL" value="512"/>
          <define name="CORRECTION_UP" value="1."/>
          <define name="CORRECTION_DOWN" value="1."/>
          <define name="CORRECTION_LEFT" value="1."/>
          <define name="CORRECTION_RIGHT" value="1."/>
          <define name="ESTIMATED_PHI_PI_4" value="0.9"/>
          <define name="360_LATERAL_CORRECTION" value="1."/>
          <define name="360_LONGITUDINAL_CORRECTION" value="1."/>
          <define name="360_VERTICAL_CORRECTION" value="1."/>
        </section>
        <section name="GYRO" prefix="GYRO_">
          <define name="ADC_ROLL_NEUTRAL" value="500"/>
          <define name="ADC_TEMP_NEUTRAL" value="476"/>
          <define name="ADC_TEMP_SLOPE" value="0"/>
          <define name="ROLL_SCALE" value="0.44"/>
          <define name="ROLL_DIRECTION" value="1."/>
        </section>
        <section name="BAT">
          <define name="MILLIAMP_PER_PERCENT" value="0.86"/>
          <define name="ADC_CHANNEL_VSUPPLY" value="AdcBank1(6)"/>
          <define name="VoltageOfAdc(adc)" value="(0.01787109375*adc)"/>
          <define name="LOW_BATTERY" value="9.3" unit="V"/>
        </section>
        <section name="MISC">
          <define name="NOMINAL_AIRSPEED" value="12." unit="m/s"/>
          <define name="CARROT" value="5." unit="s"/>
          <define name="KILL_MODE_DISTANCE" value="(1.5*MAX_DIST_FROM_HOME)"/>
          <define name="CONTROL_RATE" value="60" unit="Hz"/>
          <define name="XBEE_INIT" value="\"ATPL2\\rATRN1\\rATTT80\\r\""/>
          <define name="ALT_KALMAN_ENABLED" value="TRUE"/>
          <define name="TRIGGER_DELAY" value="1."/>
          <define name="DEFAULT_CIRCLE_RADIUS" value="80."/>
          <define name="MIN_CIRCLE_RADIUS" value="50."/>
        </section>
        <section name="VERTICAL CONTROL" prefix="V_CTL_">
          <define name="POWER_CTL_BAT_NOMINAL" value="11.1" unit="volt"/>
          <define name="ALTITUDE_PGAIN" value="-0.03"/>
          <define name="ALTITUDE_MAX_CLIMB" value="2."/>
          <define name="AUTO_THROTTLE_NOMINAL_CRUISE_THROTTLE" value="0.35"/>
          <define name="AUTO_THROTTLE_MIN_CRUISE_THROTTLE" value="0.30"/>
          <define name="AUTO_THROTTLE_MAX_CRUISE_THROTTLE" value="0.80"/>
          <define name="AUTO_THROTTLE_LOITER_TRIM" value="1500"/>
          <define name="AUTO_THROTTLE_DASH_TRIM" value="-1000"/>
          <define name="AUTO_THROTTLE_CLIMB_THROTTLE_INCREMENT" value="0.15" unit="%/(m/s)"/>
          <define name="AUTO_THROTTLE_PGAIN" value="-0.01"/>
          <define name="AUTO_THROTTLE_IGAIN" value="0.1"/>
          <define name="AUTO_THROTTLE_PITCH_OF_VZ_PGAIN" value="0.05"/>
          <define name="AUTO_PITCH_PGAIN" value="-0.05"/>
          <define name="AUTO_PITCH_IGAIN" value="0.075"/>
          <define name="AUTO_PITCH_MAX_PITCH" value="0.35"/>
          <define name="AUTO_PITCH_MIN_PITCH" value="-0.35"/>
          <define name="THROTTLE_SLEW" value="0.05"/>
        </section>
        <section name="HORIZONTAL CONTROL" prefix="H_CTL_">
          <define name="COURSE_PGAIN" value="-0.8"/>
          <define name="ROLL_MAX_SETPOINT" value="0.6" unit="radians"/>
          <define name="PITCH_MAX_SETPOINT" value="0.5" unit="radians"/>
          <define name="PITCH_MIN_SETPOINT" value="-0.5" unit="radians"/>
          <define name="ROLL_PGAIN" value="5000."/>
          <define name="AILERON_OF_THROTTLE" value="0.0"/>
          <define name="PITCH_PGAIN" value="-9000."/>
          <define name="PITCH_DGAIN" value="1.5"/>
          <define name="ELEVATOR_OF_ROLL" value="1250"/>
          <define name="ROLL_RATE_MODE_DEFAULT" value="1"/>
          <define name="ROLL_RATE_SETPOINT_PGAIN" value="-5." unit="rad/s/rad"/>
          <define name="ROLL_RATE_MAX_SETPOINT" value="10"/>
          <define name="LO_THROTTLE_ROLL_RATE_PGAIN" value="1000."/>
          <define name="HI_THROTTLE_ROLL_RATE_PGAIN" value="1000."/>
          <define name="ROLL_RATE_IGAIN" value="0."/>
          <define name="ROLL_RATE_DGAIN" value="0."/>
          <define name="ROLL_RATE_SUM_NB_SAMPLES" value="64"/>
        </section>
        <section name="NAV">
          <define name="NAV_PITCH" value="0."/>
          <define name="NAV_GLIDE_PITCH_TRIM" value="0"/>
        </section>
        <section name="AGGRESSIVE" prefix="AGR_">
          <define name="BLEND_START" value="20"/>
          <define name="BLEND_END" value="10"/>
          <define name="CLIMB_THROTTLE" value="0.8"/>
          <define name="CLIMB_PITCH" value="0.3"/>
          <define name="DESCENT_THROTTLE" value="0.1"/>
          <define name="DESCENT_PITCH" value="-0.25"/>
          <define name="CLIMB_NAV_RATIO" value="0.8"/>
          <define name="DESCENT_NAV_RATIO" value="1.0"/>
        </section>
        <section name="GYRO_GAINS">
          <define name="GYRO_MAX_RATE" value="200."/>
          <define name="ROLLRATESUM_NB_SAMPLES" value="64"/>
          <define name="ALT_ROLL__PGAIN" value="1.0"/>
          <define name="ROLL_RATE_PGAIN" value="1000.0"/>
          <define name="ROLL_RATE_IGAIN" value="0.0"/>
          <define name="ROLL_RATE_DGAIN" value="0.0"/>
        </section>
        <section name="FAILSAFE" prefix="FAILSAFE_">
          <define name="DELAY_WITHOUT_GPS" value="1" unit="s"/>
          <define name="DEFAULT_THROTTLE" value="0.3" unit="%"/>
          <define name="DEFAULT_ROLL" value="0.3" unit="rad"/>
          <define name="DEFAULT_PITCH" value="0.5" unit="rad"/>
          <define name="HOME_RADIUS" value="100" unit="m"/>
        </section>
        <section name="DATALINK" prefix="DATALINK_">
          <define name="DEVICE_TYPE" value="XBEE"/>
          <define name="DEVICE_ADDRESS" value="...."/>
        </section>
        <section name="SIMU">
          <define name="YAW_RESPONSE_FACTOR" value="0.5"/>
        </section>
        <makefile>include $(PAPARAZZI_SRC)/conf/autopilot/tiny.makefile
FLASH_MODE=IAP
ap.CFLAGS +=  -DFBW -DAP -DCONFIG=\&quot;tiny_0_99.h\&quot; -DLED -DTIME_LED=1
ap.srcs = sys_time.c $(SRC_ARCH)/sys_time_hw.c $(SRC_ARCH)/armVIC.c main_fbw.c main_ap.c main.c
ap.srcs += commands.c
ap.CFLAGS += -DACTUATORS=\&quot;servos_4015_MAT_hw.h\&quot; -DSERVOS_4015_MAT
ap.srcs += $(SRC_ARCH)/servos_4015_MAT_hw.c actuators.c
ap.CFLAGS += -DRADIO_CONTROL -DRADIO_CONTROL_TYPE=RC_FUTABA
ap.srcs += radio_control.c $(SRC_ARCH)/ppm_hw.c  
#ap.CFLAGS += -DDOWNLINK -DUSE_UART0 -DDOWNLINK_TRANSPORT=XBeeTransport -DDOWNLINK_FBW_DEVICE=Uart0 -DDOWNLINK_AP_DEVICE=Uart0 -DXBEE_UART=Uart0 -DDATALINK=XBEE -DUART0_BAUD=B9600
#ap.srcs += downlink.c $(SRC_ARCH)/uart_hw.c datalink.c xbee.c
#TRANSPARENT
#ap.CFLAGS += -DDOWNLINK -DUSE_UART0 -DDOWNLINK_TRANSPORT=PprzTransport -DDOWNLINK_FBW_DEVICE=Uart0 -DDOWNLINK_AP_DEVICE=Uart0 -DPPRZ_UART=Uart0 -DDATALINK=PPRZ -DUART0_BAUD=B9600
#TRANSPARENT 
#ap.srcs += downlink.c $(SRC_ARCH)/uart_hw.c datalink.c pprz_transport.c
ap.CFLAGS += -DDOWNLINK -DDOWNLINK_TRANSPORT=PprzTransport 
ap.srcs += downlink.c $(SRC_ARCH)/uart_hw.c datalink.c pprz_transport.c
ap.CFLAGS += -DDOWNLINK_FBW_DEVICE=Modem 
ap.CFLAGS += -DDOWNLINK_AP_DEVICE=Modem 
ap.CFLAGS += -DMODEM
ap.srcs += $(SRC_ARCH)/modem_hw.c 
ap.CFLAGS += -DINTER_MCU
ap.srcs += inter_mcu.c 
ap.CFLAGS += -DADC -DUSE_ADC_0 -DUSE_ADC_1 -DUSE_ADC_4 -DUSE_ADC_5 -DUSE_ADC_6
ap.srcs += $(SRC_ARCH)/adc_hw.c
ap.CFLAGS += -DGPS -DUBX -DUSE_UART1 -DGPS_LINK=Uart1 -DUART1_BAUD=B19200
ap.srcs += gps_ubx.c gps.c
ap.CFLAGS += -DINFRARED -DALT_KALMAN -DIR_360
ap.srcs += infrared.c estimator.c
ap.CFLAGS += -DNAV -DH_CTL_RATE_LOOP -DAGR_CLIMB -DLOITER_TRIM
ap.srcs += nav.c fw_h_ctl.c fw_v_ctl.c
#ap.CFLAGS += -DGYRO -DADXRS150
#ap.srcs += gyro.c nav_line.c chemotaxis.c anemotaxis.c discsurvey.c
ap.srcs += traffic_info.c
#ap.srcs += bomb.c
# Hack to use the same tuning file than slayer1
ap.CFLAGS += -DUSE_GPIO
ap.srcs += $(SRC_ARCH)/gpio.c
# Harware In The Loop
#ap.CFLAGS += -DHITL
# Config for SITL simulation
include $(PAPARAZZI_SRC)/conf/autopilot/sitl.makefile
sim.CFLAGS += -DCONFIG=\&quot;tiny.h\&quot; -DAGR_CLIMB -DH_CTL_RATE_LOOP
#sim.srcs += bomb.c
# a test program to setup actuators 
setup_actuators.ARCHDIR = $(ARCHI)
setup_actuators.ARCH = arm7tdmi
setup_actuators.TARGET = setup_actuators
setup_actuators.TARGETDIR = setup_actuators
setup_actuators.CFLAGS += -DFBW -DCONFIG=\&quot;tiny.h\&quot; -DLED -DTIME_LED=1 -DACTUATORS=\&quot;servos_4015_hw.h\&quot; -DSERVOS_4015 -DUSE_UART0 -DUART0_BAUD=B9600 -DDATALINK=PPRZ -DPPRZ_UART=Uart0
setup_actuators.srcs += sys_time.c $(SRC_ARCH)/sys_time_hw.c $(SRC_ARCH)/armVIC.c pprz_transport.c setup_actuators.c $(SRC_ARCH)/uart_hw.c $(SRC_ARCH)/servos_4015_hw.c main.c
# a test program to tunnel between both uart
tunnel.ARCHDIR = $(ARCHI)
tunnel.ARCH = arm7tdmi
tunnel.TARGET = tunnel
tunnel.TARGETDIR = tunnel
tunnel.CFLAGS += -DFBW -DCONFIG=\&quot;tiny.h\&quot; -DLED -DTIME_LED=1
tunnel.srcs += $(SRC_ARCH)/uart_tunnel.c</makefile>
      </airframe>
      <radio name="T9cap" data_min="900" data_max="2100" sync_min="5000" sync_max="15000">
        <channel ctl="right_stick_horiz" function="ROLL" min="1939" neutral="1525" max="1114" average="0"/>
        <channel ctl="right_stick_vert" function="PITCH" min="1112" neutral="1518" max="1937" average="0"/>
        <channel ctl="left_stick_vert" function="THROTTLE" min="1940" neutral="1940" max="1115" average="0"/>
        <channel ctl="left_stick_horiz" function="YAW" min="1940" neutral="1498" max="1115" average="0"/>
        <channel ctl="switch_G" function="CALIB" min="2080" neutral="1525" max="969" average="10"/>
        <channel ctl="VRA" function="GAIN1" min="970" neutral="1520" max="2078" average="10"/>
        <channel ctl="VRC" function="GAIN2" min="970" neutral="1518" max="2077" average="10"/>
        <channel ctl="switch_C" function="MODE" min="2079" neutral="1526" max="966" average="10"/>
      </radio>
    </aircraft>
    <aircraft name="FOO" ac_id="77" airframe="airframes/foo.xml" radio="radios/T9cap.xml" telemetry="telemetry/default.xml" flight_plan="flight_plans/muret_demo_1.xml" gui_color="#6293ba">
      <flight_plan NAME="demo 1" LON0="1.27289" MAX_DIST_FROM_HOME="400" GROUND_ALT="185" SECURITY_HEIGHT="25" QFU="270" ALT="250" LAT0="43.46223">
        <waypoints>
          <waypoint Y="30.0" NAME="HOME" X="0.0" ALT="250."/>
          <waypoint name="road_start" x="-337" y="17" alt="250."/>
          <waypoint name="road_end" x="238" y="-30" alt="250."/>
          <waypoint name="too far" x="529" y="-23" alt="250."/>
        </waypoints>
        <blocks>
          <block name="survey road 1">
            <go wp="road_start"/>
            <go wp="road_end"/>
          </block>
          <block NAME="survey road 2">
            <while cond="TRUE">
              <go wp="road_start" from="road_end" hmode="route"/>
              <go wp="road_end" from="road_start" hmode="route"/>
            </while>
          </block>
          <block name="circle">
            <circle wp="road_end" ALT="ground_alt+50" radius="75"/>
          </block>
          <block name="go too far">
            <go wp="too far"/>
            <circle wp="too far" radius="50"/>
          </block>
        </blocks>
      </flight_plan>
      <airframe name="Microjet7 Tiny 1.1">
        <servos>
          <servo name="GAZ" no="0" min="1000" neutral="1000" max="2000"/>
          <servo name="AILEVON_LEFT" no="3" max="1150" neutral="1520" min="1950"/>
          <servo name="AILEVON_RIGHT" no="6" max="1900" neutral="1460" min="1050"/>
          <servo name="HATCH" no="2" max="2000" neutral="1000" min="1000"/>
        </servos>
        <commands>
          <axis name="THROTTLE" failsafe_value="0"/>
          <axis name="ROLL" failsafe_value="0"/>
          <axis name="PITCH" failsafe_value="0"/>
          <axis name="HATCH" failsafe_value="0"/>
        </commands>
        <rc_commands>
          <set command="THROTTLE" value="@THROTTLE"/>
          <set command="ROLL" value="@ROLL"/>
          <set command="PITCH" value="@PITCH"/>
          <set command="HATCH" value="@GAIN1"/>
        </rc_commands>
        <section name="MIXER">
          <define name="AILEVON_AILERON_RATE" value="0.3"/>
          <define name="AILEVON_ELEVATOR_RATE" value="0.7"/>
        </section>
        <command_laws>
          <let var="aileron" value="@ROLL  * AILEVON_AILERON_RATE"/>
          <let var="elevator" value="@PITCH * AILEVON_ELEVATOR_RATE"/>
          <set servo="GAZ" value="@THROTTLE"/>
          <set servo="AILEVON_LEFT" value="$elevator + $aileron"/>
          <set servo="AILEVON_RIGHT" value="$elevator - $aileron"/>
          <set servo="HATCH" value="@HATCH"/>
        </command_laws>
        <section name="AUTO1" prefix="AUTO1_">
          <define name="MAX_ROLL" value="0.6"/>
          <define name="MAX_PITCH" value="0.6"/>
        </section>
        <section name="adc" prefix="ADC_CHANNEL_">
          <define name="IR1" value="ADC_0"/>
          <define name="IR2" value="ADC_1"/>
          <define name="IR_TOP" value="ADC_6"/>
          <define name="IR_NB_SAMPLES" value="16"/>
          <define name="GYRO_ROLL" value="ADC_4"/>
          <define name="GYRO_TEMP" value="ADC_5"/>
          <define name="GYRO_NB_SAMPLES" value="16"/>
        </section>
        <section name="INFRARED" prefix="IR_">
          <define name="ROLL_NEUTRAL_DEFAULT" value="0" unit="deg"/>
          <define name="PITCH_NEUTRAL_DEFAULT" value="9" unit="deg"/>
          <define name="DEFAULT_CONTRAST" value="200"/>
          <define name="RAD_OF_IR_CONTRAST" value="0.75"/>
          <linear name="RollOfIrs" arity="2" coeff1="-0.7" coeff2="0.7"/>
          <linear name="PitchOfIrs" arity="2" coeff1="-0.7" coeff2="-0.7"/>
          <linear name="TopOfIr" arity="1" coeff1="1"/>
          <define name="RAD_OF_IR_MAX_VALUE" value="0.0045"/>
          <define name="RAD_OF_IR_MIN_VALUE" value="0.00075"/>
          <define name="ADC_ROLL_NEUTRAL" value="0"/>
          <define name="ADC_PITCH_NEUTRAL" value="-716"/>
          <define name="ADC_TOP_NEUTRAL" value="512"/>
          <define name="CORRECTION_UP" value="1."/>
          <define name="CORRECTION_DOWN" value="1."/>
          <define name="CORRECTION_LEFT" value="1."/>
          <define name="CORRECTION_RIGHT" value="1."/>
          <define name="ESTIMATED_PHI_PI_4" value="M_PI_4"/>
          <define name="ALLOW_INVERTED" value="0"/>
        </section>
        <section name="GYRO" prefix="GYRO_">
          <define name="ADC_ROLL_NEUTRAL" value="500"/>
          <define name="ADC_TEMP_NEUTRAL" value="476"/>
          <define name="ADC_TEMP_SLOPE" value="0"/>
          <define name="ROLL_SCALE" value="0.44"/>
          <define name="ROLL_DIRECTION" value="1."/>
        </section>
        <section name="BAT">
          <define name="MILLIAMP_PER_PERCENT" value="0.86"/>
          <define name="ADC_CHANNEL_VSUPPLY" value="AdcBank1(6)"/>
          <define name="VoltageOfAdc(adc)" value="(0.01787109375*adc)"/>
          <define name="LOW_BATTERY" value="9.3" unit="V"/>
        </section>
        <section name="MISC">
          <define name="NOMINAL_AIRSPEED" value="12." unit="m/s"/>
          <define name="CARROT" value="5." unit="s"/>
          <define name="KILL_MODE_DISTANCE" value="(1.5*MAX_DIST_FROM_HOME)"/>
          <define name="CONTROL_RATE" value="60" unit="Hz"/>
          <define name="XBEE_INIT" value="\"ATPL2\\rATRN1\\rATTT80\\r\""/>
        </section>
        <section name="VERTICAL CONTROL" prefix="V_CTL_">
          <define name="ALTITUDE_PGAIN" value="-0.03"/>
          <define name="ALTITUDE_MAX_CLIMB" value="2."/>
          <define name="AUTO_THROTTLE_CRUISE_THROTTLE" value="0.40"/>
          <define name="AUTO_THROTTLE_CLIMB_THROTTLE_INCREMENT" value="0.15" unit="%/(m/s)"/>
          <define name="AUTO_THROTTLE_PGAIN" value="-0.01"/>
          <define name="AUTO_THROTTLE_IGAIN" value="0.1"/>
          <define name="AUTO_THROTTLE_PITCH_OF_VZ_PGAIN" value="0.05"/>
          <define name="AUTO_PITCH_PGAIN" value="-0.05"/>
          <define name="AUTO_PITCH_IGAIN" value="0.075"/>
          <define name="AUTO_PITCH_MAX_PITCH" value="0.35"/>
          <define name="AUTO_PITCH_MIN_PITCH" value="-0.35"/>
          <define name="THROTTLE_SLEW" value="0.05"/>
        </section>
        <section name="HORIZONTAL CONTROL" prefix="H_CTL_">
          <define name="COURSE_PGAIN" value="-0.4"/>
          <define name="ROLL_MAX_SETPOINT" value="0.6" unit="radians"/>
          <define name="ROLL_PGAIN" value="5000."/>
          <define name="AILERON_OF_THROTTLE" value="0.0"/>
          <define name="PITCH_PGAIN" value="-8000."/>
          <define name="ELEVATOR_OF_ROLL" value="1250"/>
          <define name="ROLL_RATE_MODE_DEFAULT" value="1"/>
          <define name="ROLL_RATE_SETPOINT_PGAIN" value="-5." unit="rad/s/rad"/>
          <define name="ROLL_RATE_MAX_SETPOINT" value="10"/>
          <define name="ROLL_RATE_PGAIN" value="1000."/>
          <define name="ROLL_RATE_IGAIN" value="0."/>
          <define name="ROLL_RATE_DGAIN" value="0."/>
          <define name="ROLL_RATE_SUM_NB_SAMPLES" value="64"/>
        </section>
        <section name="NAV">
          <define name="NAV_PITCH" value="0."/>
        </section>
        <section name="AGGRESSIVE" prefix="AGR_">
          <define name="BLEND_START" value="20"/>
          <define name="BLEND_END" value="10"/>
          <define name="CLIMB_THROTTLE" value="0.95"/>
          <define name="CLIMB_PITCH" value="0.3"/>
          <define name="DESCENT_THROTTLE" value="0.1"/>
          <define name="DESCENT_PITCH" value="-0.25"/>
          <define name="CLIMB_NAV_RATIO" value="0.8"/>
          <define name="DESCENT_NAV_RATIO" value="1.0"/>
        </section>
        <section name="GYRO_GAINS">
          <define name="GYRO_MAX_RATE" value="200."/>
          <define name="ROLLRATESUM_NB_SAMPLES" value="64"/>
          <define name="ALT_ROLL__PGAIN" value="1.0"/>
          <define name="ROLL_RATE_PGAIN" value="1000.0"/>
          <define name="ROLL_RATE_IGAIN" value="0.0"/>
          <define name="ROLL_RATE_DGAIN" value="0.0"/>
        </section>
        <section name="FAILSAFE" prefix="FAILSAFE_">
          <define name="DELAY_WITHOUT_GPS" value="1" unit="s"/>
          <define name="DEFAULT_GAZ" value="0.3" unit="%"/>
          <define name="DEFAULT_ROLL" value="0.3" unit="rad"/>
          <define name="DEFAULT_PITCH" value="0.5" unit="rad"/>
          <define name="HOME_RADIUS" value="100" unit="m"/>
        </section>
        <section name="DATALINK" prefix="DATALINK_">
          <define name="DEVICE_TYPE" value="XBEE"/>
          <define name="DEVICE_ADDRESS" value="...."/>
        </section>
        <makefile>include $(PAPARAZZI_SRC)/conf/autopilot/tiny.makefile
FLASH_MODE=IAP
ap.CFLAGS +=  -DFBW -DAP -DCONFIG=\&quot;tiny_0_99.h\&quot; -DLED -DTIME_LED=1
ap.srcs = sys_time.c $(SRC_ARCH)/sys_time_hw.c $(SRC_ARCH)/armVIC.c main_fbw.c main_ap.c main.c
ap.srcs += commands.c
ap.CFLAGS += -DACTUATORS=\&quot;servos_4015_MAT_hw.h\&quot; -DSERVOS_4015_MAT
ap.srcs += $(SRC_ARCH)/servos_4015_MAT_hw.c actuators.c
ap.CFLAGS += -DRADIO_CONTROL -DRADIO_CONTROL_TYPE=RC_FUTABA
ap.srcs += radio_control.c $(SRC_ARCH)/ppm_hw.c  
#ap.CFLAGS += -DDOWNLINK -DUSE_UART0 -DDOWNLINK_TRANSPORT=XBeeTransport -DDOWNLINK_FBW_DEVICE=Uart0 -DDOWNLINK_AP_DEVICE=Uart0 -DXBEE_UART=Uart0 -DDATALINK=XBEE -DUART0_BAUD=B9600
#ap.srcs += downlink.c $(SRC_ARCH)/uart_hw.c datalink.c xbee.c
#TRANSPARENT
ap.CFLAGS += -DDOWNLINK -DUSE_UART0 -DDOWNLINK_TRANSPORT=PprzTransport -DDOWNLINK_FBW_DEVICE=Uart0 -DDOWNLINK_AP_DEVICE=Uart0 -DPPRZ_UART=Uart0 -DDATALINK=PPRZ -DUART0_BAUD=B9600
#TRANSPARENT 
ap.srcs += downlink.c $(SRC_ARCH)/uart_hw.c datalink.c pprz_transport.c
ap.CFLAGS += -DINTER_MCU
ap.srcs += inter_mcu.c 
ap.CFLAGS += -DADC -DUSE_ADC_0 -DUSE_ADC_1 -DUSE_ADC_4 -DUSE_ADC_5 -DUSE_ADC_6
ap.srcs += $(SRC_ARCH)/adc_hw.c
ap.CFLAGS += -DGPS -DUBX -DUSE_UART1 -DGPS_LINK=Uart1 -DUART1_BAUD=B19200
ap.srcs += gps_ubx.c gps.c
ap.CFLAGS += -DINFRARED 
ap.srcs += infrared.c estimator.c
ap.CFLAGS += -DNAV -DH_CTL_RATE_LOOP -DAGR_CLIMB
ap.srcs += nav.c fw_h_ctl.c fw_v_ctl.c
ap.CFLAGS += -DGYRO -DADXRS150
ap.srcs += gyro.c
#ap.srcs += bomb.c
# Harware In The Loop
#ap.CFLAGS += -DHITL
# Config for SITL simulation
include $(PAPARAZZI_SRC)/conf/autopilot/sitl.makefile
sim.CFLAGS += -DCONFIG=\&quot;tiny.h\&quot; -DAGR_CLIMB -DH_CTL_RATE_LOOP
#sim.srcs += bomb.c
# a test program to setup actuators 
setup_actuators.ARCHDIR = $(ARCHI)
setup_actuators.ARCH = arm7tdmi
setup_actuators.TARGET = setup_actuators
setup_actuators.TARGETDIR = setup_actuators
setup_actuators.CFLAGS += -DFBW -DCONFIG=\&quot;tiny.h\&quot; -DLED -DTIME_LED=1 -DACTUATORS=\&quot;servos_4015_hw.h\&quot; -DSERVOS_4015 -DUSE_UART0 -DUART0_BAUD=B9600 -DDATALINK=PPRZ -DPPRZ_UART=Uart0
setup_actuators.srcs += sys_time.c $(SRC_ARCH)/sys_time_hw.c $(SRC_ARCH)/armVIC.c pprz_transport.c setup_actuators.c $(SRC_ARCH)/uart_hw.c $(SRC_ARCH)/servos_4015_hw.c main.c
# a test program to tunnel between both uart
tunnel.ARCHDIR = $(ARCHI)
tunnel.ARCH = arm7tdmi
tunnel.TARGET = tunnel
tunnel.TARGETDIR = tunnel
tunnel.CFLAGS += -DFBW -DCONFIG=\&quot;tiny.h\&quot; -DLED -DTIME_LED=1
tunnel.srcs += $(SRC_ARCH)/uart_tunnel.c</makefile>
      </airframe>
      <radio name="T9cap" data_min="900" data_max="2100" sync_min="5000" sync_max="15000">
        <channel ctl="right_stick_horiz" function="ROLL" min="1939" neutral="1525" max="1114" average="0"/>
        <channel ctl="right_stick_vert" function="PITCH" min="1112" neutral="1518" max="1937" average="0"/>
        <channel ctl="left_stick_vert" function="THROTTLE" min="1940" neutral="1940" max="1115" average="0"/>
        <channel ctl="left_stick_horiz" function="YAW" min="1940" neutral="1498" max="1115" average="0"/>
        <channel ctl="switch_G" function="CALIB" min="2080" neutral="1525" max="969" average="10"/>
        <channel ctl="VRA" function="GAIN1" min="970" neutral="1520" max="2078" average="10"/>
        <channel ctl="VRC" function="GAIN2" min="970" neutral="1518" max="2077" average="10"/>
        <channel ctl="switch_C" function="MODE" min="2079" neutral="1526" max="966" average="10"/>
      </radio>
    </aircraft>
    <aircraft name="TJ1" ac_id="6" airframe="airframes/twinjet1.xml" radio="radios/cockpitMM.xml" telemetry="telemetry/default.xml" flight_plan="flight_plans/versatile.xml" settings="settings/tuning.xml" gui_color="#ba6293">
      <flight_plan ground_alt="200" alt="250" lat0="43.46223" lon0="1.27289" max_dist_from_home="1000" name="Versatile" qfu="270" security_height="25">
        <header>#include &quot;bomb.h&quot;</header>
        <waypoints>
          <waypoint name="HOME" x="0" y="0"/>
          <waypoint name="1" x="200" y="0"/>
          <waypoint name="2" x="0" y="200"/>
          <waypoint name="MOB" x="200" y="200"/>
          <waypoint name="S1" x="-200" y="-200"/>
          <waypoint name="S2" x="300" y="400"/>
        </waypoints>
        <blocks>
          <block name="wait GPS">
            <while cond="!GpsFixValid()"/>
          </block>
          <block name="init">
            <while cond="LessThan(NavBlockTime(), 10)"/>
            <call fun="NavSetGroundReferenceHere()"/>
            <deroute block="circle 1"/>
          </block>
          <block name="circle 1">
            <circle radius="75" wp="1"/>
          </block>
          <block name="eight 1">
            <eight radius="75" center="1" turn_around="2"/>
          </block>
          <block name="oval" strip_button="Oval">
            <oval p1="1" p2="2" radius="80"/>
          </block>
          <block name="MOB" strip_button="MOB">
            <call fun="NavSetWaypointHere(WP_MOB)"/>
            <circle wp="MOB" radius="100"/>
          </block>
          <block name="circle 1 auto pitch">
            <circle radius="75" wp="1" pitch="auto" throttle="0.7"/>
          </block>
          <block name="circle left 1">
            <circle radius="-75" wp="1"/>
          </block>
          <block name="climb 75">
            <circle radius="50+(estimator_z-ground_alt)/2" wp="1" throttle="0.75" pitch="0.3" vmode="throttle" until="10 > PowerVoltage()"/>
          </block>
          <block name="climb 1">
            <circle radius="50+(estimator_z-ground_alt)/2" wp="1" climb="1" pitch="0.1" vmode="climb" until="10 > PowerVoltage()"/>
          </block>
          <block name="descent 0" strip_button="Descent">
            <circle radius="50+(estimator_z-ground_alt)/2" wp="1" throttle="0.0" pitch="-0.3" vmode="throttle" until="ground_alt+50 > estimator_z"/>
            <deroute block="circle 1"/>
          </block>
          <block name="route12">
            <go approaching_time="0" from="1" hmode="route" wp="2"/>
          </block>
          <block name="glide12">
            <go from="1" hmode="route" vmode="glide" wp="2"/>
          </block>
          <block name="stack 2">
            <circle radius="75" wp="2"/>
          </block>
          <block name="route21">
            <go approaching_time="0" from="2" hmode="route" wp="1"/>
          </block>
          <block name="stack 1">
            <circle radius="75" wp="1"/>
          </block>
          <block name="survey">
            <survey_rectangle grid="150" wp1="S1" wp2="S2"/>
          </block>
        </blocks>
      </flight_plan>
      <airframe NAME="Twinjet">
        <servos>
          <servo NEUTRAL="1000" MAX="2000" NAME="GAZ" NO="0" MIN="1000"/>
          <servo NEUTRAL="1652" MAX="2100" NAME="AILEVON_RIGHT" NO="1" MIN="1230"/>
          <servo NEUTRAL="1750" MAX="1300" NAME="AILEVON_LEFT" NO="2" MIN="2120"/>
          <servo NEUTRAL="1100" MAX="1700" NAME="HATCH" NO="3" MIN="1100"/>
        </servos>
        <commands>
          <axis NAME="THROTTLE" FAILSAFE_VALUE="0"/>
          <axis NAME="ROLL" FAILSAFE_VALUE="0"/>
          <axis NAME="PITCH" FAILSAFE_VALUE="0"/>
          <axis NAME="HATCH" FAILSAFE_VALUE="0"/>
        </commands>
        <rc_commands>
          <set COMMAND="THROTTLE" VALUE="@THROTTLE"/>
          <set COMMAND="ROLL" VALUE="@ROLL"/>
          <set COMMAND="PITCH" VALUE="@PITCH"/>
          <set COMMAND="HATCH" VALUE="@GAIN1"/>
        </rc_commands>
        <section NAME="MIXER">
          <define NAME="AILEVON_AILERON_RATE" VALUE="0.75"/>
          <define NAME="AILEVON_ELEVATOR_RATE" VALUE="1.00"/>
        </section>
        <command_laws>
          <set VALUE="@THROTTLE" SERVO="GAZ"/>
          <set VALUE="@HATCH" SERVO="HATCH"/>
          <let VAR="aileron" VALUE="@ROLL * AILEVON_AILERON_RATE"/>
          <let VAR="elevator" VALUE="@PITCH * AILEVON_ELEVATOR_RATE"/>
          <set VALUE="$aileron + $elevator" SERVO="AILEVON_LEFT"/>
          <set VALUE="-$aileron + $elevator" SERVO="AILEVON_RIGHT"/>
        </command_laws>
        <section NAME="AUTO1" PREFIX="AUTO1_">
          <define NAME="MAX_ROLL" VALUE="0.6"/>
          <define NAME="MAX_PITCH" VALUE="0.6"/>
        </section>
        <section NAME="adc" PREFIX="ADC_CHANNEL_">
          <define NAME="IR1" VALUE="AdcBank0(1)"/>
          <define NAME="IR2" VALUE="AdcBank0(2)"/>
          <define NAME="IR_TOP" VALUE="AdcBank0(3)"/>
          <define NAME="GYRO_ROLL" VALUE="AdcBank1(2)"/>
          <define NAME="GYRO_TEMP" VALUE="AdcBank1(3)"/>
          <define NAME="IR_NB_SAMPLES" VALUE="16"/>
          <define NAME="GYRO_NB_SAMPLES" VALUE="16"/>
          <define NAME="VSUPPLY" VALUE="AdcBank0(6)"/>
        </section>
        <section NAME="INFRARED" PREFIX="IR_">
          <define UNIT="deg" NAME="ROLL_NEUTRAL_DEFAULT" VALUE="0"/>
          <define UNIT="deg" NAME="PITCH_NEUTRAL_DEFAULT" VALUE="-1"/>
          <define NAME="DEFAULT_CONTRAST" VALUE="200"/>
          <define NAME="RAD_OF_IR_CONTRAST" VALUE="0.5"/>
          <linear COEFF1="0" NAME="RollOfIrs" ARITY="2" COEFF2="-1"/>
          <linear COEFF1="-1" NAME="PitchOfIrs" ARITY="2" COEFF2="0"/>
          <linear COEFF1="1" NAME="TopOfIr" ARITY="1"/>
          <define NAME="RAD_OF_IR_MAX_VALUE" VALUE="0.0045"/>
          <define NAME="RAD_OF_IR_MIN_VALUE" VALUE="0.00075"/>
          <define NAME="ADC_ROLL_NEUTRAL" VALUE="-512"/>
          <define NAME="ADC_PITCH_NEUTRAL" VALUE="-512"/>
          <define NAME="ADC_TOP_NEUTRAL" VALUE="512"/>
        </section>
        <section NAME="GYRO" PREFIX="GYRO_">
          <define NAME="ADC_ROLL_NEUTRAL" VALUE="316"/>
          <define NAME="ADC_TEMP_NEUTRAL" VALUE="328"/>
          <define NAME="ADC_TEMP_SLOPE" VALUE="-0.36"/>
          <define NAME="ROLL_DIRECTION" VALUE="1."/>
          <define NAME="ROLL_SCALE" VALUE="0.44"/>
        </section>
        <section NAME="PID">
          <define NAME="ROLL_PGAIN" VALUE="5000."/>
          <define NAME="PITCH_OF_ROLL" VALUE="0.0"/>
          <define NAME="PITCH_PGAIN" VALUE="8000."/>
          <define NAME="MAX_ROLL" VALUE="0.35"/>
          <define NAME="MAX_PITCH" VALUE="0.35"/>
          <define NAME="MIN_PITCH" VALUE="-0.35"/>
          <define NAME="AILERON_OF_GAZ" VALUE="0.0"/>
          <define NAME="CRUISE_THROTTLE" VALUE="0.30"/>
        </section>
        <section NAME="GYRO">
          <define NAME="GYRO_MAX_RATE" VALUE="150."/>
          <define NAME="ROLLRATESUM_NB_SAMPLES" VALUE="60"/>
          <define NAME="ALT_ROLL_PGAIN" VALUE="100.0"/>
          <define NAME="ROLL_RATE_PGAIN" VALUE="45.0"/>
          <define NAME="ROLL_RATE_IGAIN" VALUE="0.0"/>
          <define NAME="ROLL_RATE_DGAIN" VALUE="0.0"/>
        </section>
        <section NAME="ALT" PREFIX="CLIMB_">
          <define NAME="PITCH_PGAIN" VALUE="-0.1"/>
          <define NAME="PITCH_IGAIN" VALUE="0.025"/>
          <define NAME="PGAIN" VALUE="-0.01"/>
          <define NAME="IGAIN" VALUE="0.1"/>
          <define NAME="MAX" VALUE="1."/>
          <define NAME="PITCH_OF_VZ_PGAIN" VALUE="0.05"/>
          <define UNIT="%/(m/s)" NAME="GAZ_OF_CLIMB" VALUE="0.2"/>
          <define UNIT="%" NAME="MAX_DIFF_GAZ" VALUE="0.05"/>
        </section>
        <section NAME="HORIZONTAL CONTROL" PREFIX="H_CTL_">
          <define NAME="COURSE_PGAIN" VALUE="-0.9"/>
          <define NAME="COURSE_PRE_BANK_CORRECTION" VALUE="1."/>
          <define UNIT="radians" NAME="ROLL_MAX_SETPOINT" VALUE="0.73"/>
          <define UNIT="radians" NAME="PITCH_MAX_SETPOINT" VALUE="0.5"/>
          <define UNIT="radians" NAME="PITCH_MIN_SETPOINT" VALUE="-0.5"/>
          <define NAME="ROLL_PGAIN" VALUE="10000."/>
          <define NAME="AILERON_OF_THROTTLE" VALUE="0.0"/>
          <define NAME="PITCH_PGAIN" VALUE="-6000."/>
          <define NAME="PITCH_DGAIN" VALUE="0."/>
          <define NAME="ELEVATOR_OF_ROLL" VALUE="0"/>
          <define NAME="ROLL_RATE_MODE_DEFAULT" VALUE="1"/>
          <define NAME="ROLL_RATE_SETPOINT_PGAIN" VALUE="-5.5"/>
          <define NAME="ROLL_RATE_MAX_SETPOINT" VALUE="10"/>
          <define NAME="LO_THROTTLE_ROLL_RATE_PGAIN" VALUE="1500."/>
          <define NAME="HI_THROTTLE_ROLL_RATE_PGAIN" VALUE="900."/>
          <define NAME="ROLL_RATE_IGAIN" VALUE="0."/>
          <define NAME="ROLL_RATE_DGAIN" VALUE="0."/>
          <define NAME="ROLL_RATE_SUM_NB_SAMPLES" VALUE="64"/>
        </section>
        <section NAME="VERTICAL CONTROL" PREFIX="V_CTL_">
          <define NAME="ALTITUDE_PGAIN" VALUE="-0.05"/>
          <define NAME="ALTITUDE_MAX_CLIMB" VALUE="3."/>
          <define NAME="AUTO_THROTTLE_NOMINAL_CRUISE_THROTTLE" VALUE="0.60"/>
          <define NAME="AUTO_THROTTLE_MIN_CRUISE_THROTTLE" VALUE=".45"/>
          <define NAME="AUTO_THROTTLE_MAX_CRUISE_THROTTLE" VALUE="1"/>
          <define NAME="AUTO_THROTTLE_LOITER_TRIM" VALUE="2000"/>
          <define NAME="AUTO_THROTTLE_DASH_TRIM" VALUE="-1500"/>
          <define UNIT="%/(m/s)" NAME="AUTO_THROTTLE_CLIMB_THROTTLE_INCREMENT" VALUE="0.15"/>
          <define NAME="AUTO_THROTTLE_PGAIN" VALUE="-0.008"/>
          <define NAME="AUTO_THROTTLE_IGAIN" VALUE="0.25"/>
          <define NAME="AUTO_THROTTLE_PITCH_OF_VZ_PGAIN" VALUE="0.14"/>
          <define NAME="AUTO_PITCH_PGAIN" VALUE="-0.1"/>
          <define NAME="AUTO_PITCH_IGAIN" VALUE="0.025"/>
          <define NAME="AUTO_PITCH_MAX_PITCH" VALUE="0.5"/>
          <define NAME="AUTO_PITCH_MIN_PITCH" VALUE="-0.5"/>
          <define NAME="THROTTLE_SLEW" VALUE="0.05"/>
        </section>
        <section NAME="NAV">
          <define NAME="NAV_PITCH" VALUE="0."/>
          <define NAME="NAV_GLIDE_PITCH_TRIM" VALUE="0"/>
        </section>
        <section NAME="BAT">
          <define NAME="MILLIAMP_PER_PERCENT" VALUE="0.86"/>
          <define NAME="VOLTAGE_ADC_A" VALUE="0.0156"/>
          <define NAME="VOLTAGE_ADC_B" VALUE="-0.029"/>
          <define NAME="VoltageOfAdc(adc)" VALUE="(VOLTAGE_ADC_A * adc + VOLTAGE_ADC_B)"/>
          <define UNIT="V" NAME="LOW_BATTERY" VALUE="9.3"/>
        </section>
        <section NAME="MISC">
          <define UNIT="m/s" NAME="NOMINAL_AIRSPEED" VALUE="12."/>
          <define UNIT="s" NAME="CARROT" VALUE="5."/>
          <define UNIT="s" NAME="KILL_MODE_DISTANCE" VALUE="(MAX_DIST_FROM_HOME*1.5)"/>
          <define NAME="LIGHT_PIN_1" VALUE="3"/>
        </section>
        <section NAME="SIMU">
          <define NAME="WEIGHT" VALUE="1."/>
          <define NAME="YAW_RESPONSE_FACTOR" VALUE="0.5"/>
        </section>
        <section NAME="FAILSAFE" PREFIX="FAILSAFE_">
          <define UNIT="s" NAME="DELAY_WITHOUT_GPS" VALUE="2"/>
          <define UNIT="%" NAME="DEFAULT_THROTTLE" VALUE="CRUISE_THROTTLE+0.05"/>
          <define UNIT="rad" NAME="DEFAULT_ROLL" VALUE="0.17"/>
          <define UNIT="rad" NAME="DEFAULT_PITCH" VALUE="0.08"/>
          <define UNIT="m" NAME="HOME_RADIUS" VALUE="50"/>
        </section>
        <section NAME="AGGRESSIVE" PREFIX="AGR_">
          <define NAME="CLIMB_THROTTLE" VALUE="0.65"/>
          <define NAME="DESCENT_THROTTLE" VALUE="0.1"/>
          <define NAME="CLIMB_PITCH" VALUE="0.2"/>
          <define NAME="DESCENT_PITCH" VALUE="-0.25"/>
          <define NAME="BLEND_START" VALUE="20"/>
          <define NAME="BLEND_END" VALUE="10"/>
          <define NAME="CLIMB_NAV_RATIO" VALUE="0.8"/>
          <define NAME="DESCENT_NAV_RATIO" VALUE="1.0"/>
        </section>
        <section NAME="DATALINK" PREFIX="DATALINK_">
          <define NAME="DEVICE_TYPE" VALUE="XBEE"/>
          <define NAME="DEVICE_ADDRESS" VALUE="...."/>
        </section>
        <makefile>include $(PAPARAZZI_SRC)/conf/autopilot/classix.makefile
# FLASH_MODE=ISP
FLASH_MODE=IAP
fbw.CFLAGS += -DFBW -DCONFIG=\&quot;classix.h\&quot; -DLED -DTIME_LED=1
fbw.srcs = sys_time.c $(SRC_ARCH)/sys_time_hw.c $(SRC_ARCH)/armVIC.c main_fbw.c main.c
fbw.srcs += commands.c
fbw.CFLAGS += -DACTUATORS=\&quot;servos_4017_hw.h\&quot; -DSERVOS_4017 -DSERVOS_4017_CLOCK_FALLING
fbw.srcs += $(SRC_ARCH)/servos_4017_hw.c actuators.c
fbw.CFLAGS += -DRADIO_CONTROL -DRADIO_CONTROL_TYPE=RC_FUTABA
fbw.srcs += radio_control.c $(SRC_ARCH)/ppm_hw.c 
fbw.CFLAGS += -DDOWNLINK -DUSE_UART0 -DDOWNLINK_TRANSPORT=PprzTransport -DDOWNLINK_FBW_DEVICE=Uart0 -DUART0_BAUD=B9600
fbw.srcs += downlink.c pprz_transport.c $(SRC_ARCH)/uart_hw.c
fbw.CFLAGS += -DINTER_MCU -DMCU_SPI_LINK -DUSE_SPI -DSPI_SLAVE
fbw.srcs += inter_mcu.c link_mcu.c spi.c $(SRC_ARCH)/spi_hw.c
fbw.CFLAGS += -DADC -DUSE_AD0
fbw.srcs += $(SRC_ARCH)/adc_hw.c
ap.CFLAGS += -DAP -DCONFIG=\&quot;classix.h\&quot; -DLED -DTIME_LED=2
ap.srcs = sys_time.c $(SRC_ARCH)/sys_time_hw.c $(SRC_ARCH)/armVIC.c main_ap.c main.c
ap.CFLAGS += -DDOWNLINK -DUSE_UART0 -DDOWNLINK_TRANSPORT=XBeeTransport -DDOWNLINK_AP_DEVICE=Uart0 -DXBEE_UART=Uart0 -DDATALINK=XBEE -DUART0_BAUD=B9600
ap.srcs += downlink.c $(SRC_ARCH)/uart_hw.c datalink.c traffic_info.c xbee.c
ap.CFLAGS += -DINTER_MCU -DMCU_SPI_LINK -DUSE_SPI -DSPI_MASTER
ap.srcs += inter_mcu.c link_mcu.c spi.c $(SRC_ARCH)/spi_hw.c
ap.CFLAGS += -DGPS -DUBX -DUSE_UART1 -DGPS_LINK=Uart1 -DUART1_BAUD=B38400
ap.srcs += gps_ubx.c gps.c
# ADCs for infrared
ap.CFLAGS += -DADC -DUSE_AD0 -DUSE_AD0_1 -DUSE_AD0_2 -DUSE_AD0_3
# ADCs for gyro
ap.CFLAGS += -DUSE_AD1 -DUSE_AD1_2 -DUSE_AD1_3
ap.srcs += $(SRC_ARCH)/adc_hw.c
ap.CFLAGS += -DINFRARED 
ap.srcs += infrared.c estimator.c
ap.CFLAGS += -DGYRO -DADXRS150 -DPID_RATE_LOOP 
ap.srcs += gyro.c
ap.CFLAGS += -DNAV -DAGR_CLIMB -DLOITER_TRIM
ap.srcs += nav.c pid.c
ap.srcs += bomb3.c
test.CFLAGS += -DFBW -DCONFIG=\&quot;classix.h\&quot; -DLED -DTIME_LED=1 -DACTUATORS=\&quot;servos_4017_hw.h\&quot; -DSERVOS_4017 -DSERVOS_4017_CLOCK_FALLING  -DUSE_UART0 -DDATALINK -DPPRZ_INPUT -DPPRZ_UART=Uart0 -DUART0_BAUD=B9600
test.srcs += sys_time.c $(SRC_ARCH)/sys_time_hw.c $(SRC_ARCH)/armVIC.c pprz_transport.c setup_actuators.c $(SRC_ARCH)/uart_hw.c $(SRC_ARCH)/servos_4017_hw.c main.c
# Config for SITL simulation
include $(PAPARAZZI_SRC)/conf/autopilot/sitl.makefile
sim.CFLAGS += -DCONFIG=\&quot;classix.h\&quot; -DAGR_CLIMB -DLOITER_TRIM
sim.srcs += traffic_info.c</makefile>
      </airframe>
      <radio name="cockpitMM" data_min="900" data_max="2100" sync_min="5000" sync_max="15000">
        <channel ctl="D" function="ROLL" min="2000" neutral="1498" max="1000" average="0"/>
        <channel ctl="C" function="PITCH" min="2000" neutral="1498" max="1000" average="0"/>
        <channel ctl="B" function="YAW" min="2000" neutral="1498" max="1000" average="0"/>
        <channel ctl="A" function="THROTTLE" min="1120" neutral="1120" max="2000" average="0"/>
        <channel ctl="G" function="GAIN1" min="2000" neutral="1498" max="1000" average="1"/>
        <channel ctl="E" function="MODE" min="2000" neutral="1500" max="1000" average="1"/>
        <channel ctl="F" function="CALIB" min="2000" neutral="1500" max="1000" average="1"/>
      </radio>
    </aircraft>
  </conf>
  <protocol>
    <class name="telemetry">
      <message name="BOOT" id="1">
        <field name="version" type="uint16"/>
      </message>
      <message name="CALIB_START" ID="2"/>
      <message name="CALIB_CONTRAST" ID="3">
        <field name="adc" type="int16"/>
      </message>
      <message name="TAKEOFF" ID="4">
        <field name="cpu_time" type="uint16" unit="s"/>
      </message>
      <message name="RAD_OF_IR" ID="5">
        <field name="ir" type="int16"/>
        <field name="rad" type="int16" unit="decideg"/>
        <field name="rad_of_ir" type="float" format="%.5f"/>
      </message>
      <message name="ATTITUDE" ID="6">
        <field name="phi" type="int16" unit="deg"/>
        <field name="psi" type="int16" unit="deg"/>
        <field name="theta" type="int16" unit="deg"/>
      </message>
      <message name="IR_SENSORS" ID="7">
        <field name="longitudinal" type="int16"/>
        <field name="lateral" type="int16"/>
        <field name="vertical" type="int16"/>
      </message>
      <message name="GPS" ID="8">
        <field name="mode" type="uint8" unit="byte_mask"/>
        <field name="utm_east" type="int32" unit="cm"/>
        <field name="utm_north" type="int32" unit="cm"/>
        <field name="course" type="int16" unit="decideg"/>
        <field name="alt" type="int32" unit="cm"/>
        <field name="speed" type="uint16" unit="cm/s"/>
        <field name="climb" type="int16" unit="cm/s"/>
        <field name="itow" type="uint32" unit="ms"/>
        <field name="utm_zone" type="uint8"/>
        <field name="gps_nb_err" type="uint8"/>
      </message>
      <message name="NAVIGATION_REF" ID="0x09">
        <field name="utm_east" type="int32" unit="m"/>
        <field name="utm_north" type="int32" unit="m"/>
        <field name="utm_zone" type="uint8"/>
      </message>
      <message name="NAVIGATION" ID="10">
        <field name="cur_block" type="uint8"/>
        <field name="cur_stage" type="uint8"/>
        <field name="pos_x" type="int16" unit="m"/>
        <field name="pos_y" type="int16" unit="m"/>
        <field name="desired_course" type="int16" unit="decideg"/>
        <field name="dist2_wp" type="float" format="%.1f" unit="m^2"/>
        <field name="dist2_home" type="float" format="%.1f" unit="m^2"/>
      </message>
      <message name="PPRZ_MODE" ID="11">
        <field name="ap_mode" type="uint8" values="MANUAL|AUTO1|AUTO2|HOME|NOGPS|FAILSAFE"/>
        <field name="ap_gaz" type="uint8" values="MANUAL|AUTO_THROTTLE|AUTO_CLIMB|AUTO_ALT"/>
        <field name="ap_lateral" type="uint8" values="MANUAL|ROLL_RATE|ROLL|COURSE"/>
        <field name="ap_horizontal" type="uint8" values="WAYPOINT|ROUTE|CIRCLE"/>
        <field name="if_calib_mode" type="uint8" values="NONE|DOWN|UP"/>
        <field name="mcu1_status" type="uint8" values="LOST|OK|REALLY_LOST"/>
        <field name="lls_calib" type="uint8" values="LLS_CALIB_MODE_OFF|LLS_CALIB_MODE_ON"/>
      </message>
      <message name="BAT" ID="12">
        <field name="throttle" type="int16" unit="pprz"/>
        <field name="voltage" type="uint8" unit="1e-1V"/>
        <field name="flight_time" type="uint16" unit="s"/>
        <field name="kill_auto_throttle" type="uint8" unit="bool"/>
        <field name="block_time" type="uint16" unit="s"/>
        <field name="stage_time" type="uint16" unit="s"/>
        <field name="energy" type="uint16" unit="mAh"/>
      </message>
      <message name="DEBUG_MCU_LINK" ID="13">
        <field name="i2c_nb_err" type="uint8"/>
        <field name="i2c_mcu1_nb_err" type="uint8"/>
        <field name="ppm_rate" type="uint8"/>
      </message>
      <message name="CALIBRATION" ID="14">
        <field name="climb_sum_err" type="float" format="%.3f"/>
        <field name="climb_pgain" type="float" format="%.3f"/>
        <field name="course_pgain" type="float" format="%.3f"/>
        <field name="climb_gaz_submode" type="uint8"/>
      </message>
      <message name="SETTINGS" ID="15">
        <field name="slider_1_val" type="float"/>
        <field name="slider_2_val" type="float"/>
      </message>
      <message name="DESIRED" ID="16">
        <field name="roll" type="float" format="%.2f"/>
        <field name="pitch" type="float" format="%.2f"/>
        <field name="desired_x" type="float" format="%.0f"/>
        <field name="desired_y" type="float" format="%.0f"/>
        <field name="desired_altitude" type="float" format="%.3f"/>
        <field name="desired_climb" type="float" format="%.3f"/>
      </message>
      <message name="ENOSE_STATUS" ID="17">
        <field name="Sensor1" type="uint16"/>
        <field name="Sensor2" type="uint16"/>
        <field name="Sensor3" type="uint16"/>
        <field name="FCG1" type="float"/>
        <field name="FCG2" type="float"/>
        <field name="FCG3" type="float"/>
        <field name="Heat_Setting" type="uint8"/>
      </message>
      <message name="CAM" ID="20">
        <field name="phi" type="int8" unit="deg"/>
        <field name="theta" type="int8" unit="deg"/>
        <field name="target_x" type="int16" unit="m"/>
        <field name="target_y" type="int16" unit="m"/>
      </message>
      <message name="CIRCLE" ID="21">
        <field name="center_east" type="int16" unit="m"/>
        <field name="center_north" type="int16" unit="m"/>
        <field name="radius" type="int16" unit="m"/>
      </message>
      <message name="SEGMENT" ID="22">
        <field name="segment_east_1" type="int16" unit="m"/>
        <field name="segment_north_1" type="int16" unit="m"/>
        <field name="segment_east_2" type="int16" unit="m"/>
        <field name="segment_north_2" type="int16" unit="m"/>
      </message>
      <message name="DOWNLINK_STATUS" ID="23">
        <field name="run_time" type="uint32" unit="s"/>
        <field name="rx_bytes" type="uint32"/>
        <field name="rx_msgs" type="uint32"/>
        <field name="rx_err" type="uint32"/>
        <field name="rx_bytes_rate" type="float" format="%.1f"/>
        <field name="rx_msgs_rate" type="float" format="%.1f"/>
      </message>
      <message name="MODEM_STATUS" ID="24">
        <field name="detected" type="uint8"/>
        <field name="valim" type="float" format="%.1f"/>
        <field name="cd" type="uint8"/>
        <field name="nb_byte" type="uint32"/>
        <field name="nb_msg" type="uint32"/>
        <field name="nb_err" type="uint32"/>
      </message>
      <message name="SVINFO" id="25">
        <field name="chn" type="uint8"/>
        <field name="SVID" type="uint8"/>
        <field name="Flags" type="uint8"/>
        <field name="QI" type="int8"/>
        <field name="CNO" type="uint8" unit="dbHz"/>
        <field name="Elev" type="int8" unit="deg"/>
        <field name="Azim" type="int16" unit="deg"/>
      </message>
      <message name="SURVEY" ID="27">
        <field name="east" type="float" unit="m"/>
        <field name="north" type="float" unit="m"/>
        <field name="west" type="float" unit="m"/>
        <field name="south" type="float" unit="m"/>
      </message>
      <message name="WC_RSSI" id="28">
        <field name="raw_level" type="uint8"/>
      </message>
      <message name="RANGEFINDER" id="29">
        <field name="range" type="uint16" unit="cm"/>
        <field name="z_dot" type="float" unit="m/s"/>
        <field name="z_dot_sum_err" type="float" unit="m/s"/>
        <field name="z_dot_setpoint" type="float" unit="m/s"/>
        <field name="z_sum_err" type="float" unit="m/s"/>
        <field name="z_setpoint" type="float" unit="m"/>
        <field name="flying" type="uint8" unit="bool"/>
      </message>
      <message name="DEBUG_MODEM" id="30">
        <field name="modem_nb_err" type="uint8"/>
      </message>
      <message name="DL_VALUE" id="31">
        <field name="index" type="uint8"/>
        <field name="value" type="float"/>
      </message>
      <message name="MARK" id="32">
        <field name="ac_id" type="uint8"/>
        <field name="lat" type="float" unit="deg"/>
        <field name="long" type="float" unit="deg"/>
      </message>
      <message name="DEBUG1" id="33">
        <field name="xxx" type="uint8"/>
        <field name="foo" type="uint8[]"/>
      </message>
      <message name="DEBUG2" id="34">
        <field name="foo" type="uint8[]"/>
      </message>
      <message name="WP_MOVED" id="35">
        <field name="wp_id" type="uint8"/>
        <field name="utm_east" type="float" unit="m"/>
        <field name="utm_north" type="float" unit="m"/>
        <field name="alt" type="float" unit="m"/>
      </message>
      <message name="GYRO_RATES" id="36">
        <field name="roll_adc" type="int16"/>
        <field name="pitch_adc" type="int16"/>
        <field name="yaw_adc" type="int16"/>
        <field name="roll" type="float" unit="rad/s"/>
        <field name="pitch" type="float" unit="rad/s"/>
        <field name="yaw" type="float" unit="rad/s"/>
      </message>
      <message name="GRZ_MEASURE" id="37">
        <field name="roll_dot" type="float" unit="rad/s"/>
        <field name="pitch_dot" type="float" unit="rad/s"/>
        <field name="yaw_dot" type="float" unit="rad/s"/>
        <field name="roll" type="float" unit="rad"/>
        <field name="pitch" type="float" unit="rad"/>
        <field name="yaw" type="float" unit="rad"/>
      </message>
      <message name="GRZ_RATE_LOOP" id="38">
        <field name="roll_dot_meas" type="float" unit="rad"/>
        <field name="roll_dot_sp" type="float" unit="rad"/>
        <field name="pitch_dot_meas" type="float" unit="rad"/>
        <field name="pitch_dot_sp" type="float" unit="rad"/>
        <field name="yaw_dot_meas" type="float" unit="rad"/>
        <field name="yaw_dot_sp" type="float" unit="rad"/>
      </message>
      <message name="GRZ_ATTITUDE_LOOP" id="39">
        <field name="roll_meas" type="float" unit="rad"/>
        <field name="roll_sp" type="float" unit="rad"/>
        <field name="pitch_meas" type="float" unit="rad"/>
        <field name="pitch_sp" type="float" unit="rad"/>
        <field name="yaw_meas" type="float" unit="rad"/>
        <field name="yaw_sp" type="float" unit="rad"/>
      </message>
      <message name="SPEED_LOOP" id="40">
        <field name="ve_set_point" type="float" unit="m/s"/>
        <field name="ve" type="float" unit="m/s"/>
        <field name="vn_set_point" type="float" unit="m/s"/>
        <field name="vn" type="float" unit="m/s"/>
        <field name="north_sp" type="float" unit="rad"/>
        <field name="east_sp" type="float" unit="rad"/>
      </message>
      <message name="ALT_KALMAN" ID="41">
        <field name="p00" type="float"/>
        <field name="p01" type="float"/>
        <field name="p10" type="float"/>
        <field name="p11" type="float"/>
      </message>
      <message name="ESTIMATOR" ID="42">
        <field name="z" type="float" unit="m"/>
        <field name="z_dot" type="float" unit="m/s"/>
        <field name="range" type="float" unit="cm"/>
        <field name="range_dot" type="float" unit="cm"/>
        <field name="range_ave" type="float" unit="cm"/>
      </message>
      <message name="PPM" ID="100">
        <field name="values" type="uint16[]" unit="ticks"/>
      </message>
      <message name="RC" ID="101">
        <field name="values" type="int16[]" unit="pprz" format="%d"/>
      </message>
      <message name="COMMANDS" ID="102">
        <field name="values" type="int16[]" unit="ticks"/>
      </message>
      <message name="FBW_STATUS" ID="103">
        <field name="rc_status" type="uint8" values="OK|LOST|REALLY_LOST"/>
        <field name="mode" type="uint8" values="MANUAL|AUTO|FAILSAFE"/>
        <field name="vsupply" type="uint8" unit="decivolt"/>
      </message>
      <message name="ADC" ID="104">
        <field name="mcu" type="uint8" values="FBW|AP"/>
        <field name="values" type="uint16[]" unit="none"/>
      </message>
      <message name="ACTUATORS" ID="105">
        <field name="values" type="uint16[]" unit="none"/>
      </message>
      <message name="DEBUG16" ID="106">
        <field name="xxx" type="uint16" unit="none"/>
      </message>
      <message name="IMU_GYRO" ID="200">
        <field name="gx" type="float" unit="rad/s"/>
        <field name="gy" type="float" unit="rad/s"/>
        <field name="gz" type="float" unit="rad/s"/>
      </message>
      <message name="IMU_MAG" ID="201">
        <field name="ax" type="int16"/>
        <field name="ay" type="int16"/>
        <field name="az" type="int16"/>
      </message>
      <message name="IMU_ACCEL" ID="202">
        <field name="ax" type="float" unit="rad/s"/>
        <field name="ay" type="float" unit="rad/s"/>
        <field name="az" type="float" unit="rad/s"/>
      </message>
      <message name="AHRS_STATE" ID="203">
        <field name="q0" type="float"/>
        <field name="q1" type="float"/>
        <field name="q2" type="float"/>
        <field name="q3" type="float"/>
        <field name="bx" type="float"/>
        <field name="by" type="float"/>
        <field name="bz" type="float"/>
      </message>
      <message name="AHRS_COV" ID="204">
        <field name="p00" type="float"/>
        <field name="p11" type="float"/>
      </message>
      <message name="TIME" ID="206">
        <field name="t" type="uint32"/>
      </message>
      <message name="AHRS_OVERRUN" ID="207"/>
      <message name="ANTENNA_DEBUG" ID="220">
        <field name="mag_xraw" type="int32"/>
        <field name="mag_yraw" type="int32"/>
        <field name="mag_xcal" type="float"/>
        <field name="mag_ycal" type="float"/>
        <field name="mag_heading" type="float"/>
        <field name="mag_magnitude" type="float"/>
        <field name="mag_temp" type="float"/>
        <field name="mag_distor" type="uint8"/>
        <field name="mag_cal_status" type="uint8"/>
      </message>
      <message name="ANTENNA_STATUS" ID="221">
        <field name="azim_sp" type="float"/>
        <field name="elev_sp" type="float"/>
        <field name="id_sp" type="uint8"/>
        <field name="mode" type="uint8"/>
      </message>
      <message name="MOTOR_BENCH_STATUS" ID="230">
        <field name="time_ticks" type="uint32"/>
        <field name="time_s" type="uint16"/>
        <field name="throttle" type="uint16"/>
        <field name="mode" type="uint8"/>
      </message>
      <message name="SERVO" id="209">
        <field name="elev" type="int16" unit="%"/>
        <field name="ailer" type="int16" unit="%"/>
        <field name="thrust" type="int16" unit="%"/>
      </message>
      <message name="IR_DEBUG" id="210">
        <field name="ir1" type="int16" unit="ir"/>
        <field name="ir2" type="int16" unit="ir"/>
        <field name="ir3" type="int16" unit="ir"/>
        <field name="ir4" type="int16" unit="ir"/>
      </message>
      <message name="ACCEL_RATES" id="212">
        <field name="ax_adc" type="int16"/>
        <field name="ay_adc" type="int16"/>
        <field name="az_adc" type="int16"/>
        <field name="ax" type="float" unit="ms2"/>
        <field name="ay" type="float" unit="ms2"/>
        <field name="az" type="float" unit="ms2"/>
        <field name="axfil" type="float" unit="ms2"/>
        <field name="ayfil" type="float" unit="ms2"/>
        <field name="azfil" type="float" unit="ms2"/>
      </message>
      <message name="KALMAN_ROLL_PITCH" id="213">
        <field name="roll" type="float" unit="rad"/>
        <field name="pitch" type="float" unit="rad"/>
        <field name="KALMAN_Q_ANGLE" type="float" unit="err"/>
        <field name="KALMAN_Q_GYRO" type="float" unit="err"/>
        <field name="KALMAN_R_ANGLE" type="float" unit="err"/>
      </message>
    </class>
    <class name="datalink">
      <message name="ACINFO" ID="1">
        <field name="course" type="int16" unit="decideg"/>
        <field name="utm_east" type="int32" unit="cm"/>
        <field name="utm_north" type="int32" unit="cm"/>
        <field name="alt" type="int32" unit="cm"/>
        <field name="itow" type="uint32" unit="ms"/>
        <field name="speed" type="uint16" unit="cm/s"/>
        <field name="climb" type="int16" unit="cm/s"/>
        <field name="ac_id" type="uint8"/>
      </message>
      <message name="MOVE_WP" ID="2">
        <field name="wp_id" type="uint8"/>
        <field name="pad0" type="uint8"/>
        <field name="utm_east" type="int32" unit="cm"/>
        <field name="utm_north" type="int32" unit="cm"/>
        <field name="alt" type="int32" unit="cm"/>
      </message>
      <message name="WIND_INFO" ID="3">
        <field name="pad0" type="uint16"/>
        <field name="east" type="float" unit="m/s"/>
        <field name="north" type="float" unit="m/s"/>
      </message>
      <message name="SETTING" ID="4">
        <field name="index" type="uint8"/>
        <field name="pad0" type="uint8"/>
        <field name="value" type="float"/>
      </message>
      <message name="BLOCK" ID="5">
        <field name="block_id" type="uint8"/>
      </message>
      <message name="HITL_UBX" id="6">
        <field name="class" type="uint8"/>
        <field name="id" type="uint8"/>
        <field name="ubx_payload" type="uint8[]"/>
      </message>
      <message name="HITL_INFRARED" id="7">
        <field name="roll" type="int16"/>
        <field name="pitch" type="int16"/>
      </message>
      <message name="TELEMETRY_MODE" id="8">
        <field name="mode" type="uint8"/>
      </message>
      <message name="SET_ACTUATOR" id="100">
        <field name="value" type="uint16"/>
        <field name="no" type="uint8"/>
      </message>
    </class>
    <class name="ground">
      <message name="NEW_AIRCRAFT" ID="1">
        <field name="ac_id" type="string"/>
      </message>
      <message name="AIRCRAFT_DIE" ID="2">
        <field name="ac_id" type="string"/>
      </message>
      <message name="AIRCRAFTS" ID="3">
        <field name="ac_list" type="string" format="csv"/>
      </message>
      <message name="AIRCRAFTS_REQ" ID="4"/>
      <message name="SELECTED" ID="5">
        <field name="aircraft_id" type="string"/>
      </message>
      <message name="SELECTED_REQ" ID="6"/>
      <message name="WIND_CLEAR" ID="7">
        <field name="ac_id" type="string"/>
      </message>
      <message name="WIND" ID="8">
        <field name="ac_id" type="string"/>
        <field name="dir" type="float" unit="deg_wind"/>
        <field name="wspeed" type="float" unit="m/s"/>
        <field name="mean_aspeed" type="float" unit="m/s"/>
        <field name="stddev" type="float" unit="m/s"/>
      </message>
      <message name="CONFIG_REQ" ID="9">
        <field name="ac_id" type="string"/>
      </message>
      <message name="CONFIG" ID="10">
        <field name="ac_id" type="string"/>
        <field name="flight_plan" type="string" unit="url"/>
        <field name="airframe" type="string" unit="url"/>
        <field name="radio" type="string" unit="url"/>
        <field name="settings" type="string" unit="url"/>
        <field name="default_gui_color" type="string"/>
        <field name="ac_name" type="string"/>
      </message>
      <message name="FLIGHT_PARAM" ID="11">
        <field name="ac_id" type="string"/>
        <field name="roll" type="float" unit="deg"/>
        <field name="pitch" type="float" unit="deg"/>
        <field name="lat" type="float" unit="deg"/>
        <field name="long" type="float" unit="deg"/>
        <field name="speed" type="float" unit="m/s"/>
        <field name="course" type="float" unit="deg" format="%.1f"/>
        <field name="alt" type="float" unit="m"/>
        <field name="climb" type="float" unit="m/s"/>
        <field name="agl" type="float" unit="m"/>
      </message>
      <message name="AP_STATUS" ID="12">
        <field name="ac_id" type="string"/>
        <field name="ap_mode" type="string" values="MANUAL|AUTO1|AUTO2|HOME|FAILSAFE"/>
        <field name="lat_mode" type="string" values="MANUAL|ROLL_RATE|ROLL|COURSE"/>
        <field name="horiz_mode" type="string" values="WAYPOINT|ROUTE|CIRCLE"/>
        <field name="gaz_mode" type="string" values="MANUAL|THROTTLE|CLIMB|ALT"/>
        <field name="gps_mode" type="string" values="NOFIX|DRO|2D|3D|GPSDRO"/>
        <field name="kill_mode" type="string" values="OFF|ON"/>
        <field name="flight_time" type="uint32"/>
      </message>
      <message name="NAV_STATUS" ID="13">
        <field name="ac_id" type="string"/>
        <field name="cur_block" type="uint8"/>
        <field name="cur_stage" type="uint8"/>
        <field name="block_time" type="uint32"/>
        <field name="stage_time" type="uint32"/>
        <field name="target_lat" type="float" unit="deg"/>
        <field name="target_long" type="float" unit="deg"/>
        <field name="target_climb" type="float" unit="m/s"/>
        <field name="target_alt" type="float" unit="m"/>
        <field name="target_course" type="float" unit="deg"/>
      </message>
      <message name="CAM_STATUS" ID="14">
        <field name="ac_id" type="string"/>
        <field name="cam_lat" type="float" unit="deg"/>
        <field name="cam_long" type="float" unit="deg"/>
        <field name="cam_target_lat" type="float" unit="deg"/>
        <field name="cam_target_long" type="float" unit="deg"/>
      </message>
      <message name="ENGINE_STATUS" ID="15">
        <field name="ac_id" type="string"/>
        <field name="throttle" type="float" unit="%" format="%.1f"/>
        <field name="throttle_accu" type="float" format="%.1f"/>
        <field name="rpm" type="float" unit="rpm" format="%.1f"/>
        <field name="temp" type="float" unit="celcius"/>
        <field name="bat" type="float" unit="V"/>
        <field name="amp" type="float" unit="A"/>
        <field name="energy" type="uint16" unit="Wh"/>
      </message>
      <message name="SVSINFO" ID="16">
        <field name="ac_id" type="string"/>
        <field name="svid" type="string" format="csv"/>
        <field name="flags" type="string" format="csv"/>
        <field name="qi" type="string" format="csv" values="IDLE|SEARCH|SEARCH|UNUSABLE|CODELOCK|CARRIERLOCK|CARRIERLOCK|RECEIVING"/>
        <field name="cno" type="string" format="csv" unit="dbHz"/>
        <field name="elev" type="string" format="csv" unit="deg"/>
        <field name="azim" type="string" format="csv" unit="deg"/>
      </message>
      <message name="FLY_BY_WIRE" id="17">
        <field name="ac_id" type="string"/>
        <field name="rc_status" type="string" values="OK|LOST|REALLY_LOST"/>
        <field name="rc_mode" type="string" values="MANUAL|AUTO|FAILSAFE"/>
      </message>
      <message name="INFRARED" id="18">
        <field name="ac_id" type="string"/>
        <field name="gps_hybrid_mode" type="string" values="OFF|ON"/>
        <field name="gps_hybrid_factor" type="float"/>
        <field name="contrast_status" type="string" values="DEFAULT|WAITING|SET|SKIPPED"/>
        <field name="contrast_value" type="int16"/>
      </message>
      <message name="INFLIGH_CALIB" id="19">
        <field name="ac_id" type="string"/>
        <field name="if_mode" type="string" values="OFF|DOWN|UP"/>
        <field name="if_value1" type="float"/>
        <field name="if_value2" type="float"/>
      </message>
      <message name="WORLD_ENV" id="20">
        <field name="wind_east" type="float" unit="m/s" format="%.1f"/>
        <field name="wind_north" type="float" unit="m/s" format="%.1f"/>
        <field name="ir_contrast" type="float"/>
        <field name="time_scale" type="float"/>
        <field name="gps_availability" type="uint8" values="OFF|ON"/>
      </message>
      <message name="WORLD_ENV_REQ" id="21"/>
      <message name="CIRCLE_STATUS" ID="22">
        <field name="ac_id" type="string"/>
        <field name="circle_lat" type="float" unit="deg"/>
        <field name="circle_long" type="float" unit="deg"/>
        <field name="radius" type="int16" unit="m"/>
      </message>
      <message name="SEGMENT_STATUS" ID="23">
        <field name="ac_id" type="string"/>
        <field name="segment1_lat" type="float" unit="deg"/>
        <field name="segment1_long" type="float" unit="deg"/>
        <field name="segment2_lat" type="float" unit="deg"/>
        <field name="segment2_long" type="float" unit="deg"/>
      </message>
      <message name="MOVE_WAYPOINT" ID="24">
        <field name="ac_id" type="string"/>
        <field name="wp_id" type="uint8"/>
        <field name="lat" type="float" unit="deg"/>
        <field name="long" type="float" unit="deg"/>
        <field name="alt" type="float" unit="m"/>
      </message>
      <message name="DL_SETTING" ID="26">
        <field name="ac_id" type="string"/>
        <field name="index" type="uint8"/>
        <field name="value" type="float"/>
      </message>
      <message name="JUMP_TO_BLOCK" ID="27">
        <field name="ac_id" type="string"/>
        <field name="block_id" type="uint8"/>
      </message>
      <message name="DL_VALUES" ID="28">
        <field name="ac_id" type="string"/>
        <field name="values" type="string" format="csv"/>
      </message>
      <message name="RAW_DATALINK" ID="29">
        <field name="ac_id" type="string"/>
        <field name="message" type="string" format=";sv"/>
      </message>
      <message name="WAYPOINT_MOVED" id="30">
        <field name="ac_id" type="string"/>
        <field name="wp_id" type="uint8"/>
        <field name="lat" type="float" unit="deg"/>
        <field name="long" type="float" unit="deg"/>
        <field name="alt" type="float" unit="m"/>
      </message>
      <message name="SURVEY_STATUS" ID="31">
        <field name="ac_id" type="string"/>
        <field name="east_long" type="float" unit="deg"/>
        <field name="north_lat" type="float" unit="deg"/>
        <field name="west_long" type="float" unit="deg"/>
        <field name="south_lat" type="float" unit="deg"/>
      </message>
      <message name="TELEMETRY_STATUS" ID="32">
        <field name="ac_id" type="string"/>
        <field name="time_since_last_bat_msg" type="float" unit="s"/>
      </message>
      <message name="TELEMETRY_ERROR" ID="33">
        <field name="ac_id" type="string"/>
        <field name="message" type="string"/>
      </message>
      <message name="PLUMES" ID="100">
        <field name="ids" type="string" format="csv"/>
        <field name="lats" type="string" format="csv"/>
        <field name="longs" type="string" format="csv"/>
        <field name="values" type="string" format="csv"/>
      </message>
    </class>
    <class name="alert">
      <message name="BAT_LOW" ID="1">
        <field name="ac_id" type="string"/>
        <field name="level" type="string" values="CATASTROPHIC|CRITIC|WARNING"/>
        <field name="value" type="float"/>
      </message>
      <message name="AIR_PROX" ID="2">
        <field name="ac_id" type="string"/>
        <field name="level" type="string" values="CATASTROPHIC|CRITIC|WARNING"/>
      </message>
    </class>
  </protocol>
</configuration>